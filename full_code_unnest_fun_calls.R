list(list(<-, path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(library, 
        tidyr), list(library, dplyr), list(library, lubridate), 
    list(library, data.table), list(library, openxlsx), list(
        library, knitr), list(library, rmarkdown), list(library, 
        kableExtra), list(library, stringi), list(library, bit64), 
    list(library, ISOweek), list(library, lest), list(library, 
        parallel), list(library, fasttime), list(library, fst), 
    list(library, ggplot2), list(library, vroom), list(=, get_new_rattrapage, 
        list(function, NULL, list(list(=, t1, list(Sys.time)), 
            list(=, new_rattrapage, list(list(::, fst, read_fst), 
                "/data1/sidep_bases_clean/numID/p1p2dedupFromRattrapageV2.fst")), 
            list(=, new_rattrapage, list(data.table, new_rattrapage)), 
            list(print, list(nrow, new_rattrapage)), list(=, 
                mini_corres_files, list(list.files, "/data1/sidep_bases_clean/correspondance pseudos", 
                  T, "^[0-9]{4}_corresp_pseudos.csv$")), list(
                =, mini_rattrapage, list(rbindlist, list(list(
                  ::, pbapply, pblapply), mini_corres_files, 
                  fread, list(c, "Pseudo1", "Pseudo2")))), list(
                =, mini_rattrapage, list(unique, mini_rattrapage)), 
            list(=, fichier_du_jour, list(paste0, date_AAAAMMJJ, 
                "_corresp_pseudos.csv")), list(if, list(!, list(
                %in%, fichier_du_jour, list(basename, mini_corres_files))), 
                list(list(=, today_files_path, list(list.files, 
                  path_data, T, list(sprintf, "CSV_DREES_MED[24]_%s", 
                    date_AAMMJJ))), list(=, today_files, list(
                  rbindlist, list(lapply, today_files_path, fread, 
                    "", list(c, "Pseudo1", "Pseudo2"), F, "|", 
                    TRUE, "character", "Latin-1"))), list(=, 
                  mini_rattrapage, list(rbindlist, list(list, 
                    mini_rattrapage, today_files))))), list(=, 
                new_rattrapage, list(rbindlist, list(list, new_rattrapage, 
                  mini_rattrapage), T)), list(=, new_rattrapage, 
                list(unique, new_rattrapage)), list(=, t2, list(
                Sys.time)), list(print, list(difftime, t2, t1, 
                "mins")), list(print, list(nrow, new_rattrapage)), 
            list(=, doublonp2_to_p1, list([, list([, new_rattrapage, 
                new_rattrapage[, .(nb = .N), by = "Pseudo1"], 
                list(., .N), "Pseudo1"), list(>, nb, 1))), list(
                print, list(/, list(sum, list($, doublonp2_to_p1, 
                  nb)), list(nrow, new_rattrapage))), list(print, 
                list(/, list(nrow, doublonp2_to_p1), list(nrow, 
                  new_rattrapage))), list(=, new_rattrapage, 
                list([, new_rattrapage, new_rattrapage[, .SD[1], 
                  by = "Pseudo1"], list([, .SD, 1), "Pseudo1")), 
            list(print, list(nrow, new_rattrapage)), list(setnames, 
                new_rattrapage, "Pseudo1", "Pseudonyme"), list(
                print, list(nrow, new_rattrapage)), new_rattrapage), 
            list(70L, 22L, 105L, 1L, 22L, 1L, 70L, 105L))), list(
        =, t1, list(Sys.time)), list(=, new_rattrapage, list(
        get_new_rattrapage)), list(=, t2, list(Sys.time)), list(
        print, list(sprintf, "Le chargement du fichier de rattrapage a pris %s minutes.", 
            list(difftime, t2, t1, "mins"))), list(if, JP2_fromJm1P1, 
        list(list(print, "copy des fichiers P1 de la veille vers DEV"), 
            list(=, files_to_copy, list(list.files, "/data1/sidep_bases_clean/", 
                list(paste0, "^", Jm1))), list(=, one_file, list(
                sample, files_to_copy, 1)), list(for, one_file, 
                files_to_copy, list(list(print, one_file), list(
                  file.copy, list(paste0, "/data1/sidep_bases_clean/", 
                    one_file), list(paste0, "/data1/sidep_bases_clean/numID/", 
                    one_file), T))))), list(if, run_expertise, 
        list(list(render, list(paste0, path, "src/viz/expertise_donnees_du_jour_pcr_sero_ajout_pseudo2.Rmd"), 
            "word_document", list(paste0, path, "data/sorties/expertise/", 
                date_AAAAMMJJ, "_expertise_donnees_du_", list(
                  ifelse, list(==, tempo, "j"), "jour", "week-end"), 
                ".docx")))), list(print, "01 nettoyage SIDEP"), 
    list(=, safe_fread, list(list(::, purrr, quietly), list(::, 
        data.table, fread))), list(<-, prep_data, list(function, 
        list(jour_date, jour_prev_update, as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            "2020-05-20", as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = ))), 
        list(list(=, TIME_INIT, list(Sys.time)), list(print, 
            list(paste0, "lancement: ", TIME_INIT)), list(=, 
            date_AAAAMMJJ_last, list(format, last_update, "%Y%m%d")), 
            list(=, date_AAMMJJ_last, list(substr, date_AAAAMMJJ_last, 
                3, 8)), list(=, extractions, list(list.files, 
                path_data)), list(=, extractions, list(grep, 
                "CSV_DREES", extractions, T)), list(=, extractions, 
                list(grep, ".csv", extractions, T)), list(<-, 
                extractions_to_drop, list(%in%, extractions, 
                  list(c, "CSV_DREES_200518200002.csv", "CSV_DREES_200519090000.csv", 
                    "CSV_DREES_200520090000.csv", "CSV_DREES_200625130000.csv"))), 
            list(if, list(any, extractions_to_drop), list(list(
                <-, extractions, list([, extractions, list(-, 
                  list(which, extractions_to_drop)))))), list(
                <-, extractions, list([, extractions, list(!, 
                  list(grepl, "ini", extractions)))), list(=, 
                extractions, list(sort, extractions, T)), list(
                <-, list(names, extractions), list(substr, extractions, 
                  13, 16)), list(print, "Chargement des bases journalières à agréger"), 
            list(=, extract, list([, extractions, list(==, list(
                substr, extractions, 16, 21), date_AAMMJJ))), 
            list(<-, list(names, extract), list(substr, extract, 
                11, 14)), list(=, sidep_add_1, list(safe_fread, 
                list(paste0, path_data, list([, extract, "MED4")), 
                "", F, "|", TRUE, list(list, daily_files_char_vars, 
                  "Age"), "Latin-1")), list(print, list([, extract, 
                "MED4")), list(<-, w, list($, sidep_add_1, warnings)), 
            list(<-, w, list([, w, list(grepl, "^Stopped early", 
                w))), list(if, list(>, list(length, w), 0), list(
                list(stop, w))), list(<-, sidep_add_1, list($, 
                sidep_add_1, result)), list(=, sidep_add_2, list(
                safe_fread, list(paste0, path_data, list([, extract, 
                  "MED2")), "", F, "|", TRUE, list(list, daily_files_char_vars, 
                  "Age"), "Latin-1")), list(print, list([, extract, 
                "MED2")), list(<-, w, list($, sidep_add_2, warnings)), 
            list(<-, w, list([, w, list(grepl, "^Stopped early", 
                w))), list(if, list(>, list(length, w), 0), list(
                list(stop, w))), list(<-, sidep_add_2, list($, 
                sidep_add_2, result)), list(rm, w), list(=, sidep_add, 
                list(rbind, sidep_add_1, sidep_add_2)), list(
                rm, sidep_add_1, sidep_add_2), list(=, list($, 
                sidep_add, day_extract_sidep), list(as.Date, 
                date_AAAAMMJJ, "%Y%m%d")), list([, sidep_add, 
                list(!=, Pseudo2, ""), list(:=, Pseudo_diff, 
                  list(as.numeric, list(!=, Pseudo1, Pseudo2)))), 
            list(=, stockage_pseudo, list(copy, sidep_add)), 
            list([, stockage_pseudo, stockage_pseudo[, `:=`(Annee_prelev, 
                as.numeric(substr(DatePrelevement, 1, 4)))], 
                list(:=, Annee_prelev, list(as.numeric, list(
                  substr, DatePrelevement, 1, 4)))), list(=, 
                stockage_pseudo, list([, stockage_pseudo, stockage_pseudo[, 
                  c("Pseudo1", "Pseudo2", "Pseudo_diff", "Sexe", 
                    "Age", "Annee_prelev", "day_extract_sidep")], 
                  list(c, "Pseudo1", "Pseudo2", "Pseudo_diff", 
                    "Sexe", "Age", "Annee_prelev", "day_extract_sidep"))), 
            list(=, stockage_pseudo, list(unique, stockage_pseudo)), 
            list(list(::, data.table, fwrite), stockage_pseudo, 
                list(paste0, path_sortie, "correspondance pseudos/", 
                  date_AAAAMMJJ, "_corresp_pseudos.csv"), TRUE, 
                ".", FALSE, TRUE, ";", list(c, "escape"), "ISO", 
                TRUE), list(rm, stockage_pseudo), list(setnames, 
                sidep_add, "Pseudo2", "Pseudonyme"), list([, 
                sidep_add, sidep_add[, `:=`(Pseudo1, NULL)], 
                list(:=, Pseudo1, NULL)), list(print, "Suppression des antislash et .br"), 
            list([, sidep_add, sidep_add[, `:=`(Joker1, NULL)], 
                list(:=, Joker1, NULL)), list([, sidep_add, sidep_add[, 
                `:=`(Joker2, NULL)], list(:=, Joker2, NULL)), 
            list([, sidep_add, sidep_add[, `:=`(Joker3, NULL)], 
                list(:=, Joker3, NULL)), list(=, list($, sidep_add, 
                RPPSPrescripteur), list(list(::, stringr, str_extract), 
                list($, sidep_add, RPPSPrescripteur), "([0-9]{1,14})")), 
            list(=, list($, sidep_add, RPPSPrescripteur), list(
                as.integer64, list($, sidep_add, RPPSPrescripteur))), 
            list([, sidep_add, list(==, RPPSPrescripteur, 0), 
                list(:=, RPPSPrescripteur, NA)), list(=, list(
                $, sidep_add, CodePostal), list(gsub, "(\\\\)", 
                "", list($, sidep_add, CodePostal))), list(=, 
                list($, sidep_add, CodePostal), list(gsub, "(.br)", 
                  "", list($, sidep_add, CodePostal))), list(
                <-, nettoyage, list(function, list(as.pairlist(alist(temp = , element = )), 
                  as.pairlist(alist(temp = , element = ))), list(
                  list(for, i, list(colnames, temp), list(list(
                    print, i), list(print, list([, temp, list(
                    grep, element, list(get, i)), .N)), list(
                    if, list(>, list([, temp, list(grep, element, 
                      list(get, i)), .N), 0), list(list(<-, idx, 
                      list(grep, element, list([[, temp, i))), 
                      list([, temp, list(grep, element, list(
                        get, i)), list(:=, list(c, i), list(list, 
                        list(list(::, stringr, str_replace_all), 
                          list(get, i), element, "")))))))), 
                  list(return, temp)), list(224L, 16L, 235L, 
                  3L, 16L, 3L, 224L, 235L))), list(<-, sidep_add, 
                list(nettoyage, sidep_add, ";")), list(<-, sidep_add, 
                list(nettoyage, sidep_add, "\\\\")), list(<-, 
                sidep_add, list(nettoyage, sidep_add, "\"")), 
            list(=, list($, sidep_add, FINESS), list(list(::, 
                stringr, str_extract), list($, sidep_add, FINESS), 
                "([0-9AB]{1,15})")), list([, sidep_add, sidep_add[, 
                `:=`(FINESS, ifelse(FINESS == "" | nchar(FINESS) < 
                  8, NA, FINESS))], list(:=, FINESS, list(ifelse, 
                list(|, list(==, FINESS, ""), list(<, list(nchar, 
                  FINESS), 8)), NA, FINESS))), list(=, list($, 
                sidep_add, FINESSGeographique), list(list(::, 
                stringr, str_extract), list($, sidep_add, FINESSGeographique), 
                "([0-9AB]{1,15})")), list([, sidep_add, sidep_add[, 
                `:=`(FINESSGeographique, ifelse(FINESSGeographique == 
                  "" | nchar(FINESSGeographique) < 8, NA, FINESSGeographique))], 
                list(:=, FINESSGeographique, list(ifelse, list(
                  |, list(==, FINESSGeographique, ""), list(<, 
                    list(nchar, FINESSGeographique), 8)), NA, 
                  FINESSGeographique))), list([, sidep_add, sidep_add[, 
                `:=`(regCampagneDepistage, stringr::str_extract(NumCampagneDepistage, 
                  "^[A-Za-z]{3}"))], list(:=, regCampagneDepistage, 
                list(list(::, stringr, str_extract), NumCampagneDepistage, 
                  "^[A-Za-z]{3}"))), list(if, list(>, list([, 
                sidep_add, list(<, list(nchar, regCampagneDepistage), 
                  3), .N), 0), list(list(print, "Probleme: il y a des trigrammes dans NumCampagneDepistage qui ont moins de 3 caractères"))), 
            list([, sidep_add, sidep_add[, `:=`(regCampagneDepistage, 
                NULL)], list(:=, regCampagneDepistage, NULL)), 
            list(print, "Traitement des dates"), list([, sidep_add, 
                sidep_add[, `:=`(date_prelev, lubridate::ymd_hms(paste0(substr(DatePrelevement, 
                  1, 4), "-", substr(DatePrelevement, 5, 6), 
                  "-", substr(DatePrelevement, 7, 8), " ", substr(DatePrelevement, 
                    9, 10), ":", substr(DatePrelevement, 11, 
                    12), ":", substr(DatePrelevement, 13, 14))))], 
                list(:=, date_prelev, list(list(::, lubridate, 
                  ymd_hms), list(paste0, list(substr, DatePrelevement, 
                  1, 4), "-", list(substr, DatePrelevement, 5, 
                  6), "-", list(substr, DatePrelevement, 7, 8), 
                  " ", list(substr, DatePrelevement, 9, 10), 
                  ":", list(substr, DatePrelevement, 11, 12), 
                  ":", list(substr, DatePrelevement, 13, 14))))), 
            list([, sidep_add, sidep_add[, `:=`(day_prelev, as.Date(date_prelev))], 
                list(:=, day_prelev, list(as.Date, date_prelev))), 
            list([, sidep_add, sidep_add[, `:=`(date_valid, lubridate::ymd_hms(paste0(substr(DateValidationCR, 
                1, 4), "-", substr(DateValidationCR, 5, 6), "-", 
                substr(DateValidationCR, 7, 8), " ", substr(DateValidationCR, 
                  9, 10), ":", substr(DateValidationCR, 11, 12), 
                ":", substr(DateValidationCR, 13, 14))))], list(
                :=, date_valid, list(list(::, lubridate, ymd_hms), 
                  list(paste0, list(substr, DateValidationCR, 
                    1, 4), "-", list(substr, DateValidationCR, 
                    5, 6), "-", list(substr, DateValidationCR, 
                    7, 8), " ", list(substr, DateValidationCR, 
                    9, 10), ":", list(substr, DateValidationCR, 
                    11, 12), ":", list(substr, DateValidationCR, 
                    13, 14))))), list([, sidep_add, sidep_add[, 
                `:=`(day_valid, as.Date(date_valid))], list(:=, 
                day_valid, list(as.Date, date_valid))), list(
                if, list(!, list(is.na, day_init)), list(list(
                  =, sidep_add, list([, sidep_add, list(&, list(
                    >=, day_prelev, list(as.Date, day_init)), 
                    list(<=, day_prelev, date_dataset)))), list(
                  =, sidep_add, list([, sidep_add, list(|, list(
                    is.na, day_valid), list((, list(&, list(&, 
                    list(!, list(is.na, day_valid)), list(>=, 
                      day_valid, list(as.Date, day_init))), list(
                    <=, day_valid, date_dataset)))))))), list(
                =, sidep_add, list([, sidep_add, list(<=, day_prelev, 
                  day_extract_sidep))), list(print, "Pseudonymes"), 
            list(if, list(!=, list(sum, list(>, list(nchar, list(
                $, sidep_add, Pseudonyme), nchar(sidep_add$Pseudonyme, 
                )), 64), T), 0), list(list([, sidep_add, list(
                %in%, list(nchar, Pseudonyme), list(c, 128, 192)), 
                list(:=, Pseudonyme, list(substr, Pseudonyme, 
                  1, 64))))), list(=, pseudos_tests, list(c, 
                "78b14ef7c9ed19082b6d2d151678b8a74606f7dd33b811b3f97f41fe20793ea5", 
                "cf77f9f6fc3d4a40260af813aed7c3f80c274660aff9f978a99f98d29544be0c", 
                "e76950f02d9763a2533a4c6b0a3a0621e0dcfd3133c5fc3d1d0064b3324a3d50", 
                "ef9ecddf446243b60b9f15e8c7a521f79f21bfb2f95b0d6d54b4f3533f85a1d1", 
                "9fdcb52ac99ef7497ce75a543cf99afbb8c9af6f8dfd417f2a62b3dbca0ae23d", 
                "cd88cea5ff5a72eca228f63c9513492d45b5b78509e237ab55e0d787f896d747", 
                "c9d915880d6266a23ca95992a009a4491bbed5e3882fbd60b556a9df09dde4a0", 
                "aeaab01f88b19d53b7680a7fbc2a46fba31de13b2f60f75679ea2f971d8ce346", 
                "5161630ccba995deaa8d6ba5012ca521b0b245a9bd5e78658d6311ddffc0f8ec", 
                "4d07e44674b72d5c6ef58605058b671f0884394adf6535b194771325e709034f", 
                "a5c373e024776111dbb999506c28d41e4dca3011a41394493526bca3476136f0", 
                "9a4708216b2624f4461e6aa3b1181f03ecb3d4605d9d658ce6cc8fbf59a17557", 
                "8728ef871def06e09529733e60bebdde00e559a05da5bcf0b91cb13a67374564", 
                "2153039929b6bd83dd502e01d41cd4319e9674c8dedbe28d3d625e0102c5a450", 
                "03b8e61d5548edc7a9490ed86d2fbfcd8edc4746489e8543fdff64d5527e8ed8", 
                "efdaf8f12656c9b015c3410c4a8879b3c07c7b121493f5c2617df8d0db6b17ef", 
                "3563fc0e12e0e2187c0e1117849bcbc849c60afef9f807cc54b90a7e3e6bd818", 
                "4b1081eadac91e9bc974ac8cb2dd437e31dca5d2e88e086d5f68fdffa2efb0a2", 
                "2fed8eadd4765b47d5d034b1624ffc19f9f1a8dd6853887597039952d87489be", 
                "2b90416ea89cd21fe3ae4eb90ac3d8158afe87f4dc6ef43c257a37e857787107", 
                "68d80449eb5960e1912a1043ee6f388fc75417d87e246e4402538d1ad577ef6a", 
                "23c3e79e45865410393b5520d9841854427f435f272ddd32d365bb73af5570c2", 
                "5fb63a89cb4a0108ba7e4b5cea5b8a7cad48c64aa24c000f0d7cb49dddf26f43", 
                "7b7fbf4ff01a5920ea08159889b6d1a9ff03f1d26a50d30cd3b142a68e633079", 
                "3bc66709adac0bac1158bbdf7500eda1c370ef0132c65b861856ea677c405470")), 
            list(=, sidep_add, list([, sidep_add, list(!, list(
                (, list(%in%, Pseudonyme, pseudos_tests))))), 
            list(print, "AnalyseConclusion"), list(=, sidep_add, 
                list([, sidep_add, list(%in%, AnalyseConclusion, 
                  list(c, "94500-6", "94762-2", "94563-4", "94564-2", 
                    "94309-2", "94845-5")))), list(print, "Doublons parfaits extractions"), 
            list(=, etapes, list(cbind, "aucune", list(nrow, 
                sidep_add))), list(<-, sidep_add, list(unique, 
                sidep_add)), list(=, etapes, list(rbind, etapes, 
                list(cbind, "Duplicates_all_lines", list(nrow, 
                  sidep_add)))), list(print, "Premiers symptômes"), 
            list([, sidep_add, list(%in%, PremierSymptomes, list(
                c, "", "UU", "u", "non précisé", "Non communiqué", 
                "NON RENSEIGNE", "non renseignÃ©", "nrens", "PAS RENSEIGNE", 
                "NR", "Non renseigné", "NON PRECISE", "Non précisé", 
                "non renseignée", "NRENS", "np", "NCNR", "NRE", 
                "NSP", "NP", "NM", "V", "ne sais pas", "non fait", 
                "VOIR PRESCRIPTION JOINTE", "NPC", "INC", "BILAN PREOP", 
                "?", "nc", "nr", "0.000000", "0R", "GAPS2", "Demande annulée", 
                "Non communiqué", "NCNR2")), list(:=, PremierSymptomes, 
                "U")), list([, sidep_add, list(%in%, PremierSymptomes, 
                list(c, "PAS DE SYMPTOME", "a", "Asymptomatique.", 
                  "AUCUN SYMPTOME", "asy", "APSYU", "ASy", "ASYM", 
                  "A", "ASYASY", "ASYM ", "ASYU", "PASYM", "UASY", 
                  "avant entrée en EHPAD", "avant retour en EHPAD", 
                  "entrée de geriatrie", "entree en geriatrie", 
                  "avant rentrée en ehpad", "AVANT TRANSFERT EHPAD", 
                  "BILAN PRE OP", "TEST PRE OP", "TRANSFERT EN  EHPAD", 
                  "Transfert SSR-P")), list(:=, PremierSymptomes, 
                "ASY")), list([, sidep_add, list(grepl, "(Pas de symptomes)|(ASYV)|(VASY)|(Pré opératoire)|(PAS DE SYMPTOMES)|(PRE-OPERATOIRE)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "ASY")), list([, sidep_add, list(grepl, "(apparus le jour ou la veille)|(D1)|(S01S01)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "S01")), list([, sidep_add, list(grepl, "(apparus 2,3)|(apparus 2, 3)|(D2)|(D3)|(quelques jours)|(Quelques jours)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "S24")), list([, sidep_add, list(%in%, PremierSymptomes, 
                list(c, "05/05/20")), list(:=, PremierSymptomes, 
                "S57")), list([, sidep_add, list(grepl, "(apparus 5,6)|(apparus 5, 6)|(D5)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "S57")), list([, sidep_add, list(grepl, "(SS2SS2)|(D9)|(D11)|(S814)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SS2")), list([, sidep_add, list(grepl, "(apparus entre 8 et 15 jours)|(apparus entre 8 et 14 jours)|(S814)|(ss2)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SS2")), list([, sidep_add, list(grepl, "(apparus plus de 2 semaines)|(apparus plus de deux semaines)|(+ 15 jours)|(>j15)|(SS34)|(SS3SS3)|(S2-S4)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SS3")), list([, sidep_add, list(grepl, "(apparus plus de deux semaines avant le prelevement)|(apparus entre 15 et 28 jours)|(SS3U)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SS3")), list([, sidep_add, list(grepl, "(il y a 1 mois)|(plus de 3 semaines)|(DECEMBRE 19)|(plus de quatre semaines)|(D29)|(SP4S)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SS3")), list([, sidep_add, list(grepl, "(Eruption cutanée)|(colique)|(30/05/20)|(07/06/20)|(202005)|(202006)", 
                PremierSymptomes), list(:=, PremierSymptomes, 
                "SNA")), list(print, "TypologiePatient"), list(
                [, sidep_add, list(==, TypologiePatient, ""), 
                list(:=, TypologiePatient, "U")), list([, sidep_add, 
                list(%in%, TypologiePatient, list(c, "Autre structure d'hébergement collectif", 
                  "Autre structure d'hébergement", "autre structure d'hébergement collectif")), 
                list(:=, TypologiePatient, "A")), list([, sidep_add, 
                list(%in%, TypologiePatient, list(c, "résident en EHPAD", 
                  "Résident en EHPAD")), list(:=, TypologiePatient, 
                  "E")), list([, sidep_add, list(%in%, TypologiePatient, 
                list(c, "HH")), list(:=, TypologiePatient, "H")), 
            list([, sidep_add, list(%in%, TypologiePatient, list(
                c, "II", "i")), list(:=, TypologiePatient, "H")), 
            list([, sidep_add, list(!, list(%in%, TypologiePatient, 
                list(c, "I", "H", "E", "C", "A", "U"))), list(
                :=, TypologiePatient, "U")), list(print, "Resultat"), 
            list([, sidep_add, list(%in%, Resultat, list(c, "negatif", 
                "NEGATIF", "Négative", "N?gatif", "NN", "NNN", 
                "NEG", "n")), list(:=, Resultat, "N")), list(
                [, sidep_add, list(grepl, "(ninterp)|(ndéterminé)", 
                  Resultat), list(:=, Resultat, "I")), list([, 
                sidep_add, list(%in%, Resultat, list(c, "PP")), 
                list(:=, Resultat, "P")), list([, sidep_add, 
                list(==, Resultat, "N"), list(:=, valeur, "N")), 
            list([, sidep_add, list(==, Resultat, "P"), list(
                :=, valeur, "P")), list([, sidep_add, list(==, 
                Resultat, "I"), list(:=, valeur, "I")), list(
                [, sidep_add, list(==, Resultat, "X"), list(:=, 
                  valeur, "X")), list(print, "Doublons dans les dernières extractions"), 
            list([, sidep_add, sidep_add[, `:=`(na_res, ifelse(Resultat %in% 
                c("", "X", "I") | is.na(Resultat) | nchar(Resultat) > 
                1, 1, 0))], list(:=, na_res, list(ifelse, list(
                |, list(|, list(%in%, Resultat, list(c, "", "X", 
                  "I")), list(is.na, Resultat)), list(>, list(
                  nchar, Resultat), 1)), 1, 0))), list([, sidep_add, 
                sidep_add[, `:=`(na_typo, ifelse(TypologiePatient == 
                  "U" | is.na(TypologiePatient), 1, 0))], list(
                  :=, na_typo, list(ifelse, list(|, list(==, 
                    TypologiePatient, "U"), list(is.na, TypologiePatient)), 
                    1, 0))), list([, sidep_add, sidep_add[, `:=`(na_cp, 
                ifelse(CodePostal == "" | is.na(CodePostal) | 
                  nchar(CodePostal) != 5, 1, 0))], list(:=, na_cp, 
                list(ifelse, list(|, list(|, list(==, CodePostal, 
                  ""), list(is.na, CodePostal)), list(!=, list(
                  nchar, CodePostal), 5)), 1, 0))), list([, sidep_add, 
                sidep_add[, `:=`(na_sympto, ifelse(PremierSymptomes == 
                  "" | is.na(PremierSymptomes) | nchar(PremierSymptomes) == 
                  "U", 1, 0))], list(:=, na_sympto, list(ifelse, 
                  list(|, list(|, list(==, PremierSymptomes, 
                    ""), list(is.na, PremierSymptomes)), list(
                    ==, list(nchar, PremierSymptomes), "U")), 
                  1, 0))), list(=, sidep_add, list([, sidep_add, 
                sidep_add[, `:=`(date_valid_init = min(date_valid), 
                  latest_day_extract = max(day_extract_sidep), 
                  res_ok = min(na_res), typo_ok = min(na_typo), 
                  cp_ok = min(na_cp), sympto_ok = min(na_sympto)), 
                  by = .(Pseudonyme, date_prelev, AnalyseConclusion)], 
                list(:=, list(min, date_valid), list(max, day_extract_sidep), 
                  list(min, na_res), list(min, na_typo), list(
                    min, na_cp), list(min, na_sympto)), list(
                  ., Pseudonyme, date_prelev, AnalyseConclusion))), 
            list(<-, sidep_add, list([, sidep_add, list(%in%, 
                day_extract_sidep, latest_day_extract))), list(
                =, etapes, list(rbind, etapes, list(cbind, "latest_extract", 
                  list(nrow, sidep_add)))), list(<-, sidep_add, 
                list([, sidep_add, list(==, na_res, res_ok))), 
            list(=, etapes, list(rbind, etapes, list(cbind, "Resultat", 
                list(nrow, sidep_add)))), list(<-, sidep_add, 
                list([, sidep_add, list(==, na_typo, typo_ok))), 
            list(=, etapes, list(rbind, etapes, list(cbind, "TypologiePatient", 
                list(nrow, sidep_add)))), list(<-, sidep_add, 
                list([, sidep_add, list(==, na_cp, cp_ok))), 
            list(=, etapes, list(rbind, etapes, list(cbind, "CodePostal", 
                list(nrow, sidep_add)))), list(<-, sidep_add, 
                list([, sidep_add, list(==, na_sympto, sympto_ok))), 
            list(=, etapes, list(rbind, etapes, list(cbind, "PremierSymptomes", 
                list(nrow, sidep_add)))), list([, sidep_add, 
                sidep_add[, `:=`(date_valid, date_valid_init)], 
                list(:=, date_valid, date_valid_init)), list(
                =, sidep_add, list([, sidep_add, sidep_add[, 
                  -c("latest_day_extract", "na_res", "res_ok", 
                    "na_typo", "typo_ok", "na_cp", "cp_ok", "na_sympto", 
                    "sympto_ok")], list(-, list(c, "latest_day_extract", 
                  "na_res", "res_ok", "na_typo", "typo_ok", "na_cp", 
                  "cp_ok", "na_sympto", "sympto_ok")))), list(
                =, sidep_add, list([, sidep_add, sidep_add[, 
                  .SD[1], by = c("Pseudonyme", "date_prelev", 
                    "AnalyseConclusion")], list([, .SD, 1), list(
                  c, "Pseudonyme", "date_prelev", "AnalyseConclusion"))), 
            list(=, etapes, list(rbind, etapes, list(cbind, "dup_tryptique", 
                list(nrow, sidep_add)))), list(=, etapes, list(
                data.table, etapes)), list([, etapes, etapes[, 
                `:=`(n_supp, 0)], list(:=, n_supp, 0)), list(
                [, etapes, etapes[, `:=`(n_row, as.numeric(n_row))], 
                list(:=, n_row, list(as.numeric, n_row))), list(
                for, i, list(:, 2, list(nrow, etapes)), list(
                  list(=, list([, list($, etapes, n_supp), i), 
                    list(-, list([, list($, etapes, n_row), list(
                      -, i, 1)), list([, list($, etapes, n_row), 
                      i))))), list(<<-, etapes, etapes), list(
                print, "Finess"), list(=, matching_fi, list(function, 
                list(as.pairlist(alist(data_sidep = ))), list(
                  list(setnames, data_sidep, "FINESS", "fi_init"), 
                  list(load, list(paste0, path, "data/utils/finess_1116.Rdata")), 
                  list(<-, liste_et, list(%>%, liste_et, list(
                    select, ET-Département
Code, EJ-N°FINESS, 
                    EJ-Département
Code, ET-N°FINESS))), list(
                    <-, sidep_geo, list(inner_join, data_sidep, 
                      list(%>%, liste_et, list(select, FINESS_ET, 
                        DEP_ET, FINESS_EJ, DEP_EJ)), "fi_init")), 
                  list(<-, list($, sidep_geo, FINESS_ET), list(
                    $, sidep_geo, fi_init)), list(<-, sidep_ju, 
                    list(inner_join, data_sidep, list(%>%, list(
                      %>%, list(%>%, list(%>%, list(as_tibble, 
                        liste_et), list(select, FINESS_EJ, DEP_EJ)), 
                        list(group_by, fi_init)), list(slice, 
                        1)), list(ungroup)), "fi_init")), list(
                    <-, list($, sidep_ju, FINESS_EJ), list($, 
                      sidep_ju, fi_init)), list(<-, sidep_ok, 
                    list(rbindlist, list(list, sidep_geo, sidep_ju), 
                      T)), list(<-, data_sidep, list(merge, data_sidep, 
                    list(unique, list([, sidep_ok, sidep_ok[, 
                      .(fi_init, FINESS_ET, DEP_ET, FINESS_EJ, 
                        DEP_EJ)], list(., fi_init, FINESS_ET, 
                      DEP_ET, FINESS_EJ, DEP_EJ))), "fi_init", 
                    "fi_init", T)), list(<-, bio3_et, list(list(
                    ::, readxl, read_excel), list(paste0, path, 
                    "data/utils/bio3_et_1116.xlsx"))), list(<-, 
                    data_sidep, list(left_join, data_sidep, list(
                      %>%, list(%>%, list(%>%, list(%>%, bio3_et, 
                        list(group_by, FINESS_EJ)), list(slice, 
                        1)), list(ungroup)), list(select, FINESS_EJ, 
                        cat_etb)), "FINESS_EJ")), list(<-, list(
                    $, data_sidep, cat_pp), list(ifelse, list(
                    %in%, list($, data_sidep, cat_etb), list(
                      c, "2000", "3000")), "privé", NA)), list(
                    <-, list($, data_sidep, cat_pp), list(ifelse, 
                      list(==, list($, data_sidep, cat_etb), 
                        "1000"), "public", list($, data_sidep, 
                        cat_pp))), list(table, list($, data_sidep, 
                    cat_pp), NULL), list(=, data_sidep, list(
                    data.table, data_sidep)), list(remove, sidep_ok, 
                    sidep_ju, sidep_geo), list([, data_sidep, 
                    list(is.na, DEP_EJ), list(:=, DEP_EJ, "dep_inconnu")), 
                  list([, data_sidep, list(is.na, DEP_ET), list(
                    :=, DEP_ET, "dep_inconnu")), list(=, reg_dep, 
                    list(list(::, data.table, fread), list(paste0, 
                      path, "data/utils/departement2019.csv"))), 
                  list(=, list($, reg_dep, reg), list(as.character, 
                    list($, reg_dep, reg))), list([, reg_dep, 
                    list(==, list(nchar, reg), 1), list(:=, reg, 
                      list(paste0, "0", reg))), list(=, ej_et_dep, 
                    list(data.table, list([, liste_et, liste_et[, 
                      c("FINESS_ET", "DEP_ET", "FINESS_EJ", "DEP_EJ")], 
                      list(c, "FINESS_ET", "DEP_ET", "FINESS_EJ", 
                        "DEP_EJ")))), list(=, ej_et_dep, list(
                    merge, ej_et_dep, list([, reg_dep, reg_dep[, 
                      .(dep, reg)], list(., dep, reg)), "DEP_ET", 
                    "dep", T)), list(setnames, ej_et_dep, "reg", 
                    "REG_ET"), list(=, ej_et_dep, list(merge, 
                    ej_et_dep, list([, reg_dep, reg_dep[, .(dep, 
                      reg)], list(., dep, reg)), "DEP_EJ", "dep", 
                    T)), list(setnames, ej_et_dep, "reg", "REG_EJ"), 
                  list(=, nb_dep_par_ej, list([, ej_et_dep, ej_et_dep[, 
                    .(n_distinct(DEP_ET)), by = .(FINESS_EJ)], 
                    list(., list(n_distinct, DEP_ET)), list(., 
                      FINESS_EJ))), list(/, list(sum, list(==, 
                    list($, nb_dep_par_ej, V1), 1)), list(length, 
                    list(unique, list($, ej_et_dep, FINESS_EJ)))), 
                  list(=, ej_et_same_dep, list([, ej_et_dep, 
                    list(%in%, FINESS_EJ, list([, list($, nb_dep_par_ej, 
                      FINESS_EJ), list(==, list($, nb_dep_par_ej, 
                      V1), 1))))), list(=, ej_et_same_dep, list(
                    [, ej_et_same_dep, list(==, DEP_ET, DEP_EJ))), 
                  list(=, ej_et_same_dep, list(unique, list([, 
                    ej_et_same_dep, ej_et_same_dep[, .(FINESS_EJ, 
                      DEP_EJ)], list(., FINESS_EJ, DEP_EJ)))), 
                  list(=, nb_reg_par_ej, list([, ej_et_dep, ej_et_dep[, 
                    .(n_distinct(REG_ET)), by = .(FINESS_EJ)], 
                    list(., list(n_distinct, REG_ET)), list(., 
                      FINESS_EJ))), list(/, list(sum, list(==, 
                    list($, nb_reg_par_ej, V1), 1)), list(length, 
                    list(unique, list($, ej_et_dep, FINESS_EJ)))), 
                  list(=, ej_et_same_reg, list([, ej_et_dep, 
                    list(%in%, FINESS_EJ, list([, list($, nb_reg_par_ej, 
                      FINESS_EJ), list(==, list($, nb_reg_par_ej, 
                      V1), 1))))), list(=, ej_et_same_reg, list(
                    [, ej_et_same_reg, list(==, REG_ET, REG_EJ))), 
                  list(=, ej_et_same_reg, list(unique, list([, 
                    ej_et_same_reg, ej_et_same_reg[, .(FINESS_EJ, 
                      REG_EJ)], list(., FINESS_EJ, REG_EJ)))), 
                  list(<<-, ej_et_same_dep, ej_et_same_dep), 
                  list(<<-, ej_et_same_reg, ej_et_same_reg), 
                  list([, data_sidep, data_sidep[, `:=`(cat_pp, 
                    iconv(cat_pp, from = "UTF-8", to = "latin1"))], 
                    list(:=, cat_pp, list(iconv, cat_pp, "UTF-8", 
                      "latin1"))), list(return, data_sidep)), 
                list(444L, 15L, 511L, 1L, 15L, 1L, 444L, 511L))), 
            list(=, sidep_add, list(matching_fi, sidep_add)), 
            list(print, "Code postal, département et région"), 
            list([, sidep_add, list(%in%, list(substr, CodePostal, 
                1, 2), list(c, "00", "99", "XX")), list(:=, CodePostal, 
                NA)), list([, sidep_add, list(%in%, CodePostal, 
                list(c, "", "0", ".", ",", "aucun", "AUCUN")), 
                list(:=, CodePostal, NA)), list([, sidep_add, 
                list(==, CodePostal, "=59111"), list(:=, CodePostal, 
                  "59111")), list([, sidep_add, list(==, CodePostal, 
                ":78360"), list(:=, CodePostal, "78360")), list(
                [, sidep_add, list(==, CodePostal, "=35420"), 
                list(:=, CodePostal, "35420")), list([, sidep_add, 
                sidep_add[, `:=`(code_dep, case_when(substr(CodePostal, 
                  1, 3) %in% c("201", "200", "207") ~ "2A", substr(CodePostal, 
                  1, 3) %in% c("202", "206") ~ "2B", substr(CodePostal, 
                  1, 2) == "97" ~ substr(CodePostal, 1, 3), !substr(CodePostal, 
                  1, 2) %in% c("97", "20") ~ substr(CodePostal, 
                  1, 2)))], list(:=, code_dep, list(case_when, 
                  list(~, list(%in%, list(substr, CodePostal, 
                    1, 3), list(c, "201", "200", "207")), "2A"), 
                  list(~, list(%in%, list(substr, CodePostal, 
                    1, 3), list(c, "202", "206")), "2B"), list(
                    ~, list(==, list(substr, CodePostal, 1, 2), 
                      "97"), list(substr, CodePostal, 1, 3)), 
                  list(~, list(!, list(%in%, list(substr, CodePostal, 
                    1, 2), list(c, "97", "20"))), list(substr, 
                    CodePostal, 1, 2))))), list(=, corr_CP, list(
                data.table, list(read.xlsx, list(paste0, path, 
                  "data/utils/0618_corresp_CP.xlsx")))), list(
                =, corr_CP, list([, corr_CP, list(&, list(!, 
                  list(is.na, code_dep_corr)), list(!=, code_dep_corr, 
                  "")))), list(=, sidep_add, list(merge, sidep_add, 
                corr_CP, "CodePostal", T)), list([, sidep_add, 
                sidep_add[, `:=`(code_dep, ifelse(!is.na(code_dep_corr), 
                  code_dep_corr, code_dep))], list(:=, code_dep, 
                  list(ifelse, list(!, list(is.na, code_dep_corr)), 
                    code_dep_corr, code_dep))), list(=, reg_dep, 
                list(list(::, data.table, fread), list(paste0, 
                  path, "data/utils/departement2019.csv"), "Latin-1")), 
            list(=, list($, reg_dep, reg), list(as.character, 
                list($, reg_dep, reg))), list([, reg_dep, list(
                ==, list(nchar, reg), 1), list(:=, reg, list(
                paste0, "0", reg))), list(=, reg2019, list(list(
                ::, data.table, fread), list(paste0, path, "data/utils/region2019.csv"), 
                "Latin-1")), list(=, list($, reg2019, reg), list(
                as.character, list($, reg2019, reg))), list([, 
                reg2019, list(==, list(nchar, reg), 1), list(
                  :=, reg, list(paste0, "0", reg))), list([, 
                sidep_add, list(!, list(%in%, code_dep, list(
                  $, reg_dep, dep))), list(:=, code_dep, "dep_inconnu")), 
            list([, sidep_add, list(&, list(&, list(==, code_dep, 
                "dep_inconnu"), list(!, list(is.na, IRIS))), 
                list(==, list(nchar, IRIS), 9)), list(:=, code_dep, 
                list(substr, IRIS, 1, 2))), list([, sidep_add, 
                sidep_add[, `:=`(departement, ifelse(code_dep != 
                  "dep_inconnu", code_dep, ifelse(RPPSPrescripteur != 
                  "291991222", DEP_ET, "dep_inconnu")))], list(
                  :=, departement, list(ifelse, list(!=, code_dep, 
                    "dep_inconnu"), code_dep, list(ifelse, list(
                    !=, RPPSPrescripteur, "291991222"), DEP_ET, 
                    "dep_inconnu")))), list([, sidep_add, list(
                &, list(%in%, FINESS_EJ, list($, ej_et_same_dep, 
                  FINESS_EJ)), list(!=, RPPSPrescripteur, "291991222")), 
                list(:=, departement, list(ifelse, list(!=, departement, 
                  "dep_inconnu"), departement, DEP_EJ))), list(
                =, sidep_add, list(merge, sidep_add, list([, 
                  reg_dep, reg_dep[, .(dep, reg, ncc)], list(
                    ., dep, reg, ncc)), "departement", "dep", 
                  T)), list([, sidep_add, list(!, list(%in%, 
                reg, list($, reg_dep, reg))), list(:=, reg, "reg_inconnue")), 
            list(setnames, sidep_add, "ncc", "nom_dep"), list(
                =, sidep_add, list(merge, sidep_add, list([, 
                  ej_et_same_reg, ej_et_same_reg[, .(FINESS_EJ, 
                    REG_EJ)], list(., FINESS_EJ, REG_EJ)), "FINESS_EJ", 
                  T)), list([, sidep_add, list(%in%, FINESS_EJ, 
                list($, ej_et_same_reg, FINESS_EJ)), list(:=, 
                reg, list(ifelse, list(!=, reg, "reg_inconnue"), 
                  reg, REG_EJ))), list(=, sidep_add, list([, 
                sidep_add, sidep_add[, -c("REG_EJ")], list(-, 
                  list(c, "REG_EJ")))), list(=, sidep_add, list(
                merge, sidep_add, list([, reg2019, reg2019[, 
                  .(reg, libelle3)], list(., reg, libelle3)), 
                "reg", T)), list(setnames, sidep_add, "libelle3", 
                "nom_reg"), list(=, sidep_add, list([, sidep_add, 
                sidep_add[, -c("code_dep", "code_dep_corr")], 
                list(-, list(c, "code_dep", "code_dep_corr")))), 
            list(print, "Professionnel de santé et sexe"), list(
                [, sidep_add, list(%in%, ProfessionelSante, list(
                  c, "", "UU", ".U", "u", "Non communiqué", "non fait", 
                  "nr", "Non précisé", "np", "NP", "NCDD", "NM", 
                  "NO", "UN", "NR", "NCNR", "NCNR2", "Demande annulée", 
                  "Automatique")), list(:=, ProfessionelSante, 
                  "U")), list([, sidep_add, list(%in%, ProfessionelSante, 
                list(c, "n", "NN")), list(:=, ProfessionelSante, 
                "N")), list([, sidep_add, list(%in%, ProfessionelSante, 
                list(c, "OO", "o")), list(:=, ProfessionelSante, 
                "O")), list([, sidep_add, list(!, list((, list(
                %in%, ProfessionelSante, list(c, "U", "O", "N")))), 
                list(:=, ProfessionelSante, "U")), list([, sidep_add, 
                list(%in%, Sexe, list(c, "O", "", "N", "A")), 
                list(:=, Sexe, "U")), list(print, "Traitement des bases journalières terminé"), 
            list(=, sidep_add, list([, sidep_add, sidep_add[, 
                -c("DatePrelevement", "DateValidationCR", "DEP_EJ", 
                  "DEP_ET", "NumDossier")], list(-, list(c, "DatePrelevement", 
                "DateValidationCR", "DEP_EJ", "DEP_ET", "NumDossier")))), 
            list(print, "Chargement des bases agrégées"), list(
                <-, t1, list(Sys.time)), list(<-, temp, list(
                paste0, path_sortie, date_AAAAMMJJ_last, "_sidep_pcr_")), 
            list(<-, temp_mois, MoisAAAA), list(if, list(!, list(
                file.exists, list(paste0, temp, "Mai021.csv"))), 
                list(list(<-, temp_mois, list([, MoisAAAA, list(
                  :, 1, list((, list(-, list(length, MoisAAAA), 
                    1))))))), list(<-, sidep_prev_pcr_lst, list(
                list(::, pbapply, pblapply), temp_mois, list(
                  function, list(as.pairlist(alist(i = ))), list(
                    list(<-, dt, list(list(::, data.table, fread), 
                      list(paste0, temp, i, ".csv"), "", list(
                        list, date_vars, posixct_vars, char_vars, 
                        "Age"), F, ";", TRUE, "Latin-1")), list(
                      if, addP2, list(list(=, n, list(nrow, list(
                        merge, dt, corres, "Pseudonyme"))), list(
                        print, list(sprintf, "%s lignes parmi %s ont eu un p1 remplacé par p2 dans le fichier %s.", 
                          n, list(nrow, dt), i)), list([, dt, 
                        corres, list(:=, Pseudonyme, i.Pseudo2), 
                        "Pseudonyme"))), dt), list(592L, 45L, 
                    606L, 45L, 45L, 45L, 592L, 606L)))), list(
                <-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(print, list(-, t2, TIME_INIT)), 
            list(<-, t1, list(Sys.time)), list(=, path_zip_sero, 
                list(paste0, path_sortie, date_AAAAMMJJ_last, 
                  "_sidep_sero.csv")), list(print, path_zip_sero), 
            list(=, sidep_prev_sero, list(list(::, data.table, 
                fread), path_zip_sero, "", list(list, date_vars, 
                posixct_vars, char_vars, "Age"), F, ";", TRUE, 
                "Latin-1")), list(if, addP2, list(list([, sidep_prev_sero, 
                corres, list(:=, Pseudonyme, i.Pseudo2), "Pseudonyme"))), 
            list(<-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(<-, t1, list(Sys.time)), list(
                =, path_zip_pcr_sal_mil, list(paste0, path_sortie, 
                  date_AAAAMMJJ_last, "_sidep_pcr_salivaire_milieux_divers.csv")), 
            list(print, path_zip_pcr_sal_mil), list(=, sidep_prev_pcr_sal_mil, 
                list(list(::, data.table, fread), path_zip_pcr_sal_mil, 
                  "", list(list, date_vars, posixct_vars, char_vars, 
                    "Age"), F, ";", TRUE, "Latin-1")), list(if, 
                addP2, list(list([, sidep_prev_pcr_sal_mil, corres, 
                  list(:=, Pseudonyme, i.Pseudo2), "Pseudonyme"))), 
            list(<-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(print, "Concaténation des bases en liste par mois"), 
            list([, sidep_add, sidep_add[, `:=`(RPPSPrescripteur = as.character(RPPSPrescripteur))], 
                list(:=, list(as.character, RPPSPrescripteur))), 
            list(<-, t1, list(Sys.time)), list(<-, sidep_prev_pcr_lst, 
                list(lapply, sidep_prev_pcr_lst, list(function, 
                  list(as.pairlist(alist(i = ))), list([, i, 
                    i[, `:=`(date_prelev = fasttime::fastPOSIXct(date_prelev), 
                      date_valid = fasttime::fastPOSIXct(date_valid), 
                      date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                      Age = as.numeric(Age))], list(:=, list(
                      list(::, fasttime, fastPOSIXct), date_prelev), 
                      list(list(::, fasttime, fastPOSIXct), date_valid), 
                      list(list(::, fasttime, fastPOSIXct), date_valid_init), 
                      list(as.numeric, Age))), list(651L, 52L, 
                    655L, 35L, 52L, 35L, 651L, 655L)))), list(
                <-, sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(date_valid = NULL)], 
                      list(:=, NULL)), list(656L, 52L, 657L, 
                      31L, 52L, 31L, 656L, 657L)))), list(<-, 
                sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(date_valid = date_valid_init)], 
                      list(:=, date_valid_init)), list(658L, 
                      52L, 659L, 42L, 52L, 42L, 658L, 659L)))), 
            list(<-, sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(day_prelev2 = as.Date(day_prelev)), 
                    by = day_prelev], list(:=, list(as.Date, 
                    day_prelev)), day_prelev), list(660L, 52L, 
                    662L, 22L, 52L, 22L, 660L, 662L)))), list(
                <-, sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(day_prelev = NULL)], 
                      list(:=, NULL)), list(663L, 52L, 664L, 
                      31L, 52L, 31L, 663L, 664L)))), list(<-, 
                sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list(list(::, data.table, setnames), i, "day_prelev2", 
                      "day_prelev"), list(665L, 52L, 666L, 56L, 
                      52L, 56L, 665L, 666L)))), list(<-, sidep_prev_pcr_lst, 
                list(lapply, sidep_prev_pcr_lst, list(function, 
                  list(as.pairlist(alist(i = ))), list([, i, 
                    i[, `:=`(day_valid2 = as.Date(day_valid)), 
                      by = day_valid], list(:=, list(as.Date, 
                      day_valid)), day_valid), list(668L, 52L, 
                    670L, 21L, 52L, 21L, 668L, 670L)))), list(
                <-, sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(day_valid = NULL)], list(
                      :=, NULL)), list(671L, 52L, 672L, 30L, 
                      52L, 30L, 671L, 672L)))), list(<-, sidep_prev_pcr_lst, 
                list(lapply, sidep_prev_pcr_lst, list(function, 
                  list(as.pairlist(alist(i = ))), list(list(::, 
                    data.table, setnames), i, "day_valid2", "day_valid"), 
                  list(673L, 52L, 674L, 54L, 52L, 54L, 673L, 
                    674L)))), list(<-, sidep_prev_pcr_lst, list(
                lapply, sidep_prev_pcr_lst, list(function, list(
                  as.pairlist(alist(i = ))), list([, i, i[, `:=`(day_extract_sidep2 = as.Date(day_extract_sidep)), 
                  by = day_extract_sidep], list(:=, list(as.Date, 
                  day_extract_sidep)), day_extract_sidep), list(
                  676L, 52L, 678L, 29L, 52L, 29L, 676L, 678L)))), 
            list(<-, sidep_prev_pcr_lst, list(lapply, sidep_prev_pcr_lst, 
                list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(day_extract_sidep = NULL)], 
                    list(:=, NULL)), list(679L, 52L, 680L, 38L, 
                    52L, 38L, 679L, 680L)))), list(<-, sidep_prev_pcr_lst, 
                list(lapply, sidep_prev_pcr_lst, list(function, 
                  list(as.pairlist(alist(i = ))), list(list(::, 
                    data.table, setnames), i, "day_extract_sidep2", 
                    "day_extract_sidep"), list(681L, 52L, 682L, 
                    70L, 52L, 70L, 681L, 682L)))), list(<-, t2, 
                list(Sys.time)), list(print, list(-, t2, t1)), 
            list(=, last_month, list([, MoisAAAA, list(length, 
                MoisAAAA))), list(if, list(!, list(file.exists, 
                list(paste0, temp, last_month))), list(list(<-, 
                list([[, sidep_prev_pcr_lst, list(+, list(length, 
                  sidep_prev_pcr_lst), 1)), list(list(::, data.table, 
                  data.table))))), list(<-, t1, list(Sys.time)), 
            list([, sidep_prev_sero, sidep_prev_sero[, `:=`(mois_prelev, 
                lubridate::month(date_prelev))], list(:=, mois_prelev, 
                list(list(::, lubridate, month), date_prelev))), 
            list([, sidep_prev_sero, sidep_prev_sero[, `:=`(annee_prelev, 
                lubridate::year(date_prelev))], list(:=, annee_prelev, 
                list(list(::, lubridate, year), date_prelev))), 
            list(<-, sidep_sero_lst, list(split, sidep_prev_sero, 
                list(c, "annee_prelev", "mois_prelev"))), list(
                <-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(<-, sidep_sero_lst, list(lapply, 
                sidep_sero_lst, list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(mois_prelev, NULL)], list(
                    :=, mois_prelev, NULL)), list(697L, 44L, 
                    697L, 79L, 44L, 79L, 697L, 697L)))), list(
                <-, sidep_sero_lst, list(lapply, sidep_sero_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(annee_prelev, NULL)], 
                      list(:=, annee_prelev, NULL)), list(698L, 
                      44L, 698L, 80L, 44L, 80L, 698L, 698L)))), 
            list(<-, sidep_sero_lst, list(lapply, sidep_sero_lst, 
                list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(day_prelev = as.Date(day_prelev), 
                    day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                    date_valid = fasttime::fastPOSIXct(date_valid), 
                    date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                    day_extract_sidep = as.Date(day_extract_sidep), 
                    Age = as.numeric(Age))], list(:=, list(as.Date, 
                    day_prelev), list(as.Date, day_valid), list(
                    list(::, fasttime, fastPOSIXct), date_prelev), 
                    list(list(::, fasttime, fastPOSIXct), date_valid), 
                    list(list(::, fasttime, fastPOSIXct), date_valid_init), 
                    list(as.Date, day_extract_sidep), list(as.numeric, 
                      Age))), list(701L, 44L, 708L, 35L, 44L, 
                    35L, 701L, 708L)))), list(<-, t1, list(Sys.time)), 
            list([, sidep_prev_pcr_sal_mil, sidep_prev_pcr_sal_mil[, 
                `:=`(mois_prelev, lubridate::month(date_prelev))], 
                list(:=, mois_prelev, list(list(::, lubridate, 
                  month), date_prelev))), list([, sidep_prev_pcr_sal_mil, 
                sidep_prev_pcr_sal_mil[, `:=`(annee_prelev, lubridate::year(date_prelev))], 
                list(:=, annee_prelev, list(list(::, lubridate, 
                  year), date_prelev))), list(<-, sidep_prev_pcr_sal_mil_lst, 
                list(split, sidep_prev_pcr_sal_mil, list(c, "annee_prelev", 
                  "mois_prelev"))), list(<-, t2, list(Sys.time)), 
            list(print, list(-, t2, t1)), list(<-, sidep_prev_pcr_sal_mil_lst, 
                list(lapply, sidep_prev_pcr_sal_mil_lst, list(
                  function, list(as.pairlist(alist(i = ))), list(
                    [, i, i[, `:=`(mois_prelev, NULL)], list(
                      :=, mois_prelev, NULL)), list(717L, 40L, 
                    717L, 75L, 40L, 75L, 717L, 717L)))), list(
                <-, sidep_prev_pcr_sal_mil_lst, list(lapply, 
                  sidep_prev_pcr_sal_mil_lst, list(function, 
                    list(as.pairlist(alist(i = ))), list([, i, 
                      i[, `:=`(annee_prelev, NULL)], list(:=, 
                        annee_prelev, NULL)), list(719L, 40L, 
                      719L, 76L, 40L, 76L, 719L, 719L)))), list(
                <-, sidep_prev_pcr_sal_mil_lst, list(lapply, 
                  sidep_prev_pcr_sal_mil_lst, list(function, 
                    list(as.pairlist(alist(i = ))), list([, i, 
                      i[, `:=`(day_prelev = as.Date(day_prelev), 
                        day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                        date_valid = fasttime::fastPOSIXct(date_valid), 
                        date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                        day_extract_sidep = as.Date(day_extract_sidep), 
                        Age = as.numeric(Age))], list(:=, list(
                        as.Date, day_prelev), list(as.Date, day_valid), 
                        list(list(::, fasttime, fastPOSIXct), 
                          date_prelev), list(list(::, fasttime, 
                          fastPOSIXct), date_valid), list(list(
                          ::, fasttime, fastPOSIXct), date_valid_init), 
                        list(as.Date, day_extract_sidep), list(
                          as.numeric, Age))), list(720L, 68L, 
                      727L, 35L, 68L, 35L, 720L, 727L)))), list(
                [, sidep_add, sidep_add[, `:=`(mois_prelev, lubridate::month(date_prelev))], 
                list(:=, mois_prelev, list(list(::, lubridate, 
                  month), date_prelev))), list([, sidep_add, 
                sidep_add[, `:=`(annee_prelev, lubridate::year(date_prelev))], 
                list(:=, annee_prelev, list(list(::, lubridate, 
                  year), date_prelev))), list(<-, sidep_add, 
                list([, sidep_add, list(order, annee_prelev, 
                  mois_prelev))), list(<-, sidep_add_lst, list(
                split, sidep_add, list(c, "annee_prelev", "mois_prelev"))), 
            list(<-, sidep_add_lst, list(lapply, sidep_add_lst, 
                list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(mois_prelev, NULL)], list(
                    :=, mois_prelev, NULL)), list(735L, 27L, 
                    735L, 62L, 27L, 62L, 735L, 735L)))), list(
                <-, sidep_add_lst, list(lapply, sidep_add_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(annee_prelev, NULL)], 
                      list(:=, annee_prelev, NULL)), list(737L, 
                      27L, 737L, 63L, 27L, 63L, 737L, 737L)))), 
            list(<-, list(names, sidep_prev_pcr_lst), YYYY.mm), 
            list(<-, t1, list(Sys.time)), list(<-, sidep_lst, 
                list(lapply, YYYY.mm, list(function, list(as.pairlist(alist(i = ))), 
                  list(rbindlist, list(list, list([[, sidep_prev_pcr_lst, 
                    i), list([[, sidep_sero_lst, i), list([[, 
                    sidep_prev_pcr_sal_mil_lst, i), list([[, 
                    sidep_add_lst, i)), TRUE), list(742L, 23L, 
                    745L, 81L, 23L, 81L, 742L, 745L)))), list(
                <-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(rm, sidep_add, sidep_add_lst, 
                sidep_sero_lst, sidep_prev_pcr_lst, sidep_prev_pcr_sal_mil_lst), 
            list(print, "Doublons dans la base globale"), list(
                =, etapes_fin, list(cbind, "aucune", list(do.call, 
                  "sum", list(lapply, sidep_lst, nrow)))), list(
                <-, treat_duplicates, list(function, list(as.pairlist(alist(temp = ))), 
                  list(list(print, list(paste0, list(list(::, 
                    lubridate, month), list([, list($, temp, 
                    date_prelev), 1)), " - ", list(list(::, lubridate, 
                    year), list([, list($, temp, date_prelev), 
                    1)))), list(<-, rows_dup, list((, list(|, 
                    list(duplicated, temp, list(c, "Pseudonyme", 
                      "date_prelev", "AnalyseConclusion")), list(
                      duplicated, temp, list(c, "Pseudonyme", 
                        "date_prelev", "AnalyseConclusion"), 
                      TRUE)))), list([, temp, temp[, `:=`(date_valid_init = date_valid, 
                    latest_day_extract = day_extract_sidep)], 
                    list(:=, date_valid, day_extract_sidep)), 
                    list(<-, temp_to_treat, list([, temp, rows_dup)), 
                    list(<-, temp_not_to_treat, list([, temp, 
                      list(!, rows_dup))), list(print, list(nrow, 
                      temp_to_treat)), list(if, list(>, list(
                      nrow, temp_to_treat), 0), list(list([, 
                      temp_to_treat, temp_to_treat[, `:=`(date_valid_init = min(date_valid), 
                        latest_day_extract = max(day_extract_sidep)), 
                        by = c("Pseudonyme", "date_prelev", "AnalyseConclusion")], 
                      list(:=, list(min, date_valid), list(max, 
                        day_extract_sidep)), list(c, "Pseudonyme", 
                        "date_prelev", "AnalyseConclusion")), 
                      list(<-, temp_to_treat, list([, temp_to_treat, 
                        list(%in%, day_extract_sidep, latest_day_extract))), 
                      list(<-, temp_to_treat, list([, temp_to_treat, 
                        temp_to_treat[, .SD[1], by = c("Pseudonyme", 
                          "date_prelev", "AnalyseConclusion")], 
                        list([, .SD, 1), list(c, "Pseudonyme", 
                          "date_prelev", "AnalyseConclusion"))), 
                      list(<-, temp, list(rbindlist, list(list, 
                        temp_to_treat, temp_not_to_treat), T)))), 
                    list([, temp, temp[, `:=`(date_valid, date_valid_init)], 
                      list(:=, date_valid, date_valid_init)), 
                    list(return, temp)), list(756L, 23L, 786L, 
                    3L, 23L, 3L, 756L, 786L))), list(<-, t1, 
                list(Sys.time)), list(<-, sidep_lst, list(lapply, 
                sidep_lst, list(function, list(as.pairlist(alist(i = ))), 
                  list(treat_duplicates, i), list(789L, 34L, 
                    789L, 64L, 34L, 64L, 789L, 789L)))), list(
                <-, t2, list(Sys.time)), list(print, list(-, 
                t2, t1)), list(=, etapes_fin, list(rbind, etapes_fin, 
                list(cbind, "dup_tryptique_and_latest_date", 
                  list(do.call, "sum", list(lapply, sidep_lst, 
                    nrow))))), list(=, etapes_fin, list(list(
                ::, data.table, data.table), etapes_fin)), list(
                [, etapes_fin, etapes_fin[, `:=`(n_supp, 0)], 
                list(:=, n_supp, 0)), list([, etapes_fin, etapes_fin[, 
                `:=`(n_row, as.numeric(n_row))], list(:=, n_row, 
                list(as.numeric, n_row))), list(for, i, list(
                :, 2, list(nrow, etapes_fin)), list(list(=, list(
                [, list($, etapes_fin, n_supp), i), list(-, list(
                [, list($, etapes_fin, n_row), list(-, i, 1)), 
                list([, list($, etapes_fin, n_row), i))))), list(
                <<-, etapes_fin, etapes_fin), list(<-, sidep_lst, 
                list(lapply, sidep_lst, list(function, list(as.pairlist(alist(i = ))), 
                  list([, i, i[, `:=`(latest_day_extract = NULL)], 
                    list(:=, NULL)), list(805L, 34L, 806L, 39L, 
                    34L, 39L, 805L, 806L)))), list(<-, extract_dt, 
                list(function, list(as.pairlist(alist(temp = ))), 
                  list(list(<-, sidep_sero, list(lapply, temp, 
                    list(function, list(as.pairlist(alist(i = ))), 
                      list([, i, list(%in%, AnalyseConclusion, 
                        list(c, "94762-2", "94563-4", "94564-2"))), 
                      list(810L, 32L, 811L, 80L, 32L, 80L, 810L, 
                        811L)))), list(<-, sidep_pcr, list(lapply, 
                    temp, list(function, list(as.pairlist(alist(i = ))), 
                      list([, i, list(==, AnalyseConclusion, 
                        "94500-6")), list(812L, 31L, 812L, 75L, 
                        31L, 75L, 812L, 812L)))), list(<-, sidep_pcr_sal_mil, 
                    list(lapply, temp, list(function, list(as.pairlist(alist(i = ))), 
                      list([, i, list(%in%, AnalyseConclusion, 
                        list(c, "94309-2", "94845-5"))), list(
                        813L, 39L, 813L, 99L, 39L, 99L, 813L, 
                        813L)))), list(return, list(list, sidep_sero, 
                    sidep_pcr, sidep_pcr_sal_mil))), list(809L, 
                    17L, 818L, 3L, 17L, 3L, 809L, 818L))), list(
                <-, t1, list(Sys.time)), list(<-, sidep, list(
                extract_dt, sidep_lst)), list(<-, t2, list(Sys.time)), 
            list(print, list(-, t2, t1)), list(rm, sidep_lst), 
            list(<<-, sidep_sero, list([[, sidep, "sidep_sero")), 
            list(<<-, sidep_pcr, list([[, sidep, "sidep_pcr")), 
            list(<<-, sidep_pcr_sal_mil, list([[, sidep, "sidep_pcr_sal_mil")), 
            list(rm, sidep), list(print, list(-, list(Sys.time), 
                TIME_INIT)), list(gc)), list(128L, 14L, 833L, 
            1L, 14L, 1L, 128L, 833L))), list(<-, t1, list(Sys.time)), 
    list(structure(expression(MoisAAAA = MoisAAAA), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(YYYY.mm = YYYY.mm), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-20"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(corres = new_rattrapage), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(addP2 = addP2), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        TIME_INIT = Sys.time(), print(paste0("lancement: ", TIME_INIT)), 
        date_AAAAMMJJ_last = format(last_update, format = "%Y%m%d"), 
        date_AAMMJJ_last = substr(date_AAAAMMJJ_last, 3, 8), 
        extractions = list.files(path_data), extractions = grep("CSV_DREES", 
            extractions, value = T), extractions = grep(".csv", 
            extractions, value = T), extractions_to_drop <- extractions %in% 
            c("CSV_DREES_200518200002.csv", "CSV_DREES_200519090000.csv", 
                "CSV_DREES_200520090000.csv", "CSV_DREES_200625130000.csv"), 
        if (any(extractions_to_drop)) {
            extractions <- extractions[-which(extractions_to_drop)]
        }, extractions <- extractions[!grepl("ini", extractions)], 
        extractions = sort(extractions, decreasing = T), names(extractions) <- substr(extractions, 
            13, 16), print("Chargement des bases journalières à agréger"), 
        extract = extractions[substr(extractions, 16, 21) == 
            date_AAMMJJ], names(extract) <- substr(extract, 11, 
            14), sidep_add_1 = safe_fread(paste0(path_data, extract["MED4"]), 
            quote = "", verbose = F, sep = "|", header = TRUE, 
            colClasses = list(character = daily_files_char_vars, 
                numeric = "Age"), encoding = "Latin-1"), print(extract["MED4"]), 
        w <- sidep_add_1$warnings, w <- w[grepl("^Stopped early", 
            w)], if (length(w) > 0) {
            stop(w)
        }, sidep_add_1 <- sidep_add_1$result, sidep_add_2 = safe_fread(paste0(path_data, 
            extract["MED2"]), quote = "", verbose = F, sep = "|", 
            header = TRUE, colClasses = list(character = daily_files_char_vars, 
                numeric = "Age"), encoding = "Latin-1"), print(extract["MED2"]), 
        w <- sidep_add_2$warnings, w <- w[grepl("^Stopped early", 
            w)], if (length(w) > 0) {
            stop(w)
        }, sidep_add_2 <- sidep_add_2$result, rm(w), sidep_add = rbind(sidep_add_1, 
            sidep_add_2), rm(sidep_add_1, sidep_add_2), sidep_add$day_extract_sidep = as.Date(date_AAAAMMJJ, 
            format = "%Y%m%d"), sidep_add[Pseudo2 != "", `:=`(Pseudo_diff, 
            as.numeric(Pseudo1 != Pseudo2))], stockage_pseudo = copy(sidep_add), 
        stockage_pseudo[, `:=`(Annee_prelev, as.numeric(substr(DatePrelevement, 
            1, 4)))], stockage_pseudo = stockage_pseudo[, c("Pseudo1", 
            "Pseudo2", "Pseudo_diff", "Sexe", "Age", "Annee_prelev", 
            "day_extract_sidep")], stockage_pseudo = unique(stockage_pseudo), 
        data.table::fwrite(stockage_pseudo, paste0(path_sortie, 
            "correspondance pseudos/", date_AAAAMMJJ, "_corresp_pseudos.csv"), 
            quote = TRUE, dec = ".", row.names = FALSE, col.names = TRUE, 
            sep = ";", qmethod = c("escape"), dateTimeAs = "ISO", 
            verbose = TRUE), rm(stockage_pseudo), setnames(sidep_add, 
            "Pseudo2", "Pseudonyme"), sidep_add[, `:=`(Pseudo1, 
            NULL)], print("Suppression des antislash et .br"), 
        sidep_add[, `:=`(Joker1, NULL)], sidep_add[, `:=`(Joker2, 
            NULL)], sidep_add[, `:=`(Joker3, NULL)], sidep_add$RPPSPrescripteur = stringr::str_extract(sidep_add$RPPSPrescripteur, 
            "([0-9]{1,14})"), sidep_add$RPPSPrescripteur = as.integer64(sidep_add$RPPSPrescripteur), 
        sidep_add[RPPSPrescripteur == 0, `:=`(RPPSPrescripteur, 
            NA)], sidep_add$CodePostal = gsub("(\\\\)", "", sidep_add$CodePostal), 
        sidep_add$CodePostal = gsub("(.br)", "", sidep_add$CodePostal), 
        nettoyage <- function(temp, element) {
            for (i in colnames(temp)) {
                print(i)
                print(temp[grep(element, get(i)), .N])
                if (temp[grep(element, get(i)), .N] > 0) {
                  idx <- grep(element, temp[[i]])
                  temp[grep(element, get(i)), `:=`(c(i), list(stringr::str_replace_all(get(i), 
                    element, "")))]
                }
            }
            return(temp)
        }, sidep_add <- nettoyage(sidep_add, ";"), sidep_add <- nettoyage(sidep_add, 
            "\\\\"), sidep_add <- nettoyage(sidep_add, "\""), 
        sidep_add$FINESS = stringr::str_extract(sidep_add$FINESS, 
            "([0-9AB]{1,15})"), sidep_add[, `:=`(FINESS, ifelse(FINESS == 
            "" | nchar(FINESS) < 8, NA, FINESS))], sidep_add$FINESSGeographique = stringr::str_extract(sidep_add$FINESSGeographique, 
            "([0-9AB]{1,15})"), sidep_add[, `:=`(FINESSGeographique, 
            ifelse(FINESSGeographique == "" | nchar(FINESSGeographique) < 
                8, NA, FINESSGeographique))], sidep_add[, `:=`(regCampagneDepistage, 
            stringr::str_extract(NumCampagneDepistage, "^[A-Za-z]{3}"))], 
        if (sidep_add[nchar(regCampagneDepistage) < 3, .N] > 
            0) {
            print("Probleme: il y a des trigrammes dans NumCampagneDepistage qui ont moins de 3 caractères")
        }, sidep_add[, `:=`(regCampagneDepistage, NULL)], print("Traitement des dates"), 
        sidep_add[, `:=`(date_prelev, lubridate::ymd_hms(paste0(substr(DatePrelevement, 
            1, 4), "-", substr(DatePrelevement, 5, 6), "-", substr(DatePrelevement, 
            7, 8), " ", substr(DatePrelevement, 9, 10), ":", 
            substr(DatePrelevement, 11, 12), ":", substr(DatePrelevement, 
                13, 14))))], sidep_add[, `:=`(day_prelev, as.Date(date_prelev))], 
        sidep_add[, `:=`(date_valid, lubridate::ymd_hms(paste0(substr(DateValidationCR, 
            1, 4), "-", substr(DateValidationCR, 5, 6), "-", 
            substr(DateValidationCR, 7, 8), " ", substr(DateValidationCR, 
                9, 10), ":", substr(DateValidationCR, 11, 12), 
            ":", substr(DateValidationCR, 13, 14))))], sidep_add[, 
            `:=`(day_valid, as.Date(date_valid))], if (!is.na(day_init)) {
            sidep_add = sidep_add[day_prelev >= as.Date(day_init) & 
                day_prelev <= date_dataset]
            sidep_add = sidep_add[is.na(day_valid) | (!is.na(day_valid) & 
                day_valid >= as.Date(day_init) & day_valid <= 
                date_dataset)]
        }, sidep_add = sidep_add[day_prelev <= day_extract_sidep], 
        print("Pseudonymes"), if (sum(nchar(sidep_add$Pseudonyme, 
            ) > 64, na.rm = T) != 0) {
            sidep_add[nchar(Pseudonyme) %in% c(128, 192), `:=`(Pseudonyme, 
                substr(Pseudonyme, 1, 64))]
        }, pseudos_tests = c("78b14ef7c9ed19082b6d2d151678b8a74606f7dd33b811b3f97f41fe20793ea5", 
            "cf77f9f6fc3d4a40260af813aed7c3f80c274660aff9f978a99f98d29544be0c", 
            "e76950f02d9763a2533a4c6b0a3a0621e0dcfd3133c5fc3d1d0064b3324a3d50", 
            "ef9ecddf446243b60b9f15e8c7a521f79f21bfb2f95b0d6d54b4f3533f85a1d1", 
            "9fdcb52ac99ef7497ce75a543cf99afbb8c9af6f8dfd417f2a62b3dbca0ae23d", 
            "cd88cea5ff5a72eca228f63c9513492d45b5b78509e237ab55e0d787f896d747", 
            "c9d915880d6266a23ca95992a009a4491bbed5e3882fbd60b556a9df09dde4a0", 
            "aeaab01f88b19d53b7680a7fbc2a46fba31de13b2f60f75679ea2f971d8ce346", 
            "5161630ccba995deaa8d6ba5012ca521b0b245a9bd5e78658d6311ddffc0f8ec", 
            "4d07e44674b72d5c6ef58605058b671f0884394adf6535b194771325e709034f", 
            "a5c373e024776111dbb999506c28d41e4dca3011a41394493526bca3476136f0", 
            "9a4708216b2624f4461e6aa3b1181f03ecb3d4605d9d658ce6cc8fbf59a17557", 
            "8728ef871def06e09529733e60bebdde00e559a05da5bcf0b91cb13a67374564", 
            "2153039929b6bd83dd502e01d41cd4319e9674c8dedbe28d3d625e0102c5a450", 
            "03b8e61d5548edc7a9490ed86d2fbfcd8edc4746489e8543fdff64d5527e8ed8", 
            "efdaf8f12656c9b015c3410c4a8879b3c07c7b121493f5c2617df8d0db6b17ef", 
            "3563fc0e12e0e2187c0e1117849bcbc849c60afef9f807cc54b90a7e3e6bd818", 
            "4b1081eadac91e9bc974ac8cb2dd437e31dca5d2e88e086d5f68fdffa2efb0a2", 
            "2fed8eadd4765b47d5d034b1624ffc19f9f1a8dd6853887597039952d87489be", 
            "2b90416ea89cd21fe3ae4eb90ac3d8158afe87f4dc6ef43c257a37e857787107", 
            "68d80449eb5960e1912a1043ee6f388fc75417d87e246e4402538d1ad577ef6a", 
            "23c3e79e45865410393b5520d9841854427f435f272ddd32d365bb73af5570c2", 
            "5fb63a89cb4a0108ba7e4b5cea5b8a7cad48c64aa24c000f0d7cb49dddf26f43", 
            "7b7fbf4ff01a5920ea08159889b6d1a9ff03f1d26a50d30cd3b142a68e633079", 
            "3bc66709adac0bac1158bbdf7500eda1c370ef0132c65b861856ea677c405470"), 
        sidep_add = sidep_add[!(Pseudonyme %in% pseudos_tests)], 
        print("AnalyseConclusion"), sidep_add = sidep_add[AnalyseConclusion %in% 
            c("94500-6", "94762-2", "94563-4", "94564-2", "94309-2", 
                "94845-5")], print("Doublons parfaits extractions"), 
        etapes = cbind(var = "aucune", n_row = nrow(sidep_add)), 
        sidep_add <- unique(sidep_add), etapes = rbind(etapes, 
            cbind(var = "Duplicates_all_lines", n_row = nrow(sidep_add))), 
        print("Premiers symptômes"), sidep_add[PremierSymptomes %in% 
            c("", "UU", "u", "non précisé", "Non communiqué", 
                "NON RENSEIGNE", "non renseignÃ©", "nrens", "PAS RENSEIGNE", 
                "NR", "Non renseigné", "NON PRECISE", "Non précisé", 
                "non renseignée", "NRENS", "np", "NCNR", "NRE", 
                "NSP", "NP", "NM", "V", "ne sais pas", "non fait", 
                "VOIR PRESCRIPTION JOINTE", "NPC", "INC", "BILAN PREOP", 
                "?", "nc", "nr", "0.000000", "0R", "GAPS2", "Demande annulée", 
                "Non communiqué", "NCNR2"), `:=`(PremierSymptomes, 
            "U")], sidep_add[PremierSymptomes %in% c("PAS DE SYMPTOME", 
            "a", "Asymptomatique.", "AUCUN SYMPTOME", "asy", 
            "APSYU", "ASy", "ASYM", "A", "ASYASY", "ASYM ", "ASYU", 
            "PASYM", "UASY", "avant entrée en EHPAD", "avant retour en EHPAD", 
            "entrée de geriatrie", "entree en geriatrie", "avant rentrée en ehpad", 
            "AVANT TRANSFERT EHPAD", "BILAN PRE OP", "TEST PRE OP", 
            "TRANSFERT EN  EHPAD", "Transfert SSR-P"), `:=`(PremierSymptomes, 
            "ASY")], sidep_add[grepl("(Pas de symptomes)|(ASYV)|(VASY)|(Pré opératoire)|(PAS DE SYMPTOMES)|(PRE-OPERATOIRE)", 
            PremierSymptomes), `:=`(PremierSymptomes, "ASY")], 
        sidep_add[grepl("(apparus le jour ou la veille)|(D1)|(S01S01)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S01")], 
        sidep_add[grepl("(apparus 2,3)|(apparus 2, 3)|(D2)|(D3)|(quelques jours)|(Quelques jours)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S24")], 
        sidep_add[PremierSymptomes %in% c("05/05/20"), `:=`(PremierSymptomes, 
            "S57")], sidep_add[grepl("(apparus 5,6)|(apparus 5, 6)|(D5)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S57")], 
        sidep_add[grepl("(SS2SS2)|(D9)|(D11)|(S814)", PremierSymptomes), 
            `:=`(PremierSymptomes, "SS2")], sidep_add[grepl("(apparus entre 8 et 15 jours)|(apparus entre 8 et 14 jours)|(S814)|(ss2)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS2")], 
        sidep_add[grepl("(apparus plus de 2 semaines)|(apparus plus de deux semaines)|(+ 15 jours)|(>j15)|(SS34)|(SS3SS3)|(S2-S4)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(apparus plus de deux semaines avant le prelevement)|(apparus entre 15 et 28 jours)|(SS3U)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(il y a 1 mois)|(plus de 3 semaines)|(DECEMBRE 19)|(plus de quatre semaines)|(D29)|(SP4S)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(Eruption cutanée)|(colique)|(30/05/20)|(07/06/20)|(202005)|(202006)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SNA")], 
        print("TypologiePatient"), sidep_add[TypologiePatient == 
            "", `:=`(TypologiePatient, "U")], sidep_add[TypologiePatient %in% 
            c("Autre structure d'hébergement collectif", "Autre structure d'hébergement", 
                "autre structure d'hébergement collectif"), `:=`(TypologiePatient, 
            "A")], sidep_add[TypologiePatient %in% c("résident en EHPAD", 
            "Résident en EHPAD"), `:=`(TypologiePatient, "E")], 
        sidep_add[TypologiePatient %in% c("HH"), `:=`(TypologiePatient, 
            "H")], sidep_add[TypologiePatient %in% c("II", "i"), 
            `:=`(TypologiePatient, "H")], sidep_add[!TypologiePatient %in% 
            c("I", "H", "E", "C", "A", "U"), `:=`(TypologiePatient, 
            "U")], print("Resultat"), sidep_add[Resultat %in% 
            c("negatif", "NEGATIF", "Négative", "N?gatif", "NN", 
                "NNN", "NEG", "n"), `:=`(Resultat, "N")], sidep_add[grepl("(ninterp)|(ndéterminé)", 
            Resultat), `:=`(Resultat, "I")], sidep_add[Resultat %in% 
            c("PP"), `:=`(Resultat, "P")], sidep_add[Resultat == 
            "N", `:=`(valeur, "N")], sidep_add[Resultat == "P", 
            `:=`(valeur, "P")], sidep_add[Resultat == "I", `:=`(valeur, 
            "I")], sidep_add[Resultat == "X", `:=`(valeur, "X")], 
        print("Doublons dans les dernières extractions"), sidep_add[, 
            `:=`(na_res, ifelse(Resultat %in% c("", "X", "I") | 
                is.na(Resultat) | nchar(Resultat) > 1, 1, 0))], 
        sidep_add[, `:=`(na_typo, ifelse(TypologiePatient == 
            "U" | is.na(TypologiePatient), 1, 0))], sidep_add[, 
            `:=`(na_cp, ifelse(CodePostal == "" | is.na(CodePostal) | 
                nchar(CodePostal) != 5, 1, 0))], sidep_add[, 
            `:=`(na_sympto, ifelse(PremierSymptomes == "" | is.na(PremierSymptomes) | 
                nchar(PremierSymptomes) == "U", 1, 0))], sidep_add = sidep_add[, 
            `:=`(date_valid_init = min(date_valid), latest_day_extract = max(day_extract_sidep), 
                res_ok = min(na_res), typo_ok = min(na_typo), 
                cp_ok = min(na_cp), sympto_ok = min(na_sympto)), 
            by = .(Pseudonyme, date_prelev, AnalyseConclusion)], 
        sidep_add <- sidep_add[day_extract_sidep %in% latest_day_extract], 
        etapes = rbind(etapes, cbind(var = "latest_extract", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_res == 
            res_ok], etapes = rbind(etapes, cbind(var = "Resultat", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_typo == 
            typo_ok], etapes = rbind(etapes, cbind(var = "TypologiePatient", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_cp == 
            cp_ok], etapes = rbind(etapes, cbind(var = "CodePostal", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_sympto == 
            sympto_ok], etapes = rbind(etapes, cbind(var = "PremierSymptomes", 
            n_row = nrow(sidep_add))), sidep_add[, `:=`(date_valid, 
            date_valid_init)], sidep_add = sidep_add[, -c("latest_day_extract", 
            "na_res", "res_ok", "na_typo", "typo_ok", "na_cp", 
            "cp_ok", "na_sympto", "sympto_ok")], sidep_add = sidep_add[, 
            .SD[1], by = c("Pseudonyme", "date_prelev", "AnalyseConclusion")], 
        etapes = rbind(etapes, cbind(var = "dup_tryptique", n_row = nrow(sidep_add))), 
        etapes = data.table(etapes), etapes[, `:=`(n_supp, 0)], 
        etapes[, `:=`(n_row, as.numeric(n_row))], for (i in 2:nrow(etapes)) {
            etapes$n_supp[i] = etapes$n_row[i - 1] - etapes$n_row[i]
        }, etapes <<- etapes, print("Finess"), matching_fi = function(data_sidep) {
            setnames(data_sidep, "FINESS", "fi_init")
            load(paste0(path, "data/utils/finess_1116.Rdata"))
            liste_et <- liste_et %>% select(DEP_ET = ET-Département
Code, 
                FINESS_EJ = EJ-N°FINESS, DEP_EJ = EJ-Département
Code, 
                FINESS_ET = ET-N°FINESS)
            sidep_geo <- inner_join(data_sidep, liste_et %>% 
                select(fi_init = FINESS_ET, DEP_ET, FINESS_EJ, 
                  DEP_EJ), by = "fi_init")
            sidep_geo$FINESS_ET <- sidep_geo$fi_init
            sidep_ju <- inner_join(data_sidep, as_tibble(liste_et) %>% 
                select(fi_init = FINESS_EJ, DEP_EJ) %>% group_by(fi_init) %>% 
                slice(1) %>% ungroup(), by = "fi_init")
            sidep_ju$FINESS_EJ <- sidep_ju$fi_init
            sidep_ok <- rbindlist(list(sidep_geo, sidep_ju), 
                fill = T)
            data_sidep <- merge(data_sidep, unique(sidep_ok[, 
                .(fi_init, FINESS_ET, DEP_ET, FINESS_EJ, DEP_EJ)]), 
                by.x = "fi_init", by.y = "fi_init", all.x = T)
            bio3_et <- readxl::read_excel(paste0(path, "data/utils/bio3_et_1116.xlsx"))
            data_sidep <- left_join(data_sidep, bio3_et %>% group_by(FINESS_EJ) %>% 
                slice(1) %>% ungroup() %>% select(FINESS_EJ, 
                cat_etb), by = "FINESS_EJ")
            data_sidep$cat_pp <- ifelse(data_sidep$cat_etb %in% 
                c("2000", "3000"), "privé", NA)
            data_sidep$cat_pp <- ifelse(data_sidep$cat_etb == 
                "1000", "public", data_sidep$cat_pp)
            table(data_sidep$cat_pp, exclude = NULL)
            data_sidep = data.table(data_sidep)
            remove(sidep_ok, sidep_ju, sidep_geo)
            data_sidep[is.na(DEP_EJ), `:=`(DEP_EJ, "dep_inconnu")]
            data_sidep[is.na(DEP_ET), `:=`(DEP_ET, "dep_inconnu")]
            reg_dep = data.table::fread(paste0(path, "data/utils/departement2019.csv"))
            reg_dep$reg = as.character(reg_dep$reg)
            reg_dep[nchar(reg) == 1, `:=`(reg, paste0("0", reg))]
            ej_et_dep = data.table(liste_et[, c("FINESS_ET", 
                "DEP_ET", "FINESS_EJ", "DEP_EJ")])
            ej_et_dep = merge(ej_et_dep, reg_dep[, .(dep, reg)], 
                by.x = "DEP_ET", by.y = "dep", all.x = T)
            setnames(ej_et_dep, "reg", "REG_ET")
            ej_et_dep = merge(ej_et_dep, reg_dep[, .(dep, reg)], 
                by.x = "DEP_EJ", by.y = "dep", all.x = T)
            setnames(ej_et_dep, "reg", "REG_EJ")
            nb_dep_par_ej = ej_et_dep[, .(n_distinct(DEP_ET)), 
                by = .(FINESS_EJ)]
            sum(nb_dep_par_ej$V1 == 1)/length(unique(ej_et_dep$FINESS_EJ))
            ej_et_same_dep = ej_et_dep[FINESS_EJ %in% nb_dep_par_ej$FINESS_EJ[nb_dep_par_ej$V1 == 
                1]]
            ej_et_same_dep = ej_et_same_dep[DEP_ET == DEP_EJ]
            ej_et_same_dep = unique(ej_et_same_dep[, .(FINESS_EJ, 
                DEP_EJ)])
            nb_reg_par_ej = ej_et_dep[, .(n_distinct(REG_ET)), 
                by = .(FINESS_EJ)]
            sum(nb_reg_par_ej$V1 == 1)/length(unique(ej_et_dep$FINESS_EJ))
            ej_et_same_reg = ej_et_dep[FINESS_EJ %in% nb_reg_par_ej$FINESS_EJ[nb_reg_par_ej$V1 == 
                1]]
            ej_et_same_reg = ej_et_same_reg[REG_ET == REG_EJ]
            ej_et_same_reg = unique(ej_et_same_reg[, .(FINESS_EJ, 
                REG_EJ)])
            ej_et_same_dep <<- ej_et_same_dep
            ej_et_same_reg <<- ej_et_same_reg
            data_sidep[, `:=`(cat_pp, iconv(cat_pp, from = "UTF-8", 
                to = "latin1"))]
            return(data_sidep)
        }, sidep_add = matching_fi(sidep_add), print("Code postal, département et région"), 
        sidep_add[substr(CodePostal, 1, 2) %in% c("00", "99", 
            "XX"), `:=`(CodePostal, NA)], sidep_add[CodePostal %in% 
            c("", "0", ".", ",", "aucun", "AUCUN"), `:=`(CodePostal, 
            NA)], sidep_add[CodePostal == "=59111", `:=`(CodePostal, 
            "59111")], sidep_add[CodePostal == ":78360", `:=`(CodePostal, 
            "78360")], sidep_add[CodePostal == "=35420", `:=`(CodePostal, 
            "35420")], sidep_add[, `:=`(code_dep, case_when(substr(CodePostal, 
            1, 3) %in% c("201", "200", "207") ~ "2A", substr(CodePostal, 
            1, 3) %in% c("202", "206") ~ "2B", substr(CodePostal, 
            1, 2) == "97" ~ substr(CodePostal, 1, 3), !substr(CodePostal, 
            1, 2) %in% c("97", "20") ~ substr(CodePostal, 1, 
            2)))], corr_CP = data.table(read.xlsx(paste0(path, 
            "data/utils/0618_corresp_CP.xlsx"))), corr_CP = corr_CP[!is.na(code_dep_corr) & 
            code_dep_corr != ""], sidep_add = merge(sidep_add, 
            corr_CP, by = "CodePostal", all.x = T), sidep_add[, 
            `:=`(code_dep, ifelse(!is.na(code_dep_corr), code_dep_corr, 
                code_dep))], reg_dep = data.table::fread(paste0(path, 
            "data/utils/departement2019.csv"), encoding = "Latin-1"), 
        reg_dep$reg = as.character(reg_dep$reg), reg_dep[nchar(reg) == 
            1, `:=`(reg, paste0("0", reg))], reg2019 = data.table::fread(paste0(path, 
            "data/utils/region2019.csv"), encoding = "Latin-1"), 
        reg2019$reg = as.character(reg2019$reg), reg2019[nchar(reg) == 
            1, `:=`(reg, paste0("0", reg))], sidep_add[!code_dep %in% 
            reg_dep$dep, `:=`(code_dep, "dep_inconnu")], sidep_add[code_dep == 
            "dep_inconnu" & !is.na(IRIS) & nchar(IRIS) == 9, 
            `:=`(code_dep, substr(IRIS, 1, 2))], sidep_add[, 
            `:=`(departement, ifelse(code_dep != "dep_inconnu", 
                code_dep, ifelse(RPPSPrescripteur != "291991222", 
                  DEP_ET, "dep_inconnu")))], sidep_add[FINESS_EJ %in% 
            ej_et_same_dep$FINESS_EJ & RPPSPrescripteur != "291991222", 
            `:=`(departement, ifelse(departement != "dep_inconnu", 
                departement, DEP_EJ))], sidep_add = merge(sidep_add, 
            reg_dep[, .(dep, reg, ncc)], by.x = "departement", 
            by.y = "dep", all.x = T), sidep_add[!reg %in% reg_dep$reg, 
            `:=`(reg, "reg_inconnue")], setnames(sidep_add, "ncc", 
            "nom_dep"), sidep_add = merge(sidep_add, ej_et_same_reg[, 
            .(FINESS_EJ, REG_EJ)], by = "FINESS_EJ", all.x = T), 
        sidep_add[FINESS_EJ %in% ej_et_same_reg$FINESS_EJ, `:=`(reg, 
            ifelse(reg != "reg_inconnue", reg, REG_EJ))], sidep_add = sidep_add[, 
            -c("REG_EJ")], sidep_add = merge(sidep_add, reg2019[, 
            .(reg, libelle3)], by = "reg", all.x = T), setnames(sidep_add, 
            "libelle3", "nom_reg"), sidep_add = sidep_add[, -c("code_dep", 
            "code_dep_corr")], print("Professionnel de santé et sexe"), 
        sidep_add[ProfessionelSante %in% c("", "UU", ".U", "u", 
            "Non communiqué", "non fait", "nr", "Non précisé", 
            "np", "NP", "NCDD", "NM", "NO", "UN", "NR", "NCNR", 
            "NCNR2", "Demande annulée", "Automatique"), `:=`(ProfessionelSante, 
            "U")], sidep_add[ProfessionelSante %in% c("n", "NN"), 
            `:=`(ProfessionelSante, "N")], sidep_add[ProfessionelSante %in% 
            c("OO", "o"), `:=`(ProfessionelSante, "O")], sidep_add[!(ProfessionelSante %in% 
            c("U", "O", "N")), `:=`(ProfessionelSante, "U")], 
        sidep_add[Sexe %in% c("O", "", "N", "A"), `:=`(Sexe, 
            "U")], print("Traitement des bases journalières terminé"), 
        sidep_add = sidep_add[, -c("DatePrelevement", "DateValidationCR", 
            "DEP_EJ", "DEP_ET", "NumDossier")], print("Chargement des bases agrégées"), 
        t1 <- Sys.time(), temp <- paste0(path_sortie, date_AAAAMMJJ_last, 
            "_sidep_pcr_"), temp_mois <- MoisAAAA, if (!file.exists(paste0(temp, 
            "Mai021.csv"))) {
            temp_mois <- MoisAAAA[1:(length(MoisAAAA) - 1)]
        }, sidep_prev_pcr_lst <- pbapply::pblapply(temp_mois, 
            function(i) {
                dt <- data.table::fread(paste0(temp, i, ".csv"), 
                  na.strings = "", colClasses = list(Date = date_vars, 
                    POSIXct = posixct_vars, character = char_vars, 
                    numeric = "Age"), verbose = F, sep = ";", 
                  header = TRUE, encoding = "Latin-1")
                if (addP2) {
                  n = nrow(merge(dt, corres, by = "Pseudonyme"))
                  print(sprintf("%s lignes parmi %s ont eu un p1 remplacé par p2 dans le fichier %s.", 
                    n, nrow(dt), i))
                  dt[corres, `:=`(Pseudonyme, i.Pseudo2), on = "Pseudonyme"]
                }
                dt
            }), t2 <- Sys.time(), print(t2 - t1), print(t2 - 
            TIME_INIT), t1 <- Sys.time(), path_zip_sero = paste0(path_sortie, 
            date_AAAAMMJJ_last, "_sidep_sero.csv"), print(path_zip_sero), 
        sidep_prev_sero = data.table::fread(path_zip_sero, na.strings = "", 
            colClasses = list(Date = date_vars, POSIXct = posixct_vars, 
                character = char_vars, numeric = "Age"), verbose = F, 
            sep = ";", header = TRUE, encoding = "Latin-1"), 
        if (addP2) {
            sidep_prev_sero[corres, `:=`(Pseudonyme, i.Pseudo2), 
                on = "Pseudonyme"]
        }, t2 <- Sys.time(), print(t2 - t1), t1 <- Sys.time(), 
        path_zip_pcr_sal_mil = paste0(path_sortie, date_AAAAMMJJ_last, 
            "_sidep_pcr_salivaire_milieux_divers.csv"), print(path_zip_pcr_sal_mil), 
        sidep_prev_pcr_sal_mil = data.table::fread(path_zip_pcr_sal_mil, 
            na.strings = "", colClasses = list(Date = date_vars, 
                POSIXct = posixct_vars, character = char_vars, 
                numeric = "Age"), verbose = F, sep = ";", header = TRUE, 
            encoding = "Latin-1"), if (addP2) {
            sidep_prev_pcr_sal_mil[corres, `:=`(Pseudonyme, i.Pseudo2), 
                on = "Pseudonyme"]
        }, t2 <- Sys.time(), print(t2 - t1), print("Concaténation des bases en liste par mois"), 
        sidep_add[, `:=`(RPPSPrescripteur = as.character(RPPSPrescripteur))], 
        t1 <- Sys.time(), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(date_prelev = fasttime::fastPOSIXct(date_prelev), 
                date_valid = fasttime::fastPOSIXct(date_valid), 
                date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                Age = as.numeric(Age))]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(date_valid = NULL)]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(date_valid = date_valid_init)]), 
        sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, function(i) i[, 
            `:=`(day_prelev2 = as.Date(day_prelev)), by = day_prelev]), 
        sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, function(i) i[, 
            `:=`(day_prelev = NULL)]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) data.table::setnames(i, "day_prelev2", 
                "day_prelev")), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(day_valid2 = as.Date(day_valid)), 
                by = day_valid]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(day_valid = NULL)]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) data.table::setnames(i, "day_valid2", 
                "day_valid")), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(day_extract_sidep2 = as.Date(day_extract_sidep)), 
                by = day_extract_sidep]), sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, 
            function(i) i[, `:=`(day_extract_sidep = NULL)]), 
        sidep_prev_pcr_lst <- lapply(sidep_prev_pcr_lst, function(i) data.table::setnames(i, 
            "day_extract_sidep2", "day_extract_sidep")), t2 <- Sys.time(), 
        print(t2 - t1), last_month = MoisAAAA[length(MoisAAAA)], 
        if (!file.exists(paste0(temp, last_month))) {
            sidep_prev_pcr_lst[[length(sidep_prev_pcr_lst) + 
                1]] <- data.table::data.table()
        }, t1 <- Sys.time(), sidep_prev_sero[, `:=`(mois_prelev, 
            lubridate::month(date_prelev))], sidep_prev_sero[, 
            `:=`(annee_prelev, lubridate::year(date_prelev))], 
        sidep_sero_lst <- split(sidep_prev_sero, by = c("annee_prelev", 
            "mois_prelev")), t2 <- Sys.time(), print(t2 - t1), 
        sidep_sero_lst <- lapply(sidep_sero_lst, function(i) i[, 
            `:=`(mois_prelev, NULL)]), sidep_sero_lst <- lapply(sidep_sero_lst, 
            function(i) i[, `:=`(annee_prelev, NULL)]), sidep_sero_lst <- lapply(sidep_sero_lst, 
            function(i) i[, `:=`(day_prelev = as.Date(day_prelev), 
                day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                date_valid = fasttime::fastPOSIXct(date_valid), 
                date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                day_extract_sidep = as.Date(day_extract_sidep), 
                Age = as.numeric(Age))]), t1 <- Sys.time(), sidep_prev_pcr_sal_mil[, 
            `:=`(mois_prelev, lubridate::month(date_prelev))], 
        sidep_prev_pcr_sal_mil[, `:=`(annee_prelev, lubridate::year(date_prelev))], 
        sidep_prev_pcr_sal_mil_lst <- split(sidep_prev_pcr_sal_mil, 
            by = c("annee_prelev", "mois_prelev")), t2 <- Sys.time(), 
        print(t2 - t1), sidep_prev_pcr_sal_mil_lst <- lapply(sidep_prev_pcr_sal_mil_lst, 
            function(i) i[, `:=`(mois_prelev, NULL)]), sidep_prev_pcr_sal_mil_lst <- lapply(sidep_prev_pcr_sal_mil_lst, 
            function(i) i[, `:=`(annee_prelev, NULL)]), sidep_prev_pcr_sal_mil_lst <- lapply(sidep_prev_pcr_sal_mil_lst, 
            function(i) i[, `:=`(day_prelev = as.Date(day_prelev), 
                day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                date_valid = fasttime::fastPOSIXct(date_valid), 
                date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                day_extract_sidep = as.Date(day_extract_sidep), 
                Age = as.numeric(Age))]), sidep_add[, `:=`(mois_prelev, 
            lubridate::month(date_prelev))], sidep_add[, `:=`(annee_prelev, 
            lubridate::year(date_prelev))], sidep_add <- sidep_add[order(annee_prelev, 
            mois_prelev)], sidep_add_lst <- split(sidep_add, 
            by = c("annee_prelev", "mois_prelev")), sidep_add_lst <- lapply(sidep_add_lst, 
            function(i) i[, `:=`(mois_prelev, NULL)]), sidep_add_lst <- lapply(sidep_add_lst, 
            function(i) i[, `:=`(annee_prelev, NULL)]), names(sidep_prev_pcr_lst) <- YYYY.mm, 
        t1 <- Sys.time(), sidep_lst <- lapply(YYYY.mm, function(i) rbindlist(list(sidep_prev_pcr_lst[[i]], 
            sidep_sero_lst[[i]], sidep_prev_pcr_sal_mil_lst[[i]], 
            sidep_add_lst[[i]]), fill = TRUE)), t2 <- Sys.time(), 
        print(t2 - t1), rm(sidep_add, sidep_add_lst, sidep_sero_lst, 
            sidep_prev_pcr_lst, sidep_prev_pcr_sal_mil_lst), 
        print("Doublons dans la base globale"), etapes_fin = cbind(var = "aucune", 
            n_row = do.call("sum", lapply(sidep_lst, nrow))), 
        treat_duplicates <- function(temp) {
            print(paste0(lubridate::month(temp$date_prelev[1]), 
                " - ", lubridate::year(temp$date_prelev[1])))
            rows_dup <- (duplicated(temp, by = c("Pseudonyme", 
                "date_prelev", "AnalyseConclusion")) | duplicated(temp, 
                by = c("Pseudonyme", "date_prelev", "AnalyseConclusion"), 
                fromLast = TRUE))
            temp[, `:=`(date_valid_init = date_valid, latest_day_extract = day_extract_sidep)]
            temp_to_treat <- temp[rows_dup]
            temp_not_to_treat <- temp[!rows_dup]
            print(nrow(temp_to_treat))
            if (nrow(temp_to_treat) > 0) {
                temp_to_treat[, `:=`(date_valid_init = min(date_valid), 
                  latest_day_extract = max(day_extract_sidep)), 
                  by = c("Pseudonyme", "date_prelev", "AnalyseConclusion")]
                temp_to_treat <- temp_to_treat[day_extract_sidep %in% 
                  latest_day_extract]
                temp_to_treat <- temp_to_treat[, .SD[1], by = c("Pseudonyme", 
                  "date_prelev", "AnalyseConclusion")]
                temp <- rbindlist(list(temp_to_treat, temp_not_to_treat), 
                  fill = T)
            }
            temp[, `:=`(date_valid, date_valid_init)]
            return(temp)
        }, t1 <- Sys.time(), sidep_lst <- lapply(sidep_lst, function(i) treat_duplicates(i)), 
        t2 <- Sys.time(), print(t2 - t1), etapes_fin = rbind(etapes_fin, 
            cbind(var = "dup_tryptique_and_latest_date", n_row = do.call("sum", 
                lapply(sidep_lst, nrow)))), etapes_fin = data.table::data.table(etapes_fin), 
        etapes_fin[, `:=`(n_supp, 0)], etapes_fin[, `:=`(n_row, 
            as.numeric(n_row))], for (i in 2:nrow(etapes_fin)) {
            etapes_fin$n_supp[i] = etapes_fin$n_row[i - 1] - 
                etapes_fin$n_row[i]
        }, etapes_fin <<- etapes_fin, sidep_lst <- lapply(sidep_lst, 
            function(i) i[, `:=`(latest_day_extract = NULL)]), 
        extract_dt <- function(temp) {
            sidep_sero <- lapply(temp, function(i) i[AnalyseConclusion %in% 
                c("94762-2", "94563-4", "94564-2")])
            sidep_pcr <- lapply(temp, function(i) i[AnalyseConclusion == 
                "94500-6"])
            sidep_pcr_sal_mil <- lapply(temp, function(i) i[AnalyseConclusion %in% 
                c("94309-2", "94845-5")])
            return(list(sidep_sero = sidep_sero, sidep_pcr = sidep_pcr, 
                sidep_pcr_sal_mil = sidep_pcr_sal_mil))
        }, t1 <- Sys.time(), sidep <- extract_dt(sidep_lst), 
        t2 <- Sys.time(), print(t2 - t1), rm(sidep_lst), sidep_sero <<- sidep[["sidep_sero"]], 
        sidep_pcr <<- sidep[["sidep_pcr"]], sidep_pcr_sal_mil <<- sidep[["sidep_pcr_sal_mil"]], 
        rm(sidep), print(Sys.time() - TIME_INIT), gc()), list(
        <-, t2, list(Sys.time)), list(print, list(-, t2, t1)), 
    list(print, "ecriture des datas"), list(<-, t1, list(Sys.time)), 
    list(lapply, list(:, 1, list(length, sidep_pcr)), list(function, 
        list(as.pairlist(alist(i = ))), list(list(::, data.table, 
            fwrite), list([[, sidep_pcr, i), list(paste0, path_sortie, 
            date_AAAAMMJJ, "_sidep_pcr_", list([, month, i), 
            ".csv"), TRUE, ".", FALSE, TRUE, ";", list(c, "escape"), 
            "ISO", F), list(841L, 8L, 845L, 82L, 8L, 82L, 841L, 
            845L))), list(<-, t2, list(Sys.time)), list(print, 
        list(-, t2, t1)), list(lapply, sidep_pcr, nrow), list(
        <-, sidep_pcr, list(rbindlist, sidep_pcr, TRUE)), list(
        <-, sidep_sero, list(rbindlist, sidep_sero, T)), list(
        <-, sidep_pcr_sal_mil, list(rbindlist, sidep_pcr_sal_mil, 
            T)), list(<-, t1, list(Sys.time)), list(list(::, 
        data.table, fwrite), sidep_sero, list(paste0, path_sortie, 
        date_AAAAMMJJ, "_sidep_sero.csv"), TRUE, ".", FALSE, 
        TRUE, ";", list(c, "escape"), "ISO", F), list(<-, t2, 
        list(Sys.time)), list(print, list(-, t2, t1)), list(<-, 
        t1, list(Sys.time)), list(list(::, data.table, fwrite), 
        sidep_pcr_sal_mil, list(paste0, path_sortie, date_AAAAMMJJ, 
            "_sidep_pcr_salivaire_milieux_divers.csv"), TRUE, 
        ".", FALSE, TRUE, ";", list(c, "escape"), "ISO", F), 
    list(<-, t2, list(Sys.time)), list(print, list(-, t2, t1)), 
    list(print, "04 TAG"), list(=, safe_fread, list(list(::, 
        purrr, quietly), list(::, data.table, fread))), list(
        <-, prep_data_antigenique, list(function, list(jour_date, 
            jour_prev_update, as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            "2020-05-20", as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = )), 
            as.pairlist(alist(jour = jour_date, last_update = jour_prev_update, MoisAAAA = , YYYY.mm = , day_init = "2020-05-20", corres = , addP2 = ))), 
            list(list(=, TIME_INIT, list(Sys.time)), list(print, 
                list(paste0, "lancement: ", TIME_INIT)), list(
                =, date_AAAAMMJJ_last, list(format, last_update, 
                  "%Y%m%d")), list(=, date_AAMMJJ_last, list(
                substr, date_AAAAMMJJ_last, 3, 8)), list(=, extractions, 
                list(list.files, path_data)), list(=, extractions, 
                list(grep, "CSV_DREES", extractions, T)), list(
                =, extractions, list(grep, ".csv", extractions, 
                  T)), list(<-, extractions, list([, extractions, 
                list(!, list(%in%, extractions, list(c, "CSV_DREES_200518200002.csv", 
                  "CSV_DREES_200519090000.csv", "CSV_DREES_200520090000.csv", 
                  "CSV_DREES_200625130000.csv"))))), list(<-, 
                extractions, list([, extractions, list(!, list(
                  grepl, "ini", extractions)))), list(=, extractions, 
                list(sort, extractions, T)), list(<-, list(names, 
                extractions), list(substr, extractions, 13, 16)), 
                list(print, "Chargement des bases journalières à agréger"), 
                list(=, extract, list([, extractions, list(==, 
                  list(substr, extractions, 16, 21), date_AAMMJJ))), 
                list(<-, list(names, extract), list(substr, extract, 
                  11, 14)), list(=, sidep_add_1, list(safe_fread, 
                  list(paste0, path_data, list([, extract, "MED4")), 
                  "", F, "|", TRUE, list(list, daily_files_char_vars, 
                    "Age"), "Latin-1")), list(print, list([, 
                  extract, "MED4")), list(<-, w, list($, sidep_add_1, 
                  warnings)), list(<-, w, list([, w, list(grepl, 
                  "^Stopped early", w))), list(if, list(>, list(
                  length, w), 0), list(list(stop, w))), list(
                  <-, sidep_add_1, list($, sidep_add_1, result)), 
                list(=, sidep_add_2, list(safe_fread, list(paste0, 
                  path_data, list([, extract, "MED2")), "", F, 
                  "|", TRUE, list(list, daily_files_char_vars, 
                    "Age"), "Latin-1")), list(print, list([, 
                  extract, "MED2")), list(<-, w, list($, sidep_add_2, 
                  warnings)), list(<-, w, list([, w, list(grepl, 
                  "^Stopped early", w))), list(if, list(>, list(
                  length, w), 0), list(list(stop, w))), list(
                  <-, sidep_add_2, list($, sidep_add_2, result)), 
                list(rm, w), list(=, sidep_add, list(rbind, sidep_add_1, 
                  sidep_add_2)), list(rm, sidep_add_1, sidep_add_2), 
                list(print, list([, extract, "MED4")), list(print, 
                  list([, extract, "MED2")), list(<-, sidep_add, 
                  list([, sidep_add, list(%in%, AnalyseConclusion, 
                    list(c, "94558-4")))), list(=, list($, sidep_add, 
                  day_extract_sidep), list(as.Date, date_AAAAMMJJ, 
                  "%Y%m%d")), list(print, list(nrow, sidep_add)), 
                list(setnames, sidep_add, "Pseudo2", "Pseudonyme"), 
                list([, sidep_add, sidep_add[, `:=`(Pseudo1, 
                  NULL)], list(:=, Pseudo1, NULL)), list(print, 
                  "Suppression des antislash et .br"), list([, 
                  sidep_add, sidep_add[, `:=`(Joker1, NULL)], 
                  list(:=, Joker1, NULL)), list([, sidep_add, 
                  sidep_add[, `:=`(Joker2, NULL)], list(:=, Joker2, 
                    NULL)), list([, sidep_add, sidep_add[, `:=`(Joker3, 
                  NULL)], list(:=, Joker3, NULL)), list(<-, nettoyage, 
                  list(function, list(as.pairlist(alist(temp = , element = )), 
                    as.pairlist(alist(temp = , element = ))), 
                    list(list(for, i, list(colnames, temp), list(
                      list(print, i), list(print, list([, temp, 
                        list(grep, element, list(get, i)), .N)), 
                      list(if, list(>, list([, temp, list(grep, 
                        element, list(get, i)), .N), 0), list(
                        list(<-, idx, list(grep, element, list(
                          [[, temp, i))), list([, temp, list(
                          grep, element, list(get, i)), list(
                          :=, list(c, i), list(list, list(list(
                            ::, stringr, str_replace_all), list(
                            get, i), element, "")))))))), list(
                      return, temp)), list(938L, 16L, 949L, 3L, 
                      16L, 3L, 938L, 949L))), list(<-, sidep_add, 
                  list(nettoyage, sidep_add, ";")), list(<-, 
                  sidep_add, list(nettoyage, sidep_add, "\\\\")), 
                list(<-, sidep_add, list(nettoyage, sidep_add, 
                  "\"")), list(=, list($, sidep_add, RPPSPrescripteur), 
                  list(list(::, stringr, str_extract), list($, 
                    sidep_add, RPPSPrescripteur), "([0-9]{1,14})")), 
                list(=, list($, sidep_add, RPPSPrescripteur), 
                  list(as.integer64, list($, sidep_add, RPPSPrescripteur))), 
                list([, sidep_add, list(==, RPPSPrescripteur, 
                  0), list(:=, RPPSPrescripteur, NA)), list(=, 
                  list($, sidep_add, CodePostal), list(gsub, 
                    "(\\\\)", "", list($, sidep_add, CodePostal))), 
                list(=, list($, sidep_add, CodePostal), list(
                  gsub, "(.br)", "", list($, sidep_add, CodePostal))), 
                list(<-, list($, sidep_add, FINESS_c), list($, 
                  sidep_add, FINESS)), list(=, list($, sidep_add, 
                  FINESS), list(list(::, stringr, str_extract), 
                  list($, sidep_add, FINESS), "(^[0-9AB]{1,15})")), 
                list([, sidep_add, sidep_add[, `:=`(FINESS, lest::case_when(FINESS == 
                  "A" ~ NA_character_, TRUE ~ FINESS))], list(
                  :=, FINESS, list(list(::, lest, case_when), 
                    list(~, list(==, FINESS, "A"), NA_character_), 
                    list(~, TRUE, FINESS)))), list([, sidep_add, 
                  sidep_add[, `:=`(FINESS, ifelse(FINESS == "" | 
                    nchar(FINESS) < 8, NA, FINESS))], list(:=, 
                    FINESS, list(ifelse, list(|, list(==, FINESS, 
                      ""), list(<, list(nchar, FINESS), 8)), 
                      NA, FINESS))), list(=, list($, sidep_add, 
                  FINESSGeographique), list(list(::, stringr, 
                  str_extract), list($, sidep_add, FINESSGeographique), 
                  "([0-9AB]{1,15})")), list([, sidep_add, sidep_add[, 
                  `:=`(FINESSGeographique, ifelse(FINESSGeographique == 
                    "" | nchar(FINESSGeographique) < 8, NA, FINESSGeographique))], 
                  list(:=, FINESSGeographique, list(ifelse, list(
                    |, list(==, FINESSGeographique, ""), list(
                      <, list(nchar, FINESSGeographique), 8)), 
                    NA, FINESSGeographique))), list([, sidep_add, 
                  sidep_add[, `:=`(regCampagneDepistage, stringr::str_extract(NumCampagneDepistage, 
                    "^[A-Za-z]{3}"))], list(:=, regCampagneDepistage, 
                    list(list(::, stringr, str_extract), NumCampagneDepistage, 
                      "^[A-Za-z]{3}"))), list(if, list(>, list(
                  [, sidep_add, list(<, list(nchar, regCampagneDepistage), 
                    3), .N), 0), list(list(print, "Probleme: il y a des trigrammes dans NumCampagneDepistage qui ont moins de 3 caractères"))), 
                list([, sidep_add, sidep_add[, `:=`(regCampagneDepistage, 
                  NULL)], list(:=, regCampagneDepistage, NULL)), 
                list([, sidep_add, sidep_add[, `:=`(FINESS_c_maj, 
                  toupper(FINESS_c))], list(:=, FINESS_c_maj, 
                  list(toupper, FINESS_c))), list([, sidep_add, 
                  sidep_add[, `:=`(FINESS_c_maj, ifelse(stringr::str_starts(FINESS_c_maj, 
                    "MLETEST"), NA, FINESS_c_maj))], list(:=, 
                    FINESS_c_maj, list(ifelse, list(list(::, 
                      stringr, str_starts), FINESS_c_maj, "MLETEST"), 
                      NA, FINESS_c_maj))), list([, sidep_add, 
                  sidep_add[, `:=`(RPPSPrelevTA, stringr::str_extract(FINESS_c_maj, 
                    "^(RPPS_)([0-9a-zA-Z]+)"))], list(:=, RPPSPrelevTA, 
                    list(list(::, stringr, str_extract), FINESS_c_maj, 
                      "^(RPPS_)([0-9a-zA-Z]+)"))), list([, sidep_add, 
                  sidep_add[, `:=`(AdeliPrelevTA, stringr::str_extract(FINESS_c_maj, 
                    "^(ADELI_)([0-9a-zA-Z]+)"))], list(:=, AdeliPrelevTA, 
                    list(list(::, stringr, str_extract), FINESS_c_maj, 
                      "^(ADELI_)([0-9a-zA-Z]+)"))), list([, sidep_add, 
                  sidep_add[, `:=`(idNATPrelevTA, stringr::str_extract(FINESS_c_maj, 
                    "^(IDNAT_)([0-9a-zA-Z]+)"))], list(:=, idNATPrelevTA, 
                    list(list(::, stringr, str_extract), FINESS_c_maj, 
                      "^(IDNAT_)([0-9a-zA-Z]+)"))), list([, sidep_add, 
                  sidep_add[, `:=`(ProfPrelevTA, stringr::str_extract(FINESS_c_maj, 
                    "(PROF_)([a-zA-Z]+)"))], list(:=, ProfPrelevTA, 
                    list(list(::, stringr, str_extract), FINESS_c_maj, 
                      "(PROF_)([a-zA-Z]+)"))), list([, sidep_add, 
                  sidep_add[, `:=`(CPPrelevTA, stringr::str_extract(FINESS_c_maj, 
                    "(CP_)([0-9a-zA-Z]+)"))], list(:=, CPPrelevTA, 
                    list(list(::, stringr, str_extract), FINESS_c_maj, 
                      "(CP_)([0-9a-zA-Z]+)"))), list([, sidep_add, 
                  sidep_add[, `:=`(TopPrelevTA, ifelse(stringr::str_starts(FINESS_c_maj, 
                    "(RPPS|ADELI|IDNAT)"), 1, 0))], list(:=, 
                    TopPrelevTA, list(ifelse, list(list(::, stringr, 
                      str_starts), FINESS_c_maj, "(RPPS|ADELI|IDNAT)"), 
                      1, 0))), list(print, list([, sidep_add, 
                  sidep_add[, table(TopPrelevTA, ProfPrelevTA)], 
                  list(table, TopPrelevTA, ProfPrelevTA))), list(
                  if, list(>, list(nrow, list([, sidep_add, list(
                    &, list(==, TopPrelevTA, 0), list(!, list(
                      (, list(is.na, ProfPrelevTA)))), list(., 
                    FINESS_c))), 0), list(list(print, "Probleme il y a des top prelev TA à 0 alors qu'il y a une profession"))), 
                list([, sidep_add, sidep_add[, `:=`(RPPSPrelevTA, 
                  stringr::str_replace(RPPSPrelevTA, "RPPS_", 
                    ""))], list(:=, RPPSPrelevTA, list(list(::, 
                  stringr, str_replace), RPPSPrelevTA, "RPPS_", 
                  ""))), list([, sidep_add, sidep_add[, `:=`(AdeliPrelevTA, 
                  stringr::str_replace(AdeliPrelevTA, "ADELI_", 
                    ""))], list(:=, AdeliPrelevTA, list(list(
                  ::, stringr, str_replace), AdeliPrelevTA, "ADELI_", 
                  ""))), list([, sidep_add, sidep_add[, `:=`(idNATPrelevTA, 
                  stringr::str_replace(idNATPrelevTA, "IDNAT_", 
                    ""))], list(:=, idNATPrelevTA, list(list(
                  ::, stringr, str_replace), idNATPrelevTA, "IDNAT_", 
                  ""))), list([, sidep_add, sidep_add[, `:=`(ProfPrelevTA, 
                  stringr::str_replace(ProfPrelevTA, "PROF_", 
                    ""))], list(:=, ProfPrelevTA, list(list(::, 
                  stringr, str_replace), ProfPrelevTA, "PROF_", 
                  ""))), list([, sidep_add, sidep_add[, `:=`(CPPrelevTA, 
                  stringr::str_replace(CPPrelevTA, "CP_", ""))], 
                  list(:=, CPPrelevTA, list(list(::, stringr, 
                    str_replace), CPPrelevTA, "CP_", ""))), list(
                  print, "Traitement des dates"), list([, sidep_add, 
                  sidep_add[, `:=`(date_prelev, lubridate::ymd_hms(paste0(substr(DatePrelevement, 
                    1, 4), "-", substr(DatePrelevement, 5, 6), 
                    "-", substr(DatePrelevement, 7, 8), " ", 
                    substr(DatePrelevement, 9, 10), ":", substr(DatePrelevement, 
                      11, 12), ":", substr(DatePrelevement, 13, 
                      14))))], list(:=, date_prelev, list(list(
                    ::, lubridate, ymd_hms), list(paste0, list(
                    substr, DatePrelevement, 1, 4), "-", list(
                    substr, DatePrelevement, 5, 6), "-", list(
                    substr, DatePrelevement, 7, 8), " ", list(
                    substr, DatePrelevement, 9, 10), ":", list(
                    substr, DatePrelevement, 11, 12), ":", list(
                    substr, DatePrelevement, 13, 14))))), list(
                  [, sidep_add, sidep_add[, `:=`(day_prelev, 
                    as.Date(date_prelev))], list(:=, day_prelev, 
                    list(as.Date, date_prelev))), list([, sidep_add, 
                  sidep_add[, `:=`(date_valid, lubridate::ymd_hms(paste0(substr(DateValidationCR, 
                    1, 4), "-", substr(DateValidationCR, 5, 6), 
                    "-", substr(DateValidationCR, 7, 8), " ", 
                    substr(DateValidationCR, 9, 10), ":", substr(DateValidationCR, 
                      11, 12), ":", substr(DateValidationCR, 
                      13, 14))))], list(:=, date_valid, list(
                    list(::, lubridate, ymd_hms), list(paste0, 
                      list(substr, DateValidationCR, 1, 4), "-", 
                      list(substr, DateValidationCR, 5, 6), "-", 
                      list(substr, DateValidationCR, 7, 8), " ", 
                      list(substr, DateValidationCR, 9, 10), 
                      ":", list(substr, DateValidationCR, 11, 
                        12), ":", list(substr, DateValidationCR, 
                        13, 14))))), list([, sidep_add, sidep_add[, 
                  `:=`(day_valid, as.Date(date_valid))], list(
                  :=, day_valid, list(as.Date, date_valid))), 
                list(if, list(!, list(is.na, day_init)), list(
                  list(=, sidep_add, list([, sidep_add, list(
                    &, list(>=, day_prelev, list(as.Date, day_init)), 
                    list(<=, day_prelev, date_dataset)))), list(
                    =, sidep_add, list([, sidep_add, list(|, 
                      list(is.na, day_valid), list((, list(&, 
                        list(&, list(!, list(is.na, day_valid)), 
                          list(>=, day_valid, list(as.Date, day_init))), 
                        list(<=, day_valid, date_dataset)))))))), 
                list(=, sidep_add, list([, sidep_add, list(<=, 
                  day_prelev, day_extract_sidep))), list(print, 
                  "Pseudonymes"), list(if, list(!=, list(sum, 
                  list(>, list(nchar, list($, sidep_add, Pseudonyme)), 
                    64), T), 0), list(list([, sidep_add, list(
                  %in%, list(nchar, Pseudonyme), list(c, 128, 
                    192)), list(:=, Pseudonyme, list(substr, 
                  Pseudonyme, 1, 64))))), list(=, pseudos_tests, 
                  list(c, "78b14ef7c9ed19082b6d2d151678b8a74606f7dd33b811b3f97f41fe20793ea5", 
                    "cf77f9f6fc3d4a40260af813aed7c3f80c274660aff9f978a99f98d29544be0c", 
                    "e76950f02d9763a2533a4c6b0a3a0621e0dcfd3133c5fc3d1d0064b3324a3d50", 
                    "ef9ecddf446243b60b9f15e8c7a521f79f21bfb2f95b0d6d54b4f3533f85a1d1", 
                    "9fdcb52ac99ef7497ce75a543cf99afbb8c9af6f8dfd417f2a62b3dbca0ae23d", 
                    "cd88cea5ff5a72eca228f63c9513492d45b5b78509e237ab55e0d787f896d747", 
                    "c9d915880d6266a23ca95992a009a4491bbed5e3882fbd60b556a9df09dde4a0", 
                    "aeaab01f88b19d53b7680a7fbc2a46fba31de13b2f60f75679ea2f971d8ce346", 
                    "5161630ccba995deaa8d6ba5012ca521b0b245a9bd5e78658d6311ddffc0f8ec", 
                    "4d07e44674b72d5c6ef58605058b671f0884394adf6535b194771325e709034f", 
                    "a5c373e024776111dbb999506c28d41e4dca3011a41394493526bca3476136f0", 
                    "9a4708216b2624f4461e6aa3b1181f03ecb3d4605d9d658ce6cc8fbf59a17557", 
                    "8728ef871def06e09529733e60bebdde00e559a05da5bcf0b91cb13a67374564", 
                    "2153039929b6bd83dd502e01d41cd4319e9674c8dedbe28d3d625e0102c5a450", 
                    "03b8e61d5548edc7a9490ed86d2fbfcd8edc4746489e8543fdff64d5527e8ed8", 
                    "efdaf8f12656c9b015c3410c4a8879b3c07c7b121493f5c2617df8d0db6b17ef", 
                    "3563fc0e12e0e2187c0e1117849bcbc849c60afef9f807cc54b90a7e3e6bd818", 
                    "4b1081eadac91e9bc974ac8cb2dd437e31dca5d2e88e086d5f68fdffa2efb0a2", 
                    "2fed8eadd4765b47d5d034b1624ffc19f9f1a8dd6853887597039952d87489be", 
                    "2b90416ea89cd21fe3ae4eb90ac3d8158afe87f4dc6ef43c257a37e857787107", 
                    "68d80449eb5960e1912a1043ee6f388fc75417d87e246e4402538d1ad577ef6a", 
                    "23c3e79e45865410393b5520d9841854427f435f272ddd32d365bb73af5570c2", 
                    "5fb63a89cb4a0108ba7e4b5cea5b8a7cad48c64aa24c000f0d7cb49dddf26f43", 
                    "7b7fbf4ff01a5920ea08159889b6d1a9ff03f1d26a50d30cd3b142a68e633079", 
                    "3bc66709adac0bac1158bbdf7500eda1c370ef0132c65b861856ea677c405470")), 
                list(=, sidep_add, list([, sidep_add, list(!, 
                  list((, list(%in%, Pseudonyme, pseudos_tests))))), 
                list(print, "AnalyseConclusion"), list(=, sidep_add, 
                  list([, sidep_add, list(%in%, AnalyseConclusion, 
                    list(c, "94558-4")))), list(print, "Doublons parfaits extractions"), 
                list(=, etapes, list(cbind, "aucune", list(nrow, 
                  sidep_add))), list(<-, sidep_add, list(unique, 
                  sidep_add)), list(=, etapes, list(rbind, etapes, 
                  list(cbind, "Duplicates_all_lines", list(nrow, 
                    sidep_add)))), list(print, "Premiers symptômes"), 
                list([, sidep_add, list(%in%, PremierSymptomes, 
                  list(c, "", "UU", "u", "non précisé", "Non communiqué", 
                    "NON RENSEIGNE", "non renseignÃ©", "nrens", 
                    "PAS RENSEIGNE", "NR", "Non renseigné", "NON PRECISE", 
                    "Non précisé", "non renseignée", "NRENS", 
                    "np", "NCNR", "NRE", "NSP", "NP", "NM", "V", 
                    "ne sais pas", "non fait", "VOIR PRESCRIPTION JOINTE", 
                    "NPC", "INC", "BILAN PREOP", "?", "nc", "nr", 
                    "0.000000", "0R", "GAPS2", "Demande annulée", 
                    "Non communiqué", "NCNR2")), list(:=, PremierSymptomes, 
                  "U")), list([, sidep_add, list(%in%, PremierSymptomes, 
                  list(c, "PAS DE SYMPTOME", "a", "Asymptomatique.", 
                    "AUCUN SYMPTOME", "asy", "APSYU", "ASy", 
                    "ASYM", "A", "ASYASY", "ASYM ", "ASYU", "PASYM", 
                    "UASY", "avant entrée en EHPAD", "avant retour en EHPAD", 
                    "entrée de geriatrie", "entree en geriatrie", 
                    "avant rentrée en ehpad", "AVANT TRANSFERT EHPAD", 
                    "BILAN PRE OP", "TEST PRE OP", "TRANSFERT EN  EHPAD", 
                    "Transfert SSR-P")), list(:=, PremierSymptomes, 
                  "ASY")), list([, sidep_add, list(grepl, "(Pas de symptomes)|(ASYV)|(VASY)|(Pré opératoire)|(PAS DE SYMPTOMES)|(PRE-OPERATOIRE)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "ASY")), list([, sidep_add, list(grepl, "(apparus le jour ou la veille)|(D1)|(S01S01)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "S01")), list([, sidep_add, list(grepl, "(apparus 2,3)|(apparus 2, 3)|(D2)|(D3)|(quelques jours)|(Quelques jours)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "S24")), list([, sidep_add, list(%in%, PremierSymptomes, 
                  list(c, "05/05/20")), list(:=, PremierSymptomes, 
                  "S57")), list([, sidep_add, list(grepl, "(apparus 5,6)|(apparus 5, 6)|(D5)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "S57")), list([, sidep_add, list(grepl, "(SS2SS2)|(D9)|(D11)|(S814)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SS2")), list([, sidep_add, list(grepl, "(apparus entre 8 et 15 jours)|(apparus entre 8 et 14 jours)|(S814)|(ss2)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SS2")), list([, sidep_add, list(grepl, "(apparus plus de 2 semaines)|(apparus plus de deux semaines)|(+ 15 jours)|(>j15)|(SS34)|(SS3SS3)|(S2-S4)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SS3")), list([, sidep_add, list(grepl, "(apparus plus de deux semaines avant le prelevement)|(apparus entre 15 et 28 jours)|(SS3U)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SS3")), list([, sidep_add, list(grepl, "(il y a 1 mois)|(plus de 3 semaines)|(DECEMBRE 19)|(plus de quatre semaines)|(D29)|(SP4S)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SS3")), list([, sidep_add, list(grepl, "(Eruption cutanée)|(colique)|(30/05/20)|(07/06/20)|(202005)|(202006)", 
                  PremierSymptomes), list(:=, PremierSymptomes, 
                  "SNA")), list(print, "TypologiePatient"), list(
                  [, sidep_add, list(==, TypologiePatient, ""), 
                  list(:=, TypologiePatient, "U")), list([, sidep_add, 
                  list(%in%, TypologiePatient, list(c, "Autre structure d'hébergement collectif", 
                    "Autre structure d'hébergement", "autre structure d'hébergement collectif")), 
                  list(:=, TypologiePatient, "A")), list([, sidep_add, 
                  list(%in%, TypologiePatient, list(c, "résident en EHPAD", 
                    "Résident en EHPAD")), list(:=, TypologiePatient, 
                    "E")), list([, sidep_add, list(%in%, TypologiePatient, 
                  list(c, "HH")), list(:=, TypologiePatient, 
                  "H")), list([, sidep_add, list(%in%, TypologiePatient, 
                  list(c, "II", "i")), list(:=, TypologiePatient, 
                  "H")), list([, sidep_add, list(!, list(%in%, 
                  TypologiePatient, list(c, "I", "H", "E", "C", 
                    "A", "U"))), list(:=, TypologiePatient, "U")), 
                list(print, "Resultat"), list([, sidep_add, list(
                  %in%, Resultat, list(c, "negatif", "NEGATIF", 
                    "Négative", "N?gatif", "NN", "NNN", "NEG", 
                    "n")), list(:=, Resultat, "N")), list([, 
                  sidep_add, list(grepl, "(ninterp)|(ndéterminé)", 
                    Resultat), list(:=, Resultat, "I")), list(
                  [, sidep_add, list(%in%, Resultat, list(c, 
                    "PP")), list(:=, Resultat, "P")), list([, 
                  sidep_add, list(==, Resultat, "N"), list(:=, 
                    valeur, "N")), list([, sidep_add, list(==, 
                  Resultat, "P"), list(:=, valeur, "P")), list(
                  [, sidep_add, list(==, Resultat, "I"), list(
                    :=, valeur, "I")), list([, sidep_add, list(
                  ==, Resultat, "X"), list(:=, valeur, "X")), 
                list(print, "Doublons dans les dernières extractions"), 
                list([, sidep_add, sidep_add[, `:=`(na_res, ifelse(Resultat %in% 
                  c("", "X", "I") | is.na(Resultat) | nchar(Resultat) > 
                  1, 1, 0))], list(:=, na_res, list(ifelse, list(
                  |, list(|, list(%in%, Resultat, list(c, "", 
                    "X", "I")), list(is.na, Resultat)), list(
                    >, list(nchar, Resultat), 1)), 1, 0))), list(
                  [, sidep_add, sidep_add[, `:=`(na_typo, ifelse(TypologiePatient == 
                    "U" | is.na(TypologiePatient), 1, 0))], list(
                    :=, na_typo, list(ifelse, list(|, list(==, 
                      TypologiePatient, "U"), list(is.na, TypologiePatient)), 
                      1, 0))), list([, sidep_add, sidep_add[, 
                  `:=`(na_cp, ifelse(CodePostal == "" | is.na(CodePostal) | 
                    nchar(CodePostal) != 5, 1, 0))], list(:=, 
                  na_cp, list(ifelse, list(|, list(|, list(==, 
                    CodePostal, ""), list(is.na, CodePostal)), 
                    list(!=, list(nchar, CodePostal), 5)), 1, 
                    0))), list([, sidep_add, sidep_add[, `:=`(na_sympto, 
                  ifelse(PremierSymptomes == "" | is.na(PremierSymptomes) | 
                    nchar(PremierSymptomes) == "U", 1, 0))], 
                  list(:=, na_sympto, list(ifelse, list(|, list(
                    |, list(==, PremierSymptomes, ""), list(is.na, 
                      PremierSymptomes)), list(==, list(nchar, 
                    PremierSymptomes), "U")), 1, 0))), list(=, 
                  sidep_add, list([, sidep_add, sidep_add[, `:=`(date_valid_init = min(date_valid), 
                    latest_day_extract = max(day_extract_sidep), 
                    res_ok = min(na_res), typo_ok = min(na_typo), 
                    cp_ok = min(na_cp), sympto_ok = min(na_sympto)), 
                    by = .(Pseudonyme, date_prelev, AnalyseConclusion)], 
                    list(:=, list(min, date_valid), list(max, 
                      day_extract_sidep), list(min, na_res), 
                      list(min, na_typo), list(min, na_cp), list(
                        min, na_sympto)), list(., Pseudonyme, 
                      date_prelev, AnalyseConclusion))), list(
                  <-, sidep_add, list([, sidep_add, list(%in%, 
                    day_extract_sidep, latest_day_extract))), 
                list(=, etapes, list(rbind, etapes, list(cbind, 
                  "latest_extract", list(nrow, sidep_add)))), 
                list(<-, sidep_add, list([, sidep_add, list(==, 
                  na_res, res_ok))), list(=, etapes, list(rbind, 
                  etapes, list(cbind, "Resultat", list(nrow, 
                    sidep_add)))), list(<-, sidep_add, list([, 
                  sidep_add, list(==, na_typo, typo_ok))), list(
                  =, etapes, list(rbind, etapes, list(cbind, 
                    "TypologiePatient", list(nrow, sidep_add)))), 
                list(<-, sidep_add, list([, sidep_add, list(==, 
                  na_cp, cp_ok))), list(=, etapes, list(rbind, 
                  etapes, list(cbind, "CodePostal", list(nrow, 
                    sidep_add)))), list(<-, sidep_add, list([, 
                  sidep_add, list(==, na_sympto, sympto_ok))), 
                list(=, etapes, list(rbind, etapes, list(cbind, 
                  "PremierSymptomes", list(nrow, sidep_add)))), 
                list(=, sidep_add, list([, sidep_add, sidep_add[, 
                  -c("latest_day_extract", "na_res", "res_ok", 
                    "na_typo", "typo_ok", "na_cp", "cp_ok", "na_sympto", 
                    "sympto_ok")], list(-, list(c, "latest_day_extract", 
                  "na_res", "res_ok", "na_typo", "typo_ok", "na_cp", 
                  "cp_ok", "na_sympto", "sympto_ok")))), list(
                  =, sidep_add, list([, sidep_add, sidep_add[, 
                    .SD[1], by = c("Pseudonyme", "date_prelev", 
                      "AnalyseConclusion")], list([, .SD, 1), 
                    list(c, "Pseudonyme", "date_prelev", "AnalyseConclusion"))), 
                list(=, etapes, list(rbind, etapes, list(cbind, 
                  "dup_tryptique", list(nrow, sidep_add)))), 
                list(=, etapes, list(data.table, etapes)), list(
                  [, etapes, etapes[, `:=`(n_supp, 0)], list(
                    :=, n_supp, 0)), list([, etapes, etapes[, 
                  `:=`(n_row, as.numeric(n_row))], list(:=, n_row, 
                  list(as.numeric, n_row))), list(for, i, list(
                  :, 2, list(nrow, etapes)), list(list(=, list(
                  [, list($, etapes, n_supp), i), list(-, list(
                  [, list($, etapes, n_row), list(-, i, 1)), 
                  list([, list($, etapes, n_row), i))))), list(
                  <<-, etapes, etapes), list(print, "Finess"), 
                list(=, matching_fi, list(function, list(as.pairlist(alist(data_sidep = ))), 
                  list(list(setnames, data_sidep, "FINESS", "fi_init"), 
                    list(load, list(paste0, path, "data/utils/finess_1116.Rdata")), 
                    list(<-, liste_et, list(%>%, liste_et, list(
                      select, ET-Département
Code, EJ-N°FINESS, 
                      EJ-Département
Code, ET-N°FINESS))), list(
                      <-, sidep_geo, list(inner_join, data_sidep, 
                        list(%>%, liste_et, list(select, FINESS_ET, 
                          DEP_ET, FINESS_EJ, DEP_EJ)), "fi_init")), 
                    list(<-, list($, sidep_geo, FINESS_ET), list(
                      $, sidep_geo, fi_init)), list(<-, sidep_ju, 
                      list(inner_join, data_sidep, list(%>%, 
                        list(%>%, list(%>%, list(%>%, list(as_tibble, 
                          liste_et), list(select, FINESS_EJ, 
                          DEP_EJ)), list(group_by, fi_init)), 
                          list(slice, 1)), list(ungroup)), "fi_init")), 
                    list(<-, list($, sidep_ju, FINESS_EJ), list(
                      $, sidep_ju, fi_init)), list(<-, sidep_ok, 
                      list(rbindlist, list(list, sidep_geo, sidep_ju), 
                        T)), list(<-, data_sidep, list(merge, 
                      data_sidep, list(unique, list([, sidep_ok, 
                        sidep_ok[, .(fi_init, FINESS_ET, DEP_ET, 
                          FINESS_EJ, DEP_EJ)], list(., fi_init, 
                          FINESS_ET, DEP_ET, FINESS_EJ, DEP_EJ))), 
                      "fi_init", "fi_init", T)), list(<-, bio3_et, 
                      list(list(::, readxl, read_excel), list(
                        paste0, path, "data/utils/bio3_et_1116.xlsx"))), 
                    list(<-, data_sidep, list(left_join, data_sidep, 
                      list(%>%, list(%>%, list(%>%, list(%>%, 
                        bio3_et, list(group_by, FINESS_EJ)), 
                        list(slice, 1)), list(ungroup)), list(
                        select, FINESS_EJ, cat_etb)), "FINESS_EJ")), 
                    list(<-, list($, data_sidep, cat_pp), list(
                      ifelse, list(%in%, list($, data_sidep, 
                        cat_etb), list(c, "2000", "3000")), "privé", 
                      NA)), list(<-, list($, data_sidep, cat_pp), 
                      list(ifelse, list(==, list($, data_sidep, 
                        cat_etb), "1000"), "public", list($, 
                        data_sidep, cat_pp))), list(table, list(
                      $, data_sidep, cat_pp), NULL), list(=, 
                      data_sidep, list(data.table, data_sidep)), 
                    list(remove, sidep_ok, sidep_ju, sidep_geo), 
                    list([, data_sidep, list(is.na, DEP_EJ), 
                      list(:=, DEP_EJ, "dep_inconnu")), list(
                      [, data_sidep, list(is.na, DEP_ET), list(
                        :=, DEP_ET, "dep_inconnu")), list(=, 
                      reg_dep, list(list(::, data.table, fread), 
                        list(paste0, path, "data/utils/departement2019.csv"))), 
                    list(=, list($, reg_dep, reg), list(as.character, 
                      list($, reg_dep, reg))), list([, reg_dep, 
                      list(==, list(nchar, reg), 1), list(:=, 
                        reg, list(paste0, "0", reg))), list(=, 
                      ej_et_dep, list(data.table, list([, liste_et, 
                        liste_et[, c("FINESS_ET", "DEP_ET", "FINESS_EJ", 
                          "DEP_EJ")], list(c, "FINESS_ET", "DEP_ET", 
                          "FINESS_EJ", "DEP_EJ")))), list(=, 
                      ej_et_dep, list(merge, ej_et_dep, list(
                        [, reg_dep, reg_dep[, .(dep, reg)], list(
                          ., dep, reg)), "DEP_ET", "dep", T)), 
                    list(setnames, ej_et_dep, "reg", "REG_ET"), 
                    list(=, ej_et_dep, list(merge, ej_et_dep, 
                      list([, reg_dep, reg_dep[, .(dep, reg)], 
                        list(., dep, reg)), "DEP_EJ", "dep", 
                      T)), list(setnames, ej_et_dep, "reg", "REG_EJ"), 
                    list(=, nb_dep_par_ej, list([, ej_et_dep, 
                      ej_et_dep[, .(n_distinct(DEP_ET)), by = .(FINESS_EJ)], 
                      list(., list(n_distinct, DEP_ET)), list(
                        ., FINESS_EJ))), list(/, list(sum, list(
                      ==, list($, nb_dep_par_ej, V1), 1)), list(
                      length, list(unique, list($, ej_et_dep, 
                        FINESS_EJ)))), list(=, ej_et_same_dep, 
                      list([, ej_et_dep, list(%in%, FINESS_EJ, 
                        list([, list($, nb_dep_par_ej, FINESS_EJ), 
                          list(==, list($, nb_dep_par_ej, V1), 
                            1))))), list(=, ej_et_same_dep, list(
                      [, ej_et_same_dep, list(==, DEP_ET, DEP_EJ))), 
                    list(=, ej_et_same_dep, list(unique, list(
                      [, ej_et_same_dep, ej_et_same_dep[, .(FINESS_EJ, 
                        DEP_EJ)], list(., FINESS_EJ, DEP_EJ)))), 
                    list(=, nb_reg_par_ej, list([, ej_et_dep, 
                      ej_et_dep[, .(n_distinct(REG_ET)), by = .(FINESS_EJ)], 
                      list(., list(n_distinct, REG_ET)), list(
                        ., FINESS_EJ))), list(/, list(sum, list(
                      ==, list($, nb_reg_par_ej, V1), 1)), list(
                      length, list(unique, list($, ej_et_dep, 
                        FINESS_EJ)))), list(=, ej_et_same_reg, 
                      list([, ej_et_dep, list(%in%, FINESS_EJ, 
                        list([, list($, nb_reg_par_ej, FINESS_EJ), 
                          list(==, list($, nb_reg_par_ej, V1), 
                            1))))), list(=, ej_et_same_reg, list(
                      [, ej_et_same_reg, list(==, REG_ET, REG_EJ))), 
                    list(=, ej_et_same_reg, list(unique, list(
                      [, ej_et_same_reg, ej_et_same_reg[, .(FINESS_EJ, 
                        REG_EJ)], list(., FINESS_EJ, REG_EJ)))), 
                    list(<<-, ej_et_same_dep, ej_et_same_dep), 
                    list(<<-, ej_et_same_reg, ej_et_same_reg), 
                    list([, data_sidep, data_sidep[, `:=`(cat_pp, 
                      iconv(cat_pp, from = "UTF-8", to = "latin1"))], 
                      list(:=, cat_pp, list(iconv, cat_pp, "UTF-8", 
                        "latin1"))), list(return, data_sidep)), 
                  list(1186L, 15L, 1253L, 1L, 15L, 1L, 1186L, 
                    1253L))), list(=, sidep_add, list(matching_fi, 
                  sidep_add)), list(print, "Code postal, département et région"), 
                list([, sidep_add, list(%in%, list(substr, CodePostal, 
                  1, 2), list(c, "00", "99", "XX")), list(:=, 
                  CodePostal, NA)), list([, sidep_add, list(%in%, 
                  CodePostal, list(c, "", "0", ".", ",", "aucun", 
                    "AUCUN")), list(:=, CodePostal, NA)), list(
                  [, sidep_add, list(==, CodePostal, "=59111"), 
                  list(:=, CodePostal, "59111")), list([, sidep_add, 
                  list(==, CodePostal, ":78360"), list(:=, CodePostal, 
                    "78360")), list([, sidep_add, list(==, CodePostal, 
                  "=35420"), list(:=, CodePostal, "35420")), 
                list([, sidep_add, sidep_add[, `:=`(code_dep, 
                  case_when(substr(CodePostal, 1, 3) %in% c("201", 
                    "200", "207") ~ "2A", substr(CodePostal, 
                    1, 3) %in% c("202", "206") ~ "2B", substr(CodePostal, 
                    1, 2) == "97" ~ substr(CodePostal, 1, 3), 
                    !substr(CodePostal, 1, 2) %in% c("97", "20") ~ 
                      substr(CodePostal, 1, 2)))], list(:=, code_dep, 
                  list(case_when, list(~, list(%in%, list(substr, 
                    CodePostal, 1, 3), list(c, "201", "200", 
                    "207")), "2A"), list(~, list(%in%, list(substr, 
                    CodePostal, 1, 3), list(c, "202", "206")), 
                    "2B"), list(~, list(==, list(substr, CodePostal, 
                    1, 2), "97"), list(substr, CodePostal, 1, 
                    3)), list(~, list(!, list(%in%, list(substr, 
                    CodePostal, 1, 2), list(c, "97", "20"))), 
                    list(substr, CodePostal, 1, 2))))), list(
                  =, corr_CP, list(data.table, list(read.xlsx, 
                    list(paste0, path, "data/utils/0618_corresp_CP.xlsx")))), 
                list(=, corr_CP, list([, corr_CP, list(&, list(
                  !, list(is.na, code_dep_corr)), list(!=, code_dep_corr, 
                  "")))), list(=, sidep_add, list(merge, sidep_add, 
                  corr_CP, "CodePostal", T)), list([, sidep_add, 
                  sidep_add[, `:=`(code_dep, ifelse(!is.na(code_dep_corr), 
                    code_dep_corr, code_dep))], list(:=, code_dep, 
                    list(ifelse, list(!, list(is.na, code_dep_corr)), 
                      code_dep_corr, code_dep))), list(=, reg_dep, 
                  list(list(::, data.table, fread), list(paste0, 
                    path, "data/utils/departement2019.csv"), 
                    "Latin-1")), list(=, list($, reg_dep, reg), 
                  list(as.character, list($, reg_dep, reg))), 
                list([, reg_dep, list(==, list(nchar, reg), 1), 
                  list(:=, reg, list(paste0, "0", reg))), list(
                  =, reg2019, list(list(::, data.table, fread), 
                    list(paste0, path, "data/utils/region2019.csv"), 
                    "Latin-1")), list(=, list($, reg2019, reg), 
                  list(as.character, list($, reg2019, reg))), 
                list([, reg2019, list(==, list(nchar, reg), 1), 
                  list(:=, reg, list(paste0, "0", reg))), list(
                  [, sidep_add, list(!, list(%in%, code_dep, 
                    list($, reg_dep, dep))), list(:=, code_dep, 
                    "dep_inconnu")), list([, sidep_add, list(
                  &, list(&, list(==, code_dep, "dep_inconnu"), 
                    list(!, list(is.na, IRIS))), list(==, list(
                    nchar, IRIS), 9)), list(:=, code_dep, list(
                  substr, IRIS, 1, 2))), list([, sidep_add, sidep_add[, 
                  `:=`(departement, ifelse(code_dep != "dep_inconnu", 
                    code_dep, ifelse(RPPSPrescripteur != "291991222", 
                      DEP_ET, "dep_inconnu")))], list(:=, departement, 
                  list(ifelse, list(!=, code_dep, "dep_inconnu"), 
                    code_dep, list(ifelse, list(!=, RPPSPrescripteur, 
                      "291991222"), DEP_ET, "dep_inconnu")))), 
                list([, sidep_add, list(&, list(%in%, FINESS_EJ, 
                  list($, ej_et_same_dep, FINESS_EJ)), list(!=, 
                  RPPSPrescripteur, "291991222")), list(:=, departement, 
                  list(ifelse, list(!=, departement, "dep_inconnu"), 
                    departement, DEP_EJ))), list(=, sidep_add, 
                  list(merge, sidep_add, list([, reg_dep, reg_dep[, 
                    .(dep, reg, ncc)], list(., dep, reg, ncc)), 
                    "departement", "dep", T)), list([, sidep_add, 
                  list(!, list(%in%, reg, list($, reg_dep, reg))), 
                  list(:=, reg, "reg_inconnue")), list(setnames, 
                  sidep_add, "ncc", "nom_dep"), list(=, sidep_add, 
                  list(merge, sidep_add, list([, ej_et_same_reg, 
                    ej_et_same_reg[, .(FINESS_EJ, REG_EJ)], list(
                      ., FINESS_EJ, REG_EJ)), "FINESS_EJ", T)), 
                list([, sidep_add, list(%in%, FINESS_EJ, list(
                  $, ej_et_same_reg, FINESS_EJ)), list(:=, reg, 
                  list(ifelse, list(!=, reg, "reg_inconnue"), 
                    reg, REG_EJ))), list(=, sidep_add, list([, 
                  sidep_add, sidep_add[, -c("REG_EJ")], list(
                    -, list(c, "REG_EJ")))), list(=, sidep_add, 
                  list(merge, sidep_add, list([, reg2019, reg2019[, 
                    .(reg, libelle3)], list(., reg, libelle3)), 
                    "reg", T)), list(setnames, sidep_add, "libelle3", 
                  "nom_reg"), list(=, sidep_add, list([, sidep_add, 
                  sidep_add[, -c("code_dep", "code_dep_corr")], 
                  list(-, list(c, "code_dep", "code_dep_corr")))), 
                list(print, "Professionnel de santé et sexe"), 
                list([, sidep_add, list(%in%, ProfessionelSante, 
                  list(c, "", "UU", ".U", "u", "Non communiqué", 
                    "non fait", "nr", "Non précisé", "np", "NP", 
                    "NCDD", "NM", "NO", "UN", "NR", "NCNR", "NCNR2", 
                    "Demande annulée", "Automatique")), list(
                  :=, ProfessionelSante, "U")), list([, sidep_add, 
                  list(%in%, ProfessionelSante, list(c, "n", 
                    "NN")), list(:=, ProfessionelSante, "N")), 
                list([, sidep_add, list(%in%, ProfessionelSante, 
                  list(c, "OO", "o")), list(:=, ProfessionelSante, 
                  "O")), list([, sidep_add, list(!, list((, list(
                  %in%, ProfessionelSante, list(c, "U", "O", 
                    "N")))), list(:=, ProfessionelSante, "U")), 
                list([, sidep_add, list(%in%, Sexe, list(c, "O", 
                  "", "N", "A")), list(:=, Sexe, "U")), list(
                  print, "Traitement des bases journalières terminé"), 
                list(=, sidep_add, list([, sidep_add, sidep_add[, 
                  -c("DatePrelevement", "DateValidationCR", "DEP_EJ", 
                    "DEP_ET", "NumDossier")], list(-, list(c, 
                  "DatePrelevement", "DateValidationCR", "DEP_EJ", 
                  "DEP_ET", "NumDossier")))), list(print, "Chargement des bases agrégées"), 
                list(<-, t1, list(Sys.time)), list(=, path_zip_antigen, 
                  list(paste0, path_sortie, date_AAAAMMJJ_last, 
                    "_sidep_antigen.csv")), list(print, path_zip_antigen), 
                list(=, sidep_prev_antigen, list(list(::, data.table, 
                  fread), path_zip_antigen, "", list(list, date_vars, 
                  posixct_vars, list(c, char_vars, new_tag_char_vars), 
                  "Age"), F, ";", TRUE, "Latin-1")), list(if, 
                  addP2, list(list([, sidep_prev_antigen, corres, 
                    list(:=, Pseudonyme, i.Pseudo2), "Pseudonyme"))), 
                list(<-, t2, list(Sys.time)), list(print, list(
                  -, t2, t1)), list(print, "Concaténation des bases en liste par mois"), 
                list([, sidep_add, sidep_add[, `:=`(RPPSPrescripteur = as.character(RPPSPrescripteur))], 
                  list(:=, list(as.character, RPPSPrescripteur))), 
                list(list(::, data.table, setnames), sidep_add, 
                  "FINESS_c", "FINESS_PS_init"), list([, sidep_add, 
                  sidep_add[, `:=`(FINESS_c_maj, NULL)], list(
                    :=, FINESS_c_maj, NULL)), list(<-, t1, list(
                  Sys.time)), list([, sidep_prev_antigen, sidep_prev_antigen[, 
                  `:=`(mois_prelev, lubridate::month(date_prelev))], 
                  list(:=, mois_prelev, list(list(::, lubridate, 
                    month), date_prelev))), list([, sidep_prev_antigen, 
                  sidep_prev_antigen[, `:=`(annee_prelev, lubridate::year(date_prelev))], 
                  list(:=, annee_prelev, list(list(::, lubridate, 
                    year), date_prelev))), list(<-, sidep_antigen_lst, 
                  list(split, sidep_prev_antigen, list(c, "annee_prelev", 
                    "mois_prelev"))), list(<-, t2, list(Sys.time)), 
                list(print, list(-, t2, t1)), list(<-, sidep_antigen_lst, 
                  list(lapply, sidep_antigen_lst, list(function, 
                    list(as.pairlist(alist(i = ))), list([, i, 
                      i[, `:=`(mois_prelev, NULL)], list(:=, 
                        mois_prelev, NULL)), list(1359L, 50L, 
                      1359L, 85L, 50L, 85L, 1359L, 1359L)))), 
                list(<-, sidep_antigen_lst, list(lapply, sidep_antigen_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(annee_prelev, NULL)], 
                      list(:=, annee_prelev, NULL)), list(1360L, 
                      50L, 1360L, 86L, 50L, 86L, 1360L, 1360L)))), 
                list(<-, sidep_antigen_lst, list(lapply, sidep_antigen_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(day_prelev = as.Date(day_prelev), 
                      day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                      date_valid = fasttime::fastPOSIXct(date_valid), 
                      date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                      day_extract_sidep = as.Date(day_extract_sidep), 
                      Age = as.numeric(Age))], list(:=, list(
                      as.Date, day_prelev), list(as.Date, day_valid), 
                      list(list(::, fasttime, fastPOSIXct), date_prelev), 
                      list(list(::, fasttime, fastPOSIXct), date_valid), 
                      list(list(::, fasttime, fastPOSIXct), date_valid_init), 
                      list(as.Date, day_extract_sidep), list(
                        as.numeric, Age))), list(1362L, 50L, 
                      1369L, 35L, 50L, 35L, 1362L, 1369L)))), 
                list([, sidep_add, sidep_add[, `:=`(mois_prelev, 
                  lubridate::month(date_prelev))], list(:=, mois_prelev, 
                  list(list(::, lubridate, month), date_prelev))), 
                list([, sidep_add, sidep_add[, `:=`(annee_prelev, 
                  lubridate::year(date_prelev))], list(:=, annee_prelev, 
                  list(list(::, lubridate, year), date_prelev))), 
                list(<-, sidep_add, list([, sidep_add, list(order, 
                  annee_prelev, mois_prelev))), list(<-, sidep_add_lst, 
                  list(split, sidep_add, list(c, "annee_prelev", 
                    "mois_prelev"))), list(<-, sidep_add_lst, 
                  list(lapply, sidep_add_lst, list(function, 
                    list(as.pairlist(alist(i = ))), list([, i, 
                      i[, `:=`(mois_prelev, NULL)], list(:=, 
                        mois_prelev, NULL)), list(1376L, 27L, 
                      1376L, 62L, 27L, 62L, 1376L, 1376L)))), 
                list(<-, sidep_add_lst, list(lapply, sidep_add_lst, 
                  list(function, list(as.pairlist(alist(i = ))), 
                    list([, i, i[, `:=`(annee_prelev, NULL)], 
                      list(:=, annee_prelev, NULL)), list(1378L, 
                      27L, 1378L, 63L, 27L, 63L, 1378L, 1378L)))), 
                list(<-, t1, list(Sys.time)), list(<-, sidep_lst, 
                  list(lapply, YYYY.mm, list(function, list(as.pairlist(alist(i = ))), 
                    list(rbindlist, list(list, list([[, sidep_antigen_lst, 
                      i), list([[, sidep_add_lst, i)), TRUE), 
                    list(1383L, 23L, 1384L, 81L, 23L, 81L, 1383L, 
                      1384L)))), list(<-, t2, list(Sys.time)), 
                list(print, list(-, t2, t1)), list(rm, sidep_add, 
                  sidep_add_lst), list(print, "Doublons dans la base globale"), 
                list(=, etapes_fin, list(cbind, "aucune", list(
                  do.call, "sum", list(lapply, sidep_lst, nrow)))), 
                list(<-, treat_duplicates, list(function, list(
                  as.pairlist(alist(temp = ))), list(list(print, 
                  list(paste0, list(list(::, lubridate, month), 
                    list([, list($, temp, date_prelev), 1)), 
                    " - ", list(list(::, lubridate, year), list(
                      [, list($, temp, date_prelev), 1)))), list(
                  <-, rows_dup, list((, list(|, list(duplicated, 
                    temp, list(c, "Pseudonyme", "date_prelev", 
                      "AnalyseConclusion")), list(duplicated, 
                    temp, list(c, "Pseudonyme", "date_prelev", 
                      "AnalyseConclusion"), TRUE)))), list([, 
                  temp, temp[, `:=`(date_valid_init = date_valid, 
                    latest_day_extract = day_extract_sidep)], 
                  list(:=, date_valid, day_extract_sidep)), list(
                  <-, temp_to_treat, list([, temp, rows_dup)), 
                  list(<-, temp_not_to_treat, list([, temp, list(
                    !, rows_dup))), list(print, list(nrow, temp_to_treat)), 
                  list(if, list(>, list(nrow, temp_to_treat), 
                    0), list(list([, temp_to_treat, temp_to_treat[, 
                    `:=`(date_valid_init = min(date_valid), latest_day_extract = max(day_extract_sidep)), 
                    by = c("Pseudonyme", "date_prelev", "AnalyseConclusion")], 
                    list(:=, list(min, date_valid), list(max, 
                      day_extract_sidep)), list(c, "Pseudonyme", 
                      "date_prelev", "AnalyseConclusion")), list(
                    <-, temp_to_treat, list([, temp_to_treat, 
                      list(%in%, day_extract_sidep, latest_day_extract))), 
                    list(<-, temp_to_treat, list([, temp_to_treat, 
                      temp_to_treat[, .SD[1], by = c("Pseudonyme", 
                        "date_prelev", "AnalyseConclusion")], 
                      list([, .SD, 1), list(c, "Pseudonyme", 
                        "date_prelev", "AnalyseConclusion"))), 
                    list(<-, temp, list(rbindlist, list(list, 
                      temp_to_treat, temp_not_to_treat), T)))), 
                  list(return, temp)), list(1394L, 23L, 1421L, 
                  3L, 23L, 3L, 1394L, 1421L))), list(<-, t1, 
                  list(Sys.time)), list(<-, sidep_lst, list(lapply, 
                  sidep_lst, list(function, list(as.pairlist(alist(i = ))), 
                    list(treat_duplicates, i), list(1424L, 34L, 
                      1424L, 64L, 34L, 64L, 1424L, 1424L)))), 
                list(<-, t2, list(Sys.time)), list(print, list(
                  -, t2, t1)), list(=, etapes_fin, list(rbind, 
                  etapes_fin, list(cbind, "dup_tryptique_and_latest_date", 
                    list(do.call, "sum", list(lapply, sidep_lst, 
                      nrow))))), list(=, etapes_fin, list(list(
                  ::, data.table, data.table), etapes_fin)), 
                list([, etapes_fin, etapes_fin[, `:=`(n_supp, 
                  0)], list(:=, n_supp, 0)), list([, etapes_fin, 
                  etapes_fin[, `:=`(n_row, as.numeric(n_row))], 
                  list(:=, n_row, list(as.numeric, n_row))), 
                list(for, i, list(:, 2, list(nrow, etapes_fin)), 
                  list(list(=, list([, list($, etapes_fin, n_supp), 
                    i), list(-, list([, list($, etapes_fin, n_row), 
                    list(-, i, 1)), list([, list($, etapes_fin, 
                    n_row), i))))), list(<<-, etapes_fin, etapes_fin), 
                list(<-, sidep_lst, list(lapply, sidep_lst, list(
                  function, list(as.pairlist(alist(i = ))), list(
                    [, i, i[, `:=`(latest_day_extract = NULL)], 
                    list(:=, NULL)), list(1440L, 34L, 1441L, 
                    39L, 34L, 39L, 1440L, 1441L)))), list(<-, 
                  extract_dt, list(function, list(as.pairlist(alist(temp = ))), 
                    list(list(<-, sidep_antigenique, list(lapply, 
                      temp, list(function, list(as.pairlist(alist(i = ))), 
                        list([, i, list(%in%, AnalyseConclusion, 
                          list(c, "94558-4"))), list(1445L, 39L, 
                          1446L, 67L, 39L, 67L, 1445L, 1446L)))), 
                      list(return, sidep_antigenique)), list(
                      1444L, 17L, 1448L, 3L, 17L, 3L, 1444L, 
                      1448L))), list(<-, t1, list(Sys.time)), 
                list(<<-, sidep_antigenique, list(extract_dt, 
                  sidep_lst)), list(<-, t2, list(Sys.time)), 
                list(print, list(-, t2, t1)), list(print, list(
                  -, list(Sys.time), TIME_INIT)), list(gc)), 
            list(868L, 26L, 1459L, 1L, 26L, 1L, 868L, 1459L))), 
    list(<-, t1, list(Sys.time)), list(structure(expression(MoisAAAA = MoisAAAA), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(YYYY.mm = YYYY.mm), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-20"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(corres = new_rattrapage), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(addP2 = addP2), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        TIME_INIT = Sys.time(), print(paste0("lancement: ", TIME_INIT)), 
        date_AAAAMMJJ_last = format(last_update, format = "%Y%m%d"), 
        date_AAMMJJ_last = substr(date_AAAAMMJJ_last, 3, 8), 
        extractions = list.files(path_data), extractions = grep("CSV_DREES", 
            extractions, value = T), extractions = grep(".csv", 
            extractions, value = T), extractions <- extractions[!extractions %in% 
            c("CSV_DREES_200518200002.csv", "CSV_DREES_200519090000.csv", 
                "CSV_DREES_200520090000.csv", "CSV_DREES_200625130000.csv")], 
        extractions <- extractions[!grepl("ini", extractions)], 
        extractions = sort(extractions, decreasing = T), names(extractions) <- substr(extractions, 
            13, 16), print("Chargement des bases journalières à agréger"), 
        extract = extractions[substr(extractions, 16, 21) == 
            date_AAMMJJ], names(extract) <- substr(extract, 11, 
            14), sidep_add_1 = safe_fread(paste0(path_data, extract["MED4"]), 
            quote = "", verbose = F, sep = "|", header = TRUE, 
            colClasses = list(character = daily_files_char_vars, 
                numeric = "Age"), encoding = "Latin-1"), print(extract["MED4"]), 
        w <- sidep_add_1$warnings, w <- w[grepl("^Stopped early", 
            w)], if (length(w) > 0) {
            stop(w)
        }, sidep_add_1 <- sidep_add_1$result, sidep_add_2 = safe_fread(paste0(path_data, 
            extract["MED2"]), quote = "", verbose = F, sep = "|", 
            header = TRUE, colClasses = list(character = daily_files_char_vars, 
                numeric = "Age"), encoding = "Latin-1"), print(extract["MED2"]), 
        w <- sidep_add_2$warnings, w <- w[grepl("^Stopped early", 
            w)], if (length(w) > 0) {
            stop(w)
        }, sidep_add_2 <- sidep_add_2$result, rm(w), sidep_add = rbind(sidep_add_1, 
            sidep_add_2), rm(sidep_add_1, sidep_add_2), print(extract["MED4"]), 
        print(extract["MED2"]), sidep_add <- sidep_add[AnalyseConclusion %in% 
            c("94558-4")], sidep_add$day_extract_sidep = as.Date(date_AAAAMMJJ, 
            format = "%Y%m%d"), print(nrow(sidep_add)), setnames(sidep_add, 
            "Pseudo2", "Pseudonyme"), sidep_add[, `:=`(Pseudo1, 
            NULL)], print("Suppression des antislash et .br"), 
        sidep_add[, `:=`(Joker1, NULL)], sidep_add[, `:=`(Joker2, 
            NULL)], sidep_add[, `:=`(Joker3, NULL)], nettoyage <- function(temp, 
            element) {
            for (i in colnames(temp)) {
                print(i)
                print(temp[grep(element, get(i)), .N])
                if (temp[grep(element, get(i)), .N] > 0) {
                  idx <- grep(element, temp[[i]])
                  temp[grep(element, get(i)), `:=`(c(i), list(stringr::str_replace_all(get(i), 
                    element, "")))]
                }
            }
            return(temp)
        }, sidep_add <- nettoyage(sidep_add, ";"), sidep_add <- nettoyage(sidep_add, 
            "\\\\"), sidep_add <- nettoyage(sidep_add, "\""), 
        sidep_add$RPPSPrescripteur = stringr::str_extract(sidep_add$RPPSPrescripteur, 
            "([0-9]{1,14})"), sidep_add$RPPSPrescripteur = as.integer64(sidep_add$RPPSPrescripteur), 
        sidep_add[RPPSPrescripteur == 0, `:=`(RPPSPrescripteur, 
            NA)], sidep_add$CodePostal = gsub("(\\\\)", "", sidep_add$CodePostal), 
        sidep_add$CodePostal = gsub("(.br)", "", sidep_add$CodePostal), 
        sidep_add$FINESS_c <- sidep_add$FINESS, sidep_add$FINESS = stringr::str_extract(sidep_add$FINESS, 
            "(^[0-9AB]{1,15})"), sidep_add[, `:=`(FINESS, lest::case_when(FINESS == 
            "A" ~ NA_character_, TRUE ~ FINESS))], sidep_add[, 
            `:=`(FINESS, ifelse(FINESS == "" | nchar(FINESS) < 
                8, NA, FINESS))], sidep_add$FINESSGeographique = stringr::str_extract(sidep_add$FINESSGeographique, 
            "([0-9AB]{1,15})"), sidep_add[, `:=`(FINESSGeographique, 
            ifelse(FINESSGeographique == "" | nchar(FINESSGeographique) < 
                8, NA, FINESSGeographique))], sidep_add[, `:=`(regCampagneDepistage, 
            stringr::str_extract(NumCampagneDepistage, "^[A-Za-z]{3}"))], 
        if (sidep_add[nchar(regCampagneDepistage) < 3, .N] > 
            0) {
            print("Probleme: il y a des trigrammes dans NumCampagneDepistage qui ont moins de 3 caractères")
        }, sidep_add[, `:=`(regCampagneDepistage, NULL)], sidep_add[, 
            `:=`(FINESS_c_maj, toupper(FINESS_c))], sidep_add[, 
            `:=`(FINESS_c_maj, ifelse(stringr::str_starts(FINESS_c_maj, 
                "MLETEST"), NA, FINESS_c_maj))], sidep_add[, 
            `:=`(RPPSPrelevTA, stringr::str_extract(FINESS_c_maj, 
                "^(RPPS_)([0-9a-zA-Z]+)"))], sidep_add[, `:=`(AdeliPrelevTA, 
            stringr::str_extract(FINESS_c_maj, "^(ADELI_)([0-9a-zA-Z]+)"))], 
        sidep_add[, `:=`(idNATPrelevTA, stringr::str_extract(FINESS_c_maj, 
            "^(IDNAT_)([0-9a-zA-Z]+)"))], sidep_add[, `:=`(ProfPrelevTA, 
            stringr::str_extract(FINESS_c_maj, "(PROF_)([a-zA-Z]+)"))], 
        sidep_add[, `:=`(CPPrelevTA, stringr::str_extract(FINESS_c_maj, 
            "(CP_)([0-9a-zA-Z]+)"))], sidep_add[, `:=`(TopPrelevTA, 
            ifelse(stringr::str_starts(FINESS_c_maj, "(RPPS|ADELI|IDNAT)"), 
                1, 0))], print(sidep_add[, table(TopPrelevTA, 
            ProfPrelevTA)]), if (nrow(sidep_add[TopPrelevTA == 
            0 & !(is.na(ProfPrelevTA)), .(FINESS_c)]) > 0) {
            print("Probleme il y a des top prelev TA à 0 alors qu'il y a une profession")
        }, sidep_add[, `:=`(RPPSPrelevTA, stringr::str_replace(RPPSPrelevTA, 
            "RPPS_", ""))], sidep_add[, `:=`(AdeliPrelevTA, stringr::str_replace(AdeliPrelevTA, 
            "ADELI_", ""))], sidep_add[, `:=`(idNATPrelevTA, 
            stringr::str_replace(idNATPrelevTA, "IDNAT_", ""))], 
        sidep_add[, `:=`(ProfPrelevTA, stringr::str_replace(ProfPrelevTA, 
            "PROF_", ""))], sidep_add[, `:=`(CPPrelevTA, stringr::str_replace(CPPrelevTA, 
            "CP_", ""))], print("Traitement des dates"), sidep_add[, 
            `:=`(date_prelev, lubridate::ymd_hms(paste0(substr(DatePrelevement, 
                1, 4), "-", substr(DatePrelevement, 5, 6), "-", 
                substr(DatePrelevement, 7, 8), " ", substr(DatePrelevement, 
                  9, 10), ":", substr(DatePrelevement, 11, 12), 
                ":", substr(DatePrelevement, 13, 14))))], sidep_add[, 
            `:=`(day_prelev, as.Date(date_prelev))], sidep_add[, 
            `:=`(date_valid, lubridate::ymd_hms(paste0(substr(DateValidationCR, 
                1, 4), "-", substr(DateValidationCR, 5, 6), "-", 
                substr(DateValidationCR, 7, 8), " ", substr(DateValidationCR, 
                  9, 10), ":", substr(DateValidationCR, 11, 12), 
                ":", substr(DateValidationCR, 13, 14))))], sidep_add[, 
            `:=`(day_valid, as.Date(date_valid))], if (!is.na(day_init)) {
            sidep_add = sidep_add[day_prelev >= as.Date(day_init) & 
                day_prelev <= date_dataset]
            sidep_add = sidep_add[is.na(day_valid) | (!is.na(day_valid) & 
                day_valid >= as.Date(day_init) & day_valid <= 
                date_dataset)]
        }, sidep_add = sidep_add[day_prelev <= day_extract_sidep], 
        print("Pseudonymes"), if (sum(nchar(sidep_add$Pseudonyme) > 
            64, na.rm = T) != 0) {
            sidep_add[nchar(Pseudonyme) %in% c(128, 192), `:=`(Pseudonyme, 
                substr(Pseudonyme, 1, 64))]
        }, pseudos_tests = c("78b14ef7c9ed19082b6d2d151678b8a74606f7dd33b811b3f97f41fe20793ea5", 
            "cf77f9f6fc3d4a40260af813aed7c3f80c274660aff9f978a99f98d29544be0c", 
            "e76950f02d9763a2533a4c6b0a3a0621e0dcfd3133c5fc3d1d0064b3324a3d50", 
            "ef9ecddf446243b60b9f15e8c7a521f79f21bfb2f95b0d6d54b4f3533f85a1d1", 
            "9fdcb52ac99ef7497ce75a543cf99afbb8c9af6f8dfd417f2a62b3dbca0ae23d", 
            "cd88cea5ff5a72eca228f63c9513492d45b5b78509e237ab55e0d787f896d747", 
            "c9d915880d6266a23ca95992a009a4491bbed5e3882fbd60b556a9df09dde4a0", 
            "aeaab01f88b19d53b7680a7fbc2a46fba31de13b2f60f75679ea2f971d8ce346", 
            "5161630ccba995deaa8d6ba5012ca521b0b245a9bd5e78658d6311ddffc0f8ec", 
            "4d07e44674b72d5c6ef58605058b671f0884394adf6535b194771325e709034f", 
            "a5c373e024776111dbb999506c28d41e4dca3011a41394493526bca3476136f0", 
            "9a4708216b2624f4461e6aa3b1181f03ecb3d4605d9d658ce6cc8fbf59a17557", 
            "8728ef871def06e09529733e60bebdde00e559a05da5bcf0b91cb13a67374564", 
            "2153039929b6bd83dd502e01d41cd4319e9674c8dedbe28d3d625e0102c5a450", 
            "03b8e61d5548edc7a9490ed86d2fbfcd8edc4746489e8543fdff64d5527e8ed8", 
            "efdaf8f12656c9b015c3410c4a8879b3c07c7b121493f5c2617df8d0db6b17ef", 
            "3563fc0e12e0e2187c0e1117849bcbc849c60afef9f807cc54b90a7e3e6bd818", 
            "4b1081eadac91e9bc974ac8cb2dd437e31dca5d2e88e086d5f68fdffa2efb0a2", 
            "2fed8eadd4765b47d5d034b1624ffc19f9f1a8dd6853887597039952d87489be", 
            "2b90416ea89cd21fe3ae4eb90ac3d8158afe87f4dc6ef43c257a37e857787107", 
            "68d80449eb5960e1912a1043ee6f388fc75417d87e246e4402538d1ad577ef6a", 
            "23c3e79e45865410393b5520d9841854427f435f272ddd32d365bb73af5570c2", 
            "5fb63a89cb4a0108ba7e4b5cea5b8a7cad48c64aa24c000f0d7cb49dddf26f43", 
            "7b7fbf4ff01a5920ea08159889b6d1a9ff03f1d26a50d30cd3b142a68e633079", 
            "3bc66709adac0bac1158bbdf7500eda1c370ef0132c65b861856ea677c405470"), 
        sidep_add = sidep_add[!(Pseudonyme %in% pseudos_tests)], 
        print("AnalyseConclusion"), sidep_add = sidep_add[AnalyseConclusion %in% 
            c("94558-4")], print("Doublons parfaits extractions"), 
        etapes = cbind(var = "aucune", n_row = nrow(sidep_add)), 
        sidep_add <- unique(sidep_add), etapes = rbind(etapes, 
            cbind(var = "Duplicates_all_lines", n_row = nrow(sidep_add))), 
        print("Premiers symptômes"), sidep_add[PremierSymptomes %in% 
            c("", "UU", "u", "non précisé", "Non communiqué", 
                "NON RENSEIGNE", "non renseignÃ©", "nrens", "PAS RENSEIGNE", 
                "NR", "Non renseigné", "NON PRECISE", "Non précisé", 
                "non renseignée", "NRENS", "np", "NCNR", "NRE", 
                "NSP", "NP", "NM", "V", "ne sais pas", "non fait", 
                "VOIR PRESCRIPTION JOINTE", "NPC", "INC", "BILAN PREOP", 
                "?", "nc", "nr", "0.000000", "0R", "GAPS2", "Demande annulée", 
                "Non communiqué", "NCNR2"), `:=`(PremierSymptomes, 
            "U")], sidep_add[PremierSymptomes %in% c("PAS DE SYMPTOME", 
            "a", "Asymptomatique.", "AUCUN SYMPTOME", "asy", 
            "APSYU", "ASy", "ASYM", "A", "ASYASY", "ASYM ", "ASYU", 
            "PASYM", "UASY", "avant entrée en EHPAD", "avant retour en EHPAD", 
            "entrée de geriatrie", "entree en geriatrie", "avant rentrée en ehpad", 
            "AVANT TRANSFERT EHPAD", "BILAN PRE OP", "TEST PRE OP", 
            "TRANSFERT EN  EHPAD", "Transfert SSR-P"), `:=`(PremierSymptomes, 
            "ASY")], sidep_add[grepl("(Pas de symptomes)|(ASYV)|(VASY)|(Pré opératoire)|(PAS DE SYMPTOMES)|(PRE-OPERATOIRE)", 
            PremierSymptomes), `:=`(PremierSymptomes, "ASY")], 
        sidep_add[grepl("(apparus le jour ou la veille)|(D1)|(S01S01)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S01")], 
        sidep_add[grepl("(apparus 2,3)|(apparus 2, 3)|(D2)|(D3)|(quelques jours)|(Quelques jours)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S24")], 
        sidep_add[PremierSymptomes %in% c("05/05/20"), `:=`(PremierSymptomes, 
            "S57")], sidep_add[grepl("(apparus 5,6)|(apparus 5, 6)|(D5)", 
            PremierSymptomes), `:=`(PremierSymptomes, "S57")], 
        sidep_add[grepl("(SS2SS2)|(D9)|(D11)|(S814)", PremierSymptomes), 
            `:=`(PremierSymptomes, "SS2")], sidep_add[grepl("(apparus entre 8 et 15 jours)|(apparus entre 8 et 14 jours)|(S814)|(ss2)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS2")], 
        sidep_add[grepl("(apparus plus de 2 semaines)|(apparus plus de deux semaines)|(+ 15 jours)|(>j15)|(SS34)|(SS3SS3)|(S2-S4)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(apparus plus de deux semaines avant le prelevement)|(apparus entre 15 et 28 jours)|(SS3U)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(il y a 1 mois)|(plus de 3 semaines)|(DECEMBRE 19)|(plus de quatre semaines)|(D29)|(SP4S)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SS3")], 
        sidep_add[grepl("(Eruption cutanée)|(colique)|(30/05/20)|(07/06/20)|(202005)|(202006)", 
            PremierSymptomes), `:=`(PremierSymptomes, "SNA")], 
        print("TypologiePatient"), sidep_add[TypologiePatient == 
            "", `:=`(TypologiePatient, "U")], sidep_add[TypologiePatient %in% 
            c("Autre structure d'hébergement collectif", "Autre structure d'hébergement", 
                "autre structure d'hébergement collectif"), `:=`(TypologiePatient, 
            "A")], sidep_add[TypologiePatient %in% c("résident en EHPAD", 
            "Résident en EHPAD"), `:=`(TypologiePatient, "E")], 
        sidep_add[TypologiePatient %in% c("HH"), `:=`(TypologiePatient, 
            "H")], sidep_add[TypologiePatient %in% c("II", "i"), 
            `:=`(TypologiePatient, "H")], sidep_add[!TypologiePatient %in% 
            c("I", "H", "E", "C", "A", "U"), `:=`(TypologiePatient, 
            "U")], print("Resultat"), sidep_add[Resultat %in% 
            c("negatif", "NEGATIF", "Négative", "N?gatif", "NN", 
                "NNN", "NEG", "n"), `:=`(Resultat, "N")], sidep_add[grepl("(ninterp)|(ndéterminé)", 
            Resultat), `:=`(Resultat, "I")], sidep_add[Resultat %in% 
            c("PP"), `:=`(Resultat, "P")], sidep_add[Resultat == 
            "N", `:=`(valeur, "N")], sidep_add[Resultat == "P", 
            `:=`(valeur, "P")], sidep_add[Resultat == "I", `:=`(valeur, 
            "I")], sidep_add[Resultat == "X", `:=`(valeur, "X")], 
        print("Doublons dans les dernières extractions"), sidep_add[, 
            `:=`(na_res, ifelse(Resultat %in% c("", "X", "I") | 
                is.na(Resultat) | nchar(Resultat) > 1, 1, 0))], 
        sidep_add[, `:=`(na_typo, ifelse(TypologiePatient == 
            "U" | is.na(TypologiePatient), 1, 0))], sidep_add[, 
            `:=`(na_cp, ifelse(CodePostal == "" | is.na(CodePostal) | 
                nchar(CodePostal) != 5, 1, 0))], sidep_add[, 
            `:=`(na_sympto, ifelse(PremierSymptomes == "" | is.na(PremierSymptomes) | 
                nchar(PremierSymptomes) == "U", 1, 0))], sidep_add = sidep_add[, 
            `:=`(date_valid_init = min(date_valid), latest_day_extract = max(day_extract_sidep), 
                res_ok = min(na_res), typo_ok = min(na_typo), 
                cp_ok = min(na_cp), sympto_ok = min(na_sympto)), 
            by = .(Pseudonyme, date_prelev, AnalyseConclusion)], 
        sidep_add <- sidep_add[day_extract_sidep %in% latest_day_extract], 
        etapes = rbind(etapes, cbind(var = "latest_extract", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_res == 
            res_ok], etapes = rbind(etapes, cbind(var = "Resultat", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_typo == 
            typo_ok], etapes = rbind(etapes, cbind(var = "TypologiePatient", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_cp == 
            cp_ok], etapes = rbind(etapes, cbind(var = "CodePostal", 
            n_row = nrow(sidep_add))), sidep_add <- sidep_add[na_sympto == 
            sympto_ok], etapes = rbind(etapes, cbind(var = "PremierSymptomes", 
            n_row = nrow(sidep_add))), sidep_add = sidep_add[, 
            -c("latest_day_extract", "na_res", "res_ok", "na_typo", 
                "typo_ok", "na_cp", "cp_ok", "na_sympto", "sympto_ok")], 
        sidep_add = sidep_add[, .SD[1], by = c("Pseudonyme", 
            "date_prelev", "AnalyseConclusion")], etapes = rbind(etapes, 
            cbind(var = "dup_tryptique", n_row = nrow(sidep_add))), 
        etapes = data.table(etapes), etapes[, `:=`(n_supp, 0)], 
        etapes[, `:=`(n_row, as.numeric(n_row))], for (i in 2:nrow(etapes)) {
            etapes$n_supp[i] = etapes$n_row[i - 1] - etapes$n_row[i]
        }, etapes <<- etapes, print("Finess"), matching_fi = function(data_sidep) {
            setnames(data_sidep, "FINESS", "fi_init")
            load(paste0(path, "data/utils/finess_1116.Rdata"))
            liste_et <- liste_et %>% select(DEP_ET = ET-Département
Code, 
                FINESS_EJ = EJ-N°FINESS, DEP_EJ = EJ-Département
Code, 
                FINESS_ET = ET-N°FINESS)
            sidep_geo <- inner_join(data_sidep, liste_et %>% 
                select(fi_init = FINESS_ET, DEP_ET, FINESS_EJ, 
                  DEP_EJ), by = "fi_init")
            sidep_geo$FINESS_ET <- sidep_geo$fi_init
            sidep_ju <- inner_join(data_sidep, as_tibble(liste_et) %>% 
                select(fi_init = FINESS_EJ, DEP_EJ) %>% group_by(fi_init) %>% 
                slice(1) %>% ungroup(), by = "fi_init")
            sidep_ju$FINESS_EJ <- sidep_ju$fi_init
            sidep_ok <- rbindlist(list(sidep_geo, sidep_ju), 
                fill = T)
            data_sidep <- merge(data_sidep, unique(sidep_ok[, 
                .(fi_init, FINESS_ET, DEP_ET, FINESS_EJ, DEP_EJ)]), 
                by.x = "fi_init", by.y = "fi_init", all.x = T)
            bio3_et <- readxl::read_excel(paste0(path, "data/utils/bio3_et_1116.xlsx"))
            data_sidep <- left_join(data_sidep, bio3_et %>% group_by(FINESS_EJ) %>% 
                slice(1) %>% ungroup() %>% select(FINESS_EJ, 
                cat_etb), by = "FINESS_EJ")
            data_sidep$cat_pp <- ifelse(data_sidep$cat_etb %in% 
                c("2000", "3000"), "privé", NA)
            data_sidep$cat_pp <- ifelse(data_sidep$cat_etb == 
                "1000", "public", data_sidep$cat_pp)
            table(data_sidep$cat_pp, exclude = NULL)
            data_sidep = data.table(data_sidep)
            remove(sidep_ok, sidep_ju, sidep_geo)
            data_sidep[is.na(DEP_EJ), `:=`(DEP_EJ, "dep_inconnu")]
            data_sidep[is.na(DEP_ET), `:=`(DEP_ET, "dep_inconnu")]
            reg_dep = data.table::fread(paste0(path, "data/utils/departement2019.csv"))
            reg_dep$reg = as.character(reg_dep$reg)
            reg_dep[nchar(reg) == 1, `:=`(reg, paste0("0", reg))]
            ej_et_dep = data.table(liste_et[, c("FINESS_ET", 
                "DEP_ET", "FINESS_EJ", "DEP_EJ")])
            ej_et_dep = merge(ej_et_dep, reg_dep[, .(dep, reg)], 
                by.x = "DEP_ET", by.y = "dep", all.x = T)
            setnames(ej_et_dep, "reg", "REG_ET")
            ej_et_dep = merge(ej_et_dep, reg_dep[, .(dep, reg)], 
                by.x = "DEP_EJ", by.y = "dep", all.x = T)
            setnames(ej_et_dep, "reg", "REG_EJ")
            nb_dep_par_ej = ej_et_dep[, .(n_distinct(DEP_ET)), 
                by = .(FINESS_EJ)]
            sum(nb_dep_par_ej$V1 == 1)/length(unique(ej_et_dep$FINESS_EJ))
            ej_et_same_dep = ej_et_dep[FINESS_EJ %in% nb_dep_par_ej$FINESS_EJ[nb_dep_par_ej$V1 == 
                1]]
            ej_et_same_dep = ej_et_same_dep[DEP_ET == DEP_EJ]
            ej_et_same_dep = unique(ej_et_same_dep[, .(FINESS_EJ, 
                DEP_EJ)])
            nb_reg_par_ej = ej_et_dep[, .(n_distinct(REG_ET)), 
                by = .(FINESS_EJ)]
            sum(nb_reg_par_ej$V1 == 1)/length(unique(ej_et_dep$FINESS_EJ))
            ej_et_same_reg = ej_et_dep[FINESS_EJ %in% nb_reg_par_ej$FINESS_EJ[nb_reg_par_ej$V1 == 
                1]]
            ej_et_same_reg = ej_et_same_reg[REG_ET == REG_EJ]
            ej_et_same_reg = unique(ej_et_same_reg[, .(FINESS_EJ, 
                REG_EJ)])
            ej_et_same_dep <<- ej_et_same_dep
            ej_et_same_reg <<- ej_et_same_reg
            data_sidep[, `:=`(cat_pp, iconv(cat_pp, from = "UTF-8", 
                to = "latin1"))]
            return(data_sidep)
        }, sidep_add = matching_fi(sidep_add), print("Code postal, département et région"), 
        sidep_add[substr(CodePostal, 1, 2) %in% c("00", "99", 
            "XX"), `:=`(CodePostal, NA)], sidep_add[CodePostal %in% 
            c("", "0", ".", ",", "aucun", "AUCUN"), `:=`(CodePostal, 
            NA)], sidep_add[CodePostal == "=59111", `:=`(CodePostal, 
            "59111")], sidep_add[CodePostal == ":78360", `:=`(CodePostal, 
            "78360")], sidep_add[CodePostal == "=35420", `:=`(CodePostal, 
            "35420")], sidep_add[, `:=`(code_dep, case_when(substr(CodePostal, 
            1, 3) %in% c("201", "200", "207") ~ "2A", substr(CodePostal, 
            1, 3) %in% c("202", "206") ~ "2B", substr(CodePostal, 
            1, 2) == "97" ~ substr(CodePostal, 1, 3), !substr(CodePostal, 
            1, 2) %in% c("97", "20") ~ substr(CodePostal, 1, 
            2)))], corr_CP = data.table(read.xlsx(paste0(path, 
            "data/utils/0618_corresp_CP.xlsx"))), corr_CP = corr_CP[!is.na(code_dep_corr) & 
            code_dep_corr != ""], sidep_add = merge(sidep_add, 
            corr_CP, by = "CodePostal", all.x = T), sidep_add[, 
            `:=`(code_dep, ifelse(!is.na(code_dep_corr), code_dep_corr, 
                code_dep))], reg_dep = data.table::fread(paste0(path, 
            "data/utils/departement2019.csv"), encoding = "Latin-1"), 
        reg_dep$reg = as.character(reg_dep$reg), reg_dep[nchar(reg) == 
            1, `:=`(reg, paste0("0", reg))], reg2019 = data.table::fread(paste0(path, 
            "data/utils/region2019.csv"), encoding = "Latin-1"), 
        reg2019$reg = as.character(reg2019$reg), reg2019[nchar(reg) == 
            1, `:=`(reg, paste0("0", reg))], sidep_add[!code_dep %in% 
            reg_dep$dep, `:=`(code_dep, "dep_inconnu")], sidep_add[code_dep == 
            "dep_inconnu" & !is.na(IRIS) & nchar(IRIS) == 9, 
            `:=`(code_dep, substr(IRIS, 1, 2))], sidep_add[, 
            `:=`(departement, ifelse(code_dep != "dep_inconnu", 
                code_dep, ifelse(RPPSPrescripteur != "291991222", 
                  DEP_ET, "dep_inconnu")))], sidep_add[FINESS_EJ %in% 
            ej_et_same_dep$FINESS_EJ & RPPSPrescripteur != "291991222", 
            `:=`(departement, ifelse(departement != "dep_inconnu", 
                departement, DEP_EJ))], sidep_add = merge(sidep_add, 
            reg_dep[, .(dep, reg, ncc)], by.x = "departement", 
            by.y = "dep", all.x = T), sidep_add[!reg %in% reg_dep$reg, 
            `:=`(reg, "reg_inconnue")], setnames(sidep_add, "ncc", 
            "nom_dep"), sidep_add = merge(sidep_add, ej_et_same_reg[, 
            .(FINESS_EJ, REG_EJ)], by = "FINESS_EJ", all.x = T), 
        sidep_add[FINESS_EJ %in% ej_et_same_reg$FINESS_EJ, `:=`(reg, 
            ifelse(reg != "reg_inconnue", reg, REG_EJ))], sidep_add = sidep_add[, 
            -c("REG_EJ")], sidep_add = merge(sidep_add, reg2019[, 
            .(reg, libelle3)], by = "reg", all.x = T), setnames(sidep_add, 
            "libelle3", "nom_reg"), sidep_add = sidep_add[, -c("code_dep", 
            "code_dep_corr")], print("Professionnel de santé et sexe"), 
        sidep_add[ProfessionelSante %in% c("", "UU", ".U", "u", 
            "Non communiqué", "non fait", "nr", "Non précisé", 
            "np", "NP", "NCDD", "NM", "NO", "UN", "NR", "NCNR", 
            "NCNR2", "Demande annulée", "Automatique"), `:=`(ProfessionelSante, 
            "U")], sidep_add[ProfessionelSante %in% c("n", "NN"), 
            `:=`(ProfessionelSante, "N")], sidep_add[ProfessionelSante %in% 
            c("OO", "o"), `:=`(ProfessionelSante, "O")], sidep_add[!(ProfessionelSante %in% 
            c("U", "O", "N")), `:=`(ProfessionelSante, "U")], 
        sidep_add[Sexe %in% c("O", "", "N", "A"), `:=`(Sexe, 
            "U")], print("Traitement des bases journalières terminé"), 
        sidep_add = sidep_add[, -c("DatePrelevement", "DateValidationCR", 
            "DEP_EJ", "DEP_ET", "NumDossier")], print("Chargement des bases agrégées"), 
        t1 <- Sys.time(), path_zip_antigen = paste0(path_sortie, 
            date_AAAAMMJJ_last, "_sidep_antigen.csv"), print(path_zip_antigen), 
        sidep_prev_antigen = data.table::fread(path_zip_antigen, 
            na.strings = "", colClasses = list(Date = date_vars, 
                POSIXct = posixct_vars, character = c(char_vars, 
                  new_tag_char_vars), numeric = "Age"), verbose = F, 
            sep = ";", header = TRUE, encoding = "Latin-1"), 
        if (addP2) {
            sidep_prev_antigen[corres, `:=`(Pseudonyme, i.Pseudo2), 
                on = "Pseudonyme"]
        }, t2 <- Sys.time(), print(t2 - t1), print("Concaténation des bases en liste par mois"), 
        sidep_add[, `:=`(RPPSPrescripteur = as.character(RPPSPrescripteur))], 
        data.table::setnames(sidep_add, "FINESS_c", "FINESS_PS_init"), 
        sidep_add[, `:=`(FINESS_c_maj, NULL)], t1 <- Sys.time(), 
        sidep_prev_antigen[, `:=`(mois_prelev, lubridate::month(date_prelev))], 
        sidep_prev_antigen[, `:=`(annee_prelev, lubridate::year(date_prelev))], 
        sidep_antigen_lst <- split(sidep_prev_antigen, by = c("annee_prelev", 
            "mois_prelev")), t2 <- Sys.time(), print(t2 - t1), 
        sidep_antigen_lst <- lapply(sidep_antigen_lst, function(i) i[, 
            `:=`(mois_prelev, NULL)]), sidep_antigen_lst <- lapply(sidep_antigen_lst, 
            function(i) i[, `:=`(annee_prelev, NULL)]), sidep_antigen_lst <- lapply(sidep_antigen_lst, 
            function(i) i[, `:=`(day_prelev = as.Date(day_prelev), 
                day_valid = as.Date(day_valid), date_prelev = fasttime::fastPOSIXct(date_prelev), 
                date_valid = fasttime::fastPOSIXct(date_valid), 
                date_valid_init = fasttime::fastPOSIXct(date_valid_init), 
                day_extract_sidep = as.Date(day_extract_sidep), 
                Age = as.numeric(Age))]), sidep_add[, `:=`(mois_prelev, 
            lubridate::month(date_prelev))], sidep_add[, `:=`(annee_prelev, 
            lubridate::year(date_prelev))], sidep_add <- sidep_add[order(annee_prelev, 
            mois_prelev)], sidep_add_lst <- split(sidep_add, 
            by = c("annee_prelev", "mois_prelev")), sidep_add_lst <- lapply(sidep_add_lst, 
            function(i) i[, `:=`(mois_prelev, NULL)]), sidep_add_lst <- lapply(sidep_add_lst, 
            function(i) i[, `:=`(annee_prelev, NULL)]), t1 <- Sys.time(), 
        sidep_lst <- lapply(YYYY.mm, function(i) rbindlist(list(sidep_antigen_lst[[i]], 
            sidep_add_lst[[i]]), fill = TRUE)), t2 <- Sys.time(), 
        print(t2 - t1), rm(sidep_add, sidep_add_lst), print("Doublons dans la base globale"), 
        etapes_fin = cbind(var = "aucune", n_row = do.call("sum", 
            lapply(sidep_lst, nrow))), treat_duplicates <- function(temp) {
            print(paste0(lubridate::month(temp$date_prelev[1]), 
                " - ", lubridate::year(temp$date_prelev[1])))
            rows_dup <- (duplicated(temp, by = c("Pseudonyme", 
                "date_prelev", "AnalyseConclusion")) | duplicated(temp, 
                by = c("Pseudonyme", "date_prelev", "AnalyseConclusion"), 
                fromLast = TRUE))
            temp[, `:=`(date_valid_init = date_valid, latest_day_extract = day_extract_sidep)]
            temp_to_treat <- temp[rows_dup]
            temp_not_to_treat <- temp[!rows_dup]
            print(nrow(temp_to_treat))
            if (nrow(temp_to_treat) > 0) {
                temp_to_treat[, `:=`(date_valid_init = min(date_valid), 
                  latest_day_extract = max(day_extract_sidep)), 
                  by = c("Pseudonyme", "date_prelev", "AnalyseConclusion")]
                temp_to_treat <- temp_to_treat[day_extract_sidep %in% 
                  latest_day_extract]
                temp_to_treat <- temp_to_treat[, .SD[1], by = c("Pseudonyme", 
                  "date_prelev", "AnalyseConclusion")]
                temp <- rbindlist(list(temp_to_treat, temp_not_to_treat), 
                  fill = T)
            }
            return(temp)
        }, t1 <- Sys.time(), sidep_lst <- lapply(sidep_lst, function(i) treat_duplicates(i)), 
        t2 <- Sys.time(), print(t2 - t1), etapes_fin = rbind(etapes_fin, 
            cbind(var = "dup_tryptique_and_latest_date", n_row = do.call("sum", 
                lapply(sidep_lst, nrow)))), etapes_fin = data.table::data.table(etapes_fin), 
        etapes_fin[, `:=`(n_supp, 0)], etapes_fin[, `:=`(n_row, 
            as.numeric(n_row))], for (i in 2:nrow(etapes_fin)) {
            etapes_fin$n_supp[i] = etapes_fin$n_row[i - 1] - 
                etapes_fin$n_row[i]
        }, etapes_fin <<- etapes_fin, sidep_lst <- lapply(sidep_lst, 
            function(i) i[, `:=`(latest_day_extract = NULL)]), 
        extract_dt <- function(temp) {
            sidep_antigenique <- lapply(temp, function(i) i[AnalyseConclusion %in% 
                c("94558-4")])
            return(sidep_antigenique)
        }, t1 <- Sys.time(), sidep_antigenique <<- extract_dt(sidep_lst), 
        t2 <- Sys.time(), print(t2 - t1), print(Sys.time() - 
            TIME_INIT), gc()), list(<-, t2, list(Sys.time)), 
    list(print, list(-, t2, t1)), list(<-, sidep_antigenique, 
        list(rbindlist, sidep_antigenique, TRUE)), list(<-, t1, 
        list(Sys.time)), list(list(::, data.table, fwrite), sidep_antigenique, 
        list(paste0, path_sortie, date_AAAAMMJJ, "_sidep_antigen.csv"), 
        TRUE, ".", FALSE, TRUE, ";", list(c, "escape"), "ISO", 
        F), list(<-, t2, list(Sys.time)), list(print, list(-, 
        t2, t1)), list(<-, path_config, "src/"), list(=, jour_date, 
        list(Sys.Date)), list(=, date_AAAAMMJJ, list(format, 
        jour_date, "%Y%m%d")), list(=, date_AAMMJJ, list(substr, 
        date_AAAAMMJJ, 3, 8)), list(<-, annee, list(list(::, 
        lubridate, year), jour_date)), list(=, date_dataset, 
        list(as.Date, date_AAAAMMJJ, "%Y%m%d")), list(=, jour_prev_update, 
        list(-, list(Sys.Date), 1)), list(=, MoisAAAA, list(c, 
        "Mai2020", "Juin2020", "Juillet2020", "Aout2020", "Septembre2020", 
        "Octobre2020", "Novembre2020", "Decembre2020", "Janvier2021", 
        "Fevrier2021", "Mars2021", "Avril2021")), list(=, YYYY.mm, 
        list(c, "2020.5", "2020.6", "2020.7", "2020.8", "2020.9", 
            "2020.10", "2020.11", "2020.12", "2021.1", "2021.2", 
            "2021.3", "2021.4")), list(=, date_vars, list(c, 
        "day_prelev", "day_valid", "day_extract_sidep")), list(
        =, posixct_vars, list(c, "date_prelev", "date_valid", 
            "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(=, 
        run_expertise, F), list(library, tidyr), list(library, 
        dplyr), list(library, lubridate), list(library, data.table), 
    list(library, openxlsx), list(library, knitr), list(library, 
        rmarkdown), list(library, kableExtra), list(library, 
        stringi), list(library, bit64), list(library, ISOweek), 
    list(library, lest), list(library, parallel), list(library, 
        fasttime), list(library, ggplot2), list(=, pathtodata, 
        path_sortie), list(=, replaceP1P2, F), list(if, list(
        !, list(%in%, "sidep_pcr", list(ls))), list(list(print, 
        "load sidep_pcr"), list(=, sidep_pcr, list(list(::, pbapply, 
        pblapply), MoisAAAA, list(function, list(as.pairlist(alist(i = ))), 
        list(list(<-, dt, list(list(::, data.table, fread), list(
            paste0, pathtodata, date_AAAAMMJJ, "_sidep_pcr_", 
            i, ".csv"), "", list(list, date_vars, posixct_vars, 
            char_vars, "Age"), F, ";", TRUE, "Latin-1")), list(
            if, replaceP1P2, list(list(=, n, list(nrow, list(
                merge, dt, new_rattrapage, "Pseudonyme"))), list(
                print, list(sprintf, "%s lignes parmi %s ont eu un p1 remplacé par p2 dans le fichier %s.", 
                  n, list(nrow, dt), i)), list([, dt, new_rattrapage, 
                list(:=, Pseudonyme, i.Pseudo2), "Pseudonyme"))), 
            dt), list(1544L, 42L, 1559L, 3L, 42L, 3L, 1544L, 
            1559L)))), list(<-, sidep_pcr, list(rbindlist, sidep_pcr, 
        TRUE))), list(list(print, "sidep_pcr déjà chargé"))), 
    list(if, list(!, list(%in%, "sidep_pcr_sal_mil", list(ls))), 
        list(list(print, "load sidep_pcr_sal_mil"), list(=, path_pcr_sal_mil, 
            list(paste0, pathtodata, date_AAAAMMJJ, "_sidep_pcr_salivaire_milieux_divers.csv")), 
            list(print, path_pcr_sal_mil), list(=, sidep_pcr_sal_mil, 
                list(list(::, data.table, fread), path_pcr_sal_mil, 
                  "", list(list, date_vars, posixct_vars, char_vars, 
                    "Age"), F, ";", TRUE, "Latin-1")), list(nrow, 
                sidep_pcr_sal_mil), list(nrow, sidep_pcr_sal_mil), 
            list(if, replaceP1P2, list(list(nrow, list(merge, 
                sidep_pcr_sal_mil, new_rattrapage, "Pseudonyme")), 
                list([, sidep_pcr_sal_mil, new_rattrapage, list(
                  :=, Pseudonyme, i.Pseudo2), "Pseudonyme")))), 
        list(list(print, "sidep_pcr_sal_mil déjà chargé"))), 
    list(if, list(!, list(%in%, "sidep_sero", list(ls))), list(
        list(print, "load sidep_sero"), list(=, path_sero, list(
            paste0, pathtodata, date_AAAAMMJJ, "_sidep_sero.csv")), 
        list(print, path_sero), list(=, sidep_sero, list(list(
            ::, data.table, fread), path_sero, "", list(list, 
            date_vars, posixct_vars, char_vars, "Age"), F, ";", 
            TRUE, "Latin-1")), list(nrow, sidep_sero), list(nrow, 
            sidep_sero), list(if, replaceP1P2, list(list(nrow, 
            list(merge, sidep_sero, new_rattrapage, "Pseudonyme")), 
            list([, sidep_sero, new_rattrapage, list(:=, Pseudonyme, 
                i.Pseudo2), "Pseudonyme")))), list(list(print, 
        "sidep_sero déjà chargé"))), list(if, list(!, list(%in%, 
        "sidep_antigenique", list(ls))), list(list(print, "load sidep_antigenique"), 
        list(=, path_zip_antigen, list(paste0, pathtodata, date_AAAAMMJJ, 
            "_sidep_antigen.csv")), list(print, path_zip_antigen), 
        list(=, sidep_antigenique, list(list(::, data.table, 
            fread), path_zip_antigen, "", list(list, date_vars, 
            posixct_vars, list(c, char_vars, new_tag_char_vars), 
            "Age"), F, ";", TRUE, "Latin-1")), list(nrow, sidep_antigenique), 
        list(if, replaceP1P2, list(list([, sidep_antigenique, 
            new_rattrapage, list(:=, match_ok, T), "Pseudonyme"), 
            list([, sidep_antigenique, list(is.na, match_ok), 
                list(:=, match_ok, F))))), list(list(print, "sidep_antigenique déjà chargé"))), 
    list(print, "02a Nb tests"), list(print, list(gc, T)), list(
        library, ISOweek), list(library, lubridate), list(library, 
        data.table), list(library, plotly), list(library, scales), 
    list(library, bit64), list(library, openxlsx), list(options, 
        5000), list(<-, nb_tests, list(function, list(as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = ))), 
        list(list(=, date_AAAAMMJJ, list(format, jour, "%Y%m%d")), 
            list(if, list(==, type_test, "pcr"), list(list(<-, 
                sidep, sidep_pcr)), list(if, list(==, type_test, 
                "sero"), list(list(<-, sidep, sidep_sero)), list(
                if, list(==, type_test, "antigenique"), list(
                  list(<-, sidep, sidep_antigenique)), list(if, 
                  list(==, type_test, "antigen-complet"), list(
                    list(<-, sidep, sidep_antigen_complet)), 
                  list(if, list(==, type_test, "pcr_complet"), 
                    list(list(<-, sidep, sidep_pcr_complet)), 
                    list(if, list(==, type_test, "pcr_respi"), 
                      list(list(<-, sidep, sidep_pcr_respi)), 
                      list(if, list(==, type_test, "pcr_sal_mil"), 
                        list(list(<-, sidep, sidep_pcr_sal_mil)), 
                        list(if, list(==, type_test, "pcr_sal"), 
                          list(list(<-, sidep, list([, sidep_pcr_sal_mil, 
                            list(==, AnalyseConclusion, "94845-5")))), 
                          list(if, list(==, type_test, "pcr_mil"), 
                            list(list(<-, sidep, list([, sidep_pcr_sal_mil, 
                              list(==, AnalyseConclusion, "94309-2"))))))))))))), 
            list(if, list(==, type_date, "prelev"), list(list(
                <-, sidep, list([, sidep, sidep[, `:=`(date, 
                  as.Date(get(paste0("day_", type_date))))], 
                  list(:=, date, list(as.Date, list(get, list(
                    paste0, "day_", type_date))))))), list(if, 
                list(==, type_date, "valid"), list(list(<-, sidep, 
                  list([, sidep, sidep[, `:=`(date, as.Date(get(paste0("date_", 
                    type_date, "_init"))))], list(:=, date, list(
                    as.Date, list(get, list(paste0, "date_", 
                      type_date, "_init"))))))))), list(<-, sidep, 
                list([, sidep, list(!, list(is.na, date)), sidep[!is.na(date), 
                  ])), list(<-, sidep, list([, sidep, list(&, 
                list(>=, date, list(as.Date, day_init)), list(
                  <, date, jour)), sidep[date >= as.Date(day_init) & 
                date < jour, ])), list(table, list($, list([, 
                sidep, list(==, date, "2020-10-20")), ProfPrelevTA)), 
            list(sum, list(is.na, list($, list([, sidep, list(
                ==, date, "2020-10-20")), ProfPrelevTA))), list(
                table, list($, list([, sidep, list(==, date, 
                  "2020-10-20")), cat_pp)), list(sum, list(is.na, 
                list($, list([, sidep, list(==, date, "2020-10-20")), 
                  cat_pp))), list(=, nb_tests, list(dcast, list(
                [, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                  cat_pp, valeur)], list(., list((, .N)), list(
                  ., date, cat_pp, valeur)), list(~, date, list(
                +, cat_pp, list(paste0, "nb_", valeur))), "nb_res")), 
            list(=, nb_tests, list([, nb_tests, list(order, date))), 
            list(=, list([, nb_tests, list(is.na, nb_tests)), 
                0), list([, nb_tests, nb_tests[, `:=`(nb_tot, 
                rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests), "nb")), list(
                [, nb_tests, nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
                  .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                    !names(nb_tests) %like% "nb_NA"], list(:=, 
                  nb_tot_PNIX, list(rowSums, .SD)), list(&, list(
                  %like%, list(names, nb_tests), "nb_P|nb_N|nb_I|nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "nb_NA")))), list([, nb_tests, nb_tests[, 
                `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
                .SDcols = names(nb_tests) %like% "nb_P"], list(
                :=, prop_pos_PNIX, list(/, list(rowSums, .SD), 
                  nb_tot_PNIX)), list(%like%, list(names, nb_tests), 
                "nb_P")), list([, nb_tests, nb_tests[, `:=`(public_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], list(
                :=, public_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests), "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "public_nb_NA")))), list([, nb_tests, nb_tests[, 
                `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "public_nb"], list(:=, public_nb_tot, list(
                rowSums, .SD)), list(%like%, list(names, nb_tests), 
                "public_nb")), list([, nb_tests, nb_tests[, `:=`(privé_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], list(
                :=, privé_nb_tot_PNIX, list(rowSums, .SD)), list(
                &, list(%like%, list(names, nb_tests), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                list(!, list(%like%, list(names, nb_tests), "privé_nb_NA")))), 
            list([, nb_tests, nb_tests[, `:=`(privé_nb_tot, rowSums(.SD)), 
                .SDcols = names(nb_tests) %like% "privé_nb"], 
                list(:=, privé_nb_tot, list(rowSums, .SD)), list(
                  %like%, list(names, nb_tests), "privé_nb")), 
            list([, nb_tests, nb_tests[, `:=`(NA_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests) %like% 
                "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(rowSums, 
                .SD)), list(&, list(%like%, list(names, nb_tests), 
                "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), list(!, list(
                %like%, list(names, nb_tests), "NA_nb_NA")))), 
            list([, nb_tests, nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
                .SDcols = names(nb_tests) %like% "NA_nb"], list(
                :=, NA_nb_tot, list(rowSums, .SD)), list(%like%, 
                list(names, nb_tests), "NA_nb")), list([, nb_tests, 
                nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests), "nb_P")), 
            list([, nb_tests, nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
                .SDcols = names(nb_tests) %like% "NA_nb"], list(
                :=, NA_nb_tot, list(rowSums, .SD)), list(%like%, 
                list(names, nb_tests), "NA_nb")), list(<-, nb_tests, 
                list([, nb_tests, nb_tests[, .(date, public_nb_tot_PNIX, 
                  privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                  nb_pos, prop_pos_PNIX, nb_tot)], list(., date, 
                  public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                  nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot))), 
            list(<-, nb_tests_svg, nb_tests), list(<-, nb_tests, 
                nb_tests_svg), list(=, nb_tests_reg, list(dcast, 
                list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                  reg, cat_pp, valeur)], list(., list((, .N)), 
                  list(., date, reg, cat_pp, valeur)), list(~, 
                  list(+, date, reg), list(+, cat_pp, list(paste0, 
                    "nb_", valeur))), "nb_res")), list(=, reg2019, 
                list(list(::, data.table, fread), list(paste0, 
                  "data/utils/region2019_v2.csv"), "Latin-1")), 
            list(=, list($, reg2019, reg), list(as.character, 
                list($, reg2019, reg))), list([, reg2019, list(
                ==, list(nchar, reg), 1), list(:=, reg, list(
                paste0, "0", reg))), list(=, nb_tests_reg, list(
                merge, nb_tests_reg, list([, reg2019, reg2019[, 
                  .(reg, libelle)], list(., reg, libelle)), "reg", 
                T)), list(setnames, nb_tests_reg, "libelle", 
                "nom_reg"), list(=, nb_tests_reg, list([, nb_tests_reg, 
                list(order, nom_reg))), list([, nb_tests_reg, 
                list(is.na, nom_reg), list(:=, nom_reg, "Région inconnue")), 
            list(=, list([, nb_tests_reg, list(is.na, nb_tests_reg)), 
                0), list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot, 
                rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_reg), "nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
                "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                .SD)), list(&, list(%like%, list(names, nb_tests_reg), 
                "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                list(names, nb_tests_reg), "nb_NA")))), list(
                [, nb_tests_reg, nb_tests_reg[, `:=`(prop_pos_PNIX, 
                  rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                  "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                  rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                  list(names, nb_tests_reg), "nb_P")), list([, 
                nb_tests_reg, nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                  !names(nb_tests_reg) %like% "public_nb_NA"], 
                list(:=, public_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests_reg), 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "public_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(public_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_reg) %like% "public_nb"], 
                list(:=, public_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_reg), "public_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_reg) %like% "privé_nb_NA"], list(
                :=, privé_nb_tot_PNIX, list(rowSums, .SD)), list(
                &, list(%like%, list(names, nb_tests_reg), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                list(!, list(%like%, list(names, nb_tests_reg), 
                  "privé_nb_NA")))), list([, nb_tests_reg, nb_tests_reg[, 
                `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "privé_nb"], list(:=, privé_nb_tot, list(rowSums, 
                .SD)), list(%like%, list(names, nb_tests_reg), 
                "privé_nb")), list([, nb_tests_reg, nb_tests_reg[, 
                `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
                  "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(
                rowSums, .SD)), list(&, list(%like%, list(names, 
                nb_tests_reg), "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), 
                list(!, list(%like%, list(names, nb_tests_reg), 
                  "NA_nb_NA")))), list([, nb_tests_reg, nb_tests_reg[, 
                `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                .SD)), list(%like%, list(names, nb_tests_reg), 
                "NA_nb")), list([, nb_tests_reg, nb_tests_reg[, 
                `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_reg), "nb_P")), 
            list(<-, nb_tests_reg, list([, nb_tests_reg, nb_tests_reg[, 
                .(date, nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
                  NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                  nb_tot)], list(., date, nom_reg, public_nb_tot_PNIX, 
                privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                nb_pos, prop_pos_PNIX, nb_tot))), list(=, nb_tests_dep, 
                list(dcast, list([, sidep, sidep[, .(nb_res = (.N)), 
                  by = .(date, departement, cat_pp, valeur)], 
                  list(., list((, .N)), list(., date, departement, 
                    cat_pp, valeur)), list(~, list(+, date, departement), 
                  list(+, cat_pp, list(paste0, "nb_", valeur))), 
                  "nb_res")), list(=, list([, nb_tests_dep, list(
                is.na, nb_tests_dep)), 0), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_dep) %like% 
                "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                list(names, nb_tests_dep), "nb_NA")))), list(
                [, nb_tests_dep, nb_tests_dep[, `:=`(prop_pos_PNIX, 
                  rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                  rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                  list(names, nb_tests_dep), "nb_P")), list([, 
                nb_tests_dep, nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                  !names(nb_tests_dep) %like% "public_nb_NA"], 
                list(:=, public_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests_dep), 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "public_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(public_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "public_nb"], 
                list(:=, public_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "public_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_dep) %like% "privé_nb_NA"], list(
                :=, privé_nb_tot_PNIX, list(rowSums, .SD)), list(
                &, list(%like%, list(names, nb_tests_dep), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                list(!, list(%like%, list(names, nb_tests_dep), 
                  "privé_nb_NA")))), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "privé_nb"], list(:=, privé_nb_tot, list(rowSums, 
                .SD)), list(%like%, list(names, nb_tests_dep), 
                "privé_nb")), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
                  "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(
                rowSums, .SD)), list(&, list(%like%, list(names, 
                nb_tests_dep), "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), 
                list(!, list(%like%, list(names, nb_tests_dep), 
                  "NA_nb_NA")))), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                .SD)), list(%like%, list(names, nb_tests_dep), 
                "NA_nb")), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "nb_P")), 
            list(<-, nb_tests_dep, list([, nb_tests_dep, nb_tests_dep[, 
                .(date, departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
                  NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                  nb_tot)], list(., date, departement, public_nb_tot_PNIX, 
                privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                nb_pos, prop_pos_PNIX, nb_tot))), list(<-, wb, 
                list(loadWorkbook, "data/sorties/nb_tests/lisez_moi.xlsx")), 
            list(addWorksheet, wb, "national"), list(writeData, 
                wb, "national", nb_tests), list(setColWidths, 
                wb, "national", list(:, 1, list(ncol, nb_tests)), 
                12), list(addStyle, wb, "national", list(createStyle, 
                "# ##0"), list(c, 2, 3, 4, 5, 6, 8), list(+, 
                list(:, 1, list(nrow, nb_tests)), 1), T, T), 
            list(addStyle, wb, "national", list(createStyle, 
                "0.0 %"), list(c, 7), list(+, list(:, 1, list(
                nrow, nb_tests)), 1), T, T), list(addWorksheet, 
                wb, "regions"), list(writeData, wb, "regions", 
                nb_tests_reg), list(setColWidths, wb, "regions", 
                list(:, 1, list(ncol, nb_tests_reg)), 12), list(
                addStyle, wb, "regions", list(createStyle, "# ##0"), 
                list(c, 3, 4, 5, 6, 7, 9), list(+, list(:, 1, 
                  list(nrow, nb_tests_reg)), 1), T, T), list(
                addStyle, wb, "regions", list(createStyle, "0.0 %"), 
                list(c, 8), list(+, list(:, 1, list(nrow, nb_tests_reg)), 
                  1), T, T), list(addWorksheet, wb, "departements"), 
            list(writeData, wb, "departements", nb_tests_dep), 
            list(setColWidths, wb, "departements", list(:, 1, 
                list(ncol, nb_tests_dep)), 12), list(addStyle, 
                wb, "departements", list(createStyle, "# ##0"), 
                list(c, 3, 4, 5, 6, 7, 9), list(+, list(:, 1, 
                  list(nrow, nb_tests_dep)), 1), T, T), list(
                addStyle, wb, "departements", list(createStyle, 
                  "0.0 %"), list(c, 8), list(+, list(:, 1, list(
                  nrow, nb_tests_dep)), 1), T, T), list(saveWorkbook, 
                wb, list(paste0, "data/sorties/nb_tests/", date_AAAAMMJJ, 
                  "_sidep_", type_test, "_", type_date, ".xlsx"), 
                T)), list(1644L, 13L, 1808L, 1L, 13L, 1L, 1644L, 
            1808L))), list(<-, nb_tests_AG, list(function, list(
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
        as.pairlist(alist(type_test = , type_date = , day_init = , jour = ))), 
        list(list(=, date_AAAAMMJJ, list(format, jour, "%Y%m%d")), 
            list(<-, sidep, list(list(::, data.table, copy), 
                sidep_antigenique)), list(if, list(==, type_date, 
                "prelev"), list(list(<-, sidep, list([, sidep, 
                sidep[, `:=`(date, as.Date(get(paste0("day_", 
                  type_date))))], list(:=, date, list(as.Date, 
                  list(get, list(paste0, "day_", type_date))))))), 
                list(if, list(==, type_date, "valid"), list(list(
                  <-, sidep, list([, sidep, sidep[, `:=`(date, 
                    as.Date(get(paste0("date_", type_date, "_init"))))], 
                    list(:=, date, list(as.Date, list(get, list(
                      paste0, "date_", type_date, "_init"))))))))), 
            list(<-, sidep, list([, sidep, list(!, list(is.na, 
                date)), sidep[!is.na(date), ])), list(<-, sidep, 
                list([, sidep, list(&, list(>=, date, list(as.Date, 
                  day_init)), list(<, date, jour)), sidep[date >= 
                  as.Date(day_init) & date < jour, ])), list(
                print, list([, sidep, sidep[, unique(ProfPrelevTA)], 
                  list(unique, ProfPrelevTA))), list(=, nb_tests, 
                list(dcast, list([, sidep, sidep[, .(nb_res = (.N)), 
                  by = .(date, cat_pp, ProfPrelevTA, valeur)], 
                  list(., list((, .N)), list(., date, cat_pp, 
                    ProfPrelevTA, valeur)), list(~, date, list(
                  +, list(+, ProfPrelevTA, cat_pp), list(paste0, 
                    "nb_", valeur))), "nb_res")), list(=, nb_tests, 
                list([, nb_tests, list(order, date))), list(=, 
                list([, nb_tests, list(is.na, nb_tests)), 0), 
            list([, nb_tests, nb_tests[, `:=`(nb_tot, rowSums(.SD, 
                na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "nb"], list(:=, nb_tot, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests), "nb")), list(
                [, nb_tests, nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests), "nb_P|nb_N|nb_I|nb_X"), list(!, 
                  list(%like%, list(names, nb_tests), "nb_NA")))), 
            list([, nb_tests, nb_tests[, `:=`(prop_pos_PNIX, 
                rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                rowSums, .SD, TRUE), nb_tot_PNIX)), list(%like%, 
                list(names, nb_tests), "nb_P")), list([, nb_tests, 
                nb_tests[, `:=`(public_nb_tot_PNIX, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                  !names(nb_tests) %like% "public_nb_NA"], list(
                  :=, public_nb_tot_PNIX, list(rowSums, .SD, 
                    TRUE)), list(&, list(%like%, list(names, 
                  nb_tests), "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "public_nb_NA")))), list([, nb_tests, nb_tests[, 
                `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
                .SDcols = names(nb_tests) %like% "NA_public_nb"], 
                list(:=, public_nb_tot, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests), "NA_public_nb")), 
            list([, nb_tests, nb_tests[, `:=`(privé_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], list(
                :=, privé_nb_tot_PNIX, list(rowSums, .SD, TRUE)), 
                list(&, list(%like%, list(names, nb_tests), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "privé_nb_NA")))), list([, nb_tests, nb_tests[, 
                `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), 
                .SDcols = names(nb_tests) %like% "NA_privé_nb"], 
                list(:=, privé_nb_tot, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests), "NA_privé_nb")), 
            list([, nb_tests, nb_tests[, `:=`(nb_pos, rowSums(.SD, 
                na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "nb_P"], list(:=, nb_pos, list(rowSums, .SD, 
                TRUE)), list(%like%, list(names, nb_tests), "nb_P")), 
            list([, nb_tests, nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], 
                list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests), 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "MEDECIN_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(MEDECIN_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "MEDECIN_NA_nb"], list(:=, MEDECIN_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "MEDECIN_NA_nb")), list([, 
                nb_tests, nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                  !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
                list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests), "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "INFIRMIER_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "INFIRMIER_NA_nb"], list(:=, INFIRMIER_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "INFIRMIER_NA_nb")), list(
                [, nb_tests, nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                  !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], 
                list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests), "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "PHARMACIEN_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "PHARMACIEN_NA_nb"], list(:=, PHARMACIEN_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "PHARMACIEN_NA_nb")), list(
                [, nb_tests, nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                  !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
                list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests), 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "DOCTEUR_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "DOCTEUR_NA_nb"], list(:=, DOCTEUR_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "DOCTEUR_NA_nb")), list([, 
                nb_tests, nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                  !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
                list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests), 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "BIOLOGISTE_NA_nb"], list(:=, BIOLOGISTE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "BIOLOGISTE_NA_nb")), list(
                [, nb_tests, nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                  !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                [, nb_tests, nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "MASSEURKINESITHERAPE_NA_nb")), 
            list([, nb_tests, nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], 
                list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests), 
                  "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "SAGEFEMME_NA_nb_NA")))), list([, nb_tests, 
                nb_tests[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "SAGEFEMME_NA_nb"], list(:=, SAGEFEMME_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "SAGEFEMME_NA_nb")), list(
                [, nb_tests, nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                  !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "CHIRURGIENDENTISTE_NA_nb_NA")))), list([, 
                nb_tests, nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests), "CHIRURGIENDENTISTE_NA_nb")), 
            list([, nb_tests, nb_tests[, `:=`(NA_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                list(:=, NA_nb_tot_PNIX, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests), "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
            list([, nb_tests, nb_tests[, `:=`(NA_nb_tot, rowSums(.SD, 
                na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                .SD, TRUE)), list(%like%, list(names, nb_tests), 
                "NA_NA_nb")), list([, nb_tests, nb_tests[, `:=`(verif, 
                CHIRURGIENDENTISTE_nb_tot_PNIX + SAGEFEMME_nb_tot_PNIX + 
                  MASSEURKINESITHERAPE_nb_tot_PNIX + BIOLOGISTE_nb_tot_PNIX + 
                  DOCTEUR_nb_tot_PNIX + PHARMACIEN_nb_tot_PNIX + 
                  INFIRMIER_nb_tot_PNIX + MEDECIN_nb_tot_PNIX + 
                  NA_nb_tot_PNIX + privé_nb_tot_PNIX + public_nb_tot_PNIX - 
                  nb_tot_PNIX)], list(:=, verif, list(-, list(
                +, list(+, list(+, list(+, list(+, list(+, list(
                  +, list(+, list(+, list(+, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                    SAGEFEMME_nb_tot_PNIX), MASSEURKINESITHERAPE_nb_tot_PNIX), 
                    BIOLOGISTE_nb_tot_PNIX), DOCTEUR_nb_tot_PNIX), 
                  PHARMACIEN_nb_tot_PNIX), INFIRMIER_nb_tot_PNIX), 
                  MEDECIN_nb_tot_PNIX), NA_nb_tot_PNIX), privé_nb_tot_PNIX), 
                public_nb_tot_PNIX), nb_tot_PNIX))), list(if, 
                list(>, list(sum, list($, nb_tests, verif), T), 
                  0), list(print, "Il y a un probleme de sommation entre les catégories PNIX.")), 
            list([, nb_tests, nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + 
                SAGEFEMME_nb_tot + MASSEURKINESITHERAPE_nb_tot + 
                BIOLOGISTE_nb_tot + DOCTEUR_nb_tot + PHARMACIEN_nb_tot + 
                INFIRMIER_nb_tot + MEDECIN_nb_tot + NA_nb_tot + 
                privé_nb_tot + public_nb_tot - nb_tot)], list(
                :=, verif, list(-, list(+, list(+, list(+, list(
                  +, list(+, list(+, list(+, list(+, list(+, 
                    list(+, CHIRURGIENDENTISTE_nb_tot, SAGEFEMME_nb_tot), 
                    MASSEURKINESITHERAPE_nb_tot), BIOLOGISTE_nb_tot), 
                    DOCTEUR_nb_tot), PHARMACIEN_nb_tot), INFIRMIER_nb_tot), 
                  MEDECIN_nb_tot), NA_nb_tot), privé_nb_tot), 
                  public_nb_tot), nb_tot))), list(if, list(>, 
                list(sum, list($, nb_tests, verif), T), 0), list(
                print, "Il y a un probleme de sommation entre les catégories toute norme confondue.")), 
            list(<-, nb_tests, list([, nb_tests, nb_tests[, .(date, 
                MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
                list(., date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                  INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                  BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                  NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                  nb_tot))), list(=, nb_tests_top_prelev_ta, 
                list(dcast, list([, sidep, sidep[, .(nb_res = (.N)), 
                  by = .(date, TopPrelevTA, valeur)], list(., 
                  list((, .N)), list(., date, TopPrelevTA, valeur)), 
                  list(~, date, list(+, TopPrelevTA, list(paste0, 
                    "nb_", valeur))), "nb_res")), list(=, nb_tests_top_prelev_ta, 
                list([, nb_tests_top_prelev_ta, list(order, date))), 
            list([, nb_tests_top_prelev_ta, nb_tests_top_prelev_ta[, 
                `:=`(top_prelev_ta_PNIX, rowSums(.SD, na.rm = TRUE)), 
                .SDcols = names(nb_tests_top_prelev_ta) %like% 
                  "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], list(:=, top_prelev_ta_PNIX, 
                list(rowSums, .SD, TRUE)), list(%like%, list(
                names, nb_tests_top_prelev_ta), "1_nb_I|1_nb_N|1_nb_P|1_nb_X")), 
            list([, nb_tests_top_prelev_ta, nb_tests_top_prelev_ta[, 
                `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
                .SDcols = names(nb_tests_top_prelev_ta) %like% 
                  "1_nb"], list(:=, top_prelev_ta, list(rowSums, 
                .SD, TRUE)), list(%like%, list(names, nb_tests_top_prelev_ta), 
                "1_nb")), list(<-, nb_tests_top_prelev_ta, list(
                [, nb_tests_top_prelev_ta, nb_tests_top_prelev_ta[, 
                  .(date, top_prelev_ta_PNIX, top_prelev_ta)], 
                list(., date, top_prelev_ta_PNIX, top_prelev_ta))), 
            list(<-, nb_tests, list(merge, nb_tests, nb_tests_top_prelev_ta, 
                "date", TRUE)), list([, nb_tests, nb_tests[, 
                `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
                  PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
                  DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - 
                  CHIRURGIENDENTISTE_nb_tot_PNIX - SAGEFEMME_nb_tot_PNIX - 
                  MASSEURKINESITHERAPE_nb_tot_PNIX)], list(:=, 
                verif, list(-, list(-, list(-, list(-, list(-, 
                  list(-, list(-, list(-, top_prelev_ta_PNIX, 
                    MEDECIN_nb_tot_PNIX), PHARMACIEN_nb_tot_PNIX), 
                    INFIRMIER_nb_tot_PNIX), DOCTEUR_nb_tot_PNIX), 
                  BIOLOGISTE_nb_tot_PNIX), CHIRURGIENDENTISTE_nb_tot_PNIX), 
                  SAGEFEMME_nb_tot_PNIX), MASSEURKINESITHERAPE_nb_tot_PNIX))), 
            list(if, list(>, list(sum, list($, nb_tests, verif), 
                T), 0), list(print, "Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession.")), 
            list(<-, nb_tests_svg, nb_tests), list(<-, nb_tests, 
                nb_tests_svg), list(=, nb_tests_reg, list(dcast, 
                list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                  reg, ProfPrelevTA, cat_pp, valeur)], list(., 
                  list((, .N)), list(., date, reg, ProfPrelevTA, 
                  cat_pp, valeur)), list(~, list(+, date, reg), 
                  list(+, list(+, ProfPrelevTA, cat_pp), list(
                    paste0, "nb_", valeur))), "nb_res")), list(
                =, reg2019, list(list(::, data.table, fread), 
                  list(paste0, "data/utils/region2019_v2.csv"), 
                  "Latin-1")), list(=, list($, reg2019, reg), 
                list(as.character, list($, reg2019, reg))), list(
                [, reg2019, list(==, list(nchar, reg), 1), list(
                  :=, reg, list(paste0, "0", reg))), list(=, 
                nb_tests_reg, list(merge, nb_tests_reg, list(
                  [, reg2019, reg2019[, .(reg, libelle)], list(
                    ., reg, libelle)), "reg", T)), list(list(
                ::, data.table, setnames), nb_tests_reg, "libelle", 
                "nom_reg"), list(=, nb_tests_reg, list([, nb_tests_reg, 
                list(order, nom_reg))), list([, nb_tests_reg, 
                list(is.na, nom_reg), list(:=, nom_reg, "Région inconnue")), 
            list(=, list([, nb_tests_reg, list(is.na, nb_tests_reg)), 
                0), list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], list(:=, nb_tot, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests_reg), "nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
                "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                .SD, TRUE)), list(&, list(%like%, list(names, 
                nb_tests_reg), "nb_P|nb_N|nb_I|nb_X"), list(!, 
                list(%like%, list(names, nb_tests_reg), "nb_NA")))), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(prop_pos_PNIX, 
                rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                rowSums, .SD, TRUE), nb_tot_PNIX)), list(%like%, 
                list(names, nb_tests_reg), "nb_P")), list([, 
                nb_tests_reg, nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                  !names(nb_tests_reg) %like% "public_nb_NA"], 
                list(:=, public_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests_reg), 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "public_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(public_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_public_nb"], list(:=, public_nb_tot, list(
                  rowSums, .SD, TRUE)), list(%like%, list(names, 
                  nb_tests_reg), "NA_public_nb")), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                  !names(nb_tests_reg) %like% "privé_nb_NA"], 
                list(:=, privé_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests_reg), 
                  "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "privé_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(privé_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_privé_nb"], list(:=, privé_nb_tot, list(
                  rowSums, .SD, TRUE)), list(%like%, list(names, 
                  nb_tests_reg), "NA_privé_nb")), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, na.rm = TRUE)), 
                  .SDcols = names(nb_tests_reg) %like% "nb_P"], 
                list(:=, nb_pos, list(rowSums, .SD, TRUE)), list(
                  %like%, list(names, nb_tests_reg), "nb_P")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
                list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests_reg), 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "MEDECIN_NA_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "MEDECIN_NA_nb"], list(:=, MEDECIN_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "MEDECIN_NA_nb")), list(
                [, nb_tests_reg, nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], 
                list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests_reg), "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "INFIRMIER_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "INFIRMIER_NA_nb"], list(:=, INFIRMIER_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "INFIRMIER_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
                list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests_reg), "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "PHARMACIEN_NA_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "PHARMACIEN_NA_nb"], list(:=, PHARMACIEN_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "PHARMACIEN_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
                list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, .SD, 
                  TRUE)), list(&, list(%like%, list(names, nb_tests_reg), 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "DOCTEUR_NA_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "DOCTEUR_NA_nb"], list(:=, DOCTEUR_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "DOCTEUR_NA_nb")), list(
                [, nb_tests_reg, nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
                list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests_reg), "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "BIOLOGISTE_NA_nb"], list(:=, BIOLOGISTE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "BIOLOGISTE_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, list(
                  rowSums, .SD, TRUE)), list(&, list(%like%, 
                  list(names, nb_tests_reg), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                [, nb_tests_reg, nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "MASSEURKINESITHERAPE_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
                list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests_reg), "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "SAGEFEMME_NA_nb_NA")))), list([, nb_tests_reg, 
                nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "SAGEFEMME_NA_nb"], list(:=, SAGEFEMME_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "SAGEFEMME_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                  rowSums, .SD, TRUE)), list(&, list(%like%, 
                  list(names, nb_tests_reg), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "CHIRURGIENDENTISTE_NA_nb_NA")))), list([, 
                nb_tests_reg, nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                  list(rowSums, .SD, TRUE)), list(%like%, list(
                  names, nb_tests_reg), "CHIRURGIENDENTISTE_NA_nb")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                list(:=, NA_nb_tot_PNIX, list(rowSums, .SD, TRUE)), 
                list(%like%, list(names, nb_tests_reg), "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
            list([, nb_tests_reg, nb_tests_reg[, `:=`(NA_nb_tot, 
                rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                .SD, TRUE)), list(%like%, list(names, nb_tests_reg), 
                "NA_NA_nb")), list(<-, nb_tests_reg, list([, 
                nb_tests_reg, nb_tests_reg[, .(date, nom_reg, 
                  MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                  INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                  BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                  NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                  nb_tot)], list(., date, nom_reg, MEDECIN_nb_tot_PNIX, 
                  PHARMACIEN_nb_tot_PNIX, INFIRMIER_nb_tot_PNIX, 
                  DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                  CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                  MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                  privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, 
                  nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot))), 
            list(=, nb_tests_dep, list(dcast, list([, sidep, 
                sidep[, .(nb_res = (.N)), by = .(date, ProfPrelevTA, 
                  departement, cat_pp, valeur)], list(., list(
                  (, .N)), list(., date, ProfPrelevTA, departement, 
                  cat_pp, valeur)), list(~, list(+, date, departement), 
                list(+, list(+, ProfPrelevTA, cat_pp), list(paste0, 
                  "nb_", valeur))), "nb_res")), list(=, list(
                [, nb_tests_dep, list(is.na, nb_tests_dep)), 
                0), list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_dep) %like% 
                "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                list(names, nb_tests_dep), "nb_NA")))), list(
                [, nb_tests_dep, nb_tests_dep[, `:=`(prop_pos_PNIX, 
                  rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                  rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                  list(names, nb_tests_dep), "nb_P")), list([, 
                nb_tests_dep, nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                  !names(nb_tests_dep) %like% "public_nb_NA"], 
                list(:=, public_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests_dep), 
                  "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "public_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(public_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "NA_public_nb"], 
                list(:=, public_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "NA_public_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_dep) %like% "privé_nb_NA"], list(
                :=, privé_nb_tot_PNIX, list(rowSums, .SD)), list(
                &, list(%like%, list(names, nb_tests_dep), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                list(!, list(%like%, list(names, nb_tests_dep), 
                  "privé_nb_NA")))), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_privé_nb"], list(:=, privé_nb_tot, list(
                rowSums, .SD)), list(%like%, list(names, nb_tests_dep), 
                "NA_privé_nb")), list([, nb_tests_dep, nb_tests_dep[, 
                `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "nb_P")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(MEDECIN_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
                list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests_dep), 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "MEDECIN_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "MEDECIN_NA_nb"], 
                list(:=, MEDECIN_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "MEDECIN_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
                list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "INFIRMIER_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
                list(:=, INFIRMIER_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "INFIRMIER_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
                list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "PHARMACIEN_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
                list(:=, PHARMACIEN_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "PHARMACIEN_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
                list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, .SD)), 
                list(&, list(%like%, list(names, nb_tests_dep), 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "DOCTEUR_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb"], 
                list(:=, DOCTEUR_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "DOCTEUR_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
                list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
                list(:=, BIOLOGISTE_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "BIOLOGISTE_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests_dep), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                [, nb_tests_dep, nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                  list(rowSums, .SD)), list(%like%, list(names, 
                  nb_tests_dep), "MASSEURKINESITHERAPE_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
                list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "SAGEFEMME_NA_nb_NA")))), list([, nb_tests_dep, 
                nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
                  .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
                list(:=, SAGEFEMME_nb_tot, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "SAGEFEMME_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests_dep), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "CHIRURGIENDENTISTE_NA_nb_NA")))), list([, 
                nb_tests_dep, nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                  list(rowSums, .SD)), list(%like%, list(names, 
                  nb_tests_dep), "CHIRURGIENDENTISTE_NA_nb")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                list(:=, NA_nb_tot_PNIX, list(rowSums, .SD)), 
                list(%like%, list(names, nb_tests_dep), "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
            list([, nb_tests_dep, nb_tests_dep[, `:=`(NA_nb_tot, 
                rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                .SD)), list(%like%, list(names, nb_tests_dep), 
                "NA_NA_nb")), list(<-, nb_tests_dep, list([, 
                nb_tests_dep, nb_tests_dep[, .(date, departement, 
                  MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                  INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                  BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                  nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
                list(., date, departement, MEDECIN_nb_tot_PNIX, 
                  PHARMACIEN_nb_tot_PNIX, INFIRMIER_nb_tot_PNIX, 
                  DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                  CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                  MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                  privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, 
                  nb_pos, prop_pos_PNIX, nb_tot))), list(<-, 
                wb, list(loadWorkbook, "data/sorties/nb_tests/lisez_moi_TAG.xlsx")), 
            list(addWorksheet, wb, "national"), list(writeData, 
                wb, "national", nb_tests), list(setColWidths, 
                wb, "national", list(:, 1, list(ncol, nb_tests)), 
                12), list(addWorksheet, wb, "regions"), list(
                writeData, wb, "regions", nb_tests_reg), list(
                setColWidths, wb, "regions", list(:, 1, list(
                  ncol, nb_tests_reg)), 12), list(addWorksheet, 
                wb, "departements"), list(writeData, wb, "departements", 
                nb_tests_dep), list(setColWidths, wb, "departements", 
                list(:, 1, list(ncol, nb_tests_dep)), 12), list(
                saveWorkbook, wb, list(paste0, "data/sorties/nb_tests/", 
                  date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
                  ".xlsx"), T)), list(1809L, 16L, 2118L, 1L, 
            16L, 1L, 1809L, 2118L))), list(structure(expression(
        type_test = "pcr"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-20"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-24"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "sero"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-06-10"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "sero"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-06-12"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "antigenique"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-16"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), sidep <- data.table::copy(sidep_antigenique), 
        if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], print(sidep[, 
            unique(ProfPrelevTA)]), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, ProfPrelevTA, 
                valeur)], date ~ ProfPrelevTA + cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "NA_public_nb"], 
        nb_tests[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_privé_nb"], nb_tests[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], nb_tests[, 
            `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "MEDECIN_NA_nb"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb"], 
        nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], nb_tests[, 
            `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "PHARMACIEN_NA_nb"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], nb_tests[, 
            `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb"], nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot_PNIX + 
            SAGEFEMME_nb_tot_PNIX + MASSEURKINESITHERAPE_nb_tot_PNIX + 
            BIOLOGISTE_nb_tot_PNIX + DOCTEUR_nb_tot_PNIX + PHARMACIEN_nb_tot_PNIX + 
            INFIRMIER_nb_tot_PNIX + MEDECIN_nb_tot_PNIX + NA_nb_tot_PNIX + 
            privé_nb_tot_PNIX + public_nb_tot_PNIX - nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories PNIX."), 
        nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + SAGEFEMME_nb_tot + 
            MASSEURKINESITHERAPE_nb_tot + BIOLOGISTE_nb_tot + 
            DOCTEUR_nb_tot + PHARMACIEN_nb_tot + INFIRMIER_nb_tot + 
            MEDECIN_nb_tot + NA_nb_tot + privé_nb_tot + public_nb_tot - 
            nb_tot)], if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories toute norme confondue."), 
        nb_tests <- nb_tests[, .(date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_top_prelev_ta = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, TopPrelevTA, valeur)], 
            date ~ TopPrelevTA + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_top_prelev_ta = nb_tests_top_prelev_ta[order(date)], 
        nb_tests_top_prelev_ta[, `:=`(top_prelev_ta_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_top_prelev_ta) %like% 
            "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], nb_tests_top_prelev_ta[, 
            `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_top_prelev_ta) %like% "1_nb"], 
        nb_tests_top_prelev_ta <- nb_tests_top_prelev_ta[, .(date, 
            top_prelev_ta_PNIX, top_prelev_ta)], nb_tests <- merge(nb_tests, 
            nb_tests_top_prelev_ta, by = "date", all = TRUE), 
        nb_tests[, `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
            PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
            DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - CHIRURGIENDENTISTE_nb_tot_PNIX - 
            SAGEFEMME_nb_tot_PNIX - MASSEURKINESITHERAPE_nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession."), 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, ProfPrelevTA, 
                cat_pp, valeur)], date + reg ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), data.table::setnames(nb_tests_reg, 
            "libelle", "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
            "nb_NA"], nb_tests_reg[, `:=`(prop_pos_PNIX, rowSums(.SD, 
            na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "NA_public_nb"], 
        nb_tests_reg[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_reg) %like% "privé_nb_NA"], nb_tests_reg[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_privé_nb"], nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "MEDECIN_NA_nb"], 
        nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], nb_tests_reg[, 
            `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "INFIRMIER_NA_nb"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
            !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "DOCTEUR_NA_nb"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_reg[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, ProfPrelevTA, departement, 
                cat_pp, valeur)], date + departement ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_dep[is.na(nb_tests_dep)] = 0, nb_tests_dep[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_privé_nb"], nb_tests_dep[, `:=`(nb_pos, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P"], nb_tests_dep[, 
            `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MEDECIN_NA_nb"], nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "DOCTEUR_NA_nb"], nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb"], 
        nb_tests_dep[, `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_dep[, 
            `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, nb_pos, 
            prop_pos_PNIX, nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi_TAG.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addWorksheet(wb, "regions"), writeData(wb, 
            "regions", nb_tests_reg), setColWidths(wb, "regions", 
            cols = 1:ncol(nb_tests_reg), widths = 12), addWorksheet(wb, 
            "departements"), writeData(wb, "departements", nb_tests_dep), 
        setColWidths(wb, "departements", cols = 1:ncol(nb_tests_dep), 
            widths = 12), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "antigenique"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-16"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), sidep <- data.table::copy(sidep_antigenique), 
        if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], print(sidep[, 
            unique(ProfPrelevTA)]), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, ProfPrelevTA, 
                valeur)], date ~ ProfPrelevTA + cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "NA_public_nb"], 
        nb_tests[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_privé_nb"], nb_tests[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], nb_tests[, 
            `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "MEDECIN_NA_nb"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb"], 
        nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], nb_tests[, 
            `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "PHARMACIEN_NA_nb"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], nb_tests[, 
            `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb"], nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot_PNIX + 
            SAGEFEMME_nb_tot_PNIX + MASSEURKINESITHERAPE_nb_tot_PNIX + 
            BIOLOGISTE_nb_tot_PNIX + DOCTEUR_nb_tot_PNIX + PHARMACIEN_nb_tot_PNIX + 
            INFIRMIER_nb_tot_PNIX + MEDECIN_nb_tot_PNIX + NA_nb_tot_PNIX + 
            privé_nb_tot_PNIX + public_nb_tot_PNIX - nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories PNIX."), 
        nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + SAGEFEMME_nb_tot + 
            MASSEURKINESITHERAPE_nb_tot + BIOLOGISTE_nb_tot + 
            DOCTEUR_nb_tot + PHARMACIEN_nb_tot + INFIRMIER_nb_tot + 
            MEDECIN_nb_tot + NA_nb_tot + privé_nb_tot + public_nb_tot - 
            nb_tot)], if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories toute norme confondue."), 
        nb_tests <- nb_tests[, .(date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_top_prelev_ta = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, TopPrelevTA, valeur)], 
            date ~ TopPrelevTA + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_top_prelev_ta = nb_tests_top_prelev_ta[order(date)], 
        nb_tests_top_prelev_ta[, `:=`(top_prelev_ta_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_top_prelev_ta) %like% 
            "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], nb_tests_top_prelev_ta[, 
            `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_top_prelev_ta) %like% "1_nb"], 
        nb_tests_top_prelev_ta <- nb_tests_top_prelev_ta[, .(date, 
            top_prelev_ta_PNIX, top_prelev_ta)], nb_tests <- merge(nb_tests, 
            nb_tests_top_prelev_ta, by = "date", all = TRUE), 
        nb_tests[, `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
            PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
            DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - CHIRURGIENDENTISTE_nb_tot_PNIX - 
            SAGEFEMME_nb_tot_PNIX - MASSEURKINESITHERAPE_nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession."), 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, ProfPrelevTA, 
                cat_pp, valeur)], date + reg ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), data.table::setnames(nb_tests_reg, 
            "libelle", "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
            "nb_NA"], nb_tests_reg[, `:=`(prop_pos_PNIX, rowSums(.SD, 
            na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "NA_public_nb"], 
        nb_tests_reg[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_reg) %like% "privé_nb_NA"], nb_tests_reg[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_privé_nb"], nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "MEDECIN_NA_nb"], 
        nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], nb_tests_reg[, 
            `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "INFIRMIER_NA_nb"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
            !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "DOCTEUR_NA_nb"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_reg[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, ProfPrelevTA, departement, 
                cat_pp, valeur)], date + departement ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_dep[is.na(nb_tests_dep)] = 0, nb_tests_dep[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_privé_nb"], nb_tests_dep[, `:=`(nb_pos, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P"], nb_tests_dep[, 
            `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MEDECIN_NA_nb"], nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "DOCTEUR_NA_nb"], nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb"], 
        nb_tests_dep[, `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_dep[, 
            `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, nb_pos, 
            prop_pos_PNIX, nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi_TAG.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addWorksheet(wb, "regions"), writeData(wb, 
            "regions", nb_tests_reg), setColWidths(wb, "regions", 
            cols = 1:ncol(nb_tests_reg), widths = 12), addWorksheet(wb, 
            "departements"), writeData(wb, "departements", nb_tests_dep), 
        setColWidths(wb, "departements", cols = 1:ncol(nb_tests_dep), 
            widths = 12), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr_sal_mil"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-01"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr_sal_mil"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-01"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "antigen-complet") {
            sidep <- sidep_antigen_complet
        } else if (type_test == "pcr_complet") {
            sidep <- sidep_pcr_complet
        } else if (type_test == "pcr_respi") {
            sidep <- sidep_pcr_respi
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        } else if (type_test == "pcr_sal") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94845-5"]
        } else if (type_test == "pcr_mil") {
            sidep <- sidep_pcr_sal_mil[AnalyseConclusion == "94309-2"]
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], table(sidep[date == 
            "2020-10-20"]$ProfPrelevTA), sum(is.na(sidep[date == 
            "2020-10-20"]$ProfPrelevTA)), table(sidep[date == 
            "2020-10-20"]$cat_pp), sum(is.na(sidep[date == "2020-10-20"]$cat_pp)), 
        nb_tests = dcast(sidep[, .(nb_res = (.N)), by = .(date, 
            cat_pp, valeur)], date ~ cat_pp + paste0("nb_", valeur), 
            value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "nb"], 
        nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            ".xlsx"), overwrite = T)), list(print, "02a 65+"), 
    list(print, list(gc, T)), list(library, ISOweek), list(library, 
        lubridate), list(library, data.table), list(library, 
        plotly), list(library, scales), list(library, bit64), 
    list(library, openxlsx), list(options, 5000), list(<-, nb_tests_65, 
        list(function, list(as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = ))), 
            list(list(=, date_AAAAMMJJ, list(format, jour, "%Y%m%d")), 
                list(if, list(==, type_test, "pcr"), list(list(
                  <-, sidep, sidep_pcr)), list(if, list(==, type_test, 
                  "sero"), list(list(<-, sidep, sidep_sero)), 
                  list(if, list(==, type_test, "antigenique"), 
                    list(list(<-, sidep, sidep_antigenique)), 
                    list(if, list(==, type_test, "pcr_sal_mil"), 
                      list(list(<-, sidep, sidep_pcr_sal_mil)))))), 
                list(if, list(==, type_date, "prelev"), list(
                  list(<-, sidep, list([, sidep, sidep[, `:=`(date, 
                    as.Date(get(paste0("day_", type_date))))], 
                    list(:=, date, list(as.Date, list(get, list(
                      paste0, "day_", type_date))))))), list(
                  if, list(==, type_date, "valid"), list(list(
                    <-, sidep, list([, sidep, sidep[, `:=`(date, 
                      as.Date(get(paste0("date_", type_date, 
                        "_init"))))], list(:=, date, list(as.Date, 
                      list(get, list(paste0, "date_", type_date, 
                        "_init"))))))))), list(<-, sidep, list(
                  [, sidep, list(!, list(is.na, date)), sidep[!is.na(date), 
                    ])), list(<-, sidep, list([, sidep, list(
                  &, list(>=, date, list(as.Date, day_init)), 
                  list(<, date, jour)), sidep[date >= as.Date(day_init) & 
                  date < jour, ])), list(=, sidep, list([, sidep, 
                  list(>=, list(as.numeric, Age), 65))), list(
                  table, list($, list([, sidep, list(==, date, 
                    "2020-10-20")), ProfPrelevTA)), list(sum, 
                  list(is.na, list($, list([, sidep, list(==, 
                    date, "2020-10-20")), ProfPrelevTA))), list(
                  table, list($, list([, sidep, list(==, date, 
                    "2020-10-20")), cat_pp)), list(sum, list(
                  is.na, list($, list([, sidep, list(==, date, 
                    "2020-10-20")), cat_pp))), list(=, nb_tests, 
                  list(dcast, list([, sidep, sidep[, .(nb_res = (.N)), 
                    by = .(date, cat_pp, valeur)], list(., list(
                    (, .N)), list(., date, cat_pp, valeur)), 
                    list(~, date, list(+, cat_pp, list(paste0, 
                      "nb_", valeur))), "nb_res")), list(=, nb_tests, 
                  list([, nb_tests, list(order, date))), list(
                  =, list([, nb_tests, list(is.na, nb_tests)), 
                  0), list([, nb_tests, nb_tests[, `:=`(nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests), "nb")), 
                list([, nb_tests, nb_tests[, `:=`(nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests), 
                  "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                  list(names, nb_tests), "nb_NA")))), list([, 
                  nb_tests, nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), 
                    .SDcols = names(nb_tests) %like% "nb_P"], 
                  list(:=, prop_pos_PNIX, list(/, list(rowSums, 
                    .SD), nb_tot_PNIX)), list(%like%, list(names, 
                    nb_tests), "nb_P")), list([, nb_tests, nb_tests[, 
                  `:=`(public_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests), 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "public_nb_NA")))), list([, nb_tests, nb_tests[, 
                  `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "public_nb"], list(:=, public_nb_tot, list(
                  rowSums, .SD)), list(%like%, list(names, nb_tests), 
                  "public_nb")), list([, nb_tests, nb_tests[, 
                  `:=`(privé_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                    !names(nb_tests) %like% "privé_nb_NA"], list(
                  :=, privé_nb_tot_PNIX, list(rowSums, .SD)), 
                  list(&, list(%like%, list(names, nb_tests), 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "privé_nb_NA")))), list([, nb_tests, nb_tests[, 
                  `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "privé_nb"], list(:=, privé_nb_tot, list(
                  rowSums, .SD)), list(%like%, list(names, nb_tests), 
                  "privé_nb")), list([, nb_tests, nb_tests[, 
                  `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests) %like% 
                    "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests), "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests), 
                    "NA_nb_NA")))), list([, nb_tests, nb_tests[, 
                  `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD)), list(%like%, list(names, nb_tests), 
                  "NA_nb")), list([, nb_tests, nb_tests[, `:=`(nb_pos, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests), "nb_P")), 
                list([, nb_tests, nb_tests[, `:=`(NA_nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD)), list(%like%, list(names, nb_tests), 
                  "NA_nb")), list(<-, nb_tests, list([, nb_tests, 
                  nb_tests[, .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
                    NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                    nb_tot)], list(., date, public_nb_tot_PNIX, 
                    privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                    nb_pos, prop_pos_PNIX, nb_tot))), list(<-, 
                  nb_tests_svg, nb_tests), list(<-, nb_tests, 
                  nb_tests_svg), list(=, nb_tests_reg, list(dcast, 
                  list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                    reg, cat_pp, valeur)], list(., list((, .N)), 
                    list(., date, reg, cat_pp, valeur)), list(
                    ~, list(+, date, reg), list(+, cat_pp, list(
                      paste0, "nb_", valeur))), "nb_res")), list(
                  =, reg2019, list(list(::, data.table, fread), 
                    list(paste0, "data/utils/region2019_v2.csv"), 
                    "Latin-1")), list(=, list($, reg2019, reg), 
                  list(as.character, list($, reg2019, reg))), 
                list([, reg2019, list(==, list(nchar, reg), 1), 
                  list(:=, reg, list(paste0, "0", reg))), list(
                  =, nb_tests_reg, list(merge, nb_tests_reg, 
                    list([, reg2019, reg2019[, .(reg, libelle)], 
                      list(., reg, libelle)), "reg", T)), list(
                  setnames, nb_tests_reg, "libelle", "nom_reg"), 
                list(=, nb_tests_reg, list([, nb_tests_reg, list(
                  order, nom_reg))), list([, nb_tests_reg, list(
                  is.na, nom_reg), list(:=, nom_reg, "Région inconnue")), 
                list(=, list([, nb_tests_reg, list(is.na, nb_tests_reg)), 
                  0), list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_reg), "nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_reg), 
                  "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                  list(names, nb_tests_reg), "nb_NA")))), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(prop_pos_PNIX, 
                    rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                    "nb_P"], list(:=, prop_pos_PNIX, list(/, 
                    list(rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                    list(names, nb_tests_reg), "nb_P")), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests_reg) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_reg), 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "public_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(public_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_reg) %like% "public_nb"], 
                  list(:=, public_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_reg), "public_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                  !names(nb_tests_reg) %like% "privé_nb_NA"], 
                  list(:=, privé_nb_tot_PNIX, list(rowSums, .SD)), 
                  list(&, list(%like%, list(names, nb_tests_reg), 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "privé_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(privé_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_reg) %like% "privé_nb"], 
                  list(:=, privé_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_reg), "privé_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
                  "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests_reg), "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_reg), 
                    "NA_nb_NA")))), list([, nb_tests_reg, nb_tests_reg[, 
                  `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                    "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD)), list(%like%, list(names, nb_tests_reg), 
                  "NA_nb")), list([, nb_tests_reg, nb_tests_reg[, 
                  `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                    "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_reg), "nb_P")), 
                list(<-, nb_tests_reg, list([, nb_tests_reg, 
                  nb_tests_reg[, .(date, nom_reg, public_nb_tot_PNIX, 
                    privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                    nb_pos, prop_pos_PNIX, nb_tot)], list(., 
                    date, nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
                    NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                    nb_tot))), list(=, nb_tests_dep, list(dcast, 
                  list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                    departement, cat_pp, valeur)], list(., list(
                    (, .N)), list(., date, departement, cat_pp, 
                    valeur)), list(~, list(+, date, departement), 
                    list(+, cat_pp, list(paste0, "nb_", valeur))), 
                  "nb_res")), list(=, list([, nb_tests_dep, list(
                  is.na, nb_tests_dep)), 0), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "nb"], 
                  list(:=, nb_tot, list(rowSums, .SD)), list(
                    %like%, list(names, nb_tests_dep), "nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_dep) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                  list(names, nb_tests_dep), "nb_NA")))), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(prop_pos_PNIX, 
                    rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                    "nb_P"], list(:=, prop_pos_PNIX, list(/, 
                    list(rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                    list(names, nb_tests_dep), "nb_P")), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests_dep) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "public_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(public_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "public_nb"], 
                  list(:=, public_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "public_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                  !names(nb_tests_dep) %like% "privé_nb_NA"], 
                  list(:=, privé_nb_tot_PNIX, list(rowSums, .SD)), 
                  list(&, list(%like%, list(names, nb_tests_dep), 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "privé_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(privé_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "privé_nb"], 
                  list(:=, privé_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "privé_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
                  "NA_nb_NA"], list(:=, NA_nb_tot_PNIX, list(
                  rowSums, .SD)), list(&, list(%like%, list(names, 
                  nb_tests_dep), "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X"), 
                  list(!, list(%like%, list(names, nb_tests_dep), 
                    "NA_nb_NA")))), list([, nb_tests_dep, nb_tests_dep[, 
                  `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD)), list(%like%, list(names, nb_tests_dep), 
                  "NA_nb")), list([, nb_tests_dep, nb_tests_dep[, 
                  `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "nb_P")), 
                list(<-, nb_tests_dep, list([, nb_tests_dep, 
                  nb_tests_dep[, .(date, departement, public_nb_tot_PNIX, 
                    privé_nb_tot_PNIX, NA_nb_tot_PNIX, nb_tot_PNIX, 
                    nb_pos, prop_pos_PNIX, nb_tot)], list(., 
                    date, departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
                    NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                    nb_tot))), list(<-, wb, list(loadWorkbook, 
                  "data/sorties/nb_tests/lisez_moi.xlsx")), list(
                  addWorksheet, wb, "national"), list(writeData, 
                  wb, "national", nb_tests), list(setColWidths, 
                  wb, "national", list(:, 1, list(ncol, nb_tests)), 
                  12), list(addStyle, wb, "national", list(createStyle, 
                  "# ##0"), list(c, 2, 3, 4, 5, 6, 8), list(+, 
                  list(:, 1, list(nrow, nb_tests)), 1), T, T), 
                list(addStyle, wb, "national", list(createStyle, 
                  "0.0 %"), list(c, 7), list(+, list(:, 1, list(
                  nrow, nb_tests)), 1), T, T), list(addWorksheet, 
                  wb, "regions"), list(writeData, wb, "regions", 
                  nb_tests_reg), list(setColWidths, wb, "regions", 
                  list(:, 1, list(ncol, nb_tests_reg)), 12), 
                list(addStyle, wb, "regions", list(createStyle, 
                  "# ##0"), list(c, 3, 4, 5, 6, 7, 9), list(+, 
                  list(:, 1, list(nrow, nb_tests_reg)), 1), T, 
                  T), list(addStyle, wb, "regions", list(createStyle, 
                  "0.0 %"), list(c, 8), list(+, list(:, 1, list(
                  nrow, nb_tests_reg)), 1), T, T), list(addWorksheet, 
                  wb, "departements"), list(writeData, wb, "departements", 
                  nb_tests_dep), list(setColWidths, wb, "departements", 
                  list(:, 1, list(ncol, nb_tests_dep)), 12), 
                list(addStyle, wb, "departements", list(createStyle, 
                  "# ##0"), list(c, 3, 4, 5, 6, 7, 9), list(+, 
                  list(:, 1, list(nrow, nb_tests_dep)), 1), T, 
                  T), list(addStyle, wb, "departements", list(
                  createStyle, "0.0 %"), list(c, 8), list(+, 
                  list(:, 1, list(nrow, nb_tests_dep)), 1), T, 
                  T), list(saveWorkbook, wb, list(paste0, "data/sorties/nb_tests/", 
                  date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
                  "_65+.xlsx"), T)), list(2137L, 16L, 2293L, 
                1L, 16L, 1L, 2137L, 2293L))), list(<-, nb_tests_AG_65, 
        list(function, list(as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = )), 
            as.pairlist(alist(type_test = , type_date = , day_init = , jour = ))), 
            list(list(=, date_AAAAMMJJ, list(format, jour, "%Y%m%d")), 
                list(<-, sidep, list(list(::, data.table, copy), 
                  sidep_antigenique)), list(=, sidep, list([, 
                  sidep, list(>=, list(as.numeric, Age), 65))), 
                list(if, list(==, type_date, "prelev"), list(
                  list(<-, sidep, list([, sidep, sidep[, `:=`(date, 
                    as.Date(get(paste0("day_", type_date))))], 
                    list(:=, date, list(as.Date, list(get, list(
                      paste0, "day_", type_date))))))), list(
                  if, list(==, type_date, "valid"), list(list(
                    <-, sidep, list([, sidep, sidep[, `:=`(date, 
                      as.Date(get(paste0("date_", type_date, 
                        "_init"))))], list(:=, date, list(as.Date, 
                      list(get, list(paste0, "date_", type_date, 
                        "_init"))))))))), list(<-, sidep, list(
                  [, sidep, list(!, list(is.na, date)), sidep[!is.na(date), 
                    ])), list(<-, sidep, list([, sidep, list(
                  &, list(>=, date, list(as.Date, day_init)), 
                  list(<, date, jour)), sidep[date >= as.Date(day_init) & 
                  date < jour, ])), list(print, list([, sidep, 
                  sidep[, unique(ProfPrelevTA)], list(unique, 
                    ProfPrelevTA))), list(=, nb_tests, list(dcast, 
                  list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                    cat_pp, ProfPrelevTA, valeur)], list(., list(
                    (, .N)), list(., date, cat_pp, ProfPrelevTA, 
                    valeur)), list(~, date, list(+, list(+, ProfPrelevTA, 
                    cat_pp), list(paste0, "nb_", valeur))), "nb_res")), 
                list(=, nb_tests, list([, nb_tests, list(order, 
                  date))), list(=, list([, nb_tests, list(is.na, 
                  nb_tests)), 0), list([, nb_tests, nb_tests[, 
                  `:=`(nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "nb"], list(:=, nb_tot, list(rowSums, .SD, 
                  TRUE)), list(%like%, list(names, nb_tests), 
                  "nb")), list([, nb_tests, nb_tests[, `:=`(nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD, TRUE)), list(&, list(%like%, list(names, 
                  nb_tests), "nb_P|nb_N|nb_I|nb_X"), list(!, 
                  list(%like%, list(names, nb_tests), "nb_NA")))), 
                list([, nb_tests, nb_tests[, `:=`(prop_pos_PNIX, 
                  rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                  "nb_P"], list(:=, prop_pos_PNIX, list(/, list(
                  rowSums, .SD, TRUE), nb_tot_PNIX)), list(%like%, 
                  list(names, nb_tests), "nb_P")), list([, nb_tests, 
                  nb_tests[, `:=`(public_nb_tot_PNIX, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests), "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "public_nb_NA")))), list([, nb_tests, nb_tests[, 
                  `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
                  .SDcols = names(nb_tests) %like% "NA_public_nb"], 
                  list(:=, public_nb_tot, list(rowSums, .SD, 
                    TRUE)), list(%like%, list(names, nb_tests), 
                    "NA_public_nb")), list([, nb_tests, nb_tests[, 
                  `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
                  .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                    !names(nb_tests) %like% "privé_nb_NA"], list(
                  :=, privé_nb_tot_PNIX, list(rowSums, .SD, TRUE)), 
                  list(&, list(%like%, list(names, nb_tests), 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "privé_nb_NA")))), list([, nb_tests, nb_tests[, 
                  `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), 
                  .SDcols = names(nb_tests) %like% "NA_privé_nb"], 
                  list(:=, privé_nb_tot, list(rowSums, .SD, TRUE)), 
                  list(%like%, list(names, nb_tests), "NA_privé_nb")), 
                list([, nb_tests, nb_tests[, `:=`(nb_pos, rowSums(.SD, 
                  na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD, 
                  TRUE)), list(%like%, list(names, nb_tests), 
                  "nb_P")), list([, nb_tests, nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                  !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], 
                  list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests), "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "MEDECIN_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(MEDECIN_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "MEDECIN_NA_nb"], list(:=, MEDECIN_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "MEDECIN_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                    !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
                  list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests), "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "INFIRMIER_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "INFIRMIER_NA_nb"], list(:=, INFIRMIER_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "INFIRMIER_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                    !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], 
                  list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests), "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "PHARMACIEN_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "PHARMACIEN_NA_nb"], list(:=, PHARMACIEN_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "PHARMACIEN_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                    !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
                  list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests), "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "DOCTEUR_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "DOCTEUR_NA_nb"], list(:=, DOCTEUR_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "DOCTEUR_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                    !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
                  list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests), 
                    "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "BIOLOGISTE_NA_nb"], list(:=, BIOLOGISTE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "BIOLOGISTE_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                    !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                  list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    list(rowSums, .SD)), list(&, list(%like%, 
                    list(names, nb_tests), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                  [, nb_tests, nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "MASSEURKINESITHERAPE_NA_nb")), 
                list([, nb_tests, nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                  "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                  !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], 
                  list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests), 
                    "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "SAGEFEMME_NA_nb_NA")))), list([, nb_tests, 
                  nb_tests[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "SAGEFEMME_NA_nb"], list(:=, SAGEFEMME_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "SAGEFEMME_NA_nb")), list(
                  [, nb_tests, nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                    "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                    !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                  list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                    rowSums, .SD)), list(&, list(%like%, list(
                    names, nb_tests), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests), 
                      "CHIRURGIENDENTISTE_NA_nb_NA")))), list(
                  [, nb_tests, nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                    "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests), "CHIRURGIENDENTISTE_NA_nb")), 
                list([, nb_tests, nb_tests[, `:=`(NA_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                  list(:=, NA_nb_tot_PNIX, list(rowSums, .SD, 
                    TRUE)), list(%like%, list(names, nb_tests), 
                    "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
                list([, nb_tests, nb_tests[, `:=`(NA_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                  "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD, TRUE)), list(%like%, list(names, nb_tests), 
                  "NA_NA_nb")), list([, nb_tests, nb_tests[, 
                  `:=`(verif, CHIRURGIENDENTISTE_nb_tot_PNIX + 
                    SAGEFEMME_nb_tot_PNIX + MASSEURKINESITHERAPE_nb_tot_PNIX + 
                    BIOLOGISTE_nb_tot_PNIX + DOCTEUR_nb_tot_PNIX + 
                    PHARMACIEN_nb_tot_PNIX + INFIRMIER_nb_tot_PNIX + 
                    MEDECIN_nb_tot_PNIX + NA_nb_tot_PNIX + privé_nb_tot_PNIX + 
                    public_nb_tot_PNIX - nb_tot_PNIX)], list(
                  :=, verif, list(-, list(+, list(+, list(+, 
                    list(+, list(+, list(+, list(+, list(+, list(
                      +, list(+, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                        SAGEFEMME_nb_tot_PNIX), MASSEURKINESITHERAPE_nb_tot_PNIX), 
                      BIOLOGISTE_nb_tot_PNIX), DOCTEUR_nb_tot_PNIX), 
                      PHARMACIEN_nb_tot_PNIX), INFIRMIER_nb_tot_PNIX), 
                      MEDECIN_nb_tot_PNIX), NA_nb_tot_PNIX), 
                    privé_nb_tot_PNIX), public_nb_tot_PNIX), 
                    nb_tot_PNIX))), list(if, list(>, list(sum, 
                  list($, nb_tests, verif), T), 0), list(print, 
                  "Il y a un probleme de sommation entre les catégories PNIX.")), 
                list([, nb_tests, nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + 
                  SAGEFEMME_nb_tot + MASSEURKINESITHERAPE_nb_tot + 
                  BIOLOGISTE_nb_tot + DOCTEUR_nb_tot + PHARMACIEN_nb_tot + 
                  INFIRMIER_nb_tot + MEDECIN_nb_tot + NA_nb_tot + 
                  privé_nb_tot + public_nb_tot - nb_tot)], list(
                  :=, verif, list(-, list(+, list(+, list(+, 
                    list(+, list(+, list(+, list(+, list(+, list(
                      +, list(+, CHIRURGIENDENTISTE_nb_tot, SAGEFEMME_nb_tot), 
                      MASSEURKINESITHERAPE_nb_tot), BIOLOGISTE_nb_tot), 
                      DOCTEUR_nb_tot), PHARMACIEN_nb_tot), INFIRMIER_nb_tot), 
                      MEDECIN_nb_tot), NA_nb_tot), privé_nb_tot), 
                    public_nb_tot), nb_tot))), list(if, list(
                  >, list(sum, list($, nb_tests, verif), T), 
                  0), list(print, "Il y a un probleme de sommation entre les catégories toute norme confondue.")), 
                list(<-, nb_tests, list([, nb_tests, nb_tests[, 
                  .(date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                    INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                    BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                    SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                    NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                    nb_tot)], list(., date, MEDECIN_nb_tot_PNIX, 
                  PHARMACIEN_nb_tot_PNIX, INFIRMIER_nb_tot_PNIX, 
                  DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                  CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                  MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                  privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, 
                  nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot))), 
                list(=, nb_tests_top_prelev_ta, list(dcast, list(
                  [, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                    TopPrelevTA, valeur)], list(., list((, .N)), 
                  list(., date, TopPrelevTA, valeur)), list(~, 
                  date, list(+, TopPrelevTA, list(paste0, "nb_", 
                    valeur))), "nb_res")), list(=, nb_tests_top_prelev_ta, 
                  list([, nb_tests_top_prelev_ta, list(order, 
                    date))), list([, nb_tests_top_prelev_ta, 
                  nb_tests_top_prelev_ta[, `:=`(top_prelev_ta_PNIX, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_top_prelev_ta) %like% 
                    "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], list(:=, 
                    top_prelev_ta_PNIX, list(rowSums, .SD, TRUE)), 
                  list(%like%, list(names, nb_tests_top_prelev_ta), 
                    "1_nb_I|1_nb_N|1_nb_P|1_nb_X")), list([, 
                  nb_tests_top_prelev_ta, nb_tests_top_prelev_ta[, 
                    `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
                    .SDcols = names(nb_tests_top_prelev_ta) %like% 
                      "1_nb"], list(:=, top_prelev_ta, list(rowSums, 
                    .SD, TRUE)), list(%like%, list(names, nb_tests_top_prelev_ta), 
                    "1_nb")), list(<-, nb_tests_top_prelev_ta, 
                  list([, nb_tests_top_prelev_ta, nb_tests_top_prelev_ta[, 
                    .(date, top_prelev_ta_PNIX, top_prelev_ta)], 
                    list(., date, top_prelev_ta_PNIX, top_prelev_ta))), 
                list(<-, nb_tests, list(merge, nb_tests, nb_tests_top_prelev_ta, 
                  "date", TRUE)), list([, nb_tests, nb_tests[, 
                  `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
                    PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
                    DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - 
                    CHIRURGIENDENTISTE_nb_tot_PNIX - SAGEFEMME_nb_tot_PNIX - 
                    MASSEURKINESITHERAPE_nb_tot_PNIX)], list(
                  :=, verif, list(-, list(-, list(-, list(-, 
                    list(-, list(-, list(-, list(-, top_prelev_ta_PNIX, 
                      MEDECIN_nb_tot_PNIX), PHARMACIEN_nb_tot_PNIX), 
                      INFIRMIER_nb_tot_PNIX), DOCTEUR_nb_tot_PNIX), 
                    BIOLOGISTE_nb_tot_PNIX), CHIRURGIENDENTISTE_nb_tot_PNIX), 
                    SAGEFEMME_nb_tot_PNIX), MASSEURKINESITHERAPE_nb_tot_PNIX))), 
                list(if, list(>, list(sum, list($, nb_tests, 
                  verif), T), 0), list(print, "Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession.")), 
                list(<-, nb_tests_svg, nb_tests), list(<-, nb_tests, 
                  nb_tests_svg), list(=, nb_tests_reg, list(dcast, 
                  list([, sidep, sidep[, .(nb_res = (.N)), by = .(date, 
                    reg, ProfPrelevTA, cat_pp, valeur)], list(
                    ., list((, .N)), list(., date, reg, ProfPrelevTA, 
                    cat_pp, valeur)), list(~, list(+, date, reg), 
                    list(+, list(+, ProfPrelevTA, cat_pp), list(
                      paste0, "nb_", valeur))), "nb_res")), list(
                  =, reg2019, list(list(::, data.table, fread), 
                    list(paste0, "data/utils/region2019_v2.csv"), 
                    "Latin-1")), list(=, list($, reg2019, reg), 
                  list(as.character, list($, reg2019, reg))), 
                list([, reg2019, list(==, list(nchar, reg), 1), 
                  list(:=, reg, list(paste0, "0", reg))), list(
                  =, nb_tests_reg, list(merge, nb_tests_reg, 
                    list([, reg2019, reg2019[, .(reg, libelle)], 
                      list(., reg, libelle)), "reg", T)), list(
                  list(::, data.table, setnames), nb_tests_reg, 
                  "libelle", "nom_reg"), list(=, nb_tests_reg, 
                  list([, nb_tests_reg, list(order, nom_reg))), 
                list([, nb_tests_reg, list(is.na, nom_reg), list(
                  :=, nom_reg, "Région inconnue")), list(=, list(
                  [, nb_tests_reg, list(is.na, nb_tests_reg)), 
                  0), list([, nb_tests_reg, nb_tests_reg[, `:=`(nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "nb"], list(:=, nb_tot, list(rowSums, .SD, 
                  TRUE)), list(%like%, list(names, nb_tests_reg), 
                  "nb")), list([, nb_tests_reg, nb_tests_reg[, 
                  `:=`(nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
                  .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                    !names(nb_tests_reg) %like% "nb_NA"], list(
                  :=, nb_tot_PNIX, list(rowSums, .SD, TRUE)), 
                  list(&, list(%like%, list(names, nb_tests_reg), 
                    "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                    list(names, nb_tests_reg), "nb_NA")))), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(prop_pos_PNIX, 
                    rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), 
                    .SDcols = names(nb_tests_reg) %like% "nb_P"], 
                  list(:=, prop_pos_PNIX, list(/, list(rowSums, 
                    .SD, TRUE), nb_tot_PNIX)), list(%like%, list(
                    names, nb_tests_reg), "nb_P")), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(public_nb_tot_PNIX, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests_reg) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "public_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(public_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "NA_public_nb"], list(:=, public_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "NA_public_nb")), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                    !names(nb_tests_reg) %like% "privé_nb_NA"], 
                  list(:=, privé_nb_tot_PNIX, list(rowSums, .SD, 
                    TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "privé_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(privé_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "NA_privé_nb"], list(:=, privé_nb_tot, list(
                    rowSums, .SD, TRUE)), list(%like%, list(names, 
                    nb_tests_reg), "NA_privé_nb")), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, na.rm = TRUE)), 
                    .SDcols = names(nb_tests_reg) %like% "nb_P"], 
                  list(:=, nb_pos, list(rowSums, .SD, TRUE)), 
                  list(%like%, list(names, nb_tests_reg), "nb_P")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
                  list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "MEDECIN_NA_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "MEDECIN_NA_nb"], list(:=, MEDECIN_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "MEDECIN_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], 
                  list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "INFIRMIER_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "INFIRMIER_NA_nb"], list(:=, INFIRMIER_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "INFIRMIER_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
                  list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "PHARMACIEN_NA_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "PHARMACIEN_NA_nb"], list(:=, PHARMACIEN_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "PHARMACIEN_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
                  list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "DOCTEUR_NA_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "DOCTEUR_NA_nb"], list(:=, DOCTEUR_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "DOCTEUR_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
                  list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "BIOLOGISTE_NA_nb"], list(:=, BIOLOGISTE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "BIOLOGISTE_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                  list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    list(rowSums, .SD, TRUE)), list(&, list(%like%, 
                    list(names, nb_tests_reg), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "MASSEURKINESITHERAPE_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
                  list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                    .SD, TRUE)), list(&, list(%like%, list(names, 
                    nb_tests_reg), "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "SAGEFEMME_NA_nb_NA")))), list([, nb_tests_reg, 
                  nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, 
                    na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "SAGEFEMME_NA_nb"], list(:=, SAGEFEMME_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "SAGEFEMME_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                  !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                  list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                    rowSums, .SD, TRUE)), list(&, list(%like%, 
                    list(names, nb_tests_reg), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_reg), 
                      "CHIRURGIENDENTISTE_NA_nb_NA")))), list(
                  [, nb_tests_reg, nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                    rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                    "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                    list(rowSums, .SD, TRUE)), list(%like%, list(
                    names, nb_tests_reg), "CHIRURGIENDENTISTE_NA_nb")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                  list(:=, NA_nb_tot_PNIX, list(rowSums, .SD, 
                    TRUE)), list(%like%, list(names, nb_tests_reg), 
                    "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
                list([, nb_tests_reg, nb_tests_reg[, `:=`(NA_nb_tot, 
                  rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                  "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD, TRUE)), list(%like%, list(names, nb_tests_reg), 
                  "NA_NA_nb")), list(<-, nb_tests_reg, list([, 
                  nb_tests_reg, nb_tests_reg[, .(date, nom_reg, 
                    MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                    INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                    BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                    SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                    NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
                    nb_tot)], list(., date, nom_reg, MEDECIN_nb_tot_PNIX, 
                    PHARMACIEN_nb_tot_PNIX, INFIRMIER_nb_tot_PNIX, 
                    DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                    CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                    MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                    privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, 
                    nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot))), 
                list(=, nb_tests_dep, list(dcast, list([, sidep, 
                  sidep[, .(nb_res = (.N)), by = .(date, ProfPrelevTA, 
                    departement, cat_pp, valeur)], list(., list(
                    (, .N)), list(., date, ProfPrelevTA, departement, 
                    cat_pp, valeur)), list(~, list(+, date, departement), 
                  list(+, list(+, ProfPrelevTA, cat_pp), list(
                    paste0, "nb_", valeur))), "nb_res")), list(
                  =, list([, nb_tests_dep, list(is.na, nb_tests_dep)), 
                  0), list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb"], list(:=, nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_dep) %like% 
                  "nb_NA"], list(:=, nb_tot_PNIX, list(rowSums, 
                  .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                  "nb_P|nb_N|nb_I|nb_X"), list(!, list(%like%, 
                  list(names, nb_tests_dep), "nb_NA")))), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(prop_pos_PNIX, 
                    rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                    "nb_P"], list(:=, prop_pos_PNIX, list(/, 
                    list(rowSums, .SD), nb_tot_PNIX)), list(%like%, 
                    list(names, nb_tests_dep), "nb_P")), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
                    rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                    !names(nb_tests_dep) %like% "public_nb_NA"], 
                  list(:=, public_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "public_nb_P|public_nb_N|public_nb_I|public_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "public_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(public_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "NA_public_nb"], 
                  list(:=, public_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "NA_public_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                  !names(nb_tests_dep) %like% "privé_nb_NA"], 
                  list(:=, privé_nb_tot_PNIX, list(rowSums, .SD)), 
                  list(&, list(%like%, list(names, nb_tests_dep), 
                    "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "privé_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(privé_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "NA_privé_nb"], 
                  list(:=, privé_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "NA_privé_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(nb_pos, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "nb_P"], list(:=, nb_pos, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "nb_P")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(MEDECIN_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
                  list(:=, MEDECIN_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "MEDECIN_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "MEDECIN_NA_nb"], 
                  list(:=, MEDECIN_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "MEDECIN_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
                  list(:=, INFIRMIER_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "INFIRMIER_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
                  list(:=, INFIRMIER_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "INFIRMIER_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
                  list(:=, PHARMACIEN_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "PHARMACIEN_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
                  list(:=, PHARMACIEN_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "PHARMACIEN_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
                  list(:=, DOCTEUR_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "DOCTEUR_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb"], 
                  list(:=, DOCTEUR_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "DOCTEUR_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
                  list(:=, BIOLOGISTE_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "BIOLOGISTE_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
                  list(:=, BIOLOGISTE_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "BIOLOGISTE_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
                  list(:=, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    list(rowSums, .SD)), list(&, list(%like%, 
                    list(names, nb_tests_dep), "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "MASSEURKINESITHERAPE_NA_nb_NA")))), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, 
                    rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "MASSEURKINESITHERAPE_NA_nb"], list(:=, MASSEURKINESITHERAPE_nb_tot, 
                    list(rowSums, .SD)), list(%like%, list(names, 
                    nb_tests_dep), "MASSEURKINESITHERAPE_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
                  list(:=, SAGEFEMME_nb_tot_PNIX, list(rowSums, 
                    .SD)), list(&, list(%like%, list(names, nb_tests_dep), 
                    "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "SAGEFEMME_NA_nb_NA")))), list([, nb_tests_dep, 
                  nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
                    .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
                  list(:=, SAGEFEMME_nb_tot, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "SAGEFEMME_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                  !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
                  list(:=, CHIRURGIENDENTISTE_nb_tot_PNIX, list(
                    rowSums, .SD)), list(&, list(%like%, list(
                    names, nb_tests_dep), "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X"), 
                    list(!, list(%like%, list(names, nb_tests_dep), 
                      "CHIRURGIENDENTISTE_NA_nb_NA")))), list(
                  [, nb_tests_dep, nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, 
                    rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                    "CHIRURGIENDENTISTE_NA_nb"], list(:=, CHIRURGIENDENTISTE_nb_tot, 
                    list(rowSums, .SD)), list(%like%, list(names, 
                    nb_tests_dep), "CHIRURGIENDENTISTE_NA_nb")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], 
                  list(:=, NA_nb_tot_PNIX, list(rowSums, .SD)), 
                  list(%like%, list(names, nb_tests_dep), "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X")), 
                list([, nb_tests_dep, nb_tests_dep[, `:=`(NA_nb_tot, 
                  rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                  "NA_NA_nb"], list(:=, NA_nb_tot, list(rowSums, 
                  .SD)), list(%like%, list(names, nb_tests_dep), 
                  "NA_NA_nb")), list(<-, nb_tests_dep, list([, 
                  nb_tests_dep, nb_tests_dep[, .(date, departement, 
                    MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
                    INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, 
                    BIOLOGISTE_nb_tot_PNIX, CHIRURGIENDENTISTE_nb_tot_PNIX, 
                    SAGEFEMME_nb_tot_PNIX, MASSEURKINESITHERAPE_nb_tot_PNIX, 
                    public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot, 
                    nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
                  list(., date, departement, MEDECIN_nb_tot_PNIX, 
                    PHARMACIEN_nb_tot_PNIX, INFIRMIER_nb_tot_PNIX, 
                    DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
                    CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
                    MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
                    privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, 
                    nb_pos, prop_pos_PNIX, nb_tot))), list(<-, 
                  wb, list(loadWorkbook, "data/sorties/nb_tests/lisez_moi_TAG.xlsx")), 
                list(addWorksheet, wb, "national"), list(writeData, 
                  wb, "national", nb_tests), list(setColWidths, 
                  wb, "national", list(:, 1, list(ncol, nb_tests)), 
                  12), list(addWorksheet, wb, "regions"), list(
                  writeData, wb, "regions", nb_tests_reg), list(
                  setColWidths, wb, "regions", list(:, 1, list(
                    ncol, nb_tests_reg)), 12), list(addWorksheet, 
                  wb, "departements"), list(writeData, wb, "departements", 
                  nb_tests_dep), list(setColWidths, wb, "departements", 
                  list(:, 1, list(ncol, nb_tests_dep)), 12), 
                list(saveWorkbook, wb, list(paste0, "data/sorties/nb_tests/", 
                  date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
                  "_65+.xlsx"), T)), list(2294L, 19L, 2601L, 
                1L, 19L, 1L, 2294L, 2601L))), list(print, list(
        gc, T)), list(structure(expression(type_test = "pcr"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-20"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-05-24"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "sero"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-06-10"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "sero"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-06-12"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "antigenique"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-16"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), sidep <- data.table::copy(sidep_antigenique), 
        sidep = sidep[as.numeric(Age) >= 65], if (type_date == 
            "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], print(sidep[, 
            unique(ProfPrelevTA)]), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, ProfPrelevTA, 
                valeur)], date ~ ProfPrelevTA + cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "NA_public_nb"], 
        nb_tests[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_privé_nb"], nb_tests[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], nb_tests[, 
            `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "MEDECIN_NA_nb"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb"], 
        nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], nb_tests[, 
            `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "PHARMACIEN_NA_nb"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], nb_tests[, 
            `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb"], nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot_PNIX + 
            SAGEFEMME_nb_tot_PNIX + MASSEURKINESITHERAPE_nb_tot_PNIX + 
            BIOLOGISTE_nb_tot_PNIX + DOCTEUR_nb_tot_PNIX + PHARMACIEN_nb_tot_PNIX + 
            INFIRMIER_nb_tot_PNIX + MEDECIN_nb_tot_PNIX + NA_nb_tot_PNIX + 
            privé_nb_tot_PNIX + public_nb_tot_PNIX - nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories PNIX."), 
        nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + SAGEFEMME_nb_tot + 
            MASSEURKINESITHERAPE_nb_tot + BIOLOGISTE_nb_tot + 
            DOCTEUR_nb_tot + PHARMACIEN_nb_tot + INFIRMIER_nb_tot + 
            MEDECIN_nb_tot + NA_nb_tot + privé_nb_tot + public_nb_tot - 
            nb_tot)], if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories toute norme confondue."), 
        nb_tests <- nb_tests[, .(date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_top_prelev_ta = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, TopPrelevTA, valeur)], 
            date ~ TopPrelevTA + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_top_prelev_ta = nb_tests_top_prelev_ta[order(date)], 
        nb_tests_top_prelev_ta[, `:=`(top_prelev_ta_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_top_prelev_ta) %like% 
            "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], nb_tests_top_prelev_ta[, 
            `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_top_prelev_ta) %like% "1_nb"], 
        nb_tests_top_prelev_ta <- nb_tests_top_prelev_ta[, .(date, 
            top_prelev_ta_PNIX, top_prelev_ta)], nb_tests <- merge(nb_tests, 
            nb_tests_top_prelev_ta, by = "date", all = TRUE), 
        nb_tests[, `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
            PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
            DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - CHIRURGIENDENTISTE_nb_tot_PNIX - 
            SAGEFEMME_nb_tot_PNIX - MASSEURKINESITHERAPE_nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession."), 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, ProfPrelevTA, 
                cat_pp, valeur)], date + reg ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), data.table::setnames(nb_tests_reg, 
            "libelle", "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
            "nb_NA"], nb_tests_reg[, `:=`(prop_pos_PNIX, rowSums(.SD, 
            na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "NA_public_nb"], 
        nb_tests_reg[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_reg) %like% "privé_nb_NA"], nb_tests_reg[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_privé_nb"], nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "MEDECIN_NA_nb"], 
        nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], nb_tests_reg[, 
            `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "INFIRMIER_NA_nb"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
            !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "DOCTEUR_NA_nb"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_reg[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, ProfPrelevTA, departement, 
                cat_pp, valeur)], date + departement ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_dep[is.na(nb_tests_dep)] = 0, nb_tests_dep[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_privé_nb"], nb_tests_dep[, `:=`(nb_pos, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P"], nb_tests_dep[, 
            `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MEDECIN_NA_nb"], nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "DOCTEUR_NA_nb"], nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb"], 
        nb_tests_dep[, `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_dep[, 
            `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, nb_pos, 
            prop_pos_PNIX, nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi_TAG.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addWorksheet(wb, "regions"), writeData(wb, 
            "regions", nb_tests_reg), setColWidths(wb, "regions", 
            cols = 1:ncol(nb_tests_reg), widths = 12), addWorksheet(wb, 
            "departements"), writeData(wb, "departements", nb_tests_dep), 
        setColWidths(wb, "departements", cols = 1:ncol(nb_tests_dep), 
            widths = 12), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "antigenique"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-16"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), sidep <- data.table::copy(sidep_antigenique), 
        sidep = sidep[as.numeric(Age) >= 65], if (type_date == 
            "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], print(sidep[, 
            unique(ProfPrelevTA)]), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, ProfPrelevTA, 
                valeur)], date ~ ProfPrelevTA + cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests = nb_tests[order(date)], 
        nb_tests[is.na(nb_tests)] = 0, nb_tests[, `:=`(nb_tot, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests) %like% "nb_NA"], 
        nb_tests[, `:=`(prop_pos_PNIX, rowSums(.SD, na.rm = TRUE)/nb_tot_PNIX), 
            .SDcols = names(nb_tests) %like% "nb_P"], nb_tests[, 
            `:=`(public_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
                !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "NA_public_nb"], 
        nb_tests[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_privé_nb"], nb_tests[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests) %like% "MEDECIN_NA_nb_NA"], nb_tests[, 
            `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "MEDECIN_NA_nb"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
                !names(nb_tests) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests[, `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "INFIRMIER_NA_nb"], 
        nb_tests[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests) %like% "PHARMACIEN_NA_nb_NA"], nb_tests[, 
            `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "PHARMACIEN_NA_nb"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "DOCTEUR_NA_nb"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
                !names(nb_tests) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
                !names(nb_tests) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests) %like% "SAGEFEMME_NA_nb_NA"], nb_tests[, 
            `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests) %like% "SAGEFEMME_NA_nb"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests) %like% 
                "NA_NA_nb"], nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot_PNIX + 
            SAGEFEMME_nb_tot_PNIX + MASSEURKINESITHERAPE_nb_tot_PNIX + 
            BIOLOGISTE_nb_tot_PNIX + DOCTEUR_nb_tot_PNIX + PHARMACIEN_nb_tot_PNIX + 
            INFIRMIER_nb_tot_PNIX + MEDECIN_nb_tot_PNIX + NA_nb_tot_PNIX + 
            privé_nb_tot_PNIX + public_nb_tot_PNIX - nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories PNIX."), 
        nb_tests[, `:=`(verif, CHIRURGIENDENTISTE_nb_tot + SAGEFEMME_nb_tot + 
            MASSEURKINESITHERAPE_nb_tot + BIOLOGISTE_nb_tot + 
            DOCTEUR_nb_tot + PHARMACIEN_nb_tot + INFIRMIER_nb_tot + 
            MEDECIN_nb_tot + NA_nb_tot + privé_nb_tot + public_nb_tot - 
            nb_tot)], if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre les catégories toute norme confondue."), 
        nb_tests <- nb_tests[, .(date, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_top_prelev_ta = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, TopPrelevTA, valeur)], 
            date ~ TopPrelevTA + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_top_prelev_ta = nb_tests_top_prelev_ta[order(date)], 
        nb_tests_top_prelev_ta[, `:=`(top_prelev_ta_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_top_prelev_ta) %like% 
            "1_nb_I|1_nb_N|1_nb_P|1_nb_X"], nb_tests_top_prelev_ta[, 
            `:=`(top_prelev_ta, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_top_prelev_ta) %like% "1_nb"], 
        nb_tests_top_prelev_ta <- nb_tests_top_prelev_ta[, .(date, 
            top_prelev_ta_PNIX, top_prelev_ta)], nb_tests <- merge(nb_tests, 
            nb_tests_top_prelev_ta, by = "date", all = TRUE), 
        nb_tests[, `:=`(verif, top_prelev_ta_PNIX - MEDECIN_nb_tot_PNIX - 
            PHARMACIEN_nb_tot_PNIX - INFIRMIER_nb_tot_PNIX - 
            DOCTEUR_nb_tot_PNIX - BIOLOGISTE_nb_tot_PNIX - CHIRURGIENDENTISTE_nb_tot_PNIX - 
            SAGEFEMME_nb_tot_PNIX - MASSEURKINESITHERAPE_nb_tot_PNIX)], 
        if (sum(nb_tests$verif, na.rm = T) > 0) print("Il y a un probleme de sommation entre le total PS topprelevTA et le total par profession."), 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, ProfPrelevTA, 
                cat_pp, valeur)], date + reg ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), data.table::setnames(nb_tests_reg, 
            "libelle", "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P|nb_N|nb_I|nb_X" & !names(nb_tests_reg) %like% 
            "nb_NA"], nb_tests_reg[, `:=`(prop_pos_PNIX, rowSums(.SD, 
            na.rm = TRUE)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "NA_public_nb"], 
        nb_tests_reg[, `:=`(privé_nb_tot_PNIX, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
                !names(nb_tests_reg) %like% "privé_nb_NA"], nb_tests_reg[, 
            `:=`(privé_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_privé_nb"], nb_tests_reg[, `:=`(nb_pos, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "nb_P"], nb_tests_reg[, `:=`(MEDECIN_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MEDECIN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "MEDECIN_NA_nb"], 
        nb_tests_reg[, `:=`(INFIRMIER_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_reg) %like% "INFIRMIER_nb_NA"], nb_tests_reg[, 
            `:=`(INFIRMIER_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "INFIRMIER_NA_nb"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
            !names(nb_tests_reg) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_reg[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
            !names(nb_tests_reg) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_reg[, `:=`(DOCTEUR_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "DOCTEUR_NA_nb"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "MASSEURKINESITHERAPE_NA_nb"], nb_tests_reg[, `:=`(SAGEFEMME_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
            !names(nb_tests_reg) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_reg[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD, na.rm = TRUE)), 
            .SDcols = names(nb_tests_reg) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
            !names(nb_tests_reg) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_reg[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD, 
            na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "CHIRURGIENDENTISTE_NA_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_reg[, 
            `:=`(NA_nb_tot, rowSums(.SD, na.rm = TRUE)), .SDcols = names(nb_tests_reg) %like% 
                "NA_NA_nb"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, NA_nb_tot_PNIX, nb_tot_PNIX, 
            nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, ProfPrelevTA, departement, 
                cat_pp, valeur)], date + departement ~ ProfPrelevTA + 
            cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests_dep[is.na(nb_tests_dep)] = 0, nb_tests_dep[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_privé_nb"], nb_tests_dep[, `:=`(nb_pos, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P"], nb_tests_dep[, 
            `:=`(MEDECIN_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "MEDECIN_NA_nb_P|MEDECIN_NA_nb_N|MEDECIN_NA_nb_I|MEDECIN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "MEDECIN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MEDECIN_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MEDECIN_NA_nb"], nb_tests_dep[, `:=`(INFIRMIER_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "INFIRMIER_NA_nb_P|INFIRMIER_NA_nb_N|INFIRMIER_NA_nb_I|INFIRMIER_NA_nb_X" & 
            !names(nb_tests_dep) %like% "INFIRMIER_NA_nb_NA"], 
        nb_tests_dep[, `:=`(INFIRMIER_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "INFIRMIER_NA_nb"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_P|PHARMACIEN_NA_nb_N|PHARMACIEN_NA_nb_I|PHARMACIEN_NA_nb_X" & 
                !names(nb_tests_dep) %like% "PHARMACIEN_NA_nb_NA"], 
        nb_tests_dep[, `:=`(PHARMACIEN_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "PHARMACIEN_NA_nb"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "DOCTEUR_NA_nb_P|DOCTEUR_NA_nb_N|DOCTEUR_NA_nb_I|DOCTEUR_NA_nb_X" & 
                !names(nb_tests_dep) %like% "DOCTEUR_NA_nb_NA"], 
        nb_tests_dep[, `:=`(DOCTEUR_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "DOCTEUR_NA_nb"], nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "BIOLOGISTE_NA_nb_P|BIOLOGISTE_NA_nb_N|BIOLOGISTE_NA_nb_I|BIOLOGISTE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(BIOLOGISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "BIOLOGISTE_NA_nb"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "MASSEURKINESITHERAPE_NA_nb_P|MASSEURKINESITHERAPE_NA_nb_N|MASSEURKINESITHERAPE_NA_nb_I|MASSEURKINESITHERAPE_NA_nb_X" & 
            !names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(MASSEURKINESITHERAPE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "MASSEURKINESITHERAPE_NA_nb"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_P|SAGEFEMME_NA_nb_N|SAGEFEMME_NA_nb_I|SAGEFEMME_NA_nb_X" & 
                !names(nb_tests_dep) %like% "SAGEFEMME_NA_nb_NA"], 
        nb_tests_dep[, `:=`(SAGEFEMME_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "SAGEFEMME_NA_nb"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_P|CHIRURGIENDENTISTE_NA_nb_N|CHIRURGIENDENTISTE_NA_nb_I|CHIRURGIENDENTISTE_NA_nb_X" & 
                !names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb_NA"], 
        nb_tests_dep[, `:=`(CHIRURGIENDENTISTE_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "CHIRURGIENDENTISTE_NA_nb"], 
        nb_tests_dep[, `:=`(NA_nb_tot_PNIX, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_NA_nb_P|NA_NA_nb_N|NA_NA_nb_I|NA_NA_nb_X"], nb_tests_dep[, 
            `:=`(NA_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "NA_NA_nb"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, MEDECIN_nb_tot_PNIX, PHARMACIEN_nb_tot_PNIX, 
            INFIRMIER_nb_tot_PNIX, DOCTEUR_nb_tot_PNIX, BIOLOGISTE_nb_tot_PNIX, 
            CHIRURGIENDENTISTE_nb_tot_PNIX, SAGEFEMME_nb_tot_PNIX, 
            MASSEURKINESITHERAPE_nb_tot_PNIX, public_nb_tot_PNIX, 
            privé_nb_tot_PNIX, NA_nb_tot, nb_tot_PNIX, nb_pos, 
            prop_pos_PNIX, nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi_TAG.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addWorksheet(wb, "regions"), writeData(wb, 
            "regions", nb_tests_reg), setColWidths(wb, "regions", 
            cols = 1:ncol(nb_tests_reg), widths = 12), addWorksheet(wb, 
            "departements"), writeData(wb, "departements", nb_tests_dep), 
        setColWidths(wb, "departements", cols = 1:ncol(nb_tests_dep), 
            widths = 12), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr_sal_mil"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-01"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(structure(expression(
        type_test = "pcr_sal_mil"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(type_date = "valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(day_init = "2020-10-01"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(jour = jour_date), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        date_AAAAMMJJ = format(jour, format = "%Y%m%d"), if (type_test == 
            "pcr") {
            sidep <- sidep_pcr
        } else if (type_test == "sero") {
            sidep <- sidep_sero
        } else if (type_test == "antigenique") {
            sidep <- sidep_antigenique
        } else if (type_test == "pcr_sal_mil") {
            sidep <- sidep_pcr_sal_mil
        }, if (type_date == "prelev") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("day_", 
                type_date))))]
        } else if (type_date == "valid") {
            sidep <- sidep[, `:=`(date, as.Date(get(paste0("date_", 
                type_date, "_init"))))]
        }, sidep <- sidep[!is.na(date), ], sidep <- sidep[date >= 
            as.Date(day_init) & date < jour, ], sidep = sidep[as.numeric(Age) >= 
            65], table(sidep[date == "2020-10-20"]$ProfPrelevTA), 
        sum(is.na(sidep[date == "2020-10-20"]$ProfPrelevTA)), 
        table(sidep[date == "2020-10-20"]$cat_pp), sum(is.na(sidep[date == 
            "2020-10-20"]$cat_pp)), nb_tests = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, cat_pp, valeur)], 
            date ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        nb_tests = nb_tests[order(date)], nb_tests[is.na(nb_tests)] = 0, 
        nb_tests[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb"], nb_tests[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests) %like% "nb_NA"], nb_tests[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests) %like% 
                "nb_P"], nb_tests[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests) %like% "public_nb_NA"], nb_tests[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "public_nb"], nb_tests[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & 
            !names(nb_tests) %like% "privé_nb_NA"], nb_tests[, 
            `:=`(privé_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
                "privé_nb"], nb_tests[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & 
            !names(nb_tests) %like% "NA_nb_NA"], nb_tests[, `:=`(NA_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests) %like% "NA_nb"], 
        nb_tests[, `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests) %like% 
            "nb_P"], nb_tests[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests) %like% "NA_nb"], nb_tests <- nb_tests[, 
            .(date, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
                nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], 
        nb_tests_svg <- nb_tests, nb_tests <- nb_tests_svg, nb_tests_reg = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, reg, cat_pp, valeur)], 
            date + reg ~ cat_pp + paste0("nb_", valeur), value.var = "nb_res"), 
        reg2019 = data.table::fread(paste0("data/utils/region2019_v2.csv"), 
            encoding = "Latin-1"), reg2019$reg = as.character(reg2019$reg), 
        reg2019[nchar(reg) == 1, `:=`(reg, paste0("0", reg))], 
        nb_tests_reg = merge(nb_tests_reg, reg2019[, .(reg, libelle)], 
            by = "reg", all.x = T), setnames(nb_tests_reg, "libelle", 
            "nom_reg"), nb_tests_reg = nb_tests_reg[order(nom_reg)], 
        nb_tests_reg[is.na(nom_reg), `:=`(nom_reg, "Région inconnue")], 
        nb_tests_reg[is.na(nb_tests_reg)] = 0, nb_tests_reg[, 
            `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb"], nb_tests_reg[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_reg) %like% "nb_NA"], nb_tests_reg[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_reg) %like% "public_nb_NA"], nb_tests_reg[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "public_nb"], nb_tests_reg[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_reg) %like% 
            "privé_nb_NA"], nb_tests_reg[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "privé_nb"], nb_tests_reg[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_reg) %like% 
            "NA_nb_NA"], nb_tests_reg[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_reg) %like% "NA_nb"], nb_tests_reg[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_reg) %like% 
                "nb_P"], nb_tests_reg <- nb_tests_reg[, .(date, 
            nom_reg, public_nb_tot_PNIX, privé_nb_tot_PNIX, NA_nb_tot_PNIX, 
            nb_tot_PNIX, nb_pos, prop_pos_PNIX, nb_tot)], nb_tests_dep = dcast(sidep[, 
            .(nb_res = (.N)), by = .(date, departement, cat_pp, 
                valeur)], date + departement ~ cat_pp + paste0("nb_", 
            valeur), value.var = "nb_res"), nb_tests_dep[is.na(nb_tests_dep)] = 0, 
        nb_tests_dep[, `:=`(nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "nb"], nb_tests_dep[, `:=`(nb_tot_PNIX, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "nb_P|nb_N|nb_I|nb_X" & 
                !names(nb_tests_dep) %like% "nb_NA"], nb_tests_dep[, 
            `:=`(prop_pos_PNIX, rowSums(.SD)/nb_tot_PNIX), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep[, `:=`(public_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "public_nb_P|public_nb_N|public_nb_I|public_nb_X" & 
            !names(nb_tests_dep) %like% "public_nb_NA"], nb_tests_dep[, 
            `:=`(public_nb_tot, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "public_nb"], nb_tests_dep[, `:=`(privé_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb_P|privé_nb_N|privé_nb_I|privé_nb_X" & !names(nb_tests_dep) %like% 
            "privé_nb_NA"], nb_tests_dep[, `:=`(privé_nb_tot, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "privé_nb"], nb_tests_dep[, `:=`(NA_nb_tot_PNIX, 
            rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
            "NA_nb_P|NA_nb_N|NA_nb_I|NA_nb_X" & !names(nb_tests_dep) %like% 
            "NA_nb_NA"], nb_tests_dep[, `:=`(NA_nb_tot, rowSums(.SD)), 
            .SDcols = names(nb_tests_dep) %like% "NA_nb"], nb_tests_dep[, 
            `:=`(nb_pos, rowSums(.SD)), .SDcols = names(nb_tests_dep) %like% 
                "nb_P"], nb_tests_dep <- nb_tests_dep[, .(date, 
            departement, public_nb_tot_PNIX, privé_nb_tot_PNIX, 
            NA_nb_tot_PNIX, nb_tot_PNIX, nb_pos, prop_pos_PNIX, 
            nb_tot)], wb <- loadWorkbook("data/sorties/nb_tests/lisez_moi.xlsx"), 
        addWorksheet(wb, "national"), writeData(wb, "national", 
            nb_tests), setColWidths(wb, "national", cols = 1:ncol(nb_tests), 
            widths = 12), addStyle(wb, sheet = "national", style = createStyle(numFmt = "# ##0"), 
            cols = c(2, 3, 4, 5, 6, 8), rows = 1:nrow(nb_tests) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "national", 
            style = createStyle(numFmt = "0.0 %"), cols = c(7), 
            rows = 1:nrow(nb_tests) + 1, gridExpand = T, stack = T), 
        addWorksheet(wb, "regions"), writeData(wb, "regions", 
            nb_tests_reg), setColWidths(wb, "regions", cols = 1:ncol(nb_tests_reg), 
            widths = 12), addStyle(wb, sheet = "regions", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_reg) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "regions", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_reg) + 1, gridExpand = T, 
            stack = T), addWorksheet(wb, "departements"), writeData(wb, 
            "departements", nb_tests_dep), setColWidths(wb, "departements", 
            cols = 1:ncol(nb_tests_dep), widths = 12), addStyle(wb, 
            sheet = "departements", style = createStyle(numFmt = "# ##0"), 
            cols = c(3, 4, 5, 6, 7, 9), rows = 1:nrow(nb_tests_dep) + 
                1, gridExpand = T, stack = T), addStyle(wb, sheet = "departements", 
            style = createStyle(numFmt = "0.0 %"), cols = c(8), 
            rows = 1:nrow(nb_tests_dep) + 1, gridExpand = T, 
            stack = T), saveWorkbook(wb, file = paste0("data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_", type_test, "_", type_date, 
            "_65+.xlsx"), overwrite = T)), list(print, "02b"), 
    list(print, list(gc, T)), list(=, stats, list([, sidep_pcr, 
        list(&, list(!, list(is.na, day_valid)), list(<=, day_valid, 
            list(as.Date, list(-, date_dataset, 2)))), list(., 
            list((, .N)), list(., cat_pp, day_valid))), list(
        [, stats, list(is.na, cat_pp), list(:=, cat_pp, "indéterminé")), 
    list(colnames, stats), list(=, list(colnames, stats), list(
        c, "catégorie_juridique", "date_de_validation", "nombre_tests_pcr")), 
    list(=, stats, list([, stats, list(order, date_de_validation))), 
    list(write.table, stats, list(paste0, path, "data/verifs/", 
        date_AAAAMMJJ, "_Nombre_tests_pcr_par_date_de_validation_et_catégorie_juridique.csv"), 
        TRUE, ".", FALSE, TRUE, ";", list(c, "escape")), list(
        =, stats_sero, list([, sidep_sero, list(&, list(&, list(
            !, list(is.na, day_valid)), list(>=, day_valid, list(
            as.Date, "2020-06-10"))), list(<=, day_valid, list(
            as.Date, list(-, date_dataset, 2)))), list(., list(
            (, .N)), list(., cat_pp, day_valid))), list([, stats_sero, 
        list(is.na, cat_pp), list(:=, cat_pp, "indéterminé")), 
    list(colnames, stats_sero), list(=, list(colnames, stats_sero), 
        list(c, "catégorie_juridique", "date_de_validation", 
            "nombre_tests_sero")), list(=, stats_sero, list([, 
        stats_sero, list(order, date_de_validation))), list(write.table, 
        stats_sero, list(paste0, path, "data/verifs/", date_AAAAMMJJ, 
            "_Nombre_tests_sero_par_date_de_validation_et_catégorie_juridique.csv"), 
        TRUE, ".", FALSE, TRUE, ";", list(c, "escape")), list(
        =, list($, stats, nombre_tests_pcr), list(as.character, 
            list($, stats, nombre_tests_pcr))), list(=, list(
        $, stats_sero, date_de_validation), list(as.Date, list(
        $, stats_sero, date_de_validation))), list(=, all_stats, 
        list(merge, stats, stats_sero, list(c, "date_de_validation", 
            "catégorie_juridique"), T)), list(write.table, all_stats, 
        list(paste0, path, "data/verifs/", date_AAAAMMJJ, "_Nombre_tests_pcr_et_sero_par_date_de_validation_et_catégorie_juridique.csv"), 
        TRUE, ".", FALSE, TRUE, ";", list(c, "escape")), list(
        =, list_files, list(list.files, path_sortie, TRUE)), 
    list(=, list_files, list(grep, date_AAAAMMJJ, list_files, 
        T)), list(=, list_files, list(grep, ".csv", list_files, 
        T)), list(print, "zip it"), list(print, list(gc, T)), 
    list(=, t1, list(Sys.time)), list(list(::, zip, zipr), list(
        paste0, path_sortie, date_AAAAMMJJ, "_historique_sidep.zip"), 
        list_files), list(=, t2, list(Sys.time)), list(difftime, 
        t2, t1, "mins"), list(print, "WOAW THAT IS SLOW !"), 
    list(print, "07"), list(print, list(gc, T)), list(library, 
        openxlsx), list(library, ggplot2), list(library, data.table), 
    list(message, "Il faut que la base Sidep PCR soit chargées dans l'environnement de travail"), 
    list(<-, exporter_tableau_punaise, list(function, list(as.pairlist(alist(donnees = , onglet = "tableau1", format_donnees = "NUMBER", noms_lignes = FALSE, fichier_source = NULL, fichier_destination = NULL, colonnes_donnees = 2:(ncol(donnees) + 
        1), lignes_donnees = 4:(nrow(donnees) + 3), titre = NULL, aides_lecture = NULL, note = NULL, lecture = NULL, champ = NULL, sources = NULL, lignes_style_specifique = NULL, style_specifique_voulu = NULL, colonnes_format_specifique = NULL, format_specifique_voulu = NULL, nombre_decimales_voulues = NULL, visualiser = FALSE, lignes_a_ajuster = c("header", 
        "noms_colonnes", "footer"), ajustements_hauteurs_lignes = c(25, 
        35, 150), garder_premiere_case = TRUE, sauvegarde = T)), 
        "tableau1", "NUMBER", FALSE, NULL, NULL, list(:, 2, list(
            (, list(+, list(ncol, donnees), 1))), list(:, 4, 
            list((, list(+, list(nrow, donnees), 3))), NULL, 
        NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
        NULL, FALSE, list(c, "header", "noms_colonnes", "footer"), 
        list(c, 25, 35, 150), TRUE, T), list(list(options, "black"), 
        list(options, "hair"), list(options, format_donnees), 
        list(if, list(>, list(length, lignes_donnees), list(nrow, 
            donnees)), list(list(print, "Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree"))), 
        list(if, list(>, list(length, colonnes_donnees), list(
            ncol, donnees)), list(list(print, "Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree"))), 
        list(if, list(==, list([, list(class, donnees), 1), "tbl_df"), 
            list(list(<-, donnees, list(as.data.frame, donnees)), 
                list(if, list(==, noms_lignes, TRUE), list(list(
                  <-, colonnes_donnees, list([, colonnes_donnees, 
                    list(-, list(:, 1, list(length, colonnes_donnees)), 
                      1)))))), list(list(<-, donnees, list(as.data.frame, 
                donnees)))), list(<-, c_titres_lignes, 1), list(
            if, list(==, noms_lignes, TRUE), list(list(<-, c_titres_lignes, 
                2), list(<-, colonnes_donnees, list(+, colonnes_donnees, 
                1)), list(<-, style_titres_lignes, list(list(
                ::, openxlsx, createStyle), "LEFT", "CENTER", 
                "TopBottomLeftRight", T)), list(if, list(==, 
                garder_premiere_case, FALSE), list(list(<-, style_premiere_case, 
                list(list(::, openxlsx, createStyle), "CENTER", 
                  "CENTER", "BottomRight", T))), list(list(<-, 
                style_premiere_case, list(list(::, openxlsx, 
                  createStyle), "CENTER", "CENTER", "bold", "TopBottomLeftRight", 
                  T)))))), list(if, list(is.null, fichier_source), 
            list(list(<-, wb, list(list(::, openxlsx, createWorkbook))), 
                list(if, list(is.null, fichier_destination), 
                  list(list(print, "Veuillez indiquer un fichier sur lequelle ecrire les donnees"), 
                    list(return, wb)))), list(list(<-, wb, list(
                list(::, openxlsx, loadWorkbook), fichier_source)), 
                list(if, list(%in%, onglet, list(list(::, openxlsx, 
                  getSheetNames), fichier_source)), list(list(
                  print, "Erreur : ce nom d'onglet existe deja"), 
                  list(return, wb))))), list(<-, sheet, list(
            list(::, openxlsx, addWorksheet), wb, onglet)), list(
            <-, hs1, list(list(::, openxlsx, createStyle), "CENTER", 
                "CENTER", "bold", "TopBottomLeftRight", T)), 
        list(list(::, openxlsx, writeData), wb, onglet, donnees, 
            2, 3, "all", hs1), list(<-, body_style, list(list(
            ::, openxlsx, createStyle), format_donnees, "TopBottomLeftRight", 
            "CENTER", "top")), list(list(::, openxlsx, addStyle), 
            wb, onglet, body_style, lignes_donnees, list(c, 2, 
                colonnes_donnees), T), list(if, list(==, noms_lignes, 
            TRUE), list(list(if, list(==, garder_premiere_case, 
            FALSE), list(list(list(::, openxlsx, writeData), 
            wb, onglet, " ", 2, 3))), list(list(::, openxlsx, 
            addStyle), wb, onglet, style_premiere_case, 3, 2), 
            list(list(::, openxlsx, addStyle), wb, onglet, style_titres_lignes, 
                lignes_donnees, 2))), list(list(::, openxlsx, 
            setColWidths), wb, onglet, list(c, 1), 3), list(list(
            ::, openxlsx, showGridLines), wb, onglet, F), list(
            list(::, openxlsx, modifyBaseFont), wb, 8, "black", 
            "Arial"), list(<-, largeur_ajuster, 1.5), list(<-, 
            largeur_vec_header, NULL), list(for, i, list(:, 1, 
            list(length, list(colnames, donnees))), list(list(
            <-, largeur, 0), list(<-, largeur2, 0), list(<-, 
            j, 1), list(while, list(<=, j, list(nchar, list([, 
            list(colnames, donnees), i))), list(list(if, list(
            |, list((, list(==, list(substr, list([, list(colnames, 
                donnees), i), j, j), "\r")), list((, list(==, 
                list(substr, list([, list(colnames, donnees), 
                  i), j, j), "\n"))), list(list(if, list(>, largeur, 
            largeur2), list(list(<-, largeur2, largeur))), list(
            <-, largeur, 0), list(<-, j, list(+, j, 1))), list(
            list(<-, largeur, list(+, largeur, 1)), list(<-, 
                j, list(+, j, 1)))))), list(<-, largeur_vec_header, 
            list(c, largeur_vec_header, list((, list(+, list(
                max, largeur, largeur2), largeur_ajuster)))))), 
        list(<-, largeur_vec, list(apply, donnees, 2, list(function, 
            list(as.pairlist(alist(x = ))), list(max, list(+, 
                list(nchar, list(as.character, x)), largeur_ajuster), 
                TRUE), list(2770L, 36L, 2770L, 106L, 36L, 106L, 
                2770L, 2770L)))), list(<-, largeur_vec_max, list(
            pmax, largeur_vec, largeur_vec_header)), list(list(
            ::, openxlsx, setColWidths), wb, onglet, list(:, 
            2, list((, list(+, list(length, colonnes_donnees), 
                2))), largeur_vec_max), list(if, list(!, list(
            is.null, lignes_style_specifique)), list(list(if, 
            list(is.null, style_specifique_voulu), list(list(
                <-, style_specifique_voulu, list(rep, list((, 
                  "bold"), list(length, lignes_style_specifique))))), 
            list(if, list(!=, list(length, lignes_style_specifique), 
                list(length, style_specifique_voulu)), list(list(
                print, "Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant"), 
                list(if, list(>, list(length, lignes_style_specifique), 
                  list(length, style_specifique_voulu)), list(
                  list(<-, bold_ajoute, list(rep, "bold", list(
                    -, list(length, lignes_style_specifique), 
                    list(length, style_specifique_voulu)))), 
                  list(<-, style_specifique_voulu, list(c, style_specifique_voulu, 
                    bold_ajoute))), list(list(<-, style_specifique_voulu, 
                  list([, style_specifique_voulu, list(:, 1, 
                    list(length, lignes_style_specifique)))))))), 
            list(for, i, list(:, 1, list(length, lignes_style_specifique)), 
                list(list(<-, style_specifique, list(list(::, 
                  openxlsx, createStyle), list([, style_specifique_voulu, 
                  i), format_donnees, "CENTER", "CENTER")), list(
                  list(::, openxlsx, addStyle), wb, onglet, style_specifique, 
                  list(+, 3, list([, lignes_style_specifique, 
                    i)), list(c, 2, colonnes_donnees), T, TRUE))))), 
        list(if, list(!, list(is.null, colonnes_format_specifique)), 
            list(list(if, list(is.null, nombre_decimales_voulues), 
                list(list(<-, nombre_decimales_voulues, list(
                  rep, 2, list(length, colonnes_format_specifique))))), 
                list(for, i, list(:, 1, list(length, colonnes_format_specifique)), 
                  list(list(if, list(%in%, list([, format_specifique_voulu, 
                    i), list(c, "PERCENTAGE", "CURRENCY", "NUMBER", 
                    "SCIENTIFIC")), list(list(=, nb_dec, "0."))), 
                    list(if, list(>, list([, nombre_decimales_voulues, 
                      i), 0), list(list(for, j, list(:, 1, list(
                      [, nombre_decimales_voulues, i)), list(
                      list(=, nb_dec, list(paste0, nb_dec, "0")))))), 
                    list(if, list(==, list([, nombre_decimales_voulues, 
                      i), 0), list(list(<-, nb_dec, "0."))), 
                    list(if, list(==, list([, format_specifique_voulu, 
                      i), "PERCENTAGE"), list(list(<-, bon_format, 
                      list(paste0, nb_dec, " %"))), list(if, 
                      list(==, list([, format_specifique_voulu, 
                        i), "CURRENCY"), list(list(<-, bon_format, 
                        list(paste0, nb_dec, " \200"))), list(
                        if, list(%in%, list([, format_specifique_voulu, 
                          i), list(c, "NUMBER", "SCIENTIFIC")), 
                        list(list(<-, bon_format, nb_dec)), list(
                          list(<-, bon_format, list([, format_specifique_voulu, 
                            i)))))), list(<-, style_format_specifique, 
                      list(list(::, openxlsx, createStyle), bon_format)), 
                    list(list(::, openxlsx, addStyle), wb, onglet, 
                      style_format_specifique, list(:, 3, list(
                        (, list(+, list(length, lignes_donnees), 
                          3))), list(+, 1, list([, colonnes_format_specifique, 
                        i)), T, TRUE))))), list(<-, titre_style, 
            list(list(::, openxlsx, createStyle), "LEFT", "bold", 
                "top", TRUE)), list(list(::, openxlsx, writeData), 
            wb, onglet, titre, 2, 2), list(list(::, openxlsx, 
            setRowHeights), wb, onglet, 1, 10), list(list(::, 
            openxlsx, setRowHeights), wb, onglet, 2, 15), list(
            list(::, openxlsx, addStyle), wb, onglet, titre_style, 
            2, 2), list(list(::, openxlsx, mergeCells), wb, onglet, 
            list(c, 2, colonnes_donnees), 2), list(<-, footer_style, 
            list(list(::, openxlsx, createStyle), "LEFT", "TOP", 
                T)), list(if, list(is.null, aides_lecture), list(
            list(=, aides_lecture, "")), list(list(if, list(>, 
            list(length, aides_lecture), 1), list(list(<-, new_aides_lecture, 
            list(paste0, "* ", list([, aides_lecture, 1))), list(
            for, i, list(:, 2, list((, list(length, aides_lecture))), 
            list(list(<-, new_aides_lecture, list(paste, new_aides_lecture, 
                list(paste0, "* ", list([, aides_lecture, i)), 
                "\n")))), list(<-, aides_lecture, new_aides_lecture))), 
            list(=, aides_lecture, list(paste, aides_lecture, 
                "", "\n")))), list(if, list(is.null, note), list(
            list(<-, note, "")), list(list(<-, note, list(paste0, 
            "Note > ", list(paste, note, "", "\n"))))), list(
            if, list(is.null, lecture), list(list(<-, lecture, 
                "")), list(list(<-, lecture, list(paste0, "Lecture > ", 
                list(paste, lecture, "", "\n"))))), list(if, 
            list(is.null, champ), list(list(<-, champ, "")), 
            list(list(<-, champ, list(paste0, "Champ > ", list(
                paste, champ, "", "\n"))))), list(if, list(is.null, 
            sources), list(list(<-, sources, "")), list(list(
            <-, sources, list(paste0, "Sources > ", sources)))), 
        list(<-, legende, list(paste0, aides_lecture, note, lecture, 
            champ, sources)), list(list(::, openxlsx, writeData), 
            wb, onglet, legende, 2, list(+, list([, lignes_donnees, 
                list(length, lignes_donnees)), 2)), list(list(
            ::, openxlsx, mergeCells), wb, onglet, list(c, 2, 
            colonnes_donnees), list(+, list([, lignes_donnees, 
            list(length, lignes_donnees)), 2)), list(list(::, 
            openxlsx, addStyle), wb, onglet, footer_style, list(
            +, list([, lignes_donnees, list(length, lignes_donnees)), 
            2), 2), list(list(::, openxlsx, setRowHeights), wb, 
            onglet, list(+, list([, lignes_donnees, list(length, 
                lignes_donnees)), 1), 10), list(if, list(!, list(
            is.null, lignes_a_ajuster)), list(list(for, i, list(
            :, 1, list(length, ajustements_hauteurs_lignes)), 
            list(list(if, list(==, list([, lignes_a_ajuster, 
                i), "header"), list(list(list(::, openxlsx, setRowHeights), 
                wb, onglet, 2, list([, ajustements_hauteurs_lignes, 
                  i))), list(if, list(==, list([, lignes_a_ajuster, 
                i), "noms_colonnes"), list(list(list(::, openxlsx, 
                setRowHeights), wb, onglet, 3, list([, ajustements_hauteurs_lignes, 
                i))), list(if, list(==, list([, lignes_a_ajuster, 
                i), "footer"), list(list(list(::, openxlsx, setRowHeights), 
                wb, onglet, list(+, list([, lignes_donnees, list(
                  length, lignes_donnees)), 2), list([, ajustements_hauteurs_lignes, 
                  i)))))))), list(if, list(!, list((, list(%in%, 
            "header", lignes_a_ajuster))), list(list(list(::, 
            openxlsx, setRowHeights), wb, onglet, 2, 25))), list(
            if, list(!, list((, list(%in%, "noms_colonnes", lignes_a_ajuster))), 
            list(list(list(::, openxlsx, setRowHeights), wb, 
                onglet, 3, 35))), list(if, list(!, list((, list(
            %in%, "footer", lignes_a_ajuster))), list(list(list(
            ::, openxlsx, setRowHeights), wb, onglet, list(+, 
            list([, lignes_donnees, list(length, lignes_donnees)), 
            2), 150))))), list(if, list(==, visualiser, TRUE), 
            list(list(list(::, openxlsx, openXL), wb))), list(
            if, list(==, sauvegarde, T), list(list(if, list(is.null, 
                fichier_destination), list(list(list(::, openxlsx, 
                saveWorkbook), wb, fichier_source, TRUE)), list(
                list(list(::, openxlsx, saveWorkbook), wb, fichier_destination, 
                  TRUE))))), list(return, wb)), list(2657L, 29L, 
        2927L, 1L, 29L, 1L, 2657L, 2927L))), list(<-, jour, list(
        Sys.Date)), list(list(::, data.table, setkeyv), sidep_pcr, 
        "Pseudonyme"), list(=, b, list([, sidep_pcr, list(&, 
        list((, list(!, list(is.na, valeur))), list(%in%, valeur, 
            list(c, "P", "N"))), list(:=, list(c, "nb_pos", "nb_tests"), 
        list(list, list(sum, list(==, valeur, "P")), .N)), Pseudonyme)), 
    list(=, drop_c, list(c, "AnalyseConclusion", "TypeAnalyse", 
        "RPPSTraitant", "IRIS", "Statut", "res", "sem_valid", 
        "sem_jour_deb", "sem_jour_fin", "cat_delai_12h", "cat_delai", 
        "day", "delai", "FINESS_EJ", "departement", "CodePostal", 
        "fi_init", "TypologiePatient", "PremierSymptomes", "RPPSPrescripteur", 
        "FINESS_ET", "cat_etb", "cat_pp", "nom_dep", "nom_reg", 
        "reg", "Sexe", "ProfessionelSante", "tranche_age2", "sem_prelev")), 
    list(<-, b, list([, b, b[, !..drop_c], list(!, ..drop_c))), 
    list(print, "Si vous avez un warning c'est parce que certaines variables sont creees dans la note donc \n      si vous ne l'avez pas fait tourner il n'y a pas ces variables. Cela ne pose pas probleme."), 
    list([, b, b[, `:=`(day_valid_init, as.Date(date_valid_init))], 
        list(:=, day_valid_init, list(as.Date, date_valid_init))), 
    list(=, partie2, list([, b, list(&, list(>, nb_tests, 1), 
        list(==, nb_pos, 0)))), list(=, partie2, list([, partie2, 
        partie2[, `:=`(min_date_prelev_par_pseudo, min(date_prelev)), 
            by = Pseudonyme], list(:=, min_date_prelev_par_pseudo, 
            list(min, date_prelev)), Pseudonyme)), list(=, partie2, 
        list([, partie2, list(==, date_prelev, min_date_prelev_par_pseudo))), 
    list(=, col_drop, "min_date_prelev_par_pseudo"), list(=, 
        partie2, list([, partie2, partie2[, !..col_drop], list(
            !, ..col_drop))), list(dim, partie2), list(=, partie3, 
        list([, b, list(&, list(&, list(>, nb_tests, 1), list(
            >, nb_pos, 0)), list(==, valeur, "P")))), list(=, 
        partie3, list([, partie3, partie3[, `:=`(min_date_prelev_par_pseudo, 
            min(date_prelev)), by = Pseudonyme], list(:=, min_date_prelev_par_pseudo, 
            list(min, date_prelev)), Pseudonyme)), list(=, partie3, 
        list([, partie3, list(==, date_prelev, min_date_prelev_par_pseudo))), 
    list(=, col_drop, "min_date_prelev_par_pseudo"), list(=, 
        partie3, list([, partie3, partie3[, !..col_drop], list(
            !, ..col_drop))), list(dim, partie3), list(=, sidep_dedoub, 
        list(rbind, partie3, partie2)), list(rm, partie2, partie3), 
    list(=, sidep_dedoub, list(rbind, sidep_dedoub, list([, b, 
        list(==, nb_tests, 1)))), list(rm, b), list(nrow, sidep_dedoub), 
    list(=, tab_patients_par_met, list([, sidep_dedoub, sidep_dedoub[, 
        keyby = .(day_prelev), .(nb_pos_patients = sum(valeur == 
            "P"), nb_patients = .N)], list(., day_prelev), list(
        ., list(sum, list(==, valeur, "P")), .N))), list(structure(expression(
        fichier_destination = paste0("data/verifs/", jour, "_sidep_par_patient.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_valid, list([, sidep_dedoub, 
        sidep_dedoub[, keyby = .(day_valid_init), .(nb_pos_patients = sum(valeur == 
            "P"), nb_patients = .N)], list(., day_valid_init), 
        list(., list(sum, list(==, valeur, "P")), .N))), list(
        structure(expression(fichier_source = paste0("data/verifs/", 
            jour, "_sidep_par_patient.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_extract, list([, 
        sidep_dedoub, sidep_dedoub[, keyby = .(day_extract_sidep), 
            .(nb_pos_patients = sum(valeur == "P"), nb_patients = .N)], 
        list(., day_extract_sidep), list(., list(sum, list(==, 
            valeur, "P")), .N))), list(structure(expression(fichier_source = paste0("data/verifs/", 
        jour, "_sidep_par_patient.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "day_extract_sidep"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_valid_65, list([, 
        sidep_dedoub, list(>=, list(as.numeric, Age), 65), list(
            ., day_valid_init), list(., list(sum, list(==, valeur, 
            "P")), .N))), list(structure(expression(fichier_source = paste0("data/verifs/", 
        jour, "_sidep_par_patient.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_valid_65"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(print, "07bis"), list(print, list(
        gc, T)), list(library, openxlsx), list(library, ggplot2), 
    list(library, data.table), list(message, "Il faut que la base Sidep PCR soit chargée dans l'environnement de travail"), 
    list(<-, exporter_tableau_punaise, list(function, list(as.pairlist(alist(donnees = , onglet = "tableau1", format_donnees = "NUMBER", noms_lignes = FALSE, fichier_source = NULL, fichier_destination = NULL, colonnes_donnees = 2:(ncol(donnees) + 
        1), lignes_donnees = 4:(nrow(donnees) + 3), titre = NULL, aides_lecture = NULL, note = NULL, lecture = NULL, champ = NULL, sources = NULL, lignes_style_specifique = NULL, style_specifique_voulu = NULL, colonnes_format_specifique = NULL, format_specifique_voulu = NULL, nombre_decimales_voulues = NULL, visualiser = FALSE, lignes_a_ajuster = c("header", 
        "noms_colonnes", "footer"), ajustements_hauteurs_lignes = c(25, 
        35, 150), garder_premiere_case = TRUE, sauvegarde = T)), 
        "tableau1", "NUMBER", FALSE, NULL, NULL, list(:, 2, list(
            (, list(+, list(ncol, donnees), 1))), list(:, 4, 
            list((, list(+, list(nrow, donnees), 3))), NULL, 
        NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
        NULL, FALSE, list(c, "header", "noms_colonnes", "footer"), 
        list(c, 25, 35, 150), TRUE, T), list(list(options, "black"), 
        list(options, "hair"), list(options, format_donnees), 
        list(if, list(>, list(length, lignes_donnees), list(nrow, 
            donnees)), list(list(print, "Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree"))), 
        list(if, list(>, list(length, colonnes_donnees), list(
            ncol, donnees)), list(list(print, "Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree"))), 
        list(if, list(==, list([, list(class, donnees), 1), "tbl_df"), 
            list(list(<-, donnees, list(as.data.frame, donnees)), 
                list(if, list(==, noms_lignes, TRUE), list(list(
                  <-, colonnes_donnees, list([, colonnes_donnees, 
                    list(-, list(:, 1, list(length, colonnes_donnees)), 
                      1)))))), list(list(<-, donnees, list(as.data.frame, 
                donnees)))), list(<-, c_titres_lignes, 1), list(
            if, list(==, noms_lignes, TRUE), list(list(<-, c_titres_lignes, 
                2), list(<-, colonnes_donnees, list(+, colonnes_donnees, 
                1)), list(<-, style_titres_lignes, list(list(
                ::, openxlsx, createStyle), "LEFT", "CENTER", 
                "TopBottomLeftRight", T)), list(if, list(==, 
                garder_premiere_case, FALSE), list(list(<-, style_premiere_case, 
                list(list(::, openxlsx, createStyle), "CENTER", 
                  "CENTER", "BottomRight", T))), list(list(<-, 
                style_premiere_case, list(list(::, openxlsx, 
                  createStyle), "CENTER", "CENTER", "bold", "TopBottomLeftRight", 
                  T)))))), list(if, list(is.null, fichier_source), 
            list(list(<-, wb, list(list(::, openxlsx, createWorkbook))), 
                list(if, list(is.null, fichier_destination), 
                  list(list(print, "Veuillez indiquer un fichier sur lequelle ecrire les donnees"), 
                    list(return, wb)))), list(list(<-, wb, list(
                list(::, openxlsx, loadWorkbook), fichier_source)), 
                list(if, list(%in%, onglet, list(list(::, openxlsx, 
                  getSheetNames), fichier_source)), list(list(
                  print, "Erreur : ce nom d'onglet existe deja"), 
                  list(return, wb))))), list(<-, sheet, list(
            list(::, openxlsx, addWorksheet), wb, onglet)), list(
            <-, hs1, list(list(::, openxlsx, createStyle), "CENTER", 
                "CENTER", "bold", "TopBottomLeftRight", T)), 
        list(list(::, openxlsx, writeData), wb, onglet, donnees, 
            2, 3, "all", hs1), list(<-, body_style, list(list(
            ::, openxlsx, createStyle), format_donnees, "TopBottomLeftRight", 
            "CENTER", "top")), list(list(::, openxlsx, addStyle), 
            wb, onglet, body_style, lignes_donnees, list(c, 2, 
                colonnes_donnees), T), list(if, list(==, noms_lignes, 
            TRUE), list(list(if, list(==, garder_premiere_case, 
            FALSE), list(list(list(::, openxlsx, writeData), 
            wb, onglet, " ", 2, 3))), list(list(::, openxlsx, 
            addStyle), wb, onglet, style_premiere_case, 3, 2), 
            list(list(::, openxlsx, addStyle), wb, onglet, style_titres_lignes, 
                lignes_donnees, 2))), list(list(::, openxlsx, 
            setColWidths), wb, onglet, list(c, 1), 3), list(list(
            ::, openxlsx, showGridLines), wb, onglet, F), list(
            list(::, openxlsx, modifyBaseFont), wb, 8, "black", 
            "Arial"), list(<-, largeur_ajuster, 1.5), list(<-, 
            largeur_vec_header, NULL), list(for, i, list(:, 1, 
            list(length, list(colnames, donnees))), list(list(
            <-, largeur, 0), list(<-, largeur2, 0), list(<-, 
            j, 1), list(while, list(<=, j, list(nchar, list([, 
            list(colnames, donnees), i))), list(list(if, list(
            |, list((, list(==, list(substr, list([, list(colnames, 
                donnees), i), j, j), "\r")), list((, list(==, 
                list(substr, list([, list(colnames, donnees), 
                  i), j, j), "\n"))), list(list(if, list(>, largeur, 
            largeur2), list(list(<-, largeur2, largeur))), list(
            <-, largeur, 0), list(<-, j, list(+, j, 1))), list(
            list(<-, largeur, list(+, largeur, 1)), list(<-, 
                j, list(+, j, 1)))))), list(<-, largeur_vec_header, 
            list(c, largeur_vec_header, list((, list(+, list(
                max, largeur, largeur2), largeur_ajuster)))))), 
        list(<-, largeur_vec, list(apply, donnees, 2, list(function, 
            list(as.pairlist(alist(x = ))), list(max, list(+, 
                list(nchar, list(as.character, x)), largeur_ajuster), 
                TRUE), list(3105L, 36L, 3105L, 106L, 36L, 106L, 
                3105L, 3105L)))), list(<-, largeur_vec_max, list(
            pmax, largeur_vec, largeur_vec_header)), list(list(
            ::, openxlsx, setColWidths), wb, onglet, list(:, 
            2, list((, list(+, list(length, colonnes_donnees), 
                2))), largeur_vec_max), list(if, list(!, list(
            is.null, lignes_style_specifique)), list(list(if, 
            list(is.null, style_specifique_voulu), list(list(
                <-, style_specifique_voulu, list(rep, list((, 
                  "bold"), list(length, lignes_style_specifique))))), 
            list(if, list(!=, list(length, lignes_style_specifique), 
                list(length, style_specifique_voulu)), list(list(
                print, "Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant"), 
                list(if, list(>, list(length, lignes_style_specifique), 
                  list(length, style_specifique_voulu)), list(
                  list(<-, bold_ajoute, list(rep, "bold", list(
                    -, list(length, lignes_style_specifique), 
                    list(length, style_specifique_voulu)))), 
                  list(<-, style_specifique_voulu, list(c, style_specifique_voulu, 
                    bold_ajoute))), list(list(<-, style_specifique_voulu, 
                  list([, style_specifique_voulu, list(:, 1, 
                    list(length, lignes_style_specifique)))))))), 
            list(for, i, list(:, 1, list(length, lignes_style_specifique)), 
                list(list(<-, style_specifique, list(list(::, 
                  openxlsx, createStyle), list([, style_specifique_voulu, 
                  i), format_donnees, "CENTER", "CENTER")), list(
                  list(::, openxlsx, addStyle), wb, onglet, style_specifique, 
                  list(+, 3, list([, lignes_style_specifique, 
                    i)), list(c, 2, colonnes_donnees), T, TRUE))))), 
        list(if, list(!, list(is.null, colonnes_format_specifique)), 
            list(list(if, list(is.null, nombre_decimales_voulues), 
                list(list(<-, nombre_decimales_voulues, list(
                  rep, 2, list(length, colonnes_format_specifique))))), 
                list(for, i, list(:, 1, list(length, colonnes_format_specifique)), 
                  list(list(if, list(%in%, list([, format_specifique_voulu, 
                    i), list(c, "PERCENTAGE", "CURRENCY", "NUMBER", 
                    "SCIENTIFIC")), list(list(=, nb_dec, "0."))), 
                    list(if, list(>, list([, nombre_decimales_voulues, 
                      i), 0), list(list(for, j, list(:, 1, list(
                      [, nombre_decimales_voulues, i)), list(
                      list(=, nb_dec, list(paste0, nb_dec, "0")))))), 
                    list(if, list(==, list([, nombre_decimales_voulues, 
                      i), 0), list(list(<-, nb_dec, "0."))), 
                    list(if, list(==, list([, format_specifique_voulu, 
                      i), "PERCENTAGE"), list(list(<-, bon_format, 
                      list(paste0, nb_dec, " %"))), list(if, 
                      list(==, list([, format_specifique_voulu, 
                        i), "CURRENCY"), list(list(<-, bon_format, 
                        list(paste0, nb_dec, " \200"))), list(
                        if, list(%in%, list([, format_specifique_voulu, 
                          i), list(c, "NUMBER", "SCIENTIFIC")), 
                        list(list(<-, bon_format, nb_dec)), list(
                          list(<-, bon_format, list([, format_specifique_voulu, 
                            i)))))), list(<-, style_format_specifique, 
                      list(list(::, openxlsx, createStyle), bon_format)), 
                    list(list(::, openxlsx, addStyle), wb, onglet, 
                      style_format_specifique, list(:, 3, list(
                        (, list(+, list(length, lignes_donnees), 
                          3))), list(+, 1, list([, colonnes_format_specifique, 
                        i)), T, TRUE))))), list(<-, titre_style, 
            list(list(::, openxlsx, createStyle), "LEFT", "bold", 
                "top", TRUE)), list(list(::, openxlsx, writeData), 
            wb, onglet, titre, 2, 2), list(list(::, openxlsx, 
            setRowHeights), wb, onglet, 1, 10), list(list(::, 
            openxlsx, setRowHeights), wb, onglet, 2, 15), list(
            list(::, openxlsx, addStyle), wb, onglet, titre_style, 
            2, 2), list(list(::, openxlsx, mergeCells), wb, onglet, 
            list(c, 2, colonnes_donnees), 2), list(<-, footer_style, 
            list(list(::, openxlsx, createStyle), "LEFT", "TOP", 
                T)), list(if, list(is.null, aides_lecture), list(
            list(=, aides_lecture, "")), list(list(if, list(>, 
            list(length, aides_lecture), 1), list(list(<-, new_aides_lecture, 
            list(paste0, "* ", list([, aides_lecture, 1))), list(
            for, i, list(:, 2, list((, list(length, aides_lecture))), 
            list(list(<-, new_aides_lecture, list(paste, new_aides_lecture, 
                list(paste0, "* ", list([, aides_lecture, i)), 
                "\n")))), list(<-, aides_lecture, new_aides_lecture))), 
            list(=, aides_lecture, list(paste, aides_lecture, 
                "", "\n")))), list(if, list(is.null, note), list(
            list(<-, note, "")), list(list(<-, note, list(paste0, 
            "Note > ", list(paste, note, "", "\n"))))), list(
            if, list(is.null, lecture), list(list(<-, lecture, 
                "")), list(list(<-, lecture, list(paste0, "Lecture > ", 
                list(paste, lecture, "", "\n"))))), list(if, 
            list(is.null, champ), list(list(<-, champ, "")), 
            list(list(<-, champ, list(paste0, "Champ > ", list(
                paste, champ, "", "\n"))))), list(if, list(is.null, 
            sources), list(list(<-, sources, "")), list(list(
            <-, sources, list(paste0, "Sources > ", sources)))), 
        list(<-, legende, list(paste0, aides_lecture, note, lecture, 
            champ, sources)), list(list(::, openxlsx, writeData), 
            wb, onglet, legende, 2, list(+, list([, lignes_donnees, 
                list(length, lignes_donnees)), 2)), list(list(
            ::, openxlsx, mergeCells), wb, onglet, list(c, 2, 
            colonnes_donnees), list(+, list([, lignes_donnees, 
            list(length, lignes_donnees)), 2)), list(list(::, 
            openxlsx, addStyle), wb, onglet, footer_style, list(
            +, list([, lignes_donnees, list(length, lignes_donnees)), 
            2), 2), list(list(::, openxlsx, setRowHeights), wb, 
            onglet, list(+, list([, lignes_donnees, list(length, 
                lignes_donnees)), 1), 10), list(if, list(!, list(
            is.null, lignes_a_ajuster)), list(list(for, i, list(
            :, 1, list(length, ajustements_hauteurs_lignes)), 
            list(list(if, list(==, list([, lignes_a_ajuster, 
                i), "header"), list(list(list(::, openxlsx, setRowHeights), 
                wb, onglet, 2, list([, ajustements_hauteurs_lignes, 
                  i))), list(if, list(==, list([, lignes_a_ajuster, 
                i), "noms_colonnes"), list(list(list(::, openxlsx, 
                setRowHeights), wb, onglet, 3, list([, ajustements_hauteurs_lignes, 
                i))), list(if, list(==, list([, lignes_a_ajuster, 
                i), "footer"), list(list(list(::, openxlsx, setRowHeights), 
                wb, onglet, list(+, list([, lignes_donnees, list(
                  length, lignes_donnees)), 2), list([, ajustements_hauteurs_lignes, 
                  i)))))))), list(if, list(!, list((, list(%in%, 
            "header", lignes_a_ajuster))), list(list(list(::, 
            openxlsx, setRowHeights), wb, onglet, 2, 25))), list(
            if, list(!, list((, list(%in%, "noms_colonnes", lignes_a_ajuster))), 
            list(list(list(::, openxlsx, setRowHeights), wb, 
                onglet, 3, 35))), list(if, list(!, list((, list(
            %in%, "footer", lignes_a_ajuster))), list(list(list(
            ::, openxlsx, setRowHeights), wb, onglet, list(+, 
            list([, lignes_donnees, list(length, lignes_donnees)), 
            2), 150))))), list(if, list(==, visualiser, TRUE), 
            list(list(list(::, openxlsx, openXL), wb))), list(
            if, list(==, sauvegarde, T), list(list(if, list(is.null, 
                fichier_destination), list(list(list(::, openxlsx, 
                saveWorkbook), wb, fichier_source, TRUE)), list(
                list(list(::, openxlsx, saveWorkbook), wb, fichier_destination, 
                  TRUE))))), list(return, wb)), list(2992L, 29L, 
        3262L, 1L, 29L, 1L, 2992L, 3262L))), list(<-, jour, list(
        Sys.Date)), list(=, keep_c, list(c, "Pseudonyme", "date_valid_init", 
        "date_prelev", "Age", "AnalyseConclusion", "departement", 
        "valeur", "day_extract_sidep")), list(=, b, list(rbind, 
        list([, sidep_pcr, sidep_pcr[, ..keep_c], ..keep_c), 
        list([, sidep_antigenique, sidep_antigenique[, ..keep_c], 
            ..keep_c))), list(=, b, list(rbind, b, list([, sidep_pcr_sal_mil, 
        sidep_pcr_sal_mil[, ..keep_c], ..keep_c))), list(=, b, 
        list([, b, list(&, list((, list(!, list(is.na, valeur))), 
            list(%in%, valeur, list(c, "P", "N"))), list(:=, 
            list(c, "nb_pos", "nb_tests"), list(list, list(sum, 
                list(==, valeur, "P")), .N)), Pseudonyme)), list(
        [, b, b[, `:=`(day_valid_init, as.Date(date_valid_init))], 
        list(:=, day_valid_init, list(as.Date, date_valid_init))), 
    list(=, partie2, list([, b, list(&, list(>, nb_tests, 1), 
        list(==, nb_pos, 0)))), list(=, partie2, list([, partie2, 
        partie2[, `:=`(min_date_prelev_par_pseudo, min(date_prelev)), 
            by = Pseudonyme], list(:=, min_date_prelev_par_pseudo, 
            list(min, date_prelev)), Pseudonyme)), list(=, partie2, 
        list([, partie2, list(==, date_prelev, min_date_prelev_par_pseudo))), 
    list(=, col_drop, "min_date_prelev_par_pseudo"), list(=, 
        partie2, list([, partie2, partie2[, !..col_drop], list(
            !, ..col_drop))), list(dim, partie2), list(=, partie3, 
        list([, b, list(&, list(&, list(>, nb_tests, 1), list(
            >, nb_pos, 0)), list(==, valeur, "P")))), list(=, 
        partie3, list([, partie3, partie3[, `:=`(min_date_prelev_par_pseudo, 
            min(date_prelev)), by = Pseudonyme], list(:=, min_date_prelev_par_pseudo, 
            list(min, date_prelev)), Pseudonyme)), list(=, partie3, 
        list([, partie3, list(==, date_prelev, min_date_prelev_par_pseudo))), 
    list(=, col_drop, "min_date_prelev_par_pseudo"), list(=, 
        partie3, list([, partie3, partie3[, !..col_drop], list(
            !, ..col_drop))), list(dim, partie3), list(=, sidep_dedoub, 
        list(rbind, partie3, partie2)), list(rm, partie2, partie3), 
    list(=, sidep_dedoub, list(rbind, sidep_dedoub, list([, b, 
        list(==, nb_tests, 1)))), list(rm, b), list(nrow, sidep_dedoub), 
    list([, sidep_dedoub, sidep_dedoub[, `:=`(day_prelev, as.Date(date_prelev))], 
        list(:=, day_prelev, list(as.Date, date_prelev))), list(
        =, tab_patients_par_met, list([, sidep_dedoub, sidep_dedoub[, 
            keyby = .(day_prelev), .(nb_pos_patients = sum(valeur == 
                "P"), nb_patients = .N)], list(., day_prelev), 
            list(., list(sum, list(==, valeur, "P")), .N))), 
    list(structure(expression(fichier_destination = paste0("data/verifs/", 
        jour, "_sidep_par_patient_bis.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_prelev"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_valid, list([, sidep_dedoub, 
        sidep_dedoub[, keyby = .(day_valid_init), .(nb_pos_patients = sum(valeur == 
            "P"), nb_patients = .N)], list(., day_valid_init), 
        list(., list(sum, list(==, valeur, "P")), .N))), list(
        structure(expression(fichier_source = paste0("data/verifs/", 
            jour, "_sidep_par_patient_bis.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_valid"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_extract, list([, 
        sidep_dedoub, sidep_dedoub[, keyby = .(day_extract_sidep), 
            .(nb_pos_patients = sum(valeur == "P"), nb_patients = .N)], 
        list(., day_extract_sidep), list(., list(sum, list(==, 
            valeur, "P")), .N))), list(structure(expression(fichier_source = paste0("data/verifs/", 
        jour, "_sidep_par_patient_bis.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "day_extract_sidep"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(=, tab_patients_valid_65, list([, 
        sidep_dedoub, list(>=, list(as.numeric, Age), 65), list(
            ., day_valid_init), list(., list(sum, list(==, valeur, 
            "P")), .N))), list(structure(expression(fichier_source = paste0("data/verifs/", 
        jour, "_sidep_par_patient_bis.xlsx")), srcfile = <environment>, wholeSrcref = structure(c(1L, 
    0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        structure(expression(onglet = "date_valid_65"), srcfile = <environment>, wholeSrcref = structure(c(1L, 
        0L, 2L, 0L, 0L, 0L, 1L, 2L), srcfile = <environment>, class = "srcref")), 
        options(openxlsx.borderColour = "black"), options(openxlsx.borderStyle = "hair"), 
        options(openxlsx.numFmt = format_donnees), if (length(lignes_donnees) > 
            nrow(donnees)) {
            print("Erreur, le nombre de lignes des donnees depasse le nombre de lignes du tableau en entree")
        }, if (length(colonnes_donnees) > ncol(donnees)) {
            print("Erreur, le nombre de colonnes des donnees depasse le nombre de colonnes du tableau en entree")
        }, if (class(donnees)[1] == "tbl_df") {
            donnees <- as.data.frame(donnees)
            if (noms_lignes == TRUE) {
                colonnes_donnees <- colonnes_donnees[1:length(colonnes_donnees) - 
                  1]
            }
        } else {
            donnees <- as.data.frame(donnees)
        }, c_titres_lignes <- 1, if (noms_lignes == TRUE) {
            c_titres_lignes <- 2
            colonnes_donnees <- colonnes_donnees + 1
            style_titres_lignes <- openxlsx::createStyle(halign = "LEFT", 
                valign = "CENTER", border = "TopBottomLeftRight", 
                wrapText = T)
            if (garder_premiere_case == FALSE) {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", border = "BottomRight", 
                  wrapText = T)
            }
            else {
                style_premiere_case <- openxlsx::createStyle(halign = "CENTER", 
                  valign = "CENTER", textDecoration = "bold", 
                  border = "TopBottomLeftRight", wrapText = T)
            }
        }, if (is.null(fichier_source)) {
            wb <- openxlsx::createWorkbook()
            if (is.null(fichier_destination)) {
                print("Veuillez indiquer un fichier sur lequelle ecrire les donnees")
                return(wb)
            }
        } else {
            wb <- openxlsx::loadWorkbook(file = fichier_source)
            if (onglet %in% openxlsx::getSheetNames(fichier_source)) {
                print("Erreur : ce nom d'onglet existe deja")
                return(wb)
            }
        }, sheet <- openxlsx::addWorksheet(wb, sheetName = onglet), 
        hs1 <- openxlsx::createStyle(halign = "CENTER", valign = "CENTER", 
            textDecoration = "bold", border = "TopBottomLeftRight", 
            wrapText = T), openxlsx::writeData(wb, sheet = onglet, 
            donnees, startCol = 2, startRow = 3, borders = "all", 
            headerStyle = hs1), body_style <- openxlsx::createStyle(numFmt = format_donnees, 
            border = "TopBottomLeftRight", halign = "CENTER", 
            valign = "top"), openxlsx::addStyle(wb, sheet = onglet, 
            body_style, rows = lignes_donnees, cols = c(2, colonnes_donnees), 
            gridExpand = T), if (noms_lignes == TRUE) {
            if (garder_premiere_case == FALSE) {
                openxlsx::writeData(wb, onglet, x = " ", startCol = 2, 
                  startRow = 3)
            }
            openxlsx::addStyle(wb, sheet = onglet, style_premiere_case, 
                rows = 3, cols = 2)
            openxlsx::addStyle(wb, sheet = onglet, style_titres_lignes, 
                rows = lignes_donnees, cols = 2)
        }, openxlsx::setColWidths(wb, sheet = onglet, cols = c(1), 
            widths = 3), openxlsx::showGridLines(wb, onglet, 
            showGridLines = F), openxlsx::modifyBaseFont(wb, 
            fontSize = 8, fontColour = "black", fontName = "Arial"), 
        largeur_ajuster <- 1.5, largeur_vec_header <- NULL, for (i in 1:length(colnames(donnees))) {
            largeur <- 0
            largeur2 <- 0
            j <- 1
            while (j <= nchar(colnames(donnees)[i])) {
                if ((substr(colnames(donnees)[i], j, j) == "\r") | 
                  (substr(colnames(donnees)[i], j, j) == "\n")) {
                  if (largeur > largeur2) {
                    largeur2 <- largeur
                  }
                  largeur <- 0
                  j <- j + 1
                }
                else {
                  largeur <- largeur + 1
                  j <- j + 1
                }
            }
            largeur_vec_header <- c(largeur_vec_header, (max(largeur, 
                largeur2) + largeur_ajuster))
        }, largeur_vec <- apply(donnees, 2, function(x) max(nchar(as.character(x)) + 
            largeur_ajuster, na.rm = TRUE)), largeur_vec_max <- pmax(largeur_vec, 
            largeur_vec_header), openxlsx::setColWidths(wb, sheet = onglet, 
            cols = 2:(length(colonnes_donnees) + 2), widths = largeur_vec_max), 
        if (!is.null(lignes_style_specifique)) {
            if (is.null(style_specifique_voulu)) {
                style_specifique_voulu <- rep(("bold"), length(lignes_style_specifique))
            }
            if (length(lignes_style_specifique) != length(style_specifique_voulu)) {
                print("Erreur : le nombre de lignes sur lesquelles appliquer un style est different du nombre de styles\n            correspondant")
                if (length(lignes_style_specifique) > length(style_specifique_voulu)) {
                  bold_ajoute <- rep("bold", length(lignes_style_specifique) - 
                    length(style_specifique_voulu))
                  style_specifique_voulu <- c(style_specifique_voulu, 
                    bold_ajoute)
                }
                else {
                  style_specifique_voulu <- style_specifique_voulu[1:length(lignes_style_specifique)]
                }
            }
            for (i in 1:length(lignes_style_specifique)) {
                style_specifique <- openxlsx::createStyle(textDecoration = style_specifique_voulu[i], 
                  numFmt = format_donnees, halign = "CENTER", 
                  valign = "CENTER")
                openxlsx::addStyle(wb, sheet = onglet, style_specifique, 
                  rows = 3 + lignes_style_specifique[i], cols = c(2, 
                    colonnes_donnees), gridExpand = T, stack = TRUE)
            }
        }, if (!is.null(colonnes_format_specifique)) {
            if (is.null(nombre_decimales_voulues)) {
                nombre_decimales_voulues <- rep(2, length(colonnes_format_specifique))
            }
            for (i in 1:length(colonnes_format_specifique)) {
                if (format_specifique_voulu[i] %in% c("PERCENTAGE", 
                  "CURRENCY", "NUMBER", "SCIENTIFIC")) {
                  nb_dec = "0."
                }
                if (nombre_decimales_voulues[i] > 0) {
                  for (j in 1:nombre_decimales_voulues[i]) {
                    nb_dec = paste0(nb_dec, "0")
                  }
                }
                if (nombre_decimales_voulues[i] == 0) {
                  nb_dec <- "0."
                }
                if (format_specifique_voulu[i] == "PERCENTAGE") {
                  bon_format <- paste0(nb_dec, " %")
                }
                else if (format_specifique_voulu[i] == "CURRENCY") {
                  bon_format <- paste0(nb_dec, " \200")
                }
                else if (format_specifique_voulu[i] %in% c("NUMBER", 
                  "SCIENTIFIC")) {
                  bon_format <- nb_dec
                }
                else {
                  bon_format <- format_specifique_voulu[i]
                }
                style_format_specifique <- openxlsx::createStyle(numFmt = bon_format)
                openxlsx::addStyle(wb, sheet = onglet, style_format_specifique, 
                  rows = 3:(length(lignes_donnees) + 3), cols = 1 + 
                    colonnes_format_specifique[i], gridExpand = T, 
                  stack = TRUE)
            }
        }, titre_style <- openxlsx::createStyle(halign = "LEFT", 
            textDecoration = "bold", valign = "top", wrapText = TRUE), 
        openxlsx::writeData(wb, onglet, titre, startCol = 2, 
            startRow = 2), openxlsx::setRowHeights(wb, onglet, 
            1, 10), openxlsx::setRowHeights(wb, onglet, 2, 15), 
        openxlsx::addStyle(wb, onglet, titre_style, rows = 2, 
            cols = 2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = 2), footer_style <- openxlsx::createStyle(halign = "LEFT", 
            valign = "TOP", wrapText = T), if (is.null(aides_lecture)) {
            aides_lecture = ""
        } else {
            if (length(aides_lecture) > 1) {
                new_aides_lecture <- paste0("* ", aides_lecture[1])
                for (i in 2:(length(aides_lecture))) {
                  new_aides_lecture <- paste(new_aides_lecture, 
                    paste0("* ", aides_lecture[i]), sep = "\n")
                }
                aides_lecture <- new_aides_lecture
            }
            aides_lecture = paste(aides_lecture, "", sep = "\n")
        }, if (is.null(note)) {
            note <- ""
        } else {
            note <- paste0("Note > ", paste(note, "", sep = "\n"))
        }, if (is.null(lecture)) {
            lecture <- ""
        } else {
            lecture <- paste0("Lecture > ", paste(lecture, "", 
                sep = "\n"))
        }, if (is.null(champ)) {
            champ <- ""
        } else {
            champ <- paste0("Champ > ", paste(champ, "", sep = "\n"))
        }, if (is.null(sources)) {
            sources <- ""
        } else {
            sources <- paste0("Sources > ", sources)
        }, legende <- paste0(aides_lecture, note, lecture, champ, 
            sources), openxlsx::writeData(wb, onglet, legende, 
            startCol = 2, startRow = lignes_donnees[length(lignes_donnees)] + 
                2), openxlsx::mergeCells(wb, onglet, cols = c(2, 
            colonnes_donnees), rows = lignes_donnees[length(lignes_donnees)] + 
            2), openxlsx::addStyle(wb, onglet, footer_style, 
            rows = lignes_donnees[length(lignes_donnees)] + 2, 
            cols = 2), openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
            1, 10), if (!is.null(lignes_a_ajuster)) {
            for (i in 1:length(ajustements_hauteurs_lignes)) {
                if (lignes_a_ajuster[i] == "header") {
                  openxlsx::setRowHeights(wb, onglet, 2, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "noms_colonnes") {
                  openxlsx::setRowHeights(wb, onglet, 3, heights = ajustements_hauteurs_lignes[i])
                }
                else if (lignes_a_ajuster[i] == "footer") {
                  openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                    2, heights = ajustements_hauteurs_lignes[i])
                }
            }
            if (!("header" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 2, heights = 25)
            }
            if (!("noms_colonnes" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, 3, heights = 35)
            }
            if (!("footer" %in% lignes_a_ajuster)) {
                openxlsx::setRowHeights(wb, onglet, lignes_donnees[length(lignes_donnees)] + 
                  2, heights = 150)
            }
        }, if (visualiser == TRUE) {
            openxlsx::openXL(wb)
        }, if (sauvegarde == T) {
            if (is.null(fichier_destination)) {
                openxlsx::saveWorkbook(wb, fichier_source, overwrite = TRUE)
            }
            else {
                openxlsx::saveWorkbook(wb, fichier_destination, 
                  overwrite = TRUE)
            }
        }, return(wb)), list(print, "TAP"), list(print, list(
        gc, T)), list(library, dplyr), list(library, openxlsx), 
    list(library, ggplot2), list(=, TABLE_RESULTATS, list(data.frame)), 
    list(=, NB_PCR, list([, list(dim, list([, sidep_pcr, list(
        &, list(&, list(>=, list(as.Date, date_valid_init), list(
            -, list(Sys.Date), 8)), list(<=, list(as.Date, date_valid_init), 
            list(-, list(Sys.Date), 2))), list(%in%, valeur, 
            list(c, "P", "N", "I", "X"))))), 1)), list(=, NB_TAG, 
        list([, list(dim, list([, sidep_antigenique, list(&, 
            list(&, list(>=, list(as.Date, date_prelev), list(
                -, list(Sys.Date), 8)), list(<=, list(as.Date, 
                date_prelev), list(-, list(Sys.Date), 2))), list(
                %in%, valeur, list(c, "P", "N", "I", "X"))))), 
            1)), list(dim, list([, sidep_antigenique, list(&, 
        list(==, list(as.Date, date_valid_init), "2021-03-09"), 
        list(%in%, valeur, list(c, "P", "N", "I", "X"))))), list(
        =, NB_SALMIL, list([, list(dim, list([, sidep_pcr_sal_mil, 
            list(&, list(&, list(>=, list(as.Date, date_valid_init), 
                list(-, list(Sys.Date), 8)), list(<=, list(as.Date, 
                date_valid_init), list(-, list(Sys.Date), 2))), 
                list(%in%, valeur, list(c, "P", "N", "I", "X"))))), 
            1)), list(=, TABLE_RESULTATS, list(rbind, TABLE_RESULTATS, 
        list(data.frame, "Nombre de tests", list(+, list(+, NB_PCR, 
            NB_TAG), NB_SALMIL)))), list(=, PART_TAG, list(/, 
        NB_TAG, list((, list(+, list(+, NB_PCR, NB_TAG), NB_SALMIL)))), 
    list(=, TABLE_RESULTATS, list(rbind, TABLE_RESULTATS, list(
        data.frame, "Part des TAG", PART_TAG))), list(=, TABLE_RESULTATS, 
        list(rbind, TABLE_RESULTATS, list(data.frame, "Part des PCR (y compris salivaires)", 
            list(-, 1, PART_TAG)))), list(=, FILTRE_DELAI, 10), 
    list(=, t1, list(setDT, sidep_pcr)), list(=, t3, list(setDT, 
        sidep_pcr_sal_mil)), list([, t1, t1[, `:=`(delai, as.numeric(difftime(date_valid_init, 
        date_prelev, units = "days")))], list(:=, delai, list(
        as.numeric, list(difftime, date_valid_init, date_prelev, 
            "days")))), list([, t3, t3[, `:=`(delai, as.numeric(difftime(date_valid_init, 
        date_prelev, units = "days")))], list(:=, delai, list(
        as.numeric, list(difftime, date_valid_init, date_prelev, 
            "days")))), list(=, t_empilee, list(rbind, list([, 
        t1, list(&, list(&, list(&, list(>=, list(as.Date, date_valid_init), 
            list(-, list(Sys.Date), 8)), list(<=, list(as.Date, 
            date_valid_init), list(-, list(Sys.Date), 2))), list(
            >=, delai, 0)), list(<, delai, FILTRE_DELAI)), list(
            c, "delai")), list([, t3, list(&, list(&, list(&, 
        list(>=, list(as.Date, date_valid_init), list(-, list(
            Sys.Date), 8)), list(<=, list(as.Date, date_valid_init), 
            list(-, list(Sys.Date), 2))), list(>=, delai, 0)), 
        list(<, delai, FILTRE_DELAI)), list(c, "delai")))), list(
        =, TABLE_RESULTATS, list(rbind, TABLE_RESULTATS, list(
            data.frame, "Proportion des tests rendus en moins de 24h", 
            list(/, list(sum, list(<, list($, t_empilee, delai), 
                1)), list([, list(dim, t_empilee), 1))))), list(
        rm, t1, t3, t_empilee), list(=, t1, list([, sidep_pcr, 
        list(&, list(&, list(&, list(!, list(is.na, valeur)), 
            list(%in%, valeur, list(c, "P", "N"))), list(>=, 
            list(as.Date, date_valid_init), list(-, list(Sys.Date), 
                8))), list(<=, list(as.Date, date_valid_init), 
            list(-, list(Sys.Date), 2))))), list([, t1, t1[, 
        `:=`(delai, as.numeric(difftime(date_valid_init, date_prelev, 
            units = "days")))], list(:=, delai, list(as.numeric, 
        list(difftime, date_valid_init, date_prelev, "days")))), 
    list(=, t1, list([, t1, list(&, list(&, list(!, list(is.na, 
        delai)), list(>=, delai, 0)), list(<, delai, FILTRE_DELAI)))), 
    list([, t1, t1[, `:=`(symptomes, dplyr::case_when(PremierSymptomes == 
        "ASY" ~ "Asy", PremierSymptomes == "S01" ~ "0-1", PremierSymptomes == 
        "S24" ~ "2-4", PremierSymptomes == "S57" ~ "5-7", PremierSymptomes == 
        "SS2" ~ "8-15", PremierSymptomes == "SS3" ~ "> 15", PremierSymptomes == 
        "U" ~ "NR"))], list(:=, symptomes, list(list(::, dplyr, 
        case_when), list(~, list(==, PremierSymptomes, "ASY"), 
        "Asy"), list(~, list(==, PremierSymptomes, "S01"), "0-1"), 
        list(~, list(==, PremierSymptomes, "S24"), "2-4"), list(
            ~, list(==, PremierSymptomes, "S57"), "5-7"), list(
            ~, list(==, PremierSymptomes, "SS2"), "8-15"), list(
            ~, list(==, PremierSymptomes, "SS3"), "> 15"), list(
            ~, list(==, PremierSymptomes, "U"), "NR")))), list(
        [, t1, t1[, `:=`(symptomes, ifelse(is.na(symptomes), 
            "NR", symptomes))], list(:=, symptomes, list(ifelse, 
            list(is.na, symptomes), "NR", symptomes))), list(
        [, t1, t1[, `:=`(symptomes_ordre, dplyr::case_when(symptomes == 
            "Asy" ~ 1, symptomes == "0-1" ~ 2, symptomes == "2-4" ~ 
            3, symptomes == "5-7" ~ 4, symptomes == "8-15" ~ 
            5, symptomes == "> 15" ~ 6, symptomes == "NR" ~ 7))], 
        list(:=, symptomes_ordre, list(list(::, dplyr, case_when), 
            list(~, list(==, symptomes, "Asy"), 1), list(~, list(
                ==, symptomes, "0-1"), 2), list(~, list(==, symptomes, 
                "2-4"), 3), list(~, list(==, symptomes, "5-7"), 
                4), list(~, list(==, symptomes, "8-15"), 5), 
            list(~, list(==, symptomes, "> 15"), 6), list(~, 
                list(==, symptomes, "NR"), 7)))), list(=, delai_sympt_nat, 
        list([, t1, t1[, .(n = .N), by = c("symptomes", "symptomes_ordre")], 
            list(., .N), list(c, "symptomes", "symptomes_ordre"))), 
    list(=, delai_sympt_nat, list([, delai_sympt_nat, delai_sympt_nat[, 
        `:=`(N, sum(n))], list(:=, N, list(sum, n)))), list(=, 
        delai_sympt_nat, list([, delai_sympt_nat, delai_sympt_nat[, 
            `:=`(prop, n/N)], list(:=, prop, list(/, n, N)))), 
    list(setorder, delai_sympt_nat, symptomes_ordre), list(=, 
        delai_sympt_nat, list([, delai_sympt_nat, delai_sympt_nat[, 
            c("symptomes", "prop")], list(c, "symptomes", "prop"))), 
    list(setnames, delai_sympt_nat, list(c, "symptomes", "prop"), 
        list(c, "indicateur", "valeur")), list(=, TABLE_RESULTATS, 
        list(rbind, TABLE_RESULTATS, delai_sympt_nat)), list(
        write.xlsx, TABLE_RESULTATS, list(paste0, "/production/echange/sidep/codes_ccs/TAP/", 
            list(Sys.Date), " - reporting TAP.xlsx")), list(if, 
        rewrite_fichier_variants, list(list(=, tab_rattrapee, 
            list(list(::, data.table, fread), "/data1/sidep_bases_clean/bases_clean_1604/Sauvegarde variants du 15012021 au 17032021.csv", 
                "", "|", TRUE, list(list, list(c, "Pseudonyme", 
                  "Sexe", "CodePostal", "IRIS", "NumDossier", 
                  "TypologiePatient", "ProfessionelSante", "PremierSymptomes", 
                  "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
                  "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
                  "TypeAnalyse", "Resultat", "Statut", "CodePays", 
                  "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
                  "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
                  "FINESSGeographique", "NumCampagneDepistage", 
                  "Joker1", "Joker2", "Joker3"), "Age"), "Latin-1")), 
            list(list(::, assertthat, assert_that), list(==, 
                list(sum, list(!=, list(nchar, list($, tab_rattrapee, 
                  Pseudonyme)), 64)), 0), "Le Pseudonyme devrait toujours être sur 64 caractères"), 
            list(print, list(nrow, tab_rattrapee)), list(print, 
                list(nrow, list(merge, tab_rattrapee, new_rattrapage, 
                  "Pseudonyme"))), list([, tab_rattrapee, new_rattrapage, 
                list(:=, Pseudonyme, i.Pseudo2), "Pseudonyme"), 
            list(list(::, data.table, fwrite), tab_rattrapee, 
                list(paste0, path_sortie, "Sauvegarde variants du 15012021 au 17032021.csv"), 
                ".", FALSE, "|", FALSE, list(c, "escape"), "ISO", 
                TRUE))), list(print, "10"), list(=, addP2, F), 
    list(print, "variants A"), list(print, list(gc, T)), list(
        <-, path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(library, 
        tidyr), list(library, dplyr), list(library, lubridate), 
    list(library, data.table), list(library, openxlsx), list(
        library, knitr), list(library, rmarkdown), list(library, 
        kableExtra), list(library, stringi), list(library, bit64), 
    list(library, ISOweek), list(library, lest), list(library, 
        parallel), list(library, fasttime), list(if, list(!, 
        list(exists, "sidep_pcr")), list(list(=, TIME_INIT, list(
        Sys.time)), list(print, list(paste0, "lancement: ", TIME_INIT)), 
        list(<-, t1, list(Sys.time)), list(<-, temp, list(paste0, 
            path_sortie, date_AAAAMMJJ, "_sidep_pcr_")), list(
            <-, sidep_pcr, list(list(::, pbapply, pblapply), 
                MoisAAAA, list(function, list(as.pairlist(alist(i = ))), 
                  list(list(<-, dt, list(list(::, data.table, 
                    fread), list(paste0, temp, i, ".csv"), "", 
                    list(list, date_vars, posixct_vars, char_vars, 
                      "Age"), F, ";", TRUE, "Latin-1")), dt), 
                  list(3502L, 34L, 3512L, 34L, 34L, 34L, 3502L, 
                    3512L)))), list(<-, t2, list(Sys.time)), 
        list(print, list(-, t2, t1)), list(<-, t1, list(Sys.time)), 
        list(<-, sidep_pcr, list(lapply, sidep_pcr, list(function, 
            list(as.pairlist(alist(i = ))), list([, i, i[, `:=`(date_prelev = fasttime::fastPOSIXct(date_prelev), 
                date_valid = fasttime::fastPOSIXct(date_valid), 
                date_valid_init = fasttime::fastPOSIXct(date_valid_init))], 
                list(:=, list(list(::, fasttime, fastPOSIXct), 
                  date_prelev), list(list(::, fasttime, fastPOSIXct), 
                  date_valid), list(list(::, fasttime, fastPOSIXct), 
                  date_valid_init))), list(3520L, 34L, 3524L, 
                6L, 34L, 6L, 3520L, 3524L)))), list(<-, sidep_pcr, 
            list(lapply, sidep_pcr, list(function, list(as.pairlist(alist(i = ))), 
                list([, i, list(grepl, "priv", cat_etb), list(
                  :=, cat_etb, "Laboratoire privé")), list(3526L, 
                  34L, 3527L, 62L, 34L, 62L, 3526L, 3527L)))), 
        list(<-, sidep_pcr, list(rbindlist, sidep_pcr, T)), list(
            <-, t2, list(Sys.time)), list(print, list(-, t2, 
            TIME_INIT))), list(list(print, "sidep_pcr existe deja"))), 
    list(if, list(!, list(exists, "sidep_sero")), list(list(<-, 
        t1, list(Sys.time)), list(=, path_zip_sero, list(paste0, 
        path_sortie, date_AAAAMMJJ, "_sidep_sero.csv")), list(
        print, path_zip_sero), list(=, sidep_sero, list(list(
        ::, data.table, fread), path_zip_sero, "", list(list, 
        date_vars, posixct_vars, char_vars, "Age"), F, ";", TRUE, 
        "Latin-1")), list(<-, t2, list(Sys.time)), list(print, 
        list(-, t2, t1))), list(list(print, "sidep_sero existe deja"))), 
    list(if, list(!, list(exists, "sidep_pcr_sal_mil")), list(
        list(<-, t1, list(Sys.time)), list(=, path_zip_pcr_sal_mil, 
            list(paste0, path_sortie, date_AAAAMMJJ, "_sidep_pcr_salivaire_milieux_divers.csv")), 
        list(print, path_zip_pcr_sal_mil), list(=, sidep_pcr_sal_mil, 
            list(list(::, data.table, fread), path_zip_pcr_sal_mil, 
                "", list(list, date_vars, posixct_vars, char_vars, 
                  "Age"), F, ";", TRUE, "Latin-1")), list(<-, 
            t2, list(Sys.time)), list(print, list(-, t2, t1))), 
        list(list(print, "sidep_pcr_sal_mil existe deja"))), 
    list(if, list(!, list(exists, "sidep_antigen_complet")), 
        list(list(if, list(!, list(exists, "sidep_antigenique")), 
            list(list(<-, t1, list(Sys.time)), list(=, path_zip_antigen, 
                list(paste0, path_sortie, date_AAAAMMJJ, "_sidep_antigen.csv")), 
                list(print, path_zip_antigen), list(=, sidep_antigen_complet, 
                  list(list(::, data.table, fread), path_zip_antigen, 
                    "", list(list, date_vars, posixct_vars, list(
                      c, char_vars, new_tag_char_vars), "Age"), 
                    F, ";", TRUE, "Latin-1")), list(<-, t2, list(
                  Sys.time)), list(print, list(-, t2, t1))), 
            list(list(=, sidep_antigen_complet, sidep_antigenique), 
                list(rm, sidep_antigenique), list(gc)))), list(
            list(print, "sidep_antigen_complet existe deja"))), 
    list(print, "variants B"), list(print, list(gc, T)), list(
        message, "Il faut avoir chargé les bases PCR et antigéniques => le faire à partir du script 08 (sans exécuter la note)"), 
    list(=, variants_pre1803, list(list(::, data.table, fread), 
        list(paste0, path_sortie, "Sauvegarde variants du 15012021 au 17032021.csv"), 
        "", TRUE, "|", TRUE, list(list, daily_files_char_vars, 
            "Age"), "Latin-1")), list(=, liste_fichiers, list(
        dir, "/data1/sidep_brut/bases_dechiffrees/")), list(=, 
        liste_fichiers, list([, liste_fichiers, list(grep, "CSV_DREES_MED", 
            liste_fichiers))), list(=, tab_rattrapee, NULL), 
    list(=, liste_des_dates, list(gsub, "-", "", list(substr, 
        list(as.character, list(seq.Date, list(as.Date, "2021-03-18"), 
            list(Sys.Date), 1)), 3, 10))), list(=, liste_des_dates, 
        list([, liste_des_dates, list(which, list(!, list((, 
            list(%in%, liste_des_dates, list(c, "210323"))))))), 
    list(=, safe_fread, list(list(::, purrr, quietly), list(::, 
        data.table, fread))), list(for, item, liste_des_dates, 
        list(list(print, item), list(=, fichiers, list([, liste_fichiers, 
            list(grep, item, liste_fichiers))), list(=, med4, 
            list(safe_fread, list(paste0, "/data1/sidep_brut/bases_dechiffrees/", 
                list([, fichiers, list(grep, "MED4", fichiers))), 
                T, "", F, "|", TRUE, list(list, daily_files_char_vars, 
                  "Age"), "Latin-1")), list(<-, w, list($, med4, 
            warnings)), list(<-, w, list([, w, list(grepl, "^Stopped early", 
            w))), list(if, list(>, list(length, w), 0), list(
            list(stop, w))), list(<-, med4, list($, med4, result)), 
            list(=, med2, list(safe_fread, list(paste0, "/data1/sidep_brut/bases_dechiffrees/", 
                list([, fichiers, list(grep, "MED2", fichiers))), 
                T, "", F, "|", TRUE, list(list, daily_files_char_vars, 
                  "Age"), "Latin-1")), list(<-, w, list($, med2, 
                warnings)), list(<-, w, list([, w, list(grepl, 
                "^Stopped early", w))), list(if, list(>, list(
                length, w), 0), list(list(stop, w))), list(<-, 
                med2, list($, med2, result)), list(=, tab_add, 
                list(rbind, med4, med2)), list(=, tab_rattrapee, 
                list(rbind, tab_rattrapee, tab_add)))), list(
        rm, med2, med4, tab_add), list(=, tab_rattrapee, list(
        [, tab_rattrapee, list(!, list((, list(&, list(==, Joker2, 
            ""), list((, list(|, list(==, Joker3, ""), list(is.na, 
            Joker3)))))))), list([, tab_rattrapee, tab_rattrapee[, 
        `:=`(Pseudo1, NULL)], list(:=, Pseudo1, NULL)), list(
        setnames, tab_rattrapee, "Pseudo2", "Pseudonyme"), list(
        =, tab_rattrapee, list(rbind, variants_pre1803, tab_rattrapee)), 
    list(=, tab_rattrapee, list(unique, tab_rattrapee)), list(
        =, noms_sans_date_valid, list([, list(names, tab_rattrapee), 
            list(!=, list(names, tab_rattrapee), "DateValidationCR"))), 
    list([, tab_rattrapee, tab_rattrapee[, `:=`(PremiereDateValidationCRVariant, 
        as.character(min(as.numeric(DateValidationCR)))), by = noms_sans_date_valid], 
        list(:=, PremiereDateValidationCRVariant, list(as.character, 
            list(min, list(as.numeric, DateValidationCR)))), 
        noms_sans_date_valid), list(=, noms_keep, list(c, "PremiereDateValidationCRVariant", 
        noms_sans_date_valid)), list(=, aux, list([, tab_rattrapee, 
        tab_rattrapee[, ..noms_keep], ..noms_keep)), list(=, 
        tab_rattrapee, list(unique, aux)), list([, tab_rattrapee, 
        tab_rattrapee[, .(nb = .N), by = "AnalyseConclusion"], 
        list(., .N), "AnalyseConclusion"), list([, tab_rattrapee, 
        tab_rattrapee[, .(nb = .N), by = "Resultat"], list(., 
            .N), "Resultat"), list(=, noms_communs, list(intersect, 
        list(names, sidep_pcr), list(names, sidep_antigen_complet))), 
    list([, sidep_antigen_complet, sidep_antigen_complet[, `:=`(day_valid, 
        as.Date(day_valid))], list(:=, day_valid, list(as.Date, 
        day_valid))), list([, sidep_pcr, sidep_pcr[, `:=`(day_extract_sidep, 
        as.Date(day_extract_sidep))], list(:=, day_extract_sidep, 
        list(as.Date, day_extract_sidep))), list(=, sidep_base, 
        list(rbind, list([, sidep_pcr, sidep_pcr[, ..noms_communs], 
            ..noms_communs), list([, sidep_antigen_complet, sidep_antigen_complet[, 
            ..noms_communs], ..noms_communs))), list([, tab_rattrapee, 
        tab_rattrapee[, `:=`(date_prelev, lubridate::ymd_hms(paste0(substr(DatePrelevement, 
            1, 4), "-", substr(DatePrelevement, 5, 6), "-", substr(DatePrelevement, 
            7, 8), " ", substr(DatePrelevement, 9, 10), ":", 
            substr(DatePrelevement, 11, 12), ":", substr(DatePrelevement, 
                13, 14))))], list(:=, date_prelev, list(list(
            ::, lubridate, ymd_hms), list(paste0, list(substr, 
            DatePrelevement, 1, 4), "-", list(substr, DatePrelevement, 
            5, 6), "-", list(substr, DatePrelevement, 7, 8), 
            " ", list(substr, DatePrelevement, 9, 10), ":", list(
                substr, DatePrelevement, 11, 12), ":", list(substr, 
                DatePrelevement, 13, 14))))), list([, tab_rattrapee, 
        tab_rattrapee[, `:=`(num_identification, seq(.N))], list(
            :=, num_identification, list(seq, .N))), list([, 
        sidep_base, sidep_base[, `:=`(num_identification_sidep_base, 
            seq(.N))], list(:=, num_identification_sidep_base, 
            list(seq, .N))), list([, tab_rattrapee, tab_rattrapee[, 
        `:=`(indic_tab_rattrapee, 1)], list(:=, indic_tab_rattrapee, 
        1)), list([, sidep_base, sidep_base[, `:=`(indic_sidep_base, 
        1)], list(:=, indic_sidep_base, 1)), list(=, table, list(
        merge, tab_rattrapee, sidep_base, list(c, "Pseudonyme", 
            "date_prelev"), T)), list(=, out, list([, table, 
        table[, .(nb = .N), by = "num_identification"], list(
            ., .N), "num_identification")), list(setorder, out, 
        list(-, nb)), list(=, out, list([, table, table[, .(nb = .N), 
        by = "num_identification_sidep_base"], list(., .N), "num_identification_sidep_base")), 
    list(setorder, out, list(-, nb)), list([, table, table[, 
        `:=`(compte, .N), by = "num_identification_sidep_base"], 
        list(:=, compte, .N), "num_identification_sidep_base"), 
    list(=, p1, list([, table, list(==, compte, 1))), list(=, 
        aux, list([, table, list(>, compte, 1))), list(setorder, 
        aux, num_identification_sidep_base, PremiereDateValidationCRVariant), 
    list([, aux, aux[, `:=`(num_ordre, seq(.N)), by = "num_identification_sidep_base"], 
        list(:=, num_ordre, list(seq, .N)), "num_identification_sidep_base"), 
    list(=, aux, list([, aux, list(==, num_ordre, 1))), list(
        =, table, list(rbind, p1, list([, aux, aux[, !c("num_ordre")], 
            list(!, list(c, "num_ordre"))))), list(if, list(!=, 
        list([, list(dim, table), 1), list([, list(dim, sidep_base), 
            1)), list(message, "Problème d'appariemment : pas le même nombre de lignes avant/après ajout des variants")), 
    list([, table, table[, `:=`(info_sur_variant, 0)], list(:=, 
        info_sur_variant, 0)), list([, table, list(!=, num_identification, 
        ""), list(:=, info_sur_variant, 1)), list([, table, table[, 
        `:=`(check, .N), by = "num_identification"], list(:=, 
        check, .N), "num_identification"), list(table, list($, 
        table, check)), list(sum, list([, table, list(==, info_sur_variant, 
        1), list(&, list((, list(|, list(==, Joker2, ""), list(
        is.na, Joker2))), list((, list(|, list(==, Joker3, ""), 
        list(is.na, Joker3)))))), list(sum, list([, table, list(
        ==, info_sur_variant, 10), list(|, list((, list(&, list(
        !=, Joker2, ""), list(!, list(is.na, Joker2)))), list(
        (, list(&, list(!=, Joker3, ""), list(!, list(is.na, 
            Joker3))))))), list(=, out, list([, table, table[, 
        .(nb = .N), by = "info_sur_variant"], list(., .N), "info_sur_variant")), 
    list(setorder, out, list(-, nb)), out, list(=, out, list(
        [, table, table[, .(nb = .N), by = "Joker2"], list(., 
            .N), "Joker2")), list(setorder, out, list(-, nb)), 
    list([, table, table[, `:=`(date_valid_info_variant, paste0(substr(PremiereDateValidationCRVariant, 
        1, 4), "-", substr(PremiereDateValidationCRVariant, 5, 
        6), "-", substr(PremiereDateValidationCRVariant, 7, 8), 
        " ", substr(PremiereDateValidationCRVariant, 9, 10), 
        ":", substr(PremiereDateValidationCRVariant, 11, 12), 
        ":", substr(PremiereDateValidationCRVariant, 13, 14)))], 
        list(:=, date_valid_info_variant, list(paste0, list(substr, 
            PremiereDateValidationCRVariant, 1, 4), "-", list(
            substr, PremiereDateValidationCRVariant, 5, 6), "-", 
            list(substr, PremiereDateValidationCRVariant, 7, 
                8), " ", list(substr, PremiereDateValidationCRVariant, 
                9, 10), ":", list(substr, PremiereDateValidationCRVariant, 
                11, 12), ":", list(substr, PremiereDateValidationCRVariant, 
                13, 14)))), list([, table, table[, `:=`(date_valid_info_variant, 
        lubridate::ymd_hms(date_valid_info_variant))], list(:=, 
        date_valid_info_variant, list(list(::, lubridate, ymd_hms), 
            date_valid_info_variant))), list([, table, list(==, 
        info_sur_variant, 1), list(:=, delai_remontee_variant, 
        list(as.numeric, list(difftime, date_valid_info_variant, 
            date_valid_init, "days")))), list(any, list(&, list(
        ==, list($, table, info_sur_variant), 1), list(==, list(
        $, table, delai_remontee_variant), 0))), list(sum, list(
        &, list(==, list($, table, info_sur_variant), 1), list(
            ==, list($, table, delai_remontee_variant), 0))), 
    list(sum, list(==, list($, table, info_sur_variant), 1)), 
    list(/, list(sum, list(&, list(==, list($, table, info_sur_variant), 
        1), list(==, list($, table, delai_remontee_variant), 
        0))), list(sum, list(==, list($, table, info_sur_variant), 
        1))), list([, table, table[, `:=`(day_valid_init, as.Date(date_valid_init))], 
        list(:=, day_valid_init, list(as.Date, date_valid_init))), 
    list([, table, table[, `:=`(delai_classique, difftime(date_valid_init, 
        date_prelev, unit = "days"))], list(:=, delai_classique, 
        list(difftime, date_valid_init, date_prelev, "days"))), 
    list([, table, table[, `:=`(day_valid_init, as.Date(date_valid_init))], 
        list(:=, day_valid_init, list(as.Date, date_valid_init))), 
    list([, table, table[, `:=`(Joker2_recode, "")], list(:=, 
        Joker2_recode, "")), list([, table, list(==, Joker2, 
        "ABS_20I/501Y.V1-20H/501Y.V2-20J/501Y.V3"), list(:=, 
        Joker2_recode, "NON UK - NON SA - NON BR")), list([, 
        table, list(==, Joker2, "ABS_201/501Y.V1-20H/501Y.V2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1-20H/501Y.V2/20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1-20H/501Y.V2-20J/501Y.V3ABS_20I/501Y.V1-20H/501Y.V2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1-20J/501Y.V3-20H/501Y.V2"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABSVA"), list(:=, Joker2_recode, 
        "NON UK - NON SA - NON BR")), list([, table, list(==, 
        Joker2, "ABSV"), list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "Sars-CoV-2 pos (absence de lignage 20I/501Y.V1 et 20H/501Y.V2 et 20J/501Y.V3)"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1 20H/501Y.V2 20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1-20H/501YV2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501V1-20H/501Y.V2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "NON UK - NON SA - NON BR")), 
    list([, table, list(==, Joker2, "ABS_20I/501Y.V1-20H/501Y.V2"), 
        list(:=, Joker2_recode, "NON UK - NON SA")), list([, 
        table, list(==, Joker2, "ABS_201/501Y.V1-20H/501Y.V2"), 
        list(:=, Joker2_recode, "NON UK - NON SA")), list([, 
        table, list(==, Joker2, "ABS_20I/501Y.V1"), list(:=, 
            Joker2_recode, "NON UK")), list([, table, list(==, 
        Joker2, "ABS_20l/501Y.V1"), list(:=, Joker2_recode, "NON UK")), 
    list([, table, list(==, Joker2, "ABS_20H/501Y.V2"), list(
        :=, Joker2_recode, "NON SA")), list([, table, list(==, 
        Joker2, "ABS_20J/501Y.V3"), list(:=, Joker2_recode, "NON BR")), 
    list([, table, list(==, Joker2, "PCR_20I/501Y.V1"), list(
        :=, Joker2_recode, "OUI UK")), list([, table, list(==, 
        Joker2, "PCR_20H/501Y.V1"), list(:=, Joker2_recode, "OUI UK")), 
    list([, table, list(==, Joker2, "PCR_20I/501Y.V1PCR_20I/501Y.V1"), 
        list(:=, Joker2_recode, "OUI UK")), list([, table, list(
        ==, Joker2, "PCR_20l/501Y.V1"), list(:=, Joker2_recode, 
        "OUI UK")), list([, table, list(==, Joker2, "PCR_201/501Y.V1"), 
        list(:=, Joker2_recode, "OUI UK")), list([, table, list(
        ==, Joker2, "PCR_ 20I/501Y.V1"), list(:=, Joker2_recode, 
        "OUI UK")), list([, table, list(==, Joker2, "ANGLP"), 
        list(:=, Joker2_recode, "OUI UK")), list([, table, list(
        ==, Joker2, "PCR_20H/501Y.V2"), list(:=, Joker2_recode, 
        "OUI SA")), list([, table, list(==, Joker2, "PCR_20H/501Y.V2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "OUI SA ou BR")), list([, table, 
        list(==, Joker2, "PCR_20I/501Y.V1-20H/501Y.V2-20J/501Y.V3"), 
        list(:=, Joker2_recode, "OUI UK ou SA ou BR")), list(
        [, table, list(==, Joker2, "PREL_NC"), list(:=, Joker2_recode, 
            "Non conforme")), list([, table, list(==, Joker2, 
        "le prélèvement n'a pas permis de réaliser la recherche de variant."), 
        list(:=, Joker2_recode, "Non conforme")), list([, table, 
        list(==, Joker2, "VAR_IND"), list(:=, Joker2_recode, 
            "Indéterminé")), list([, table, list(==, Joker2, 
        "IND"), list(:=, Joker2_recode, "Indéterminé")), list(
        [, table, list(==, Joker2, "INDET"), list(:=, Joker2_recode, 
            "Indéterminé")), list([, table, list(==, Joker2, 
        "VAR_SUSP"), list(:=, Joker2_recode, "Suspicion")), list(
        [, table, list(==, Joker2, "SUSP_VAR"), list(:=, Joker2_recode, 
            "Suspicion")), list([, table, list(==, Joker2, "SUSP"), 
        list(:=, Joker2_recode, "Suspicion")), list([, table, 
        list(==, Joker2, "SUSPICION"), list(:=, Joker2_recode, 
            "Suspicion")), list([, table, list(==, Joker2, "var_susp"), 
        list(:=, Joker2_recode, "Suspicion")), list([, table, 
        list(==, Joker2, "VAR_SUS"), list(:=, Joker2_recode, 
            "Suspicion")), list([, table, list(==, Joker2, "Présence d'un variant suspectée"), 
        list(:=, Joker2_recode, "Suspicion")), list(sum, list(
        &, list(&, list(!=, list($, table, Joker2), ""), list(
            ==, list($, table, Joker2_recode), "")), list(==, 
            list($, table, info_sur_variant), 1))), list(/, list(
        sum, list(&, list(&, list(!=, list($, table, Joker2), 
            ""), list(==, list($, table, Joker2_recode), "")), 
            list(==, list($, table, info_sur_variant), 1))), 
        list(sum, list(&, list(!=, list($, table, Joker2), ""), 
            list(==, list($, table, info_sur_variant), 1)))), 
    list(=, aux, list([, table, list(&, list(!=, Joker2, ""), 
        list(==, Joker2_recode, "")))), list(=, out, list([, 
        aux, aux[, .(nb = .N), by = "Joker2"], list(., .N), "Joker2")), 
    list(setorder, out, list(-, nb)), list([, table, list(&, 
        list(==, Joker2_recode, ""), list(==, info_sur_variant, 
            1)), list(:=, Joker2_recode, "Joker2 manquant ou non recodable")), 
    list(=, out, list([, table, table[, .(nb = .N), by = "Joker2_recode"], 
        list(., .N), "Joker2_recode")), list(setorder, out, list(
        -, nb)), list([, table, table[, `:=`(Joker2_simplifie, 
        "")], list(:=, Joker2_simplifie, "")), list([, table, 
        list(%in%, Joker2_recode, list(c, "OUI UK", "OUI SA ou BR", 
            "OUI UK ou SA ou BR", "OUI SA")), list(:=, Joker2_simplifie, 
            "Oui")), list([, table, list(%in%, Joker2_recode, 
        list(c, "NON UK", "NON UK - NON SA", "NON UK - NON SA - NON BR")), 
        list(:=, Joker2_simplifie, "Non")), list([, table, list(
        %in%, Joker2_recode, list(c, "Suspicion")), list(:=, 
        Joker2_simplifie, "Suspicion")), list([, table, list(
        %in%, Joker2_recode, list(c, "Non conforme")), list(:=, 
        Joker2_simplifie, "Non conforme")), list([, table, list(
        %in%, Joker2_recode, list(c, "Indéterminé")), list(:=, 
        Joker2_simplifie, "Indéterminé")), list([, table, list(
        %in%, Joker2_recode, list(c, "Joker2 manquant ou non recodable")), 
        list(:=, Joker2_simplifie, "Non recodable")), list(=, 
        out2, list([, table, table[, .(nb = .N), by = "Joker2_simplifie"], 
            list(., .N), "Joker2_simplifie")), list(setorder, 
        out2, list(-, nb)), list(=, out, list([, table, list(
        ==, valeur, "N"), list(., .N), "Joker2_simplifie")), 
    list(setorder, out, list(-, nb)), list(=, out, list([, table, 
        list(==, valeur, "P"), list(., .N), "Joker2_simplifie")), 
    list(setorder, out, list(-, nb)), list(print, "variants C"), 
    list(print, list(gc, T)), list(=, tg_pcr, list([, table, 
        list(&, list(!, list(is.na, valeur)), list(==, AnalyseConclusion.y, 
            "94500-6")))), list(=, tg_pcr, list([, tg_pcr, tg_pcr[, 
        .(nb_tot = sum(valeur %in% c("P", "N", "I", "X")), nb_positifs = sum(valeur == 
            "P"), nb_info_variant = sum(info_sur_variant == 1 & 
            valeur == "P"), nb_variant_oui = sum(Joker2_simplifie == 
            "Oui" & valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
        by = c("day_valid_init")], list(., list(sum, list(%in%, 
        valeur, list(c, "P", "N", "I", "X"))), list(sum, list(
        ==, valeur, "P")), list(sum, list(&, list(==, info_sur_variant, 
        1), list(==, valeur, "P"))), list(sum, list(&, list(==, 
        Joker2_simplifie, "Oui"), list(==, valeur, "P"))), list(
        sum, list(&, list(==, Joker2_simplifie, "Non"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Suspicion"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non conforme"), list(==, 
            valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Indéterminé"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non recodable"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_recode, 
        "OUI UK"), list(==, valeur, "P"))), list(sum, list(&, 
        list(==, Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
            "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
        list(c, "OUI SA", "OUI UK ou SA ou BR")), list(==, valeur, 
        "P")))), list(c, "day_valid_init"))), list(=, wb, list(
        createWorkbook)), list(addWorksheet, wb, "PCR only"), 
    list(writeData, wb, "PCR only", tg_pcr), list(list(::, openxlsx, 
        saveWorkbook), wb, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - table_pcr_variants.xlsx"), T), list(
        <-, somme_7j, list(function, list(as.pairlist(alist(x = ))), 
            list(list(<-, res, list(ifelse, list(is.na, list(
                list(::, data.table, shift), x, 6)), NA, list(
                +, list(+, list(+, list(+, list(+, list(+, x, 
                  list(list(::, data.table, shift), x, 1)), list(
                  list(::, data.table, shift), x, 2)), list(list(
                  ::, data.table, shift), x, 3)), list(list(::, 
                  data.table, shift), x, 4)), list(list(::, data.table, 
                  shift), x, 5)), list(list(::, data.table, shift), 
                  x, 6)))), list(return, res)), list(3782L, 13L, 
                3792L, 1L, 13L, 1L, 3782L, 3792L))), list(setorder, 
        tg_pcr, day_valid_init), list([, tg_pcr, tg_pcr[, `:=`("Taux de positivité - PCR" = somme_7j(nb_positifs)/somme_7j(nb_tot), 
        "Proportion de criblés parmi les positifs - PCR" = (somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc))/somme_7j(nb_positifs), 
        "Proportion de variant parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant UK parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_uk)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant SA ou BR parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_sa_ou_br)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant autre parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui_autre) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(-, list(
            -, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))))), list(=, tg, list([, table, 
        list(!, list(is.na, valeur)))), list(=, tg, list([, tg, 
        tg[, .(nb_tot = sum(valeur %in% c("P", "N", "I", "X")), 
            nb_positifs = sum(valeur == "P"), nb_info_variant = sum(info_sur_variant == 
                1 & valeur == "P"), nb_variant_oui = sum(Joker2_simplifie == 
                "Oui" & valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
                "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
                "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
                "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
                "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
                "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
                "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
                "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
                c("OUI SA", "OUI UK ou SA ou BR") & valeur == 
                "P")), by = c("day_valid_init")], list(., list(
            sum, list(%in%, valeur, list(c, "P", "N", "I", "X"))), 
            list(sum, list(==, valeur, "P")), list(sum, list(
                &, list(==, info_sur_variant, 1), list(==, valeur, 
                  "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
                "Oui"), list(==, valeur, "P"))), list(sum, list(
                &, list(==, Joker2_simplifie, "Non"), list(==, 
                  valeur, "P"))), list(sum, list(&, list(==, 
                Joker2_simplifie, "Suspicion"), list(==, valeur, 
                "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
                "Non conforme"), list(==, valeur, "P"))), list(
                sum, list(&, list(==, Joker2_simplifie, "Indéterminé"), 
                  list(==, valeur, "P"))), list(sum, list(&, 
                list(==, Joker2_simplifie, "Non recodable"), 
                list(==, valeur, "P"))), list(sum, list(&, list(
                ==, Joker2_recode, "OUI UK"), list(==, valeur, 
                "P"))), list(sum, list(&, list(==, Joker2_recode, 
                "OUI SA ou BR"), list(==, valeur, "P"))), list(
                sum, list(&, list(%in%, Joker2_recode, list(c, 
                  "OUI SA", "OUI UK ou SA ou BR")), list(==, 
                  valeur, "P")))), list(c, "day_valid_init"))), 
    list(=, wb, list(createWorkbook)), list(addWorksheet, wb, 
        "PCR et TAG"), list(writeData, wb, "PCR et TAG", tg), 
    list(list(::, openxlsx, saveWorkbook), wb, list(paste0, path, 
        "data/sorties/variants/", list(Sys.Date), " - table_tot_variants.xlsx"), 
        T), list(setorder, tg, day_valid_init), list([, tg, tg[, 
        `:=`("Taux de positivité" = somme_7j(nb_positifs)/somme_7j(nb_tot))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(=, tg_all, list(merge, 
        list([, tg, tg[, c("day_valid_init", "Taux de positivité")], 
            list(c, "day_valid_init", "Taux de positivité")), 
        list([, tg_pcr, tg_pcr[, c("day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
            "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
            "Proportion de variant autre parmi les positifs criblés - PCR", 
            "Proportion de criblés parmi les positifs - PCR")], 
            list(c, "day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
                "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
                "Proportion de variant autre parmi les positifs criblés - PCR", 
                "Proportion de criblés parmi les positifs - PCR")))), 
    list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant UK, 
        Proportion de variant UK parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant UK, 
        list(*, Proportion de variant UK parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant SA ou BR, 
        Proportion de variant SA ou BR parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant SA ou BR, 
        list(*, Proportion de variant SA ou BR parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant autre, 
        Proportion de variant autre parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant autre, 
        list(*, Proportion de variant autre parmi les positifs criblés - PCR, 
            Taux de positivité))), list(setnames, tg_all, "Proportion de criblés parmi les positifs - PCR", 
        "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage"), 
    list([, tg_all, tg_all[, `:=`(Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
        Proportion des tests RT-PCR positifs faisant l'objet d'un criblage * 
            8/60)], list(:=, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
        list(/, list(*, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage, 
            8), 60))), list(=, graphique_decomp_tp_fra_hebdo, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(+, list(+, list(+, list(+, list(ggplot), 
                list(geom_bar, list(melt, list([, tg_all, list(
                  &, list(>=, day_valid_init, "2021-01-31"), 
                  list(<=, day_valid_init, list(-, list(Sys.Date), 
                    2))), list(c, "day_valid_init", "dont estimation du TP attribuable au variant UK", 
                  "dont estimation du TP attribuable au variant SA ou BR", 
                  "dont estimation du TP attribuable au variant autre")), 
                  "day_valid_init"), list(aes, day_valid_init, 
                  value, variable, variable), "identity", 0.5)), 
                list(geom_line, list(melt, list([, tg_all, list(
                  &, list(>=, day_valid_init, "2021-01-01"), 
                  list(<=, day_valid_init, list(-, list(Sys.Date), 
                    1))), list(c, "day_valid_init", "Taux de positivité", 
                  "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage\n(échelle de droite)")), 
                  "day_valid_init", 1.1), list(aes, day_valid_init, 
                  value, variable, variable))), list(theme_minimal)), 
                list(theme, "bottom", list(element_blank), list(
                  element_blank), list(element_text, 0.5, 10), 
                  list(element_text, 0.5, 8), list(element_text, 
                    0, 8), list(element_text, 8))), list(xlab, 
                "Date de validation du résultat du test de première intention")), 
            list(guides, list(guide_legend, 3), list(guide_legend, 
                3))), list(scale_fill_manual, list(list(::, wesanderson, 
            wes_palette), "Darjeeling1"))), list(scale_color_manual, 
            list(c, list(rgb, 0, 0, list(/, 128, 255)), list(
                rgb, 1, list(/, 204, 255), 0), list(rgb, 1, list(
                /, 102, 255), 0)))), list(labs, "Evolution du taux de positivité des tests (RT-PCR et TAg, non dédoublonnés)\net des informations issues du criblage", 
            "Moyennes hebdomadaires glissantes", "A partir des résultats obtenus sur les tests RT-PCR positifs criblés, on réalise une estimation de la décomposition du taux de positivité entre\nles différents variants. Cela repose sur l'hypothèse que les tests actuellement criblés sont effectivement représentatifs de l'ensemble des tests.")), 
            list(scale_y_continuous, list(::, scales, percent), 
                list(sec_axis, list(~, list(/, list(*, ., 60), 
                  8)), list(::, scales, percent)))), list(geom_vline, 
            list(-, list(Sys.Date), 4), "dotted"))), graphique_decomp_tp_fra_hebdo, 
    list(ggsave, graphique_decomp_tp_fra_hebdo, list(paste0, 
        path, "data/sorties/variants/", list(Sys.Date), " - graphique_decomp_tp_fra_hebdo.jpg"), 
        8, 5, 800), list(setorder, table, nom_dep), list(=, LISTE_DEP, 
        list(na.omit, list(unique, list($, table, nom_dep)))), 
    list(pdf, list(paste0, path, "data/sorties/variants/", list(
        Sys.Date), " - decomposition_tp_par_departement.pdf")), 
    list(for, DEP, LISTE_DEP, list(list(=, tg_pcr, list([, table, 
        list(&, list(&, list(!, list(is.na, valeur)), list(==, 
            AnalyseConclusion.y, "94500-6")), list(==, nom_dep, 
            DEP)))), list(=, tg_pcr, list([, tg_pcr, tg_pcr[, 
        .(nb_tot = sum(valeur %in% c("P", "N", "I", "X")), nb_positifs = sum(valeur == 
            "P"), nb_info_variant = sum(info_sur_variant == 1 & 
            valeur == "P"), nb_variant_oui = sum(Joker2_simplifie == 
            "Oui" & valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
        by = c("day_valid_init")], list(., list(sum, list(%in%, 
        valeur, list(c, "P", "N", "I", "X"))), list(sum, list(
        ==, valeur, "P")), list(sum, list(&, list(==, info_sur_variant, 
        1), list(==, valeur, "P"))), list(sum, list(&, list(==, 
        Joker2_simplifie, "Oui"), list(==, valeur, "P"))), list(
        sum, list(&, list(==, Joker2_simplifie, "Non"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Suspicion"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non conforme"), list(==, 
            valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Indéterminé"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non recodable"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_recode, 
        "OUI UK"), list(==, valeur, "P"))), list(sum, list(&, 
        list(==, Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
            "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
        list(c, "OUI SA", "OUI UK ou SA ou BR")), list(==, valeur, 
        "P")))), list(c, "day_valid_init"))), list(setorder, 
        tg_pcr, day_valid_init), list([, tg_pcr, tg_pcr[, `:=`("Taux de positivité - PCR" = somme_7j(nb_positifs)/somme_7j(nb_tot), 
        "Proportion de criblés parmi les positifs - PCR" = (somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc))/somme_7j(nb_positifs), 
        "Proportion de variant parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant UK parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_uk)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant SA ou BR parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_sa_ou_br)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant autre parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui_autre) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(-, list(
            -, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))))), list(=, tg, list([, table, 
        list(&, list(!, list(is.na, valeur)), list(==, nom_dep, 
            DEP)))), list(=, tg, list([, tg, tg[, .(nb_tot = sum(valeur %in% 
        c("P", "N", "I", "X")), nb_positifs = sum(valeur == "P"), 
        nb_info_variant = sum(info_sur_variant == 1 & valeur == 
            "P"), nb_variant_oui = sum(Joker2_simplifie == "Oui" & 
            valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
        by = c("day_valid_init")], list(., list(sum, list(%in%, 
        valeur, list(c, "P", "N", "I", "X"))), list(sum, list(
        ==, valeur, "P")), list(sum, list(&, list(==, info_sur_variant, 
        1), list(==, valeur, "P"))), list(sum, list(&, list(==, 
        Joker2_simplifie, "Oui"), list(==, valeur, "P"))), list(
        sum, list(&, list(==, Joker2_simplifie, "Non"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Suspicion"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non conforme"), list(==, 
            valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Indéterminé"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non recodable"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_recode, 
        "OUI UK"), list(==, valeur, "P"))), list(sum, list(&, 
        list(==, Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
            "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
        list(c, "OUI SA", "OUI UK ou SA ou BR")), list(==, valeur, 
        "P")))), list(c, "day_valid_init"))), list(setorder, 
        tg, day_valid_init), list([, tg, tg[, `:=`("Taux de positivité" = somme_7j(nb_positifs)/somme_7j(nb_tot))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(=, tg_all, list(merge, 
        list([, tg, tg[, c("day_valid_init", "Taux de positivité")], 
            list(c, "day_valid_init", "Taux de positivité")), 
        list([, tg_pcr, tg_pcr[, c("day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
            "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
            "Proportion de variant autre parmi les positifs criblés - PCR", 
            "Proportion de criblés parmi les positifs - PCR")], 
            list(c, "day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
                "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
                "Proportion de variant autre parmi les positifs criblés - PCR", 
                "Proportion de criblés parmi les positifs - PCR")), 
        T)), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant UK, 
        Proportion de variant UK parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant UK, 
        list(*, Proportion de variant UK parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant SA ou BR, 
        Proportion de variant SA ou BR parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant SA ou BR, 
        list(*, Proportion de variant SA ou BR parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant autre, 
        Proportion de variant autre parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant autre, 
        list(*, Proportion de variant autre parmi les positifs criblés - PCR, 
            Taux de positivité))), list(setnames, tg_all, "Proportion de criblés parmi les positifs - PCR", 
        "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage"), 
        list([, tg_all, tg_all[, `:=`(Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
            Proportion des tests RT-PCR positifs faisant l'objet d'un criblage * 
                8/60)], list(:=, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
            list(/, list(*, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage, 
                8), 60))), list(print, list(+, list(+, list(+, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                +, list(+, list(ggplot), list(geom_bar, list(
                  melt, list([, tg_all, list(&, list(>=, day_valid_init, 
                    "2021-01-31"), list(<=, day_valid_init, list(
                    -, list(Sys.Date), 2))), list(c, "day_valid_init", 
                    "dont estimation du TP attribuable au variant UK", 
                    "dont estimation du TP attribuable au variant SA ou BR", 
                    "dont estimation du TP attribuable au variant autre")), 
                  "day_valid_init"), list(aes, day_valid_init, 
                  value, variable, variable), "identity", 0.5)), 
                list(geom_line, list(melt, list([, tg_all, list(
                  &, list(>=, day_valid_init, "2021-01-01"), 
                  list(<=, day_valid_init, list(-, list(Sys.Date), 
                    1))), list(c, "day_valid_init", "Taux de positivité", 
                  "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage\n(échelle de droite)")), 
                  "day_valid_init", 1.1), list(aes, day_valid_init, 
                  value, variable, variable))), list(theme_minimal)), 
                list(theme, "bottom", list(element_blank), list(
                  element_blank), list(element_text, 0.5, 10), 
                  list(element_text, 0.5, 8), list(element_text, 
                    0, 8), list(element_text, 8), list(element_text, 
                    6))), list(xlab, "Date de validation du résultat du test de première intention")), 
                list(guides, list(guide_legend, 3), list(guide_legend, 
                  3))), list(scale_fill_manual, list(list(::, 
                wesanderson, wes_palette), "Darjeeling1"))), 
                list(scale_color_manual, list(c, list(rgb, 0, 
                  0, list(/, 128, 255)), list(rgb, 1, list(/, 
                  204, 255), 0), list(rgb, 1, list(/, 102, 255), 
                  0)))), list(labs, "Evolution du taux de positivité des tests (RT-PCR et TAg, non dédoublonnés)\net des informations issues du criblage", 
                list(paste0, "Département ", DEP, " - Moyennes hebdomadaires glissantes"), 
                "A partir des résultats obtenus sur les tests RT-PCR positifs criblés, on réalise une estimation de la décomposition\ndu taux de positivité entre les différents variants. Cela repose sur l'hypothèse que les tests actuellement\ncriblés sont effectivement représentatifs de l'ensemble des tests.")), 
            list(scale_y_continuous, list(::, scales, percent), 
                list(sec_axis, list(~, list(/, list(*, ., 60), 
                  8)), list(::, scales, percent)))), list(geom_vline, 
            list(-, list(Sys.Date), 4), "dotted"))))), list(dev.off), 
    list(=, LISTE_REG, list(na.omit, list(unique, list($, table, 
        nom_reg)))), list(=, LISTE_REG, list([, LISTE_REG, list(
        order, LISTE_REG))), list(pdf, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - decomposition_tp_par_region.pdf")), 
    list(for, REG, LISTE_REG, list(list(=, tg_pcr, list([, table, 
        list(&, list(&, list(!, list(is.na, valeur)), list(==, 
            AnalyseConclusion.y, "94500-6")), list(==, nom_reg, 
            REG)))), list(=, tg_pcr, list([, tg_pcr, tg_pcr[, 
        .(nb_tot = sum(valeur %in% c("P", "N", "I", "X")), nb_positifs = sum(valeur == 
            "P"), nb_info_variant = sum(info_sur_variant == 1 & 
            valeur == "P"), nb_variant_oui = sum(Joker2_simplifie == 
            "Oui" & valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
        by = c("day_valid_init")], list(., list(sum, list(%in%, 
        valeur, list(c, "P", "N", "I", "X"))), list(sum, list(
        ==, valeur, "P")), list(sum, list(&, list(==, info_sur_variant, 
        1), list(==, valeur, "P"))), list(sum, list(&, list(==, 
        Joker2_simplifie, "Oui"), list(==, valeur, "P"))), list(
        sum, list(&, list(==, Joker2_simplifie, "Non"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Suspicion"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non conforme"), list(==, 
            valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Indéterminé"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non recodable"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_recode, 
        "OUI UK"), list(==, valeur, "P"))), list(sum, list(&, 
        list(==, Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
            "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
        list(c, "OUI SA", "OUI UK ou SA ou BR")), list(==, valeur, 
        "P")))), list(c, "day_valid_init"))), list(setorder, 
        tg_pcr, day_valid_init), list([, tg_pcr, tg_pcr[, `:=`("Taux de positivité - PCR" = somme_7j(nb_positifs)/somme_7j(nb_tot), 
        "Proportion de criblés parmi les positifs - PCR" = (somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc))/somme_7j(nb_positifs), 
        "Proportion de variant parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant UK parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_uk)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant SA ou BR parmi les positifs criblés - PCR" = somme_7j(nb_variant_oui_sa_ou_br)/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)), 
        "Proportion de variant autre parmi les positifs criblés - PCR" = (somme_7j(nb_variant_oui_autre) + 
            somme_7j(nb_variant_suspicion) + somme_7j(nb_variant_indet))/(somme_7j(nb_info_variant) - 
            somme_7j(nb_variant_non_recodable) - somme_7j(nb_variant_nc)))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(-, list(
            -, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list((, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(/, list((, list(+, list(
            +, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list((, list(-, list(-, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))))), list(=, tg, list([, table, 
        list(&, list(!, list(is.na, valeur)), list(==, nom_reg, 
            REG)))), list(=, tg, list([, tg, tg[, .(nb_tot = sum(valeur %in% 
        c("P", "N", "I", "X")), nb_positifs = sum(valeur == "P"), 
        nb_info_variant = sum(info_sur_variant == 1 & valeur == 
            "P"), nb_variant_oui = sum(Joker2_simplifie == "Oui" & 
            valeur == "P"), nb_variant_non = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
        by = c("day_valid_init")], list(., list(sum, list(%in%, 
        valeur, list(c, "P", "N", "I", "X"))), list(sum, list(
        ==, valeur, "P")), list(sum, list(&, list(==, info_sur_variant, 
        1), list(==, valeur, "P"))), list(sum, list(&, list(==, 
        Joker2_simplifie, "Oui"), list(==, valeur, "P"))), list(
        sum, list(&, list(==, Joker2_simplifie, "Non"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Suspicion"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non conforme"), list(==, 
            valeur, "P"))), list(sum, list(&, list(==, Joker2_simplifie, 
        "Indéterminé"), list(==, valeur, "P"))), list(sum, list(
        &, list(==, Joker2_simplifie, "Non recodable"), list(
            ==, valeur, "P"))), list(sum, list(&, list(==, Joker2_recode, 
        "OUI UK"), list(==, valeur, "P"))), list(sum, list(&, 
        list(==, Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
            "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
        list(c, "OUI SA", "OUI UK ou SA ou BR")), list(==, valeur, 
        "P")))), list(c, "day_valid_init"))), list(setorder, 
        tg, day_valid_init), list([, tg, tg[, `:=`("Taux de positivité" = somme_7j(nb_positifs)/somme_7j(nb_tot))], 
        list(:=, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))))), list(=, tg_all, list(merge, 
        list([, tg, tg[, c("day_valid_init", "Taux de positivité")], 
            list(c, "day_valid_init", "Taux de positivité")), 
        list([, tg_pcr, tg_pcr[, c("day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
            "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
            "Proportion de variant autre parmi les positifs criblés - PCR", 
            "Proportion de criblés parmi les positifs - PCR")], 
            list(c, "day_valid_init", "Proportion de variant UK parmi les positifs criblés - PCR", 
                "Proportion de variant SA ou BR parmi les positifs criblés - PCR", 
                "Proportion de variant autre parmi les positifs criblés - PCR", 
                "Proportion de criblés parmi les positifs - PCR")), 
        T)), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant UK, 
        Proportion de variant UK parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant UK, 
        list(*, Proportion de variant UK parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant SA ou BR, 
        Proportion de variant SA ou BR parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant SA ou BR, 
        list(*, Proportion de variant SA ou BR parmi les positifs criblés - PCR, 
            Taux de positivité))), list([, tg_all, tg_all[, `:=`(dont estimation du TP attribuable au variant autre, 
        Proportion de variant autre parmi les positifs criblés - PCR * 
            Taux de positivité)], list(:=, dont estimation du TP attribuable au variant autre, 
        list(*, Proportion de variant autre parmi les positifs criblés - PCR, 
            Taux de positivité))), list(setnames, tg_all, "Proportion de criblés parmi les positifs - PCR", 
        "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage"), 
        list([, tg_all, tg_all[, `:=`(Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
            Proportion des tests RT-PCR positifs faisant l'objet d'un criblage * 
                8/60)], list(:=, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage
(échelle de droite), 
            list(/, list(*, Proportion des tests RT-PCR positifs faisant l'objet d'un criblage, 
                8), 60))), list(print, list(+, list(+, list(+, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                +, list(+, list(ggplot), list(geom_bar, list(
                  melt, list([, tg_all, list(&, list(>=, day_valid_init, 
                    "2021-01-31"), list(<=, day_valid_init, list(
                    -, list(Sys.Date), 2))), list(c, "day_valid_init", 
                    "dont estimation du TP attribuable au variant UK", 
                    "dont estimation du TP attribuable au variant SA ou BR", 
                    "dont estimation du TP attribuable au variant autre")), 
                  "day_valid_init"), list(aes, day_valid_init, 
                  value, variable, variable), "identity", 0.5)), 
                list(geom_line, list(melt, list([, tg_all, list(
                  &, list(>=, day_valid_init, "2021-01-01"), 
                  list(<=, day_valid_init, list(-, list(Sys.Date), 
                    1))), list(c, "day_valid_init", "Taux de positivité", 
                  "Proportion des tests RT-PCR positifs faisant l'objet d'un criblage\n(échelle de droite)")), 
                  "day_valid_init", 1.1), list(aes, day_valid_init, 
                  value, variable, variable))), list(theme_minimal)), 
                list(theme, "bottom", list(element_blank), list(
                  element_blank), list(element_text, 0.5, 10), 
                  list(element_text, 0.5, 8), list(element_text, 
                    0, 8), list(element_text, 8), list(element_text, 
                    6))), list(xlab, "Date de validation du résultat du test de première intention")), 
                list(guides, list(guide_legend, 3), list(guide_legend, 
                  3))), list(scale_fill_manual, list(list(::, 
                wesanderson, wes_palette), "Darjeeling1"))), 
                list(scale_color_manual, list(c, list(rgb, 0, 
                  0, list(/, 128, 255)), list(rgb, 1, list(/, 
                  204, 255), 0), list(rgb, 1, list(/, 102, 255), 
                  0)))), list(labs, "Evolution du taux de positivité des tests (RT-PCR et TAg, non dédoublonnés)\net des informations issues du criblage", 
                list(paste0, "Région ", REG, " - Moyennes hebdomadaires glissantes"), 
                "A partir des résultats obtenus sur les tests RT-PCR positifs criblés, on réalise une estimation de la décomposition\ndu taux de positivité entre les différents variants. Cela repose sur l'hypothèse que les tests actuellement\ncriblés sont effectivement représentatifs de l'ensemble des tests.")), 
            list(scale_y_continuous, list(::, scales, percent), 
                list(sec_axis, list(~, list(/, list(*, ., 60), 
                  8)), list(::, scales, percent)))), list(geom_vline, 
            list(-, list(Sys.Date), 4), "dotted"))))), list(dev.off), 
    list(print, "variants D"), list(print, list(gc, T)), list(
        =, tg_pcr, list([, table, list(&, list(&, list(!, list(
            is.na, valeur)), list(==, AnalyseConclusion.y, "94500-6")), 
            list(>=, day_valid_init, "2021-01-01")))), list(=, 
        tg_pcr, list([, tg_pcr, tg_pcr[, .(nb_pos_pcr = sum(valeur == 
            "P"), nb_info_variant_pcr = sum(info_sur_variant == 
            1 & valeur == "P"), nb_variant_oui_pcr = sum(Joker2_simplifie == 
            "Oui" & valeur == "P"), nb_variant_non_pcr = sum(Joker2_simplifie == 
            "Non" & valeur == "P"), nb_variant_suspicion_pcr = sum(Joker2_simplifie == 
            "Suspicion" & valeur == "P"), nb_variant_nc_pcr = sum(Joker2_simplifie == 
            "Non conforme" & valeur == "P"), nb_variant_indet_pcr = sum(Joker2_simplifie == 
            "Indéterminé" & valeur == "P"), nb_variant_non_recodable_pcr = sum(Joker2_simplifie == 
            "Non recodable" & valeur == "P"), nb_variant_oui_uk_pcr = sum(Joker2_recode == 
            "OUI UK" & valeur == "P"), nb_variant_oui_sa_ou_br_pcr = sum(Joker2_recode == 
            "OUI SA ou BR" & valeur == "P"), nb_variant_oui_autre_pcr = sum(Joker2_recode %in% 
            c("OUI SA", "OUI UK ou SA ou BR") & valeur == "P")), 
            by = c("nom_dep", "departement", "day_valid_init")], 
            list(., list(sum, list(==, valeur, "P")), list(sum, 
                list(&, list(==, info_sur_variant, 1), list(==, 
                  valeur, "P"))), list(sum, list(&, list(==, 
                Joker2_simplifie, "Oui"), list(==, valeur, "P"))), 
                list(sum, list(&, list(==, Joker2_simplifie, 
                  "Non"), list(==, valeur, "P"))), list(sum, 
                  list(&, list(==, Joker2_simplifie, "Suspicion"), 
                    list(==, valeur, "P"))), list(sum, list(&, 
                  list(==, Joker2_simplifie, "Non conforme"), 
                  list(==, valeur, "P"))), list(sum, list(&, 
                  list(==, Joker2_simplifie, "Indéterminé"), 
                  list(==, valeur, "P"))), list(sum, list(&, 
                  list(==, Joker2_simplifie, "Non recodable"), 
                  list(==, valeur, "P"))), list(sum, list(&, 
                  list(==, Joker2_recode, "OUI UK"), list(==, 
                    valeur, "P"))), list(sum, list(&, list(==, 
                  Joker2_recode, "OUI SA ou BR"), list(==, valeur, 
                  "P"))), list(sum, list(&, list(%in%, Joker2_recode, 
                  list(c, "OUI SA", "OUI UK ou SA ou BR")), list(
                  ==, valeur, "P")))), list(c, "nom_dep", "departement", 
                "day_valid_init"))), list(=, tg, list([, table, 
        list(&, list(!, list(is.na, valeur)), list(>=, day_valid_init, 
            "2021-01-01")))), list(=, tg, list([, tg, tg[, .(nb_tot_pcr_tag = sum(valeur %in% 
        c("P", "N", "I", "X")), nb_positifs_pcr_tag = sum(valeur == 
        "P")), by = c("nom_dep", "departement", "day_valid_init")], 
        list(., list(sum, list(%in%, valeur, list(c, "P", "N", 
            "I", "X"))), list(sum, list(==, valeur, "P"))), list(
            c, "nom_dep", "departement", "day_valid_init"))), 
    list(=, t_out, list(merge, tg_pcr, tg)), list(<-, somme_7j, 
        list(function, list(as.pairlist(alist(x = ))), list(list(
            <-, res, list(ifelse, list(is.na, list(list(::, data.table, 
                shift), x, 6)), NA, list(+, list(+, list(+, list(
                +, list(+, list(+, x, list(list(::, data.table, 
                  shift), x, 1)), list(list(::, data.table, shift), 
                  x, 2)), list(list(::, data.table, shift), x, 
                  3)), list(list(::, data.table, shift), x, 4)), 
                list(list(::, data.table, shift), x, 5)), list(
                list(::, data.table, shift), x, 6)))), list(return, 
            res)), list(4107L, 13L, 4117L, 1L, 13L, 1L, 4107L, 
            4117L))), list(=, pop_spf, list(fread, "data/utils/pop_dep_spf.csv")), 
    list([, pop_spf, list(==, list(nchar, dep), 1), list(:=, 
        dep, list(paste0, "0", dep))), list(=, t_out, list(merge, 
        t_out, pop_spf, "departement", "dep", T)), list(setorder, 
        t_out, departement, day_valid_init), list([, t_out, t_out[, 
        `:=`(tp, somme_7j(nb_positifs_pcr_tag)/somme_7j(nb_tot_pcr_tag)), 
        by = "departement"], list(:=, tp, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
        6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
        2) + data.table::shift(x, 3) + data.table::shift(x, 4) + 
        data.table::shift(x, 5) + data.table::shift(x, 6)), return(res)), 
        list(res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
            x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))), "departement"), list([, 
        t_out, t_out[, `:=`(tp_variant_uk, tp * somme_7j(nb_variant_oui_uk_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, tp_variant_uk, list(
            /, list(*, tp, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(tp_variant_sabr, tp * somme_7j(nb_variant_oui_sa_ou_br_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, tp_variant_sabr, list(
            /, list(*, tp, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(tp_variant_autre, tp * (somme_7j(nb_variant_oui_autre_pcr) + 
            somme_7j(nb_variant_indet_pcr) + somme_7j(nb_variant_suspicion_pcr))/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, tp_variant_autre, list(
            /, list(*, tp, list((, list(+, list(+, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))))), list((, list(-, list(-, 
                list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(tp_variant_non, tp - tp_variant_uk - 
            tp_variant_sabr - tp_variant_autre), by = "departement"], 
        list(:=, tp_variant_non, list(-, list(-, list(-, tp, 
            tp_variant_uk), tp_variant_sabr), tp_variant_autre)), 
        "departement"), list([, t_out, t_out[, `:=`(delta_tp, 
        tp - shift(tp, 7)), by = "departement"], list(:=, delta_tp, 
        list(-, tp, list(shift, tp, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(delta_tp_variant_uk, tp_variant_uk - 
            shift(tp_variant_uk, 7)), by = "departement"], list(
            :=, delta_tp_variant_uk, list(-, tp_variant_uk, list(
                shift, tp_variant_uk, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(delta_tp_variant_sabr, tp_variant_sabr - 
            shift(tp_variant_sabr, 7)), by = "departement"], 
        list(:=, delta_tp_variant_sabr, list(-, tp_variant_sabr, 
            list(shift, tp_variant_sabr, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_tp_variant_non, tp_variant_non - 
        shift(tp_variant_non, 7)), by = "departement"], list(
        :=, delta_tp_variant_non, list(-, tp_variant_non, list(
            shift, tp_variant_non, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(ti, somme_7j(nb_positifs_pcr_tag)/pop), 
            by = "departement"], list(:=, ti, list(/, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), pop)), "departement"), list([, 
        t_out, t_out[, `:=`(ti_variant_uk, ti * somme_7j(nb_variant_oui_uk_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, ti_variant_uk, list(
            /, list(*, ti, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(ti_variant_sabr, ti * somme_7j(nb_variant_oui_sa_ou_br_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, ti_variant_sabr, list(
            /, list(*, ti, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(ti_variant_autre, ti * (somme_7j(nb_variant_oui_autre_pcr) + 
            somme_7j(nb_variant_indet_pcr) + somme_7j(nb_variant_suspicion_pcr))/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, ti_variant_autre, list(
            /, list(*, ti, list((, list(+, list(+, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))))), list((, list(-, list(-, 
                list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(ti_variant_non, ti - ti_variant_uk - 
            ti_variant_sabr - ti_variant_autre), by = "departement"], 
        list(:=, ti_variant_non, list(-, list(-, list(-, ti, 
            ti_variant_uk), ti_variant_sabr), ti_variant_autre)), 
        "departement"), list([, t_out, t_out[, `:=`(delta_ti, 
        ti - shift(ti, 7)), by = "departement"], list(:=, delta_ti, 
        list(-, ti, list(shift, ti, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(delta_ti_variant_uk, ti_variant_uk - 
            shift(ti_variant_uk, 7)), by = "departement"], list(
            :=, delta_ti_variant_uk, list(-, ti_variant_uk, list(
                shift, ti_variant_uk, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(delta_ti_variant_sabr, ti_variant_sabr - 
            shift(ti_variant_sabr, 7)), by = "departement"], 
        list(:=, delta_ti_variant_sabr, list(-, ti_variant_sabr, 
            list(shift, ti_variant_sabr, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_ti_variant_non, ti_variant_non - 
        shift(ti_variant_non, 7)), by = "departement"], list(
        :=, delta_ti_variant_non, list(-, ti_variant_non, list(
            shift, ti_variant_non, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(part_variant, (somme_7j(nb_variant_oui_pcr) + 
            somme_7j(nb_variant_indet_pcr) + somme_7j(nb_variant_suspicion_pcr))/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, part_variant, list(
            /, list((, list(+, list(+, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))), list((, list(-, list(-, 
                list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                  6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(part_variant_uk, somme_7j(nb_variant_oui_uk_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, part_variant_uk, list(
            /, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(part_variant_sabr, somme_7j(nb_variant_oui_sa_ou_br_pcr)/(somme_7j(nb_info_variant_pcr) - 
            somme_7j(nb_variant_non_recodable_pcr) - somme_7j(nb_variant_nc_pcr))), 
            by = "departement"], list(:=, part_variant_sabr, 
            list(/, list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)), list((, list(-, list(-, list(
                res <- ifelse(is.na(data.table::shift(x, 6)), 
                  NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                    2) + data.table::shift(x, 3) + data.table::shift(x, 
                    4) + data.table::shift(x, 5) + data.table::shift(x, 
                    6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
                6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res)))))), "departement"), list([, 
        t_out, t_out[, `:=`(part_variant_quot, (nb_variant_oui_pcr + 
            nb_variant_indet_pcr + nb_variant_suspicion_pcr)/(nb_info_variant_pcr - 
            nb_variant_non_recodable_pcr - nb_variant_nc_pcr)), 
            by = "departement"], list(:=, part_variant_quot, 
            list(/, list((, list(+, list(+, nb_variant_oui_pcr, 
                nb_variant_indet_pcr), nb_variant_suspicion_pcr)), 
                list((, list(-, list(-, nb_info_variant_pcr, 
                  nb_variant_non_recodable_pcr), nb_variant_nc_pcr)))), 
        "departement"), list([, t_out, t_out[, `:=`(part_variant_uk_quot, 
        nb_variant_oui_uk_pcr/(nb_info_variant_pcr - nb_variant_non_recodable_pcr - 
            nb_variant_nc_pcr)), by = "departement"], list(:=, 
        part_variant_uk_quot, list(/, nb_variant_oui_uk_pcr, 
            list((, list(-, list(-, nb_info_variant_pcr, nb_variant_non_recodable_pcr), 
                nb_variant_nc_pcr)))), "departement"), list([, 
        t_out, t_out[, `:=`(part_variant_sabr_quot, nb_variant_oui_sa_ou_br_pcr/(nb_info_variant_pcr - 
            nb_variant_non_recodable_pcr - nb_variant_nc_pcr)), 
            by = "departement"], list(:=, part_variant_sabr_quot, 
            list(/, nb_variant_oui_sa_ou_br_pcr, list((, list(
                -, list(-, nb_info_variant_pcr, nb_variant_non_recodable_pcr), 
                nb_variant_nc_pcr)))), "departement"), list([, 
        t_out, t_out[, `:=`(delta_part_variant, part_variant - 
            shift(part_variant, 7)), by = "departement"], list(
            :=, delta_part_variant, list(-, part_variant, list(
                shift, part_variant, 7))), "departement"), list(
        [, t_out, t_out[, `:=`(delta_part_variant_uk, part_variant_uk - 
            shift(part_variant_uk, 7)), by = "departement"], 
        list(:=, delta_part_variant_uk, list(-, part_variant_uk, 
            list(shift, part_variant_uk, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_part_variant_sabr, part_variant_sabr - 
        shift(part_variant_sabr, 7)), by = "departement"], list(
        :=, delta_part_variant_sabr, list(-, part_variant_sabr, 
            list(shift, part_variant_sabr, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_part_variant_quot, part_variant_quot - 
        shift(part_variant_quot, 7)), by = "departement"], list(
        :=, delta_part_variant_quot, list(-, part_variant_quot, 
            list(shift, part_variant_quot, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_part_variant_uk_quot, part_variant_uk_quot - 
        shift(part_variant_uk_quot, 7)), by = "departement"], 
        list(:=, delta_part_variant_uk_quot, list(-, part_variant_uk_quot, 
            list(shift, part_variant_uk_quot, 7))), "departement"), 
    list([, t_out, t_out[, `:=`(delta_part_variant_sabr_quot, 
        part_variant_sabr_quot - shift(part_variant_sabr_quot, 
            7)), by = "departement"], list(:=, delta_part_variant_sabr_quot, 
        list(-, part_variant_sabr_quot, list(shift, part_variant_sabr_quot, 
            7))), "departement"), list([, t_out, t_out[, `:=`(part_cribles, 
        (somme_7j(nb_info_variant_pcr) - somme_7j(nb_variant_non_recodable_pcr) - 
            somme_7j(nb_variant_nc_pcr))/somme_7j(nb_pos_pcr)), 
        by = "departement"], list(:=, part_cribles, list(/, list(
        (, list(-, list(-, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res)))), list(res <- ifelse(is.na(data.table::shift(x, 
        6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
        2) + data.table::shift(x, 3) + data.table::shift(x, 4) + 
        data.table::shift(x, 5) + data.table::shift(x, 6)), return(res)))), 
        "departement"), list([, t_out, t_out[, `:=`(delta_part_cribles, 
        part_cribles - shift(part_cribles, 7)), by = "departement"], 
        list(:=, delta_part_cribles, list(-, part_cribles, list(
            shift, part_cribles, 7))), "departement"), list(write.csv, 
        t_out, list(paste0, path, "data/sorties/variants/", list(
            Sys.Date), " - table_pour_carto.csv")), list(print, 
        "variants E"), list(print, list(gc, T)), list(=, wb, 
        list(loadWorkbook, "src/utils/Modèle fichier variants.xlsx")), 
    list(=, t, list(setDT, list(read.xlsx, list(paste0, "data/sorties/nb_tests/", 
        list(gsub, "-", "", list(Sys.Date)), "_sidep_pcr_valid.xlsx"), 
        "national", T))), list(writeData, wb, "pcr valid pr check", 
        list([, t, list(<=, date, list(Sys.Date)), list(c, "date", 
            "nb_pos", "nb_tot_PNIX"))), list(rm, t), list(=, 
        t, list(setDT, list(read.xlsx, list(paste0, "data/sorties/nb_tests/", 
            list(gsub, "-", "", list(Sys.Date)), "_sidep_antigenique_valid.xlsx"), 
            "national", T))), list(=, t, list(merge, list(data.frame, 
        list(seq.Date, list(min, list($, list([, t, list(<=, 
            date, list(Sys.Date))), date)), list(max, list($, 
            list([, t, list(<=, date, list(Sys.Date))), date)), 
            1)), list([, t, list(<=, date, list(Sys.Date)), list(
        c, "date", "nb_pos", "nb_tot_PNIX")), T)), list(setorder, 
        t, date), list(writeData, wb, "tag valid pr check", t), 
    list(rm, t), list(=, t, list(setDT, list(read.xlsx, list(
        paste0, "data/sorties/variants/", list(Sys.Date), " - table_pcr_variants.xlsx"), 
        T))), list(setorder, t, day_valid_init), list([, t, t[, 
        `:=`(variant_oui_quot, nb_variant_oui/(nb_info_variant - 
            nb_variant_nc - nb_variant_non_recodable))], list(
        :=, variant_oui_quot, list(/, nb_variant_oui, list((, 
            list(-, list(-, nb_info_variant, nb_variant_nc), 
                nb_variant_non_recodable))))), list(writeData, 
        wb, "PCR only", list([, t, list(&, list(!, list(is.na, 
            day_valid_init)), list(<, day_valid_init, list(Sys.Date))))), 
    list(rm, t), list(=, t, list(setDT, list(read.xlsx, list(
        paste0, "data/sorties/variants/", list(Sys.Date), " - table_tot_variants.xlsx"), 
        T))), list(setorder, t, day_valid_init), list(writeData, 
        wb, "PCR et TAG", list([, t, list(&, list(!, list(is.na, 
            day_valid_init)), list(<, day_valid_init, list(Sys.Date))))), 
    list(rm, t), list(saveWorkbook, wb, list(paste0, "data/sorties/variants/", 
        list(gsub, "-", "", list(Sys.Date)), " table_pcr_variants - avec graphiques.xlsx")), 
    list(print, "variants F"), list(print, list(gc, T)), list(
        library, officer), list(library, data.table), list(library, 
        leaflet), list(library, sf), list(library, htmltools), 
    list(library, openxlsx), list(if, list(!, list(%in%, list(
        paste0, list(Sys.Date), " - table_pour_carto.csv"), list(
        dir, "data/sorties/variants/"))), list(list(message, 
        "Attention, les données ne sont pas à jour : le programme ne peut pas tourner.")), 
        list(list(=, data_sidep, list(fread, list(paste0, "data/sorties/variants/", 
            list(Sys.Date), " - table_pour_carto.csv"))), list(
            =, data_sidep, list([, data_sidep, list(&, list(&, 
                list(!, list(is.na, departement)), list(!=, departement, 
                  "dep_inconnu")), list(!=, departement, "97")))), 
            list(setorder, data_sidep, departement, day_valid_init), 
            list(=, data_sidep, list([, data_sidep, data_sidep[, 
                `:=`(delta_part_cribles, part_cribles - shift(part_cribles, 
                  7)), by = "departement"], list(:=, delta_part_cribles, 
                list(-, part_cribles, list(shift, part_cribles, 
                  7))), "departement")), list(setorder, data_sidep, 
                departement, day_valid_init), list([, data_sidep, 
                data_sidep[, `:=`(evo_pourcentage_tp, tp/shift(tp, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_tp, 
                  list(-, list(/, tp, list(shift, tp, 7)), 1)), 
                "departement"), list([, data_sidep, data_sidep[, 
                `:=`(evo_pourcentage_tp_uk, tp_variant_uk/shift(tp_variant_uk, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_tp_uk, 
                list(-, list(/, tp_variant_uk, list(shift, tp_variant_uk, 
                  7)), 1)), "departement"), list([, data_sidep, 
                data_sidep[, `:=`(evo_pourcentage_tp_sabr, tp_variant_sabr/shift(tp_variant_sabr, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_tp_sabr, 
                  list(-, list(/, tp_variant_sabr, list(shift, 
                    tp_variant_sabr, 7)), 1)), "departement"), 
            list([, data_sidep, list(is.nan, evo_pourcentage_tp_sabr), 
                list(:=, evo_pourcentage_tp_sabr, NA)), list(
                [, data_sidep, list(==, evo_pourcentage_tp_sabr, 
                  Inf), list(:=, evo_pourcentage_tp_sabr, 10)), 
            list([, data_sidep, list(==, evo_pourcentage_tp_sabr, 
                list(-, Inf)), list(:=, evo_pourcentage_tp_sabr, 
                list(-, 10))), list([, data_sidep, data_sidep[, 
                `:=`(evo_pourcentage_tp_non, tp_variant_non/shift(tp_variant_non, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_tp_non, 
                list(-, list(/, tp_variant_non, list(shift, tp_variant_non, 
                  7)), 1)), "departement"), list(setorder, data_sidep, 
                departement, day_valid_init), list([, data_sidep, 
                data_sidep[, `:=`(evo_pourcentage_ti, ti/shift(ti, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_ti, 
                  list(-, list(/, ti, list(shift, ti, 7)), 1)), 
                "departement"), list([, data_sidep, data_sidep[, 
                `:=`(evo_pourcentage_ti_uk, ti_variant_uk/shift(ti_variant_uk, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_ti_uk, 
                list(-, list(/, ti_variant_uk, list(shift, ti_variant_uk, 
                  7)), 1)), "departement"), list([, data_sidep, 
                data_sidep[, `:=`(evo_pourcentage_ti_sabr, ti_variant_sabr/shift(ti_variant_sabr, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_ti_sabr, 
                  list(-, list(/, ti_variant_sabr, list(shift, 
                    ti_variant_sabr, 7)), 1)), "departement"), 
            list([, data_sidep, list(is.nan, evo_pourcentage_ti_sabr), 
                list(:=, evo_pourcentage_ti_sabr, NA)), list(
                [, data_sidep, list(==, evo_pourcentage_ti_sabr, 
                  Inf), list(:=, evo_pourcentage_ti_sabr, 10)), 
            list([, data_sidep, list(==, evo_pourcentage_ti_sabr, 
                list(-, Inf)), list(:=, evo_pourcentage_ti_sabr, 
                list(-, 10))), list([, data_sidep, data_sidep[, 
                `:=`(evo_pourcentage_ti_non, ti_variant_non/shift(ti_variant_non, 
                  7) - 1), by = "departement"], list(:=, evo_pourcentage_ti_non, 
                list(-, list(/, ti_variant_non, list(shift, ti_variant_non, 
                  7)), 1)), "departement"), list(load, "data/utils/carte_dep.Rdata"), 
            list(<-, bornes, list(unname, list(st_bbox, carte_dep))), 
            list(=, cartographie, list(function, list(as.pairlist(alist(data = , titre = , coefficient = 1, suffixe = "", delta = F, reverse_delta = T)), 
                as.pairlist(alist(data = , titre = , coefficient = 1, suffixe = "", delta = F, reverse_delta = T)), 
                1, "", F, T), list(list(=, multiplie, list(function, 
                list(as.pairlist(alist(x = ))), list(list(return, 
                  list(*, x, coefficient))), list(4248L, 17L, 
                  4248L, 53L, 17L, 53L, 4248L, 4248L))), list(
                =, list(names, data), list(c, "departement", 
                  "valeur")), list(<-, carte_dep, list(merge, 
                carte_dep, data, "CC_2", "departement")), list(
                if, list(==, delta, F), list(list(<-, palette_de_couleur_aplat, 
                  list(colorNumeric, "viridis", TRUE, list(c, 
                    list(min, list(na.omit, list($, list([, data, 
                      list(==, list(nchar, departement), 2)), 
                      valeur))), list(max, list(na.omit, list(
                      $, list([, data, list(==, list(nchar, departement), 
                        2)), valeur))))))), list(list(<-, palette_de_couleur_aplat, 
                  list(colorNumeric, "RdBu", reverse_delta, list(
                    c, list(-, list(max, list(abs, list(na.omit, 
                      list($, list([, data, list(==, list(nchar, 
                        departement), 2)), valeur))))), list(
                      max, list(abs, list(na.omit, list($, list(
                        [, data, list(==, list(nchar, departement), 
                          2)), valeur))))))))), list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(leaflet, 
                  carte_dep), list(fitBounds, list([, bornes, 
                  1), list([, bornes, 3), list([, bornes, 2), 
                  list([, bornes, 4))), list(addProviderTiles, 
                  list($, providers, CartoDB.PositronNoLabels), 
                  addProviderTiles(providers$CartoDB.PositronNoLabels, 
                    ))), list(addPolygons, carte_dep, list(~, 
                  GID_2), T, "white", 1, 0.8, list(~, list(palette_de_couleur_aplat, 
                  valeur)), list(paste0, list($, list(@, carte_dep, 
                  data), NAME_2), " : ", list(round, list(*, 
                  coefficient, list($, list(@, carte_dep, data), 
                    valeur)), 1), suffixe), list(labelOptions, 
                  0.7, list(list, "normal", "3px 8px"), "15px", 
                  "auto"))), list(addLegend, "topright", palette_de_couleur_aplat, 
                  list($, carte_dep, valeur), list(paste0, list(
                    $, carte_dep, valeur), "%"), 0.8, list(labelFormat, 
                    suffixe, multiplie))), list(addControl, list(
                HTML, titre), "bottomleft", "title"))), list(
                4241L, 18L, 4301L, 3L, 18L, 3L, 4241L, 4301L))), 
            list(=, G_1.1, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "tp"))), list(=, carte_tp, list(cartographie, 
                G_1.1, "1.1. Taux de positivité des tests (non dédoublonnés) à J-2", 
                100, " %")), carte_tp, list(=, G_1.2, list([, 
                data_sidep, list(==, day_valid_init, list(-, 
                  list(Sys.Date), 2)), list(c, "departement", 
                  "tp_variant_uk"))), list(=, carte_tpv_uk, list(
                cartographie, G_1.2, "1.2. Estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                100, " %")), carte_tpv_uk, list(=, G_1.3, list(
                [, data_sidep, list(==, day_valid_init, list(
                  -, list(Sys.Date), 2)), list(c, "departement", 
                  "tp_variant_sabr"))), list(=, carte_tpv_sabr, 
                list(cartographie, G_1.3, "1.3. Estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  100, " %")), carte_tpv_sabr, list(=, G_1.4, 
                list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "tp_variant_non"))), list(=, carte_tpv_non, 
                list(cartographie, G_1.4, "1.4. Estimation du taux de positivité des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                  100, " %")), carte_tpv_non, list(=, G_2.1, 
                list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "delta_tp"))), list(=, carte_evo_tp, list(cartographie, 
                G_2.1, "2.1. Delta hebdomadaire du taux de positivité des tests (non dédoublonnés) à J-2", 
                100, " point(s)", T)), carte_evo_tp, list(=, 
                G_2.2, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "delta_tp_variant_uk"))), list(=, carte_evo_tpv_uk, 
                list(cartographie, G_2.2, "2.2. Delta hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                  100, " point(s)", T)), carte_evo_tpv_uk, list(
                =, G_2.3, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "delta_tp_variant_sabr"))), list(=, carte_evo_tpv_sabr, 
                list(cartographie, G_2.3, "2.3. Delta hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  100, " point(s)", T)), carte_evo_tpv_sabr, 
            list(=, G_2.4, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "delta_tp_variant_non"))), list(=, carte_evo_tpv_non, 
                list(cartographie, G_2.4, "2.4. Delta hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                  100, " point(s)", T)), carte_evo_tpv_non, list(
                =, G_2.1_bis, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "evo_pourcentage_tp"))), list(=, carte_evo_pourcentage_tp, 
                list(cartographie, G_2.1_bis, "2.1.bis. Variation hebdomadaire du taux de positivité des tests (non dédoublonnés) à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tp, list(
                =, G_2.2_bis, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "evo_pourcentage_tp_uk"))), list(=, carte_evo_pourcentage_tpv_uk, 
                list(cartographie, G_2.2_bis, "2.2.bis. Variation hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tpv_uk, 
            list(=, G_2.3_bis, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "evo_pourcentage_tp_sabr"))), list(=, carte_evo_pourcentage_tpv_sabr, 
                list(cartographie, G_2.3_bis, "2.3.bis. Variation hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tpv_sabr, 
            list(=, G_2.4_bis, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "evo_pourcentage_tp_non"))), list(=, carte_evo_pourcentage_tpv_non, 
                list(cartographie, G_2.4_bis, "2.4.bis. Variation hebdomadaire de l'estimation du taux de positivité des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tpv_non, 
            list(=, G_3.1, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "ti"))), list(=, carte_ti, list(cartographie, 
                G_3.1, "3.1. Taux \"d'incidence\" des tests (non dédoublonnés) à J-2", 
                1e+05, " pour 100 000 habitants")), carte_ti, 
            list(=, G_3.2, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "ti_variant_uk"))), list(=, carte_tiv_uk, list(
                cartographie, G_3.2, "3.2. Estimation du taux \"d'incidence\" des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                1e+05, " pour 100 000 habitants")), carte_tiv_uk, 
            list(=, G_3.3, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "ti_variant_sabr"))), list(=, carte_tiv_sabr, 
                list(cartographie, G_3.3, "3.3. Estimation du taux \"d'incidence\" des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  1e+05, " pour 100 000 habitants")), carte_tiv_sabr, 
            list(=, G_3.4, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "ti_variant_non"))), list(=, carte_tiv_non, list(
                cartographie, G_3.4, "3.4. Estimation du taux \"d'incidence\" des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                1e+05, " pour 100 000 habitants")), carte_tiv_non, 
            list(=, G_4.1, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "delta_ti"))), list(=, carte_evo_ti, list(cartographie, 
                G_4.1, "4.1. Delta hebdomadaire du taux \"d'incidence\" des tests (non dédoublonnés) à J-2", 
                1e+05, " pour 100 000 habitants", T)), carte_evo_ti, 
            list(=, G_4.2, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "delta_ti_variant_uk"))), list(=, carte_evo_tiv_uk, 
                list(cartographie, G_4.2, "4.2. Delta hebdomadaire de l'estimation du taux \"d'incidence\" des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                  1e+05, " pour 100 000 habitants", T)), carte_evo_tiv_uk, 
            list(=, G_4.3, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "delta_ti_variant_sabr"))), list(=, carte_evo_tiv_sabr, 
                list(cartographie, G_4.3, "4.3. Delta hebdomadaire de l'estimation du taux \"d'incidence\" des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  1e+05, " pour 100 000 habitants", T)), carte_evo_tiv_sabr, 
            list(=, G_4.4, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "delta_ti_variant_non"))), list(=, carte_evo_tiv_non, 
                list(cartographie, G_4.4, "4.4. Delta hebdomadaire de l'estimation du taux \"d'incidence\" des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                  1e+05, " pour 100 000 habitants", T)), carte_evo_tiv_non, 
            list(=, G_4.1_bis, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "evo_pourcentage_ti"))), list(=, carte_evo_pourcentage_ti, 
                list(cartographie, G_4.1_bis, "4.1.bis. Variation hebdomadaire du taux d'\"incidence\" des tests (non dédoublonnés) à J-2", 
                  100, "%", T)), carte_evo_pourcentage_ti, list(
                =, G_4.2_bis, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 2)), list(c, "departement", 
                  "evo_pourcentage_ti_uk"))), list(=, carte_evo_pourcentage_tiv_uk, 
                list(cartographie, G_4.2_bis, "4.2.bis. Variation hebdomadaire de l'estimation du taux d'\"incidence\" des tests (non dédoublonnés) attribuable au variant UK à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tiv_uk, 
            list(=, G_4.3_bis, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "evo_pourcentage_ti_sabr"))), list(=, carte_evo_pourcentage_tiv_sabr, 
                list(cartographie, G_4.3_bis, "4.3.bis. Variation hebdomadaire de l'estimation du taux d'\"incidence\" des tests (non dédoublonnés) attribuable au variant SA/BR à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tiv_sabr, 
            list(=, G_4.4_bis, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 2)), list(c, "departement", 
                "evo_pourcentage_ti_non"))), list(=, carte_evo_pourcentage_tiv_non, 
                list(cartographie, G_4.4_bis, "4.4.bis. Variation hebdomadaire de l'estimation du taux d'\"incidence\" des tests (non dédoublonnés) non attribuable à un variant à J-2", 
                  100, "%", T)), carte_evo_pourcentage_tiv_non, 
            list(=, G_5.1, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 3)), list(c, "departement", 
                "part_variant"))), list(=, carte_tpcriblage, 
                list(cartographie, G_5.1, "5.1. Taux de tests positifs criblés anormaux (non dédoublonnés) à J-3", 
                  100, " %")), carte_tpcriblage, list(=, G_5.2, 
                list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 3)), list(c, "departement", 
                  "part_variant_uk"))), list(=, carte_tpcriblage_uk, 
                list(cartographie, G_5.2, "5.2. Taux de tests positifs criblés anormaux UK (non dédoublonnés) à J-3", 
                  100, " %")), carte_tpcriblage_uk, list(=, G_5.3, 
                list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 3)), list(c, "departement", 
                  "part_variant_sabr"))), list(=, carte_tpcriblage_sabr, 
                list(cartographie, G_5.3, "5.3. Taux de tests positifs criblés anormaux SA-BR (non dédoublonnés) à J-3", 
                  100, " %")), carte_tpcriblage_sabr, list(=, 
                G_6.1, list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 3)), list(c, "departement", 
                  "delta_part_variant"))), list(=, carte_evo_tpcriblage, 
                list(cartographie, G_6.1, "6.1. Delta hebdomadaire du taux de tests positifs criblés anormaux (non dédoublonnés) à J-3", 
                  100, " point(s)", T)), carte_evo_tpcriblage, 
            list(=, G_6.2, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 3)), list(c, "departement", 
                "delta_part_variant_uk"))), list(=, carte_evo_tpcriblage_uk, 
                list(cartographie, G_6.2, "6.2. Delta hebdomadaire du taux de tests positifs criblés anormaux UK (non dédoublonnés) à J-3", 
                  100, " point(s)", T)), carte_evo_tpcriblage_uk, 
            list(=, G_6.3, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 3)), list(c, "departement", 
                "delta_part_variant_sabr"))), list(=, carte_evo_tpcriblage_sabr, 
                list(cartographie, G_6.3, "6.3. Delta hebdomadaire du taux de tests positifs criblés anormaux SA-BR (non dédoublonnés) à J-3", 
                  100, " point(s)", T)), carte_evo_tpcriblage_sabr, 
            list(=, G_7.1, list([, data_sidep, list(==, day_valid_init, 
                list(-, list(Sys.Date), 3)), list(c, "departement", 
                "part_cribles"))), list(=, carte_partcriblage, 
                list(cartographie, G_7.1, "7.1. Part de tests criblés parmi les tests positifs (non dédoublonnés) à J-3", 
                  100, " %")), carte_partcriblage, list(=, G_7.2, 
                list([, data_sidep, list(==, day_valid_init, 
                  list(-, list(Sys.Date), 3)), list(c, "departement", 
                  "delta_part_cribles"))), list(=, carte_evo_partcriblage, 
                list(cartographie, G_7.2, "7.2. Delta hebdomadaire de la part de tests criblés parmi les tests positifs (non dédoublonnés) à J-3", 
                  100, " point(s)", T)), carte_evo_partcriblage, 
            list(list(::, rmarkdown, render), "src/variants/Cartes variants.Rmd", 
                list(paste0, "data/sorties/variants/", list(Sys.Date), 
                  "_cartes_variants.html")), list(=, TABLE_FINALE, 
                list([, G_1.1, G_1.1[, c("departement")], list(
                  c, "departement"))), list(=, table_des_dep, 
                list(fread, "data/utils/departement2019.csv", 
                  "UTF-8")), list(=, TABLE_FINALE, list(merge, 
                TABLE_FINALE, list([, table_des_dep, table_des_dep[, 
                  c("dep", "libelle")], list(c, "dep", "libelle")), 
                "departement", "dep")), list(for, nom_table, 
                list(c, "G_1.1", "G_1.2", "G_1.3", "G_1.4", "G_2.1", 
                  "G_2.2", "G_2.3", "G_2.4", "G_2.1_bis", "G_2.2_bis", 
                  "G_2.3_bis", "G_2.4_bis", "G_3.1", "G_3.2", 
                  "G_3.3", "G_3.4", "G_4.1", "G_4.2", "G_4.3", 
                  "G_4.4", "G_4.1_bis", "G_4.2_bis", "G_4.3_bis", 
                  "G_4.4_bis", "G_5.1", "G_5.2", "G_5.3", "G_6.1", 
                  "G_6.2", "G_6.3", "G_7.1", "G_7.2"), list(list(
                  =, t, list(eval, list(parse, nom_table))), 
                  list(=, list([, list(names, t), 2), nom_table), 
                  list(=, TABLE_FINALE, list(merge, TABLE_FINALE, 
                    t, "departement", T)))), list([, TABLE_FINALE, 
                TABLE_FINALE[, `:=`(G_1.1 = 100 * G_1.1, G_1.2 = 100 * 
                  G_1.2, G_1.3 = 100 * G_1.3, G_1.4 = 100 * G_1.4, 
                  G_2.1 = 100 * G_2.1, G_2.2 = 100 * G_2.2, G_2.3 = 100 * 
                    G_2.3, G_2.4 = 100 * G_2.4, G_2.1_bis = 100 * 
                    G_2.1_bis, G_2.2_bis = 100 * G_2.2_bis, G_2.3_bis = 100 * 
                    G_2.3_bis, G_2.4_bis = 100 * G_2.4_bis, G_3.1 = 1e+05 * 
                    G_3.1, G_3.2 = 1e+05 * G_3.2, G_3.3 = 1e+05 * 
                    G_3.3, G_3.4 = 1e+05 * G_3.4, G_4.1 = 1e+05 * 
                    G_4.1, G_4.2 = 1e+05 * G_4.2, G_4.3 = 1e+05 * 
                    G_4.3, G_4.4 = 1e+05 * G_4.4, G_4.1_bis = 100 * 
                    G_4.1_bis, G_4.2_bis = 100 * G_4.2_bis, G_4.3_bis = 100 * 
                    G_4.3_bis, G_4.4_bis = 100 * G_4.4_bis, G_5.1 = 100 * 
                    G_5.1, G_5.2 = 100 * G_5.2, G_5.3 = 100 * 
                    G_5.3, G_6.1 = 100 * G_6.1, G_6.2 = 100 * 
                    G_6.2, G_6.3 = 100 * G_6.3, G_7.1 = 100 * 
                    G_7.1, G_7.2 = 100 * G_7.2)], list(:=, list(
                  *, 100, G_1.1), list(*, 100, G_1.2), list(*, 
                  100, G_1.3), list(*, 100, G_1.4), list(*, 100, 
                  G_2.1), list(*, 100, G_2.2), list(*, 100, G_2.3), 
                  list(*, 100, G_2.4), list(*, 100, G_2.1_bis), 
                  list(*, 100, G_2.2_bis), list(*, 100, G_2.3_bis), 
                  list(*, 100, G_2.4_bis), list(*, 1e+05, G_3.1), 
                  list(*, 1e+05, G_3.2), list(*, 1e+05, G_3.3), 
                  list(*, 1e+05, G_3.4), list(*, 1e+05, G_4.1), 
                  list(*, 1e+05, G_4.2), list(*, 1e+05, G_4.3), 
                  list(*, 1e+05, G_4.4), list(*, 100, G_4.1_bis), 
                  list(*, 100, G_4.2_bis), list(*, 100, G_4.3_bis), 
                  list(*, 100, G_4.4_bis), list(*, 100, G_5.1), 
                  list(*, 100, G_5.2), list(*, 100, G_5.3), list(
                    *, 100, G_6.1), list(*, 100, G_6.2), list(
                    *, 100, G_6.3), list(*, 100, G_7.1), list(
                    *, 100, G_7.2))), list(<-, wb, list(createWorkbook)), 
            list(addWorksheet, wb, "Données cartes"), list(writeData, 
                wb, "Données cartes", TABLE_FINALE), list(addStyle, 
                wb, "Données cartes", list(createStyle, "black", 
                  "Times New Roman", "center", "white"), 1, list(
                  :, 1, list([, list(dim, TABLE_FINALE), 2)), 
                T), list(addStyle, wb, "Données cartes", list(
                createStyle, list(rgb, list(/, 150, 255), list(
                  /, 150, 255), list(/, 150, 255)), "Times New Roman"), 
                list(+, list((, list(:, 1, list([, list(dim, 
                  t), 1))), 1), list(which, list(%in%, list(names, 
                  TABLE_FINALE), list(c, "departement", "libelle"))), 
                T), list(addStyle, wb, "Données cartes", list(
                createStyle, "white", "Times New Roman", "center"), 
                list(+, list((, list(:, 1, list([, list(dim, 
                  t), 1))), 1), list(which, list(!, list((, list(
                  %in%, list(names, TABLE_FINALE), list(c, "departement", 
                    "libelle"))))), T), list(saveWorkbook, wb, 
                list(paste0, "data/sorties/variants/", list(Sys.Date), 
                  " - données carte.xlsx"), T))), list(print, 
        "variants ZIP"), list(print, list(gc, T)), list(=, path_fabrice, 
        list(paste0, path, "data/sorties/dossier_quotidien_fabrice/")), 
    list(if, list(!, list(dir.exists, list(paste0, path_fabrice, 
        list(Sys.Date)))), list(dir.create, list(paste0, path_fabrice, 
        list(Sys.Date)))), list(=, path_fabrice_du_jour, list(
        paste0, path_fabrice, list(Sys.Date), "/")), list(file.copy, 
        list(paste0, path, "data/sorties/variants/", list(gsub, 
            "-", "", list(Sys.Date)), " table_pcr_variants - avec graphiques.xlsx"), 
        list(paste0, path_fabrice, list(gsub, "-", "", list(Sys.Date)), 
            " table_pcr_variants - avec graphiques.xlsx"), T), 
    list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - decomposition_tp_par_departement.pdf"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - decomposition_tp_par_departement.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - decomposition_tp_par_region.pdf"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - decomposition_tp_par_region.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - graphique_decomp_tp_fra_hebdo.jpg"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - graphique_decomp_tp_fra_hebdo.jpg"), 
        T), list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - table_pour_carto.csv"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - table_pour_carto.csv"), 
        T), list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), "_cartes_variants.html"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), "_cartes_variants.html"), 
        T), list(file.copy, list(paste0, path, "data/sorties/variants/", 
        list(Sys.Date), " - données carte.xlsx"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - données carte.xlsx"), 
        T), list(list(::, zip, zipr), list(paste0, path_fabrice, 
        list(Sys.Date), "_export_quotidien_variants.zip"), list(
        paste0, path_fabrice_du_jour, list(dir, path_fabrice_du_jour))), 
    list(file.remove, list(paste0, path_fabrice_du_jour, list(
        dir, path_fabrice_du_jour))), list(file.remove, list(
        paste0, path_fabrice, list(Sys.Date))), list(print, list(
        gc, T)), list(rm, list(ls)), list(gc), list(<-, path_config, 
        "src/"), list(=, jour_date, list(Sys.Date)), list(=, 
        date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), list(
        =, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), list(
        <-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(print, 
        "Heatmaps"), list(library, data.table), list(library, 
        ggplot2), list(library, openxlsx), list(library, officer), 
    list(library, flextable), list(library, dplyr), list(<-, 
        path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(<-, 
        somme_7j, list(function, list(as.pairlist(alist(x = ))), 
            list(list(<-, res, list(ifelse, list(is.na, list(
                shift, x, 6)), NA, list(+, list(+, list(+, list(
                +, list(+, list(+, x, list(shift, x, 1)), list(
                  shift, x, 2)), list(shift, x, 3)), list(shift, 
                x, 4)), list(shift, x, 5)), list(shift, x, 6)))), 
                list(return, res)), list(4819L, 13L, 4823L, 1L, 
                13L, 1L, 4819L, 4823L))), list(<-, Creer_une_boite, 
        list(function, list(as.pairlist(alist(texte = ))), list(
            list(=, aux, list(data.frame, list(matrix, NA, 0, 
                1))), list(=, list(names, aux), texte), list(
                return, aux)), list(4824L, 20L, 4828L, 1L, 20L, 
            1L, 4824L, 4828L))), list(=, DATE_DEPART, "2021-01-16"), 
    list(=, SEUIL_TP, 0.05), list(=, SEUIL_TI, 200), list(=, 
        DATE_FIXE, "2021-01-16"), list(=, DATE_DREES, list(gsub, 
        "-", "", list(Sys.Date))), list(=, chemin_sorties_quot, 
        list(paste0, path, "data/sorties/nb_tests/")), list(=, 
        chemin_utils_sidep, list(paste0, path, "data/utils/")), 
    list(=, chemin_sortie_heatmaps, list(paste0, path, "data/sorties/heatmaps/")), 
    list(=, data_sidep_reg_drees_pcr, list(setDT, list(read.xlsx, 
        list(paste0, chemin_sorties_quot, DATE_DREES, "_sidep_pcr_valid.xlsx"), 
        "regions", T))), list(=, data_sidep_dep_drees_pcr, list(
        setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_valid.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees_tag, list(setDT, 
        list(read.xlsx, list(paste0, chemin_sorties_quot, DATE_DREES, 
            "_sidep_antigenique_valid.xlsx"), "regions", T))), 
    list(=, data_sidep_dep_drees_tag, list(setDT, list(read.xlsx, 
        list(paste0, chemin_sorties_quot, DATE_DREES, "_sidep_antigenique_valid.xlsx"), 
        "departements", T))), list(=, data_sidep_reg_drees_pcr_sal_mil, 
        list(setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid.xlsx"), "regions", 
            T))), list(=, data_sidep_dep_drees_pcr_sal_mil, list(
        setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees, list(rbind, list(
        [, data_sidep_reg_drees_pcr, data_sidep_reg_drees_pcr[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
        list([, data_sidep_reg_drees_tag, data_sidep_reg_drees_tag[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
        list([, data_sidep_reg_drees_pcr_sal_mil, data_sidep_reg_drees_pcr_sal_mil[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")))), 
    list(=, data_sidep_reg_drees, list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "nom_reg")], list(., list(sum, nb_pos), 
            list(sum, nb_tot_PNIX)), list(c, "date", "nom_reg"))), 
    list(=, data_sidep_dep_drees, list(rbind, list([, data_sidep_dep_drees_pcr, 
        data_sidep_dep_drees_pcr[, c("date", "departement", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "departement", "nb_pos", 
            "nb_tot_PNIX")), list([, data_sidep_dep_drees_tag, 
        data_sidep_dep_drees_tag[, c("date", "departement", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "departement", "nb_pos", 
            "nb_tot_PNIX")), list([, data_sidep_dep_drees_pcr_sal_mil, 
        data_sidep_dep_drees_pcr_sal_mil[, c("date", "departement", 
            "nb_pos", "nb_tot_PNIX")], list(c, "date", "departement", 
            "nb_pos", "nb_tot_PNIX")))), list(=, data_sidep_dep_drees, 
        list([, data_sidep_dep_drees, data_sidep_dep_drees[, 
            .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "departement")], list(., list(sum, 
            nb_pos), list(sum, nb_tot_PNIX)), list(c, "date", 
            "departement"))), list(=, libelle_reg, list(fread, 
        list(paste0, chemin_utils_sidep, "region2019.csv"), "UTF-8")), 
    list([, libelle_reg, libelle_reg[, `:=`(reg, as.character(reg))], 
        list(:=, reg, list(as.character, reg))), list(=, libelle_dep, 
        list(fread, list(paste0, chemin_utils_sidep, "departement2019.csv"), 
            "UTF-8")), list(=, population_dep, list(fread, list(
        paste0, path, "/data/utils/pop_dep_spf.csv"))), list(
        [, population_dep, population_dep[, `:=`(dep, ifelse(nchar(dep) == 
            1, paste0("0", dep), dep))], list(:=, dep, list(ifelse, 
            list(==, list(nchar, dep), 1), list(paste0, "0", 
                dep), dep))), list(=, population_reg, list(fread, 
        list(paste0, path, "/data/utils/pop_reg_spf.csv"))), 
    list(setorder, data_sidep_reg_drees, nom_reg, date), list(
        =, data_sidep_reg_drees, list([, data_sidep_reg_drees, 
            data_sidep_reg_drees[, c("date", "nom_reg", "nb_pos", 
                "nb_tot_PNIX")], list(c, "date", "nom_reg", "nb_pos", 
                "nb_tot_PNIX"))), list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, `:=`(nb_pos_7j, somme_7j(nb_pos)), 
            by = "nom_reg"], list(:=, nb_pos_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "nom_reg"], list(:=, nb_tot_PNIX_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, population_reg, 
        list(==, nom_region, "Ile-de-France"), list(:=, nom_region, 
            "Île-de-France")), list([, population_reg, list(==, 
        nom_region, "Centre-Val de Loire"), list(:=, nom_region, 
        "Centre Val-de-Loire")), list([, population_reg, list(
        ==, nom_region, "Grand Est"), list(:=, nom_region, "Grand-Est")), 
    list([, population_reg, list(==, nom_region, "Nouvelle-Aquitaine"), 
        list(:=, nom_region, "Nouvelle Aquitaine")), list(=, 
        data_sidep_reg_drees, list(merge, data_sidep_reg_drees, 
            population_reg, "nom_reg", "nom_region")), list([, 
        data_sidep_reg_drees, data_sidep_reg_drees[, `:=`(ti, 
            nb_pos_7j/pop * 1e+05), by = "nom_reg"], list(:=, 
            ti, list(*, list(/, nb_pos_7j, pop), 1e+05)), "nom_reg"), 
    list(setorder, data_sidep_reg_drees, nom_reg, date), list(
        [, data_sidep_reg_drees, data_sidep_reg_drees[, `:=`(evo_ti_1, 
            ti/shift(ti, 1) - 1), by = "nom_reg"], list(:=, evo_ti_1, 
            list(-, list(/, ti, list(shift, ti, 1)), 1)), "nom_reg"), 
    list([, data_sidep_reg_drees, data_sidep_reg_drees[, `:=`(evo_ti_7, 
        ti/shift(ti, 7) - 1), by = "nom_reg"], list(:=, evo_ti_7, 
        list(-, list(/, ti, list(shift, ti, 7)), 1)), "nom_reg"), 
    list([, data_sidep_reg_drees, data_sidep_reg_drees[, `:=`(var_ti_7, 
        ti - shift(ti, 7)), by = "nom_reg"], list(:=, var_ti_7, 
        list(-, ti, list(shift, ti, 7))), "nom_reg"), list(for, 
        REGION, list(unique, list($, data_sidep_reg_drees, nom_reg)), 
        list(list(=, val_fixe, list(as.numeric, list([, data_sidep_reg_drees, 
            list(&, list(==, date, DATE_FIXE), list(==, nom_reg, 
                REGION)), "ti"))), list([, data_sidep_reg_drees, 
            list(==, nom_reg, REGION), list(:=, evo_ti_fixe, 
                list(-, list(/, ti, val_fixe), 1)), "nom_reg"), 
            list([, data_sidep_reg_drees, list(==, nom_reg, REGION), 
                list(:=, var_ti_fixe, list(-, ti, val_fixe)), 
                "nom_reg"))), list(setorder, data_sidep_dep_drees, 
        departement, date), list(=, data_sidep_dep_drees, list(
        [, data_sidep_dep_drees, data_sidep_dep_drees[, c("date", 
            "departement", "nb_pos", "nb_tot_PNIX")], list(c, 
            "date", "departement", "nb_pos", "nb_tot_PNIX"))), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(nb_pos_7j, 
        somme_7j(nb_pos)), by = "departement"], list(:=, nb_pos_7j, 
        list(res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
            x + data.table::shift(x, 1) + data.table::shift(x, 
                2) + data.table::shift(x, 3) + data.table::shift(x, 
                4) + data.table::shift(x, 5) + data.table::shift(x, 
                6)), return(res))), "departement"), list([, data_sidep_dep_drees, 
        data_sidep_dep_drees[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "departement"], list(:=, nb_tot_PNIX_7j, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), "departement"), list(=, 
        data_sidep_dep_drees, list(merge, data_sidep_dep_drees, 
            population_dep, "departement", "dep")), list([, data_sidep_dep_drees, 
        data_sidep_dep_drees[, `:=`(ti, nb_pos_7j/pop * 1e+05), 
            by = "departement"], list(:=, ti, list(*, list(/, 
            nb_pos_7j, pop), 1e+05)), "departement"), list(setorder, 
        data_sidep_dep_drees, departement, date), list([, data_sidep_dep_drees, 
        data_sidep_dep_drees[, `:=`(evo_ti_1, ti/shift(ti, 1) - 
            1), by = "departement"], list(:=, evo_ti_1, list(
            -, list(/, ti, list(shift, ti, 1)), 1)), "departement"), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(evo_ti_7, 
        ti/shift(ti, 7) - 1), by = "departement"], list(:=, evo_ti_7, 
        list(-, list(/, ti, list(shift, ti, 7)), 1)), "departement"), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(var_ti_7, 
        ti - shift(ti, 7)), by = "departement"], list(:=, var_ti_7, 
        list(-, ti, list(shift, ti, 7))), "departement"), list(
        for, DEPARTEMENT, list(unique, list($, data_sidep_dep_drees, 
            departement)), list(list(=, val_fixe, list(as.numeric, 
            list([, data_sidep_dep_drees, list(&, list(==, date, 
                DATE_FIXE), list(==, departement, DEPARTEMENT)), 
                "ti"))), list([, data_sidep_dep_drees, list(==, 
            departement, DEPARTEMENT), list(:=, evo_ti_fixe, 
            list(-, list(/, ti, val_fixe), 1)), "departement"), 
            list([, data_sidep_dep_drees, list(==, departement, 
                DEPARTEMENT), list(:=, var_ti_fixe, list(-, ti, 
                val_fixe)), "departement"))), list(=, data_sidep_dep_drees, 
        list(merge, data_sidep_dep_drees, libelle_dep, "departement", 
            "dep")), list(=, aux, list([, libelle_reg, libelle_reg[, 
        c("reg", "libelle")], list(c, "reg", "libelle"))), list(
        [, aux, aux[, `:=`(libelle_reg, libelle)], list(:=, libelle_reg, 
            libelle)), list([, aux, aux[, `:=`(libelle, NULL)], 
        list(:=, libelle, NULL)), list([, aux, aux[, `:=`(reg, 
        as.numeric(reg))], list(:=, reg, list(as.numeric, reg))), 
    list(=, data_sidep_dep_drees, list(merge, data_sidep_dep_drees, 
        aux, "reg")), list(setorder, data_sidep_dep_drees, libelle), 
    list(=, tg, list([, data_sidep_reg_drees, list(&, list(>=, 
        date, DATE_DEPART), list(!=, nom_reg, "Région inconnue")), 
        list(c, "date", "nom_reg", "ti", "evo_ti_7", "var_ti_7", 
            "evo_ti_fixe", "var_ti_fixe"))), list(=, class, list(
        [, tg, list(==, date, list(max, date)))), list(setorder, 
        class, ti), list([, tg, tg[, `:=`(nom_reg, factor(nom_reg, 
        class$nom_reg))], list(:=, nom_reg, list(factor, nom_reg, 
        list($, class, nom_reg)))), list(=, G_france_ti_niv, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, ti))), list(scale_fill_distiller, list(
            list(::, RColorBrewer, brewer.pal), 9, "YlGn"), 1)), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
            list(geom_hline, list(-, list(min, list(which, list(
                >=, list($, class, ti), SEUIL_TI))), 0.5), 0.2))), 
    list(=, min, list(list(::, plyr, round_any), list(min, list(
        $, tg, evo_ti_7)), 0.1, floor)), list(=, max, list(list(
        ::, plyr, round_any), list(max, list($, tg, evo_ti_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_ti_var7, list(+, list(+, list(
        +, list(+, list(+, list(+, list(+, list(ggplot), list(
            geom_tile, tg, list(aes, date, nom_reg, evo_ti_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
        list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, ti), SEUIL_TI))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, var_ti_7)), 0.1, floor)), list(=, max, list(
        list(::, plyr, round_any), list(max, list($, tg, var_ti_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_ti_var7_delta, list(+, list(+, 
        list(+, list(+, list(+, list(+, list(+, list(ggplot), 
            list(geom_tile, tg, list(aes, date, nom_reg, var_ti_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, ti), SEUIL_TI))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, evo_ti_fixe)), 0.1, floor)), list(=, max, 
        list(list(::, plyr, round_any), list(max, list($, tg, 
            evo_ti_fixe)), 0.1, ceiling)), list(=, borne, list(
        max, list(abs, min), max)), list(=, G_france_ti_varfixe, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, evo_ti_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, ti), SEUIL_TI))), 
            0.5), 0.2))), list(=, min, list(list(::, plyr, round_any), 
        list(min, list($, tg, var_ti_fixe)), 0.1, floor)), list(
        =, max, list(list(::, plyr, round_any), list(max, list(
            $, tg, var_ti_fixe)), 0.1, ceiling)), list(=, borne, 
        list(max, list(abs, min), max)), list(=, G_france_ti_varfixe_delta, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, var_ti_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, ti), SEUIL_TI))), 
            0.5), 0.2))), list(=, fichier_niv, list(file.path, 
        list(tempdir), "niv.png")), list(ggsave, G_france_ti_niv, 
        fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(file.path, 
        list(tempdir), "evo_7.png")), list(ggsave, G_france_ti_var7, 
        fichier_evo_7, 5.8, 6), list(=, fichier_var_7, list(file.path, 
        list(tempdir), "var_7.png")), list(ggsave, G_france_ti_var7_delta, 
        fichier_var_7, 5.8, 6), list(=, fichier_evo_fixe, list(
        file.path, list(tempdir), "evo_fixe.png")), list(ggsave, 
        G_france_ti_varfixe, fichier_evo_fixe, 5.8, 6), list(
        =, fichier_var_fixe, list(file.path, list(tempdir), "var_fixe.png")), 
    list(ggsave, G_france_ti_varfixe_delta, fichier_var_fixe, 
        5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
                fichier_niv, list(/, 10, 3), 5), list(ph_location, 
                1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_evo_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_evo_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
                "header")), list(font, "Calibri", "header")), 
            list(ph_location, 1.5, list(+, 6, list(/, 5, 6))))), 
        list(ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
            list(width, 8)), list(height, 0.3, "header")), list(
            font, "Calibri", "header")), list(fontsize, 8, "header")), 
            list(ph_location, 6, 1))), list(ph_with, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(aux = data.frame(matrix(NA, nrow = 0, 
                ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
            list(::, flextable, align), "left", "header")), list(
            bold, "header")), list(width, 8)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            fontsize, 8, "header")), list(ph_location, 6.6, 1)))), 
    list(=, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
            fichier_niv, list(/, 10, 3), 5), list(ph_location, 
            1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_var_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_var_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(aux = data.frame(matrix(NA, nrow = 0, 
                ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
            list(::, flextable, align), "center", "header")), 
            list(bold, "header")), list(color, "white", "header")), 
            list(bg, list(rgb, 0, 0, list(/, 128, 255)), "header")), 
            list(width, 3)), list(height, 0.3, "header")), list(
        font, "Calibri", "header")), list(ph_location, 1.5, list(
        +, 6, list(/, 5, 6))))), list(ph_with, list(%>%, list(
        %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                names(aux) = texte, return(aux)), list(flextable)), 
            list(border_remove)), list(list(::, flextable, align), 
            "left", "header")), list(width, 8)), list(height, 
            0.3, "header")), list(font, "Calibri", "header")), 
        list(fontsize, 8, "header")), list(ph_location, 6, 1))), 
        list(ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
                list(bold, "header")), list(width, 8)), list(
            height, 0.3, "header")), list(font, "Calibri", "header")), 
            list(fontsize, 8, "header")), list(ph_location, 6.6, 
            1)))), list(for, LIB_REG, list(unique, list($, data_sidep_dep_drees, 
        libelle_reg)), list(list(print, LIB_REG), list(=, tg, 
        list([, data_sidep_dep_drees, list(&, list(>=, date, 
            DATE_DEPART), list(==, libelle_reg, LIB_REG)), list(
            c, "date", "libelle", "ti", "evo_ti_7", "var_ti_7", 
            "evo_ti_fixe", "var_ti_fixe"))), list(=, class, list(
        [, tg, list(==, date, list(max, date)))), list(setorder, 
        class, ti), list([, tg, tg[, `:=`(libelle, factor(libelle, 
        class$libelle))], list(:=, libelle, list(factor, libelle, 
        list($, class, libelle)))), list(=, G_reg_ti_niv, list(
        +, list(+, list(+, list(+, list(+, list(ggplot), list(
            geom_tile, tg, list(aes, date, libelle, ti))), list(
            scale_fill_distiller, list(list(::, RColorBrewer, 
                brewer.pal), 9, "YlGn"), 1)), list(theme_minimal)), 
            list(theme, list(element_blank), list(element_text, 
                8), list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(coord_fixed))), 
        list(if, list(any, list(>=, list($, class, ti), SEUIL_TI)), 
            list(list(=, G_reg_ti_niv, list(+, list(+, G_reg_ti_niv, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, ti), SEUIL_TI))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, evo_ti_7)), 0.1, floor)), list(=, 
            max, list(list(::, plyr, round_any), list(max, list(
                $, tg, evo_ti_7)), 0.1, ceiling)), list(=, borne, 
            list(max, list(abs, min), max)), list(=, G_reg_ti_var7, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                ggplot), list(geom_tile, tg, list(aes, date, 
                libelle, evo_ti_7))), list(scale_fill_gradient2, 
                list(rgb, 0, 0, list(/, 128, 255)), list(rgb, 
                  list(/, 192, 255), 0, 0), "white", 0, list(
                  c, list(-, borne), borne))), list(theme_minimal)), 
                list(theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, ti), SEUIL_TI)), 
            list(list(=, G_reg_ti_var7, list(+, list(+, G_reg_ti_var7, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, ti), SEUIL_TI))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_ti_7)), 0.1, floor)), list(=, 
            max, list(list(::, plyr, round_any), list(max, list(
                $, tg, var_ti_7)), 0.1, ceiling)), list(=, borne, 
            list(max, list(abs, min), max)), list(=, G_reg_ti_var7_delta, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                ggplot), list(geom_tile, tg, list(aes, date, 
                libelle, var_ti_7))), list(scale_fill_gradient2, 
                list(rgb, 0, 0, list(/, 128, 255)), list(rgb, 
                  list(/, 192, 255), 0, 0), "white", 0, list(
                  c, list(-, borne), borne))), list(theme_minimal)), 
                list(theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, ti), SEUIL_TI)), 
            list(list(=, G_reg_ti_var7_delta, list(+, list(+, 
                G_reg_ti_var7_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, ti), SEUIL_TI))), 0.5), 
                  0.2))))), list(=, min, list(list(::, plyr, 
            round_any), list(min, list($, tg, evo_ti_fixe)), 
            0.1, floor)), list(=, max, list(list(::, plyr, round_any), 
            list(max, list($, tg, evo_ti_fixe)), 0.1, ceiling)), 
        list(=, borne, list(max, list(abs, min), max)), list(
            =, G_reg_ti_varfixe, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, evo_ti_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, ti), SEUIL_TI)), 
            list(list(=, G_reg_ti_varfixe, list(+, list(+, G_reg_ti_varfixe, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, ti), SEUIL_TI))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_ti_fixe)), 0.1, floor)), list(
            =, max, list(list(::, plyr, round_any), list(max, 
                list($, tg, var_ti_fixe)), 0.1, ceiling)), list(
            =, borne, list(max, list(abs, min), max)), list(=, 
            G_reg_ti_varfixe_delta, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, var_ti_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, ti), SEUIL_TI)), 
            list(list(=, G_reg_ti_varfixe_delta, list(+, list(
                +, G_reg_ti_varfixe_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, ti), SEUIL_TI))), 0.5), 
                  0.2))))), list(=, fichier_niv, list(file.path, 
            list(tempdir), "niv.png")), list(ggsave, G_reg_ti_niv, 
            fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(
            file.path, list(tempdir), "evo_7.png")), list(ggsave, 
            G_reg_ti_var7, fichier_evo_7, 5.8, 6), list(=, fichier_var_7, 
            list(file.path, list(tempdir), "var_7.png")), list(
            ggsave, G_reg_ti_var7_delta, fichier_var_7, 5.8, 
            6), list(=, fichier_evo_fixe, list(file.path, list(
            tempdir), "evo_fixe.png")), list(ggsave, G_reg_ti_varfixe, 
            fichier_evo_fixe, 5.8, 6), list(=, fichier_var_fixe, 
            list(file.path, list(tempdir), "var_fixe.png")), 
        list(ggsave, G_reg_ti_varfixe_delta, fichier_var_fixe, 
            5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, PPT_EVO, list(add_slide, "Title Slide", 
                  "Office Theme")), list(ph_with, list(external_img, 
                  fichier_niv, list(/, 10, 3), 5), list(ph_location, 
                  1.5, 0), FALSE)), list(ph_with, list(external_img, 
                fichier_evo_7, list(/, 10, 3), 5), list(ph_location, 
                1.5, list(/, 10, 3)), FALSE)), list(ph_with, 
                list(external_img, fichier_evo_fixe, list(/, 
                  10, 3), 5), list(ph_location, 1.5, list(/, 
                  20, 3)), FALSE)), list(ph_with, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                  color, "white", "header")), list(bg, list(rgb, 
                  0, 0, list(/, 128, 255)), "header")), list(
                  width, 10)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(ph_location, 
                0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(/, 1, 6)))), list(ph_with, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                  color, "white", "header")), list(bg, list(rgb, 
                  0, 0, list(/, 128, 255)), "header")), list(
                  width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
                "header")), list(font, "Calibri", "header")), 
            list(ph_location, 1.5, list(+, 6, list(/, 5, 6))))), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "left", "header")), 
                list(width, 8)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(fontsize, 
                8, "header")), list(ph_location, 6, 1)))), list(
            =, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, PPT_DELTA, list(add_slide, "Title Slide", 
                    "Office Theme")), list(ph_with, list(external_img, 
                    fichier_niv, list(/, 10, 3), 5), list(ph_location, 
                    1.5, 0), FALSE)), list(ph_with, list(external_img, 
                  fichier_var_7, list(/, 10, 3), 5), list(ph_location, 
                  1.5, list(/, 10, 3)), FALSE)), list(ph_with, 
                  list(external_img, fichier_var_fixe, list(/, 
                    10, 3), 5), list(ph_location, 1.5, list(/, 
                    20, 3)), FALSE)), list(ph_with, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                      list(list(::, flextable, align), "center", 
                        "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 10)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 3)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  1.5, list(/, 1, 6)))), list(ph_with, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                  color, "white", "header")), list(bg, list(rgb, 
                  0, 0, list(/, 128, 255)), "header")), list(
                  width, 3)), list(height, 0.3, "header")), list(
                  font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(+, 6, list(/, 5, 6))))), list(ph_with, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "left", "header")), 
                  list(width, 8)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(fontsize, 
                  8, "header")), list(ph_location, 6, 1)))))), 
    list(=, path_ppt_evo, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - heatmap ti (donnees drees) - evolution.pptx")), 
    list(if, list(file.exists, path_ppt_evo), list(file.remove, 
        path_ppt_delta)), list(print, PPT_EVO, path_ppt_evo), 
    list(=, path_ppt_delta, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - heatmap ti (donnees drees) - delta.pptx")), 
    list(if, list(file.exists, path_ppt_delta), list(file.remove, 
        path_ppt_delta)), list(print, PPT_DELTA, path_ppt_delta), 
    list(write.csv, data_sidep_dep_drees, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - data_dep_ti.csv")), list(write.csv, 
        data_sidep_reg_drees, list(paste0, chemin_sortie_heatmaps, 
            list(Sys.Date), " - data_reg_ti.csv")), list(print, 
        list(gc, T)), list(library, data.table), list(library, 
        ggplot2), list(library, openxlsx), list(library, officer), 
    list(library, flextable), list(library, dplyr), list(<-, 
        path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(<-, 
        somme_7j, list(function, list(as.pairlist(alist(x = ))), 
            list(list(<-, res, list(ifelse, list(is.na, list(
                shift, x, 6)), NA, list(+, list(+, list(+, list(
                +, list(+, list(+, x, list(shift, x, 1)), list(
                  shift, x, 2)), list(shift, x, 3)), list(shift, 
                x, 4)), list(shift, x, 5)), list(shift, x, 6)))), 
                list(return, res)), list(5567L, 13L, 5571L, 1L, 
                13L, 1L, 5567L, 5571L))), list(<-, Creer_une_boite, 
        list(function, list(as.pairlist(alist(texte = ))), list(
            list(=, aux, list(data.frame, list(matrix, NA, 0, 
                1))), list(=, list(names, aux), texte), list(
                return, aux)), list(5572L, 20L, 5576L, 1L, 20L, 
            1L, 5572L, 5576L))), list(=, DATE_DEPART, "2021-01-16"), 
    list(=, SEUIL_TP, 0.05), list(=, SEUIL_TI, 200), list(=, 
        DATE_FIXE, "2021-01-16"), list(=, DATE_DREES, list(gsub, 
        "-", "", list(Sys.Date))), list(=, chemin_sorties_quot, 
        list(paste0, path, "data/sorties/nb_tests/")), list(=, 
        chemin_utils_sidep, list(paste0, path, "data/utils/")), 
    list(=, chemin_sortie_heatmaps, list(paste0, path, "data/sorties/heatmaps/")), 
    list(=, data_sidep_reg_drees_pcr, list(setDT, list(read.xlsx, 
        list(paste0, chemin_sorties_quot, DATE_DREES, "_sidep_pcr_valid.xlsx"), 
        "regions", T))), list(=, data_sidep_dep_drees_pcr, list(
        setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_valid.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees_tag, list(setDT, 
        list(read.xlsx, list(paste0, chemin_sorties_quot, DATE_DREES, 
            "_sidep_antigenique_valid.xlsx"), "regions", T))), 
    list(=, data_sidep_dep_drees_tag, list(setDT, list(read.xlsx, 
        list(paste0, chemin_sorties_quot, DATE_DREES, "_sidep_antigenique_valid.xlsx"), 
        "departements", T))), list(=, data_sidep_reg_drees_pcr_sal_mil, 
        list(setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid.xlsx"), "regions", 
            T))), list(=, data_sidep_dep_drees_pcr_sal_mil, list(
        setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees, list(rbind, list(
        [, data_sidep_reg_drees_pcr, data_sidep_reg_drees_pcr[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
        list([, data_sidep_reg_drees_tag, data_sidep_reg_drees_tag[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
        list([, data_sidep_reg_drees_pcr_sal_mil, data_sidep_reg_drees_pcr_sal_mil[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")))), 
    list(=, data_sidep_reg_drees, list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "nom_reg")], list(., list(sum, nb_pos), 
            list(sum, nb_tot_PNIX)), list(c, "date", "nom_reg"))), 
    list(=, data_sidep_dep_drees, list(rbind, list([, data_sidep_dep_drees_pcr, 
        data_sidep_dep_drees_pcr[, c("date", "departement", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "departement", "nb_pos", 
            "nb_tot_PNIX")), list([, data_sidep_dep_drees_tag, 
        data_sidep_dep_drees_tag[, c("date", "departement", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "departement", "nb_pos", 
            "nb_tot_PNIX")), list([, data_sidep_dep_drees_pcr_sal_mil, 
        data_sidep_dep_drees_pcr_sal_mil[, c("date", "departement", 
            "nb_pos", "nb_tot_PNIX")], list(c, "date", "departement", 
            "nb_pos", "nb_tot_PNIX")))), list(=, data_sidep_dep_drees, 
        list([, data_sidep_dep_drees, data_sidep_dep_drees[, 
            .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "departement")], list(., list(sum, 
            nb_pos), list(sum, nb_tot_PNIX)), list(c, "date", 
            "departement"))), list(=, libelle_reg, list(fread, 
        list(paste0, chemin_utils_sidep, "region2019.csv"), "UTF-8")), 
    list([, libelle_reg, libelle_reg[, `:=`(reg, as.character(reg))], 
        list(:=, reg, list(as.character, reg))), list(=, libelle_dep, 
        list(fread, list(paste0, chemin_utils_sidep, "departement2019.csv"), 
            "UTF-8")), list(setorder, data_sidep_reg_drees, nom_reg, 
        date), list(=, data_sidep_reg_drees, list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, c("date", "nom_reg", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "nom_reg", "nb_pos", 
            "nb_tot_PNIX"))), list([, data_sidep_reg_drees, data_sidep_reg_drees[, 
        `:=`(nb_pos_7j, somme_7j(nb_pos)), by = "nom_reg"], list(
        :=, nb_pos_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "nom_reg"], list(:=, nb_tot_PNIX_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, `:=`(tp, nb_pos_7j/nb_tot_PNIX_7j), 
            by = "nom_reg"], list(:=, tp, list(/, nb_pos_7j, 
            nb_tot_PNIX_7j)), "nom_reg"), list(setorder, data_sidep_reg_drees, 
        nom_reg, date), list([, data_sidep_reg_drees, data_sidep_reg_drees[, 
        `:=`(evo_tp_1, tp/shift(tp, 1) - 1), by = "nom_reg"], 
        list(:=, evo_tp_1, list(-, list(/, tp, list(shift, tp, 
            1)), 1)), "nom_reg"), list([, data_sidep_reg_drees, 
        data_sidep_reg_drees[, `:=`(evo_tp_7, tp/shift(tp, 7) - 
            1), by = "nom_reg"], list(:=, evo_tp_7, list(-, list(
            /, tp, list(shift, tp, 7)), 1)), "nom_reg"), list(
        [, data_sidep_reg_drees, data_sidep_reg_drees[, `:=`(var_tp_7, 
            tp - shift(tp, 7)), by = "nom_reg"], list(:=, var_tp_7, 
            list(-, tp, list(shift, tp, 7))), "nom_reg"), list(
        for, REGION, list(unique, list($, data_sidep_reg_drees, 
            nom_reg)), list(list(=, val_fixe, list(as.numeric, 
            list([, data_sidep_reg_drees, list(&, list(==, date, 
                DATE_FIXE), list(==, nom_reg, REGION)), "tp"))), 
            list([, data_sidep_reg_drees, list(==, nom_reg, REGION), 
                list(:=, evo_tp_fixe, list(-, list(/, tp, val_fixe), 
                  1)), "nom_reg"), list([, data_sidep_reg_drees, 
                list(==, nom_reg, REGION), list(:=, var_tp_fixe, 
                  list(-, tp, val_fixe)), "nom_reg"))), list(
        setorder, data_sidep_dep_drees, departement, date), list(
        =, data_sidep_dep_drees, list([, data_sidep_dep_drees, 
            data_sidep_dep_drees[, c("date", "departement", "nb_pos", 
                "nb_tot_PNIX")], list(c, "date", "departement", 
                "nb_pos", "nb_tot_PNIX"))), list([, data_sidep_dep_drees, 
        data_sidep_dep_drees[, `:=`(nb_pos_7j, somme_7j(nb_pos)), 
            by = "departement"], list(:=, nb_pos_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "departement"), list([, data_sidep_dep_drees, 
        data_sidep_dep_drees[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "departement"], list(:=, nb_tot_PNIX_7j, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), "departement"), list([, 
        data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(tp, 
            nb_pos_7j/nb_tot_PNIX_7j), by = "departement"], list(
            :=, tp, list(/, nb_pos_7j, nb_tot_PNIX_7j)), "departement"), 
    list(setorder, data_sidep_dep_drees, departement, date), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(evo_tp_1, 
        tp/shift(tp, 1) - 1), by = "departement"], list(:=, evo_tp_1, 
        list(-, list(/, tp, list(shift, tp, 1)), 1)), "departement"), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(evo_tp_7, 
        tp/shift(tp, 7) - 1), by = "departement"], list(:=, evo_tp_7, 
        list(-, list(/, tp, list(shift, tp, 7)), 1)), "departement"), 
    list([, data_sidep_dep_drees, data_sidep_dep_drees[, `:=`(var_tp_7, 
        tp - shift(tp, 7)), by = "departement"], list(:=, var_tp_7, 
        list(-, tp, list(shift, tp, 7))), "departement"), list(
        for, DEPARTEMENT, list(unique, list($, data_sidep_dep_drees, 
            departement)), list(list(=, val_fixe, list(as.numeric, 
            list([, data_sidep_dep_drees, list(&, list(==, date, 
                DATE_FIXE), list(==, departement, DEPARTEMENT)), 
                "tp"))), list([, data_sidep_dep_drees, list(==, 
            departement, DEPARTEMENT), list(:=, evo_tp_fixe, 
            list(-, list(/, tp, val_fixe), 1)), "departement"), 
            list([, data_sidep_dep_drees, list(==, departement, 
                DEPARTEMENT), list(:=, var_tp_fixe, list(-, tp, 
                val_fixe)), "departement"))), list(=, data_sidep_dep_drees, 
        list(merge, data_sidep_dep_drees, libelle_dep, "departement", 
            "dep")), list(=, aux, list([, libelle_reg, libelle_reg[, 
        c("reg", "libelle")], list(c, "reg", "libelle"))), list(
        [, aux, aux[, `:=`(libelle_reg, libelle)], list(:=, libelle_reg, 
            libelle)), list([, aux, aux[, `:=`(libelle, NULL)], 
        list(:=, libelle, NULL)), list([, aux, aux[, `:=`(reg, 
        as.numeric(reg))], list(:=, reg, list(as.numeric, reg))), 
    list(=, data_sidep_dep_drees, list(merge, data_sidep_dep_drees, 
        aux, "reg")), list(setorder, data_sidep_dep_drees, libelle), 
    list(=, tg, list([, data_sidep_reg_drees, list(&, list(>=, 
        date, DATE_DEPART), list(!=, nom_reg, "Région inconnue")), 
        list(c, "date", "nom_reg", "tp", "evo_tp_7", "var_tp_7", 
            "evo_tp_fixe", "var_tp_fixe"))), list(=, class, list(
        [, tg, list(==, date, list(max, date)))), list(setorder, 
        class, tp), list([, tg, tg[, `:=`(nom_reg, factor(nom_reg, 
        class$nom_reg))], list(:=, nom_reg, list(factor, nom_reg, 
        list($, class, nom_reg)))), list(=, G_france_tp_niv, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, tp))), list(scale_fill_distiller, list(
            list(::, RColorBrewer, brewer.pal), 9, "YlGn"), 1)), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
            list(geom_hline, list(-, list(min, list(which, list(
                >=, list($, class, tp), SEUIL_TP))), 0.5), 0.2))), 
    list(=, min, list(list(::, plyr, round_any), list(min, list(
        $, tg, evo_tp_7)), 0.1, floor)), list(=, max, list(list(
        ::, plyr, round_any), list(max, list($, tg, evo_tp_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_tp_var7, list(+, list(+, list(
        +, list(+, list(+, list(+, list(+, list(ggplot), list(
            geom_tile, tg, list(aes, date, nom_reg, evo_tp_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
        list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, tp), SEUIL_TP))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, var_tp_7)), 0.1, floor)), list(=, max, list(
        list(::, plyr, round_any), list(max, list($, tg, var_tp_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_tp_var7_delta, list(+, list(+, 
        list(+, list(+, list(+, list(+, list(+, list(ggplot), 
            list(geom_tile, tg, list(aes, date, nom_reg, var_tp_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, tp), SEUIL_TP))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, evo_tp_fixe)), 0.1, floor)), list(=, max, 
        list(list(::, plyr, round_any), list(max, list($, tg, 
            evo_tp_fixe)), 0.1, ceiling)), list(=, borne, list(
        max, list(abs, min), max)), list(=, G_france_tp_varfixe, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, evo_tp_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, tp), SEUIL_TP))), 
            0.5), 0.2))), list(=, min, list(list(::, plyr, round_any), 
        list(min, list($, tg, var_tp_fixe)), 0.1, floor)), list(
        =, max, list(list(::, plyr, round_any), list(max, list(
            $, tg, var_tp_fixe)), 0.1, ceiling)), list(=, borne, 
        list(max, list(abs, min), max)), list(=, G_france_tp_varfixe_delta, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, var_tp_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, tp), SEUIL_TP))), 
            0.5), 0.2))), list(=, fichier_niv, list(file.path, 
        list(tempdir), "niv.png")), list(ggsave, G_france_tp_niv, 
        fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(file.path, 
        list(tempdir), "evo_7.png")), list(ggsave, G_france_tp_var7, 
        fichier_evo_7, 5.8, 6), list(=, fichier_var_7, list(file.path, 
        list(tempdir), "var_7.png")), list(ggsave, G_france_tp_var7_delta, 
        fichier_var_7, 5.8, 6), list(=, fichier_evo_fixe, list(
        file.path, list(tempdir), "evo_fixe.png")), list(ggsave, 
        G_france_tp_varfixe, fichier_evo_fixe, 5.8, 6), list(
        =, fichier_var_fixe, list(file.path, list(tempdir), "var_fixe.png")), 
    list(ggsave, G_france_tp_varfixe_delta, fichier_var_fixe, 
        5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
                fichier_niv, list(/, 10, 3), 5), list(ph_location, 
                1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_evo_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_evo_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
                "header")), list(font, "Calibri", "header")), 
            list(ph_location, 1.5, list(+, 6, list(/, 5, 6))))), 
        list(ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
            list(width, 8)), list(height, 0.3, "header")), list(
            font, "Calibri", "header")), list(fontsize, 8, "header")), 
            list(ph_location, 6.3, 1))), list(ph_with, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                names(aux) = texte, return(aux)), list(flextable)), 
            list(border_remove)), list(list(::, flextable, align), 
            "left", "header")), list(width, 8)), list(height, 
            0.3, "header")), list(font, "Calibri", "header")), 
        list(fontsize, 8, "header")), list(ph_location, 6, 1)))), 
    list(=, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
            fichier_niv, list(/, 10, 3), 5), list(ph_location, 
            1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_var_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_var_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(aux = data.frame(matrix(NA, nrow = 0, 
                ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
            list(::, flextable, align), "center", "header")), 
            list(bold, "header")), list(color, "white", "header")), 
            list(bg, list(rgb, 0, 0, list(/, 128, 255)), "header")), 
            list(width, 3)), list(height, 0.3, "header")), list(
        font, "Calibri", "header")), list(ph_location, 1.5, list(
        +, 6, list(/, 5, 6))))), list(ph_with, list(%>%, list(
        %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                names(aux) = texte, return(aux)), list(flextable)), 
            list(border_remove)), list(list(::, flextable, align), 
            "left", "header")), list(width, 8)), list(height, 
            0.3, "header")), list(font, "Calibri", "header")), 
        list(fontsize, 8, "header")), list(ph_location, 6.3, 
        1))), list(ph_with, list(%>%, list(%>%, list(%>%, list(
        %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
            nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
            list(flextable)), list(border_remove)), list(list(
            ::, flextable, align), "left", "header")), list(width, 
            8)), list(height, 0.3, "header")), list(font, "Calibri", 
        "header")), list(fontsize, 8, "header")), list(ph_location, 
        6, 1)))), list(for, LIB_REG, list(unique, list($, data_sidep_dep_drees, 
        libelle_reg)), list(list(=, tg, list([, data_sidep_dep_drees, 
        list(&, list(>=, date, DATE_DEPART), list(==, libelle_reg, 
            LIB_REG)), list(c, "date", "libelle", "tp", "evo_tp_7", 
            "var_tp_7", "evo_tp_fixe", "var_tp_fixe"))), list(
        =, class, list([, tg, list(==, date, list(max, date)))), 
        list(setorder, class, tp), list([, tg, tg[, `:=`(libelle, 
            factor(libelle, class$libelle))], list(:=, libelle, 
            list(factor, libelle, list($, class, libelle)))), 
        list(=, G_reg_tp_niv, list(+, list(+, list(+, list(+, 
            list(+, list(ggplot), list(geom_tile, tg, list(aes, 
                date, libelle, tp))), list(scale_fill_distiller, 
                list(list(::, RColorBrewer, brewer.pal), 9, "YlGn"), 
                1)), list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(coord_fixed))), list(if, list(any, list(>=, 
            list($, class, tp), SEUIL_TP)), list(list(=, G_reg_tp_niv, 
            list(+, list(+, G_reg_tp_niv, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, min, list(list(::, plyr, 
            round_any), list(min, list($, tg, evo_tp_7)), 0.1, 
            floor)), list(=, max, list(list(::, plyr, round_any), 
            list(max, list($, tg, evo_tp_7)), 0.1, ceiling)), 
        list(=, borne, list(max, list(abs, min), max)), list(
            =, G_reg_tp_var7, list(+, list(+, list(+, list(+, 
                list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, evo_tp_7))), list(
                  scale_fill_gradient2, list(rgb, 0, 0, list(
                    /, 128, 255)), list(rgb, list(/, 192, 255), 
                    0, 0), "white", 0, list(c, list(-, borne), 
                    borne))), list(theme_minimal)), list(theme, 
                list(element_blank), list(element_text, 8), list(
                  element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_var7, list(+, list(+, G_reg_tp_var7, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, tp), SEUIL_TP))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_tp_7)), 0.1, floor)), list(=, 
            max, list(list(::, plyr, round_any), list(max, list(
                $, tg, var_tp_7)), 0.1, ceiling)), list(=, borne, 
            list(max, list(abs, min), max)), list(=, G_reg_tp_var7_delta, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                ggplot), list(geom_tile, tg, list(aes, date, 
                libelle, var_tp_7))), list(scale_fill_gradient2, 
                list(rgb, 0, 0, list(/, 128, 255)), list(rgb, 
                  list(/, 192, 255), 0, 0), "white", 0, list(
                  c, list(-, borne), borne))), list(theme_minimal)), 
                list(theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_var7_delta, list(+, list(+, 
                G_reg_tp_var7_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, min, list(list(::, plyr, 
            round_any), list(min, list($, tg, evo_tp_fixe)), 
            0.1, floor)), list(=, max, list(list(::, plyr, round_any), 
            list(max, list($, tg, evo_tp_fixe)), 0.1, ceiling)), 
        list(=, borne, list(max, list(abs, min), max)), list(
            =, G_reg_tp_varfixe, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, evo_tp_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_varfixe, list(+, list(+, G_reg_tp_varfixe, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, tp), SEUIL_TP))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_tp_fixe)), 0.1, floor)), list(
            =, max, list(list(::, plyr, round_any), list(max, 
                list($, tg, var_tp_fixe)), 0.1, ceiling)), list(
            =, borne, list(max, list(abs, min), max)), list(=, 
            G_reg_tp_varfixe_delta, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, var_tp_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_varfixe_delta, list(+, list(
                +, G_reg_tp_varfixe_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, fichier_niv, list(file.path, 
            list(tempdir), "niv.png")), list(ggsave, G_reg_tp_niv, 
            fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(
            file.path, list(tempdir), "evo_7.png")), list(ggsave, 
            G_reg_tp_var7, fichier_evo_7, 5.8, 6), list(=, fichier_var_7, 
            list(file.path, list(tempdir), "var_7.png")), list(
            ggsave, G_reg_tp_var7_delta, fichier_var_7, 5.8, 
            6), list(=, fichier_evo_fixe, list(file.path, list(
            tempdir), "evo_fixe.png")), list(ggsave, G_reg_tp_varfixe, 
            fichier_evo_fixe, 5.8, 6), list(=, fichier_var_fixe, 
            list(file.path, list(tempdir), "var_fixe.png")), 
        list(ggsave, G_reg_tp_varfixe_delta, fichier_var_fixe, 
            5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, PPT_EVO, list(add_slide, 
                  "Title Slide", "Office Theme")), list(ph_with, 
                  list(external_img, fichier_niv, list(/, 10, 
                    3), 5), list(ph_location, 1.5, 0), FALSE)), 
                list(ph_with, list(external_img, fichier_evo_7, 
                  list(/, 10, 3), 5), list(ph_location, 1.5, 
                  list(/, 10, 3)), FALSE)), list(ph_with, list(
                external_img, fichier_evo_fixe, list(/, 10, 3), 
                5), list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
                list(ph_with, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                    list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                  list(width, 10)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(/, 1, 6)))), list(ph_with, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                  color, "white", "header")), list(bg, list(rgb, 
                  0, 0, list(/, 128, 255)), "header")), list(
                  width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(+, 6, list(/, 5, 6))))), list(ph_with, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
                list(width, 8)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(fontsize, 
                8, "header")), list(ph_location, 6.3, 1))), list(
            ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "left", "header")), 
                list(width, 8)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(fontsize, 
                8, "header")), list(ph_location, 6, 1)))), list(
            =, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, PPT_DELTA, list(add_slide, 
                    "Title Slide", "Office Theme")), list(ph_with, 
                    list(external_img, fichier_niv, list(/, 10, 
                      3), 5), list(ph_location, 1.5, 0), FALSE)), 
                  list(ph_with, list(external_img, fichier_var_7, 
                    list(/, 10, 3), 5), list(ph_location, 1.5, 
                    list(/, 10, 3)), FALSE)), list(ph_with, list(
                  external_img, fichier_var_fixe, list(/, 10, 
                    3), 5), list(ph_location, 1.5, list(/, 20, 
                  3)), FALSE)), list(ph_with, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                    list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                      list(list(::, flextable, align), "center", 
                        "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 10)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 3)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  1.5, list(/, 1, 6)))), list(ph_with, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                      list(list(::, flextable, align), "center", 
                        "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 3)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(+, 6, list(/, 5, 6))))), list(ph_with, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "left", "header")), 
                  list(width, 8)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(fontsize, 
                  8, "header")), list(ph_location, 6.3, 1))), 
                list(ph_with, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "left", 
                      "header")), list(width, 8)), list(height, 
                  0.3, "header")), list(font, "Calibri", "header")), 
                  list(fontsize, 8, "header")), list(ph_location, 
                  6, 1)))))), list(=, path_ppt_evo, list(paste0, 
        chemin_sortie_heatmaps, list(Sys.Date), " - heatmap tp (donnees drees) - evolution.pptx")), 
    list(if, list(file.exists, path_ppt_evo), list(file.remove, 
        path_ppt_delta)), list(print, PPT_EVO, path_ppt_evo), 
    list(=, path_ppt_delta, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - heatmap tp (donnees drees) - delta.pptx")), 
    list(if, list(file.exists, path_ppt_delta), list(file.remove, 
        path_ppt_delta)), list(print, PPT_DELTA, path_ppt_delta), 
    list(write.csv, data_sidep_dep_drees, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - data_dep_tp.csv")), list(write.csv, 
        data_sidep_reg_drees, list(paste0, chemin_sortie_heatmaps, 
            list(Sys.Date), " - data_reg_tp.csv")), list(print, 
        list(gc, T)), list(library, data.table), list(library, 
        ggplot2), list(library, openxlsx), list(library, officer), 
    list(library, flextable), list(library, dplyr), list(<-, 
        path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(<-, 
        somme_7j, list(function, list(as.pairlist(alist(x = ))), 
            list(list(<-, res, list(ifelse, list(is.na, list(
                shift, x, 6)), NA, list(+, list(+, list(+, list(
                +, list(+, list(+, x, list(shift, x, 1)), list(
                  shift, x, 2)), list(shift, x, 3)), list(shift, 
                x, 4)), list(shift, x, 5)), list(shift, x, 6)))), 
                list(return, res)), list(6312L, 13L, 6316L, 1L, 
                13L, 1L, 6312L, 6316L))), list(<-, Creer_une_boite, 
        list(function, list(as.pairlist(alist(texte = ))), list(
            list(=, aux, list(data.frame, list(matrix, NA, 0, 
                1))), list(=, list(names, aux), texte), list(
                return, aux)), list(6317L, 20L, 6321L, 1L, 20L, 
            1L, 6317L, 6321L))), list(=, DATE_DEPART, "2021-01-16"), 
    list(=, SEUIL_TP, 0.05), list(=, SEUIL_TI, 200), list(=, 
        DATE_FIXE, "2021-01-16"), list(=, DATE_DREES, list(gsub, 
        "-", "", list(Sys.Date))), list(=, chemin_sorties_quot, 
        list(paste0, path, "data/sorties/nb_tests/")), list(=, 
        chemin_utils_sidep, list(paste0, path, "data/utils/")), 
    list(=, chemin_sortie_heatmaps, list(paste0, path, "data/sorties/heatmaps/")), 
    list(=, data_sidep_reg_drees_pcr_65, list(setDT, list(read.xlsx, 
        list(paste0, chemin_sorties_quot, DATE_DREES, "_sidep_pcr_valid_65+.xlsx"), 
        "regions", T))), list(=, data_sidep_dep_drees_pcr_65, 
        list(setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_valid_65+.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees_tag_65, list(setDT, 
        list(read.xlsx, list(paste0, chemin_sorties_quot, DATE_DREES, 
            "_sidep_antigenique_valid_65+.xlsx"), "regions", 
            T))), list(=, data_sidep_dep_drees_tag_65, list(setDT, 
        list(read.xlsx, list(paste0, chemin_sorties_quot, DATE_DREES, 
            "_sidep_antigenique_valid_65+.xlsx"), "departements", 
            T))), list(=, data_sidep_reg_drees_pcr_sal_mil_65, 
        list(setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid_65+.xlsx"), 
            "regions", T))), list(=, data_sidep_dep_drees_pcr_sal_mil_65, 
        list(setDT, list(read.xlsx, list(paste0, chemin_sorties_quot, 
            DATE_DREES, "_sidep_pcr_sal_mil_valid_65+.xlsx"), 
            "departements", T))), list(=, data_sidep_reg_drees_65, 
        list(rbind, list([, data_sidep_reg_drees_pcr_65, data_sidep_reg_drees_pcr_65[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
            list([, data_sidep_reg_drees_tag_65, data_sidep_reg_drees_tag_65[, 
                c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], 
                list(c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")), 
            list([, data_sidep_reg_drees_pcr_sal_mil_65, data_sidep_reg_drees_pcr_sal_mil_65[, 
                c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], 
                list(c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX")))), 
    list(=, data_sidep_reg_drees_65, list([, data_sidep_reg_drees_65, 
        data_sidep_reg_drees_65[, .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "nom_reg")], list(., list(sum, nb_pos), 
            list(sum, nb_tot_PNIX)), list(c, "date", "nom_reg"))), 
    list(=, data_sidep_dep_drees_65, list(rbind, list([, data_sidep_dep_drees_pcr_65, 
        data_sidep_dep_drees_pcr_65[, c("date", "departement", 
            "nb_pos", "nb_tot_PNIX")], list(c, "date", "departement", 
            "nb_pos", "nb_tot_PNIX")), list([, data_sidep_dep_drees_tag_65, 
        data_sidep_dep_drees_tag_65[, c("date", "departement", 
            "nb_pos", "nb_tot_PNIX")], list(c, "date", "departement", 
            "nb_pos", "nb_tot_PNIX")), list([, data_sidep_dep_drees_pcr_sal_mil_65, 
        data_sidep_dep_drees_pcr_sal_mil_65[, c("date", "departement", 
            "nb_pos", "nb_tot_PNIX")], list(c, "date", "departement", 
            "nb_pos", "nb_tot_PNIX")))), list(=, data_sidep_dep_drees_65, 
        list([, data_sidep_dep_drees_65, data_sidep_dep_drees_65[, 
            .(nb_pos = sum(nb_pos), nb_tot_PNIX = sum(nb_tot_PNIX)), 
            by = c("date", "departement")], list(., list(sum, 
            nb_pos), list(sum, nb_tot_PNIX)), list(c, "date", 
            "departement"))), list(=, libelle_reg, list(fread, 
        list(paste0, chemin_utils_sidep, "region2019.csv"), "UTF-8")), 
    list([, libelle_reg, libelle_reg[, `:=`(reg, as.character(reg))], 
        list(:=, reg, list(as.character, reg))), list(=, libelle_dep, 
        list(fread, list(paste0, chemin_utils_sidep, "departement2019.csv"), 
            "UTF-8")), list(setorder, data_sidep_reg_drees_65, 
        nom_reg, date), list(=, data_sidep_reg_drees_65, list(
        [, data_sidep_reg_drees_65, data_sidep_reg_drees_65[, 
            c("date", "nom_reg", "nb_pos", "nb_tot_PNIX")], list(
            c, "date", "nom_reg", "nb_pos", "nb_tot_PNIX"))), 
    list([, data_sidep_reg_drees_65, data_sidep_reg_drees_65[, 
        `:=`(nb_pos_7j, somme_7j(nb_pos)), by = "nom_reg"], list(
        :=, nb_pos_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, data_sidep_reg_drees_65, 
        data_sidep_reg_drees_65[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "nom_reg"], list(:=, nb_tot_PNIX_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "nom_reg"), list([, data_sidep_reg_drees_65, 
        data_sidep_reg_drees_65[, `:=`(tp, nb_pos_7j/nb_tot_PNIX_7j), 
            by = "nom_reg"], list(:=, tp, list(/, nb_pos_7j, 
            nb_tot_PNIX_7j)), "nom_reg"), list(setorder, data_sidep_reg_drees_65, 
        nom_reg, date), list([, data_sidep_reg_drees_65, data_sidep_reg_drees_65[, 
        `:=`(evo_tp_1, tp/shift(tp, 1) - 1), by = "nom_reg"], 
        list(:=, evo_tp_1, list(-, list(/, tp, list(shift, tp, 
            1)), 1)), "nom_reg"), list([, data_sidep_reg_drees_65, 
        data_sidep_reg_drees_65[, `:=`(evo_tp_7, tp/shift(tp, 
            7) - 1), by = "nom_reg"], list(:=, evo_tp_7, list(
            -, list(/, tp, list(shift, tp, 7)), 1)), "nom_reg"), 
    list([, data_sidep_reg_drees_65, data_sidep_reg_drees_65[, 
        `:=`(var_tp_7, tp - shift(tp, 7)), by = "nom_reg"], list(
        :=, var_tp_7, list(-, tp, list(shift, tp, 7))), "nom_reg"), 
    list(for, REGION, list(unique, list($, data_sidep_reg_drees_65, 
        nom_reg)), list(list(=, val_fixe, list(as.numeric, list(
        [, data_sidep_reg_drees_65, list(&, list(==, date, DATE_FIXE), 
            list(==, nom_reg, REGION)), "tp"))), list([, data_sidep_reg_drees_65, 
        list(==, nom_reg, REGION), list(:=, evo_tp_fixe, list(
            -, list(/, tp, val_fixe), 1)), "nom_reg"), list([, 
        data_sidep_reg_drees_65, list(==, nom_reg, REGION), list(
            :=, var_tp_fixe, list(-, tp, val_fixe)), "nom_reg"))), 
    list(setorder, data_sidep_dep_drees_65, departement, date), 
    list(=, data_sidep_dep_drees_65, list([, data_sidep_dep_drees_65, 
        data_sidep_dep_drees_65[, c("date", "departement", "nb_pos", 
            "nb_tot_PNIX")], list(c, "date", "departement", "nb_pos", 
            "nb_tot_PNIX"))), list([, data_sidep_dep_drees_65, 
        data_sidep_dep_drees_65[, `:=`(nb_pos_7j, somme_7j(nb_pos)), 
            by = "departement"], list(:=, nb_pos_7j, list(res <- ifelse(is.na(data.table::shift(x, 
            6)), NA, x + data.table::shift(x, 1) + data.table::shift(x, 
            2) + data.table::shift(x, 3) + data.table::shift(x, 
            4) + data.table::shift(x, 5) + data.table::shift(x, 
            6)), return(res))), "departement"), list([, data_sidep_dep_drees_65, 
        data_sidep_dep_drees_65[, `:=`(nb_tot_PNIX_7j, somme_7j(nb_tot_PNIX)), 
            by = "departement"], list(:=, nb_tot_PNIX_7j, list(
            res <- ifelse(is.na(data.table::shift(x, 6)), NA, 
                x + data.table::shift(x, 1) + data.table::shift(x, 
                  2) + data.table::shift(x, 3) + data.table::shift(x, 
                  4) + data.table::shift(x, 5) + data.table::shift(x, 
                  6)), return(res))), "departement"), list([, 
        data_sidep_dep_drees_65, data_sidep_dep_drees_65[, `:=`(tp, 
            nb_pos_7j/nb_tot_PNIX_7j), by = "departement"], list(
            :=, tp, list(/, nb_pos_7j, nb_tot_PNIX_7j)), "departement"), 
    list(setorder, data_sidep_dep_drees_65, departement, date), 
    list([, data_sidep_dep_drees_65, data_sidep_dep_drees_65[, 
        `:=`(evo_tp_1, tp/shift(tp, 1) - 1), by = "departement"], 
        list(:=, evo_tp_1, list(-, list(/, tp, list(shift, tp, 
            1)), 1)), "departement"), list([, data_sidep_dep_drees_65, 
        data_sidep_dep_drees_65[, `:=`(evo_tp_7, tp/shift(tp, 
            7) - 1), by = "departement"], list(:=, evo_tp_7, 
            list(-, list(/, tp, list(shift, tp, 7)), 1)), "departement"), 
    list([, data_sidep_dep_drees_65, data_sidep_dep_drees_65[, 
        `:=`(var_tp_7, tp - shift(tp, 7)), by = "departement"], 
        list(:=, var_tp_7, list(-, tp, list(shift, tp, 7))), 
        "departement"), list(for, DEPARTEMENT, list(unique, list(
        $, data_sidep_dep_drees_65, departement)), list(list(
        =, val_fixe, list(as.numeric, list([, data_sidep_dep_drees_65, 
            list(&, list(==, date, DATE_FIXE), list(==, departement, 
                DEPARTEMENT)), "tp"))), list([, data_sidep_dep_drees_65, 
        list(==, departement, DEPARTEMENT), list(:=, evo_tp_fixe, 
            list(-, list(/, tp, val_fixe), 1)), "departement"), 
        list([, data_sidep_dep_drees_65, list(==, departement, 
            DEPARTEMENT), list(:=, var_tp_fixe, list(-, tp, val_fixe)), 
            "departement"))), list(=, data_sidep_dep_drees_65, 
        list(merge, data_sidep_dep_drees_65, libelle_dep, "departement", 
            "dep")), list(=, aux, list([, libelle_reg, libelle_reg[, 
        c("reg", "libelle")], list(c, "reg", "libelle"))), list(
        [, aux, aux[, `:=`(libelle_reg, libelle)], list(:=, libelle_reg, 
            libelle)), list([, aux, aux[, `:=`(libelle, NULL)], 
        list(:=, libelle, NULL)), list([, aux, aux[, `:=`(reg, 
        as.numeric(reg))], list(:=, reg, list(as.numeric, reg))), 
    list(=, data_sidep_dep_drees_65, list(merge, data_sidep_dep_drees_65, 
        aux, "reg")), list(setorder, data_sidep_dep_drees_65, 
        libelle), list(write.csv, data_sidep_dep_drees_65, list(
        paste0, chemin_sortie_heatmaps, list(Sys.Date), " - data_dep_tp_65.csv")), 
    list(write.csv, data_sidep_reg_drees_65, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - data_reg_tp_65.csv")), list(=, tg, 
        list([, data_sidep_reg_drees_65, list(&, list(>=, date, 
            DATE_DEPART), list(!=, nom_reg, "Région inconnue")), 
            list(c, "date", "nom_reg", "tp", "evo_tp_7", "var_tp_7", 
                "evo_tp_fixe", "var_tp_fixe"))), list(=, class, 
        list([, tg, list(==, date, list(max, date)))), list(setorder, 
        class, tp), list([, tg, tg[, `:=`(nom_reg, factor(nom_reg, 
        class$nom_reg))], list(:=, nom_reg, list(factor, nom_reg, 
        list($, class, nom_reg)))), list(=, G_france_tp_niv, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, tp))), list(scale_fill_distiller, list(
            list(::, RColorBrewer, brewer.pal), 9, "YlGn"), 1)), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
            list(geom_hline, list(-, list(min, list(which, list(
                >=, list($, class, tp), SEUIL_TP))), 0.5), 0.2))), 
    list(=, min, list(list(::, plyr, round_any), list(min, list(
        $, tg, evo_tp_7)), 0.1, floor)), list(=, max, list(list(
        ::, plyr, round_any), list(max, list($, tg, evo_tp_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_tp_var7, list(+, list(+, list(
        +, list(+, list(+, list(+, list(+, list(ggplot), list(
            geom_tile, tg, list(aes, date, nom_reg, evo_tp_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
        list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, tp), SEUIL_TP))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, var_tp_7)), 0.1, floor)), list(=, max, list(
        list(::, plyr, round_any), list(max, list($, tg, var_tp_7)), 
        0.1, ceiling)), list(=, borne, list(max, list(abs, min), 
        max)), list(=, G_france_tp_var7_delta, list(+, list(+, 
        list(+, list(+, list(+, list(+, list(+, list(ggplot), 
            list(geom_tile, tg, list(aes, date, nom_reg, var_tp_7))), 
            list(scale_fill_gradient2, list(rgb, 0, 0, list(/, 
                128, 255)), list(rgb, list(/, 192, 255), 0, 0), 
                "white", 0, list(c, list(-, borne), borne))), 
            list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(xlab, "Date de validation")), list(coord_fixed)), 
        list(geom_hline, list(-, list(min, list(which, list(>=, 
            list($, class, tp), SEUIL_TP))), 0.5), 0.2))), list(
        =, min, list(list(::, plyr, round_any), list(min, list(
            $, tg, evo_tp_fixe)), 0.1, floor)), list(=, max, 
        list(list(::, plyr, round_any), list(max, list($, tg, 
            evo_tp_fixe)), 0.1, ceiling)), list(=, borne, list(
        max, list(abs, min), max)), list(=, G_france_tp_varfixe, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, evo_tp_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, tp), SEUIL_TP))), 
            0.5), 0.2))), list(=, min, list(list(::, plyr, round_any), 
        list(min, list($, tg, var_tp_fixe)), 0.1, floor)), list(
        =, max, list(list(::, plyr, round_any), list(max, list(
            $, tg, var_tp_fixe)), 0.1, ceiling)), list(=, borne, 
        list(max, list(abs, min), max)), list(=, G_france_tp_varfixe_delta, 
        list(+, list(+, list(+, list(+, list(+, list(+, list(
            +, list(ggplot), list(geom_tile, tg, list(aes, date, 
                nom_reg, var_tp_fixe))), list(scale_fill_gradient2, 
            list(rgb, 0, 0, list(/, 128, 255)), list(rgb, list(
                /, 192, 255), 0, 0), "white", 0, list(c, list(
                -, borne), borne))), list(theme_minimal)), list(
            theme, list(element_blank), list(element_text, 8), 
            list(element_blank), "bottom", list(element_text, 
                0.5), list(element_text, 0.5))), list(xlab, "Date de validation")), 
            list(coord_fixed)), list(geom_hline, list(-, list(
            min, list(which, list(>=, list($, class, tp), SEUIL_TP))), 
            0.5), 0.2))), list(=, fichier_niv, list(file.path, 
        list(tempdir), "niv.png")), list(ggsave, G_france_tp_niv, 
        fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(file.path, 
        list(tempdir), "evo_7.png")), list(ggsave, G_france_tp_var7, 
        fichier_evo_7, 5.8, 6), list(=, fichier_var_7, list(file.path, 
        list(tempdir), "var_7.png")), list(ggsave, G_france_tp_var7_delta, 
        fichier_var_7, 5.8, 6), list(=, fichier_evo_fixe, list(
        file.path, list(tempdir), "evo_fixe.png")), list(ggsave, 
        G_france_tp_varfixe, fichier_evo_fixe, 5.8, 6), list(
        =, fichier_var_fixe, list(file.path, list(tempdir), "var_fixe.png")), 
    list(ggsave, G_france_tp_varfixe_delta, fichier_var_fixe, 
        5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
                fichier_niv, list(/, 10, 3), 5), list(ph_location, 
                1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_evo_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_evo_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
                "header")), list(font, "Calibri", "header")), 
            list(ph_location, 1.5, list(+, 6, list(/, 5, 6))))), 
        list(ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
            list(width, 8)), list(height, 0.3, "header")), list(
            font, "Calibri", "header")), list(fontsize, 8, "header")), 
            list(ph_location, 6.3, 1))), list(ph_with, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                names(aux) = texte, return(aux)), list(flextable)), 
            list(border_remove)), list(list(::, flextable, align), 
            "left", "header")), list(width, 8)), list(height, 
            0.3, "header")), list(font, "Calibri", "header")), 
        list(fontsize, 8, "header")), list(ph_location, 6, 1)))), 
    list(=, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(read_pptx), list(add_slide, "Title Slide", 
                "Office Theme")), list(ph_with, list(external_img, 
            fichier_niv, list(/, 10, 3), 5), list(ph_location, 
            1.5, 0), FALSE)), list(ph_with, list(external_img, 
            fichier_var_7, list(/, 10, 3), 5), list(ph_location, 
            1.5, list(/, 10, 3)), FALSE)), list(ph_with, list(
            external_img, fichier_var_fixe, list(/, 10, 3), 5), 
            list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
            list(ph_with, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                10)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 0.5, 
                0))), list(ph_with, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "center", "header")), 
                list(bold, "header")), list(color, "white", "header")), 
                list(bg, list(rgb, 0, 0, list(/, 128, 255)), 
                  "header")), list(width, 3)), list(height, 0.3, 
            "header")), list(font, "Calibri", "header")), list(
            ph_location, 1.5, list(/, 1, 6)))), list(ph_with, 
            list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                  names(aux) = texte, return(aux)), list(flextable)), 
                  list(border_remove)), list(list(::, flextable, 
                  align), "center", "header")), list(bold, "header")), 
                list(color, "white", "header")), list(bg, list(
                rgb, 0, 0, list(/, 128, 255)), "header")), list(
                width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
        list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
            %>%, list(%>%, list(aux = data.frame(matrix(NA, nrow = 0, 
                ncol = 1)), names(aux) = texte, return(aux)), 
                list(flextable)), list(border_remove)), list(
            list(::, flextable, align), "center", "header")), 
            list(bold, "header")), list(color, "white", "header")), 
            list(bg, list(rgb, 0, 0, list(/, 128, 255)), "header")), 
            list(width, 3)), list(height, 0.3, "header")), list(
        font, "Calibri", "header")), list(ph_location, 1.5, list(
        +, 6, list(/, 5, 6))))), list(ph_with, list(%>%, list(
        %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(%>%, 
            list(aux = data.frame(matrix(NA, nrow = 0, ncol = 1)), 
                names(aux) = texte, return(aux)), list(flextable)), 
            list(border_remove)), list(list(::, flextable, align), 
            "left", "header")), list(width, 8)), list(height, 
            0.3, "header")), list(font, "Calibri", "header")), 
        list(fontsize, 8, "header")), list(ph_location, 6.3, 
        1))), list(ph_with, list(%>%, list(%>%, list(%>%, list(
        %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
            nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
            list(flextable)), list(border_remove)), list(list(
            ::, flextable, align), "left", "header")), list(width, 
            8)), list(height, 0.3, "header")), list(font, "Calibri", 
        "header")), list(fontsize, 8, "header")), list(ph_location, 
        6, 1)))), list(for, LIB_REG, list(unique, list($, data_sidep_dep_drees_65, 
        libelle_reg)), list(list(=, tg, list([, data_sidep_dep_drees_65, 
        list(&, list(>=, date, DATE_DEPART), list(==, libelle_reg, 
            LIB_REG)), list(c, "date", "libelle", "tp", "evo_tp_7", 
            "var_tp_7", "evo_tp_fixe", "var_tp_fixe"))), list(
        =, class, list([, tg, list(==, date, list(max, date)))), 
        list(setorder, class, tp), list([, tg, tg[, `:=`(libelle, 
            factor(libelle, class$libelle))], list(:=, libelle, 
            list(factor, libelle, list($, class, libelle)))), 
        list(=, G_reg_tp_niv, list(+, list(+, list(+, list(+, 
            list(+, list(ggplot), list(geom_tile, tg, list(aes, 
                date, libelle, tp))), list(scale_fill_distiller, 
                list(list(::, RColorBrewer, brewer.pal), 9, "YlGn"), 
                1)), list(theme_minimal)), list(theme, list(element_blank), 
            list(element_text, 8), list(element_blank), "bottom", 
            list(element_text, 0.5), list(element_text, 0.5))), 
            list(coord_fixed))), list(if, list(any, list(>=, 
            list($, class, tp), SEUIL_TP)), list(list(=, G_reg_tp_niv, 
            list(+, list(+, G_reg_tp_niv, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, min, list(list(::, plyr, 
            round_any), list(min, list($, tg, evo_tp_7)), 0.1, 
            floor)), list(=, max, list(list(::, plyr, round_any), 
            list(max, list($, tg, evo_tp_7)), 0.1, ceiling)), 
        list(=, borne, list(max, list(abs, min), max)), list(
            =, G_reg_tp_var7, list(+, list(+, list(+, list(+, 
                list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, evo_tp_7))), list(
                  scale_fill_gradient2, list(rgb, 0, 0, list(
                    /, 128, 255)), list(rgb, list(/, 192, 255), 
                    0, 0), "white", 0, list(c, list(-, borne), 
                    borne))), list(theme_minimal)), list(theme, 
                list(element_blank), list(element_text, 8), list(
                  element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_var7, list(+, list(+, G_reg_tp_var7, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, tp), SEUIL_TP))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_tp_7)), 0.1, floor)), list(=, 
            max, list(list(::, plyr, round_any), list(max, list(
                $, tg, var_tp_7)), 0.1, ceiling)), list(=, borne, 
            list(max, list(abs, min), max)), list(=, G_reg_tp_var7_delta, 
            list(+, list(+, list(+, list(+, list(+, list(+, list(
                ggplot), list(geom_tile, tg, list(aes, date, 
                libelle, var_tp_7))), list(scale_fill_gradient2, 
                list(rgb, 0, 0, list(/, 128, 255)), list(rgb, 
                  list(/, 192, 255), 0, 0), "white", 0, list(
                  c, list(-, borne), borne))), list(theme_minimal)), 
                list(theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_var7_delta, list(+, list(+, 
                G_reg_tp_var7_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, min, list(list(::, plyr, 
            round_any), list(min, list($, tg, evo_tp_fixe)), 
            0.1, floor)), list(=, max, list(list(::, plyr, round_any), 
            list(max, list($, tg, evo_tp_fixe)), 0.1, ceiling)), 
        list(=, borne, list(max, list(abs, min), max)), list(
            =, G_reg_tp_varfixe, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, evo_tp_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_varfixe, list(+, list(+, G_reg_tp_varfixe, 
                list(xlab, "Date de validation")), list(geom_hline, 
                list(-, list(min, list(which, list(>=, list($, 
                  class, tp), SEUIL_TP))), 0.5), 0.2))))), list(
            =, min, list(list(::, plyr, round_any), list(min, 
                list($, tg, var_tp_fixe)), 0.1, floor)), list(
            =, max, list(list(::, plyr, round_any), list(max, 
                list($, tg, var_tp_fixe)), 0.1, ceiling)), list(
            =, borne, list(max, list(abs, min), max)), list(=, 
            G_reg_tp_varfixe_delta, list(+, list(+, list(+, list(
                +, list(+, list(+, list(ggplot), list(geom_tile, 
                  tg, list(aes, date, libelle, var_tp_fixe))), 
                  list(scale_fill_gradient2, list(rgb, 0, 0, 
                    list(/, 128, 255)), list(rgb, list(/, 192, 
                    255), 0, 0), "white", 0, list(c, list(-, 
                    borne), borne))), list(theme_minimal)), list(
                theme, list(element_blank), list(element_text, 
                  8), list(element_blank), "bottom", list(element_text, 
                  0.5), list(element_text, 0.5))), list(coord_fixed)), 
                list(xlab, "Date de validation"))), list(if, 
            list(any, list(>=, list($, class, tp), SEUIL_TP)), 
            list(list(=, G_reg_tp_varfixe_delta, list(+, list(
                +, G_reg_tp_varfixe_delta, list(xlab, "Date de validation")), 
                list(geom_hline, list(-, list(min, list(which, 
                  list(>=, list($, class, tp), SEUIL_TP))), 0.5), 
                  0.2))))), list(=, fichier_niv, list(file.path, 
            list(tempdir), "niv.png")), list(ggsave, G_reg_tp_niv, 
            fichier_niv, 5.8, 6), list(=, fichier_evo_7, list(
            file.path, list(tempdir), "evo_7.png")), list(ggsave, 
            G_reg_tp_var7, fichier_evo_7, 5.8, 6), list(=, fichier_var_7, 
            list(file.path, list(tempdir), "var_7.png")), list(
            ggsave, G_reg_tp_var7_delta, fichier_var_7, 5.8, 
            6), list(=, fichier_evo_fixe, list(file.path, list(
            tempdir), "evo_fixe.png")), list(ggsave, G_reg_tp_varfixe, 
            fichier_evo_fixe, 5.8, 6), list(=, fichier_var_fixe, 
            list(file.path, list(tempdir), "var_fixe.png")), 
        list(ggsave, G_reg_tp_varfixe_delta, fichier_var_fixe, 
            5.8, 6), list(=, PPT_EVO, list(%>%, list(%>%, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, PPT_EVO, list(add_slide, 
                  "Title Slide", "Office Theme")), list(ph_with, 
                  list(external_img, fichier_niv, list(/, 10, 
                    3), 5), list(ph_location, 1.5, 0), FALSE)), 
                list(ph_with, list(external_img, fichier_evo_7, 
                  list(/, 10, 3), 5), list(ph_location, 1.5, 
                  list(/, 10, 3)), FALSE)), list(ph_with, list(
                external_img, fichier_evo_fixe, list(/, 10, 3), 
                5), list(ph_location, 1.5, list(/, 20, 3)), FALSE)), 
                list(ph_with, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                    list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                  list(width, 10)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(/, 1, 6)))), list(ph_with, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                  color, "white", "header")), list(bg, list(rgb, 
                  0, 0, list(/, 128, 255)), "header")), list(
                  width, 3)), list(height, 0.3, "header")), list(
                font, "Calibri", "header")), list(ph_location, 
                1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(+, 6, list(/, 5, 6))))), list(ph_with, list(
            %>%, list(%>%, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                list(::, flextable, align), "left", "header")), 
                list(width, 8)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(fontsize, 
                8, "header")), list(ph_location, 6.3, 1))), list(
            ph_with, list(%>%, list(%>%, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                  nrow = 0, ncol = 1)), names(aux) = texte, return(aux)), 
                  list(flextable)), list(border_remove)), list(
                  list(::, flextable, align), "left", "header")), 
                list(width, 8)), list(height, 0.3, "header")), 
                list(font, "Calibri", "header")), list(fontsize, 
                8, "header")), list(ph_location, 6, 1)))), list(
            =, PPT_DELTA, list(%>%, list(%>%, list(%>%, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, PPT_DELTA, list(add_slide, 
                    "Title Slide", "Office Theme")), list(ph_with, 
                    list(external_img, fichier_niv, list(/, 10, 
                      3), 5), list(ph_location, 1.5, 0), FALSE)), 
                  list(ph_with, list(external_img, fichier_var_7, 
                    list(/, 10, 3), 5), list(ph_location, 1.5, 
                    list(/, 10, 3)), FALSE)), list(ph_with, list(
                  external_img, fichier_var_fixe, list(/, 10, 
                    3), 5), list(ph_location, 1.5, list(/, 20, 
                  3)), FALSE)), list(ph_with, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                    list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                      list(list(::, flextable, align), "center", 
                        "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 10)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  0.5, 0))), list(ph_with, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "center", 
                      "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 3)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  1.5, list(/, 1, 6)))), list(ph_with, list(%>%, 
                  list(%>%, list(%>%, list(%>%, list(%>%, list(
                    %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                      nrow = 0, ncol = 1)), names(aux) = texte, 
                      return(aux)), list(flextable)), list(border_remove)), 
                      list(list(::, flextable, align), "center", 
                        "header")), list(bold, "header")), list(
                    color, "white", "header")), list(bg, list(
                    rgb, 0, 0, list(/, 128, 255)), "header")), 
                    list(width, 3)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(ph_location, 
                  1.5, 3.5))), list(ph_with, list(%>%, list(%>%, 
                list(%>%, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "center", 
                    "header")), list(bold, "header")), list(color, 
                  "white", "header")), list(bg, list(rgb, 0, 
                  0, list(/, 128, 255)), "header")), list(width, 
                  3)), list(height, 0.3, "header")), list(font, 
                "Calibri", "header")), list(ph_location, 1.5, 
                list(+, 6, list(/, 5, 6))))), list(ph_with, list(
                %>%, list(%>%, list(%>%, list(%>%, list(%>%, 
                  list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                  list(list(::, flextable, align), "left", "header")), 
                  list(width, 8)), list(height, 0.3, "header")), 
                  list(font, "Calibri", "header")), list(fontsize, 
                  8, "header")), list(ph_location, 6.3, 1))), 
                list(ph_with, list(%>%, list(%>%, list(%>%, list(
                  %>%, list(%>%, list(%>%, list(%>%, list(aux = data.frame(matrix(NA, 
                    nrow = 0, ncol = 1)), names(aux) = texte, 
                    return(aux)), list(flextable)), list(border_remove)), 
                    list(list(::, flextable, align), "left", 
                      "header")), list(width, 8)), list(height, 
                  0.3, "header")), list(font, "Calibri", "header")), 
                  list(fontsize, 8, "header")), list(ph_location, 
                  6, 1)))))), list(=, path_ppt_evo, list(paste0, 
        chemin_sortie_heatmaps, list(Sys.Date), " - heatmap tp (donnees drees) - evolution_65.pptx")), 
    list(if, list(file.exists, path_ppt_evo), list(file.remove, 
        path_ppt_delta)), list(print, PPT_EVO, path_ppt_evo), 
    list(=, path_ppt_delta, list(paste0, chemin_sortie_heatmaps, 
        list(Sys.Date), " - heatmap tp (donnees drees) - delta_65.pptx")), 
    list(if, list(file.exists, path_ppt_delta), list(file.remove, 
        path_ppt_delta)), list(print, PPT_DELTA, path_ppt_delta), 
    list(print, list(gc, T)), list(print, "Comparaison SPF"), 
    list(<-, path_config, "src/"), list(=, jour_date, list(Sys.Date)), 
    list(=, date_AAAAMMJJ, list(format, jour_date, "%Y%m%d")), 
    list(=, date_AAMMJJ, list(substr, date_AAAAMMJJ, 3, 8)), 
    list(<-, annee, list(list(::, lubridate, year), jour_date)), 
    list(=, date_dataset, list(as.Date, date_AAAAMMJJ, "%Y%m%d")), 
    list(=, jour_prev_update, list(-, list(Sys.Date), 1)), list(
        =, MoisAAAA, list(c, "Mai2020", "Juin2020", "Juillet2020", 
            "Aout2020", "Septembre2020", "Octobre2020", "Novembre2020", 
            "Decembre2020", "Janvier2021", "Fevrier2021", "Mars2021", 
            "Avril2021")), list(=, YYYY.mm, list(c, "2020.5", 
        "2020.6", "2020.7", "2020.8", "2020.9", "2020.10", "2020.11", 
        "2020.12", "2021.1", "2021.2", "2021.3", "2021.4")), 
    list(=, date_vars, list(c, "day_prelev", "day_valid", "day_extract_sidep")), 
    list(=, posixct_vars, list(c, "date_prelev", "date_valid", 
        "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(library, 
        data.table), list(library, ggplot2), list(library, plotly), 
    list(=, drees_ti_reg, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - data_reg_ti.csv"), "UTF-8")), list(
        =, drees_ti_dep, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
            list(Sys.Date), " - data_dep_ti.csv"), "UTF-8")), 
    list(=, drees_tp_reg, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - data_reg_tp.csv"), "UTF-8")), list(
        =, drees_tp_dep, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
            list(Sys.Date), " - data_dep_tp.csv"), "UTF-8")), 
    list(=, spf_dep, list(fread, "/production/echange/spf_vm_sidep/raw/sp_ti_tp_7j_dep.csv", 
        "UTF-8")), list([, spf_dep, spf_dep[, `:=`(ti_spf, P/pop * 
        1e+05)], list(:=, ti_spf, list(*, list(/, P, pop), 1e+05))), 
    list([, spf_dep, spf_dep[, `:=`(tp_spf, P/T)], list(:=, tp_spf, 
        list(/, P, T))), list([, spf_dep, spf_dep[, `:=`(semaine_glissante, 
        substr(semaine_glissante, nchar(semaine_glissante) - 
            9, nchar(semaine_glissante)))], list(:=, semaine_glissante, 
        list(substr, semaine_glissante, list(-, list(nchar, semaine_glissante), 
            9), list(nchar, semaine_glissante)))), list(=, spf_reg, 
        list(fread, "/production/echange/spf_vm_sidep/raw/sp_ti_tp_7j_reg.csv", 
            "UTF-8")), list([, spf_reg, spf_reg[, `:=`(ti_spf, 
        P/pop * 1e+05)], list(:=, ti_spf, list(*, list(/, P, 
        pop), 1e+05))), list([, spf_reg, spf_reg[, `:=`(tp_spf, 
        P/T)], list(:=, tp_spf, list(/, P, T))), list([, spf_reg, 
        spf_reg[, `:=`(semaine_glissante, substr(semaine_glissante, 
            nchar(semaine_glissante) - 9, nchar(semaine_glissante)))], 
        list(:=, semaine_glissante, list(substr, semaine_glissante, 
            list(-, list(nchar, semaine_glissante), 9), list(
                nchar, semaine_glissante)))), list([, drees_ti_reg, 
        drees_ti_reg[, `:=`(date, as.character(date))], list(
            :=, date, list(as.character, date))), list(=, compar_ti_reg, 
        list(merge, list([, drees_ti_reg, drees_ti_reg[, c("date", 
            "reg", "ti")], list(c, "date", "reg", "ti")), list(
            [, spf_reg, spf_reg[, c("semaine_glissante", "reg", 
                "nom_region", "ti_spf")], list(c, "semaine_glissante", 
                "reg", "nom_region", "ti_spf")), list(c, "date", 
            "reg"), list(c, "semaine_glissante", "reg"), T)), 
    list([, compar_ti_reg, compar_ti_reg[, `:=`(ti_drees, ti)], 
        list(:=, ti_drees, ti)), list([, compar_ti_reg, compar_ti_reg[, 
        `:=`(date, as.Date(date))], list(:=, date, list(as.Date, 
        date))), list(pdf, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check ti reg.pdf")), list(for, NOM_REG, 
        list(na.omit, list(unique, list($, compar_ti_reg, nom_region))), 
        list(list(=, tg, list([, compar_ti_reg, list(==, reg, 
            list(as.numeric, list(unique, list([, compar_ti_reg, 
                list(==, nom_region, NOM_REG), list(c, "reg"))))), 
            list(c, "date", "ti_spf", "ti_drees"))), list(print, 
            list(+, list(+, list(+, list(+, list(+, list(ggplot), 
                list(geom_line, list(melt, tg, "date"), list(
                  aes, date, value, variable, variable), 1)), 
                list(scale_color_manual, list(c, list(rgb, 0, 
                  0, list(/, 128, 255)), list(rgb, 1, list(/, 
                  102, 255), 0)))), list(theme, "bottom", list(
                element_blank), list(element_blank))), list(labs, 
                list(paste0, "Taux d'incidence - ", NOM_REG))), 
                list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, drees_ti_dep, drees_ti_dep[, `:=`(date, 
        as.character(date))], list(:=, date, list(as.character, 
        date))), list(=, compar_ti_dep, list(merge, list([, drees_ti_dep, 
        drees_ti_dep[, c("date", "departement", "ti", "libelle")], 
        list(c, "date", "departement", "ti", "libelle")), list(
        [, spf_dep, spf_dep[, c("semaine_glissante", "dep", "ti_spf")], 
        list(c, "semaine_glissante", "dep", "ti_spf")), list(
        c, "date", "departement"), list(c, "semaine_glissante", 
        "dep"), T)), list([, compar_ti_dep, compar_ti_dep[, `:=`(ti_drees, 
        ti)], list(:=, ti_drees, ti)), list([, compar_ti_dep, 
        compar_ti_dep[, `:=`(date, as.Date(date))], list(:=, 
            date, list(as.Date, date))), list(pdf, list(paste0, 
        path, "data/sorties/compar drees spf/", list(Sys.Date), 
        " - check ti dep.pdf")), list(for, NOM_DEP, list(na.omit, 
        list(unique, list($, compar_ti_dep, libelle))), list(
        list(=, tg, list([, compar_ti_dep, list(==, libelle, 
            NOM_DEP), list(c, "date", "ti_spf", "ti_drees"))), 
        list(print, list(+, list(+, list(+, list(+, list(+, list(
            ggplot), list(geom_line, list(melt, tg, "date"), 
            list(aes, date, value, variable, variable), 1)), 
            list(scale_color_manual, list(c, list(rgb, 0, 0, 
                list(/, 128, 255)), list(rgb, 1, list(/, 102, 
                255), 0)))), list(theme, "bottom", list(element_blank), 
            list(element_blank))), list(labs, list(paste0, "Taux d'incidence - ", 
            NOM_DEP))), list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, spf_reg, list(==, nom_region, "Ile-de-France"), 
        list(:=, nom_region, "Île-de-France")), list([, spf_reg, 
        list(==, nom_region, "Centre-Val de Loire"), list(:=, 
            nom_region, "Centre Val-de-Loire")), list([, spf_reg, 
        list(==, nom_region, "Grand Est"), list(:=, nom_region, 
            "Grand-Est")), list([, spf_reg, list(==, nom_region, 
        "Nouvelle-Aquitaine"), list(:=, nom_region, "Nouvelle Aquitaine")), 
    list(=, drees_tp_reg, list([, drees_tp_reg, list(!=, nom_reg, 
        "Région inconnue"))), list([, drees_tp_reg, drees_tp_reg[, 
        `:=`(date, as.character(date))], list(:=, date, list(
        as.character, date))), list(=, compar_tp_reg, list(merge, 
        list([, drees_tp_reg, drees_tp_reg[, c("date", "nom_reg", 
            "tp")], list(c, "date", "nom_reg", "tp")), list([, 
            spf_reg, spf_reg[, c("semaine_glissante", "reg", 
                "nom_region", "tp_spf")], list(c, "semaine_glissante", 
                "reg", "nom_region", "tp_spf")), list(c, "date", 
            "nom_reg"), list(c, "semaine_glissante", "nom_region"), 
        T)), list([, compar_tp_reg, compar_tp_reg[, `:=`(tp_drees, 
        tp)], list(:=, tp_drees, tp)), list([, compar_tp_reg, 
        compar_tp_reg[, `:=`(date, as.Date(date))], list(:=, 
            date, list(as.Date, date))), list(pdf, list(paste0, 
        path, "data/sorties/compar drees spf/", list(Sys.Date), 
        " - check tp reg.pdf")), list(for, NOM_REG, list(na.omit, 
        list(unique, list($, compar_tp_reg, nom_reg))), list(
        list(=, tg, list([, compar_tp_reg, list(==, nom_reg, 
            NOM_REG), list(c, "date", "tp_spf", "tp_drees"))), 
        list(print, list(+, list(+, list(+, list(+, list(+, list(
            ggplot), list(geom_line, list(melt, tg, "date"), 
            list(aes, date, value, variable, variable), 1)), 
            list(scale_color_manual, list(c, list(rgb, 0, 0, 
                list(/, 128, 255)), list(rgb, 1, list(/, 102, 
                255), 0)))), list(theme, "bottom", list(element_blank), 
            list(element_blank))), list(labs, list(paste0, "Taux de positivité - ", 
            NOM_REG))), list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, drees_tp_dep, drees_tp_dep[, `:=`(date, 
        as.character(date))], list(:=, date, list(as.character, 
        date))), list(=, compar_tp_dep, list(merge, list([, drees_tp_dep, 
        drees_tp_dep[, c("date", "departement", "tp", "libelle")], 
        list(c, "date", "departement", "tp", "libelle")), list(
        [, spf_dep, spf_dep[, c("semaine_glissante", "dep", "tp_spf")], 
        list(c, "semaine_glissante", "dep", "tp_spf")), list(
        c, "date", "departement"), list(c, "semaine_glissante", 
        "dep"), T)), list([, compar_tp_dep, compar_tp_dep[, `:=`(tp_drees, 
        tp)], list(:=, tp_drees, tp)), list([, compar_tp_dep, 
        compar_tp_dep[, `:=`(date, as.Date(date))], list(:=, 
            date, list(as.Date, date))), list(pdf, list(paste0, 
        path, "data/sorties/compar drees spf/", list(Sys.Date), 
        " - check tp dep.pdf")), list(for, NOM_DEP, list(na.omit, 
        list(unique, list($, compar_tp_dep, libelle))), list(
        list(=, tg, list([, compar_tp_dep, list(==, libelle, 
            NOM_DEP), list(c, "date", "tp_spf", "tp_drees"))), 
        list(print, list(+, list(+, list(+, list(+, list(+, list(
            ggplot), list(geom_line, list(melt, tg, "date"), 
            list(aes, date, value, variable, variable), 1)), 
            list(scale_color_manual, list(c, list(rgb, 0, 0, 
                list(/, 128, 255)), list(rgb, 1, list(/, 102, 
                255), 0)))), list(theme, "bottom", list(element_blank), 
            list(element_blank))), list(labs, list(paste0, "Taux de positivité - ", 
            NOM_DEP))), list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, drees_tp_reg, drees_tp_reg[, `:=`(date, 
        as.Date(date))], list(:=, date, list(as.Date, date))), 
    list(list(::, htmlwidgets, saveWidget), list(ggplotly, list(
        +, list(+, list(+, list(ggplot), list(geom_line, list(
            [, drees_tp_reg, list(!, list(%in%, nom_reg, list(
                c, "La Réunion", "Guadeloupe", "Martinique", 
                "Mayotte", "Guyane", "Région inconnue")))), list(
            aes, date, tp, nom_reg, nom_reg), 1)), list(theme, 
            "bottom", list(element_blank), list(element_blank))), 
        list(labs, list(paste0, "Taux de positivité des tests")))), 
        list(paste0, path, "data/sorties/compar drees spf/", 
            list(Sys.Date), " - tp par région longue période.html")), 
    list(print, list(gc, T)), list(<-, path_config, "src/"), 
    list(=, jour_date, list(Sys.Date)), list(=, date_AAAAMMJJ, 
        list(format, jour_date, "%Y%m%d")), list(=, date_AAMMJJ, 
        list(substr, date_AAAAMMJJ, 3, 8)), list(<-, annee, list(
        list(::, lubridate, year), jour_date)), list(=, date_dataset, 
        list(as.Date, date_AAAAMMJJ, "%Y%m%d")), list(=, jour_prev_update, 
        list(-, list(Sys.Date), 1)), list(=, MoisAAAA, list(c, 
        "Mai2020", "Juin2020", "Juillet2020", "Aout2020", "Septembre2020", 
        "Octobre2020", "Novembre2020", "Decembre2020", "Janvier2021", 
        "Fevrier2021", "Mars2021", "Avril2021")), list(=, YYYY.mm, 
        list(c, "2020.5", "2020.6", "2020.7", "2020.8", "2020.9", 
            "2020.10", "2020.11", "2020.12", "2021.1", "2021.2", 
            "2021.3", "2021.4")), list(=, date_vars, list(c, 
        "day_prelev", "day_valid", "day_extract_sidep")), list(
        =, posixct_vars, list(c, "date_prelev", "date_valid", 
            "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(library, 
        data.table), list(library, ggplot2), list(library, plotly), 
    list(=, drees_tp_reg, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - data_reg_tp_65.csv"), "UTF-8")), 
    list(=, drees_tp_dep, list(fread, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - data_dep_tp_65.csv"), "UTF-8")), 
    list(=, spf_dep, list(fread, "/production/echange/spf_vm_sidep/raw/sp_ti_tp_7j_dep_65.csv", 
        "UTF-8")), list([, spf_dep, spf_dep[, `:=`(pop, as.numeric(sub(",", 
        ".", pop)))], list(:=, pop, list(as.numeric, list(sub, 
        ",", ".", pop)))), list([, spf_dep, spf_dep[, `:=`(ti_spf, 
        P/pop * 1e+05)], list(:=, ti_spf, list(*, list(/, P, 
        pop), 1e+05))), list([, spf_dep, spf_dep[, `:=`(tp_spf, 
        P/T)], list(:=, tp_spf, list(/, P, T))), list([, spf_dep, 
        spf_dep[, `:=`(semaine_glissante, substr(semaine_glissante, 
            nchar(semaine_glissante) - 9, nchar(semaine_glissante)))], 
        list(:=, semaine_glissante, list(substr, semaine_glissante, 
            list(-, list(nchar, semaine_glissante), 9), list(
                nchar, semaine_glissante)))), list(=, spf_reg, 
        list(fread, "/production/echange/spf_vm_sidep/raw/sp_ti_tp_7j_reg_65.csv", 
            "UTF-8")), list([, spf_reg, spf_reg[, `:=`(pop, as.numeric(sub(",", 
        ".", pop)))], list(:=, pop, list(as.numeric, list(sub, 
        ",", ".", pop)))), list([, spf_reg, spf_reg[, `:=`(ti_spf, 
        P/pop * 1e+05)], list(:=, ti_spf, list(*, list(/, P, 
        pop), 1e+05))), list([, spf_reg, spf_reg[, `:=`(tp_spf, 
        P/T)], list(:=, tp_spf, list(/, P, T))), list([, spf_reg, 
        spf_reg[, `:=`(semaine_glissante, substr(semaine_glissante, 
            nchar(semaine_glissante) - 9, nchar(semaine_glissante)))], 
        list(:=, semaine_glissante, list(substr, semaine_glissante, 
            list(-, list(nchar, semaine_glissante), 9), list(
                nchar, semaine_glissante)))), list([, spf_reg, 
        list(==, nom_region, "Ile-de-France"), list(:=, nom_region, 
            "Île-de-France")), list([, spf_reg, list(==, nom_region, 
        "Centre-Val de Loire"), list(:=, nom_region, "Centre Val-de-Loire")), 
    list([, spf_reg, list(==, nom_region, "Grand Est"), list(
        :=, nom_region, "Grand-Est")), list([, spf_reg, list(
        ==, nom_region, "Nouvelle-Aquitaine"), list(:=, nom_region, 
        "Nouvelle Aquitaine")), list(=, drees_tp_reg, list([, 
        drees_tp_reg, list(!=, nom_reg, "Région inconnue"))), 
    list([, drees_tp_reg, drees_tp_reg[, `:=`(date, as.character(date))], 
        list(:=, date, list(as.character, date))), list(=, compar_tp_reg, 
        list(merge, list([, drees_tp_reg, drees_tp_reg[, c("date", 
            "nom_reg", "tp")], list(c, "date", "nom_reg", "tp")), 
            list([, spf_reg, spf_reg[, c("semaine_glissante", 
                "reg", "nom_region", "tp_spf")], list(c, "semaine_glissante", 
                "reg", "nom_region", "tp_spf")), list(c, "date", 
                "nom_reg"), list(c, "semaine_glissante", "nom_region"), 
            T)), list([, compar_tp_reg, compar_tp_reg[, `:=`(tp_drees, 
        tp)], list(:=, tp_drees, tp)), list([, compar_tp_reg, 
        compar_tp_reg[, `:=`(date, as.Date(date))], list(:=, 
            date, list(as.Date, date))), list(pdf, list(paste0, 
        path, "data/sorties/compar drees spf/", list(Sys.Date), 
        " - check tp reg - 65.pdf")), list(for, NOM_REG, list(
        na.omit, list(unique, list($, compar_tp_reg, nom_reg))), 
        list(list(=, tg, list([, compar_tp_reg, list(==, nom_reg, 
            NOM_REG), list(c, "date", "tp_spf", "tp_drees"))), 
            list(print, list(+, list(+, list(+, list(+, list(
                +, list(ggplot), list(geom_line, list(melt, tg, 
                  "date"), list(aes, date, value, variable, variable), 
                  1)), list(scale_color_manual, list(c, list(
                rgb, 0, 0, list(/, 128, 255)), list(rgb, 1, list(
                /, 102, 255), 0)))), list(theme, "bottom", list(
                element_blank), list(element_blank))), list(labs, 
                list(paste0, "Taux de positivité - ", NOM_REG))), 
                list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, drees_tp_dep, drees_tp_dep[, `:=`(date, 
        as.character(date))], list(:=, date, list(as.character, 
        date))), list(=, compar_tp_dep, list(merge, list([, drees_tp_dep, 
        drees_tp_dep[, c("date", "departement", "tp", "libelle")], 
        list(c, "date", "departement", "tp", "libelle")), list(
        [, spf_dep, spf_dep[, c("semaine_glissante", "dep", "tp_spf")], 
        list(c, "semaine_glissante", "dep", "tp_spf")), list(
        c, "date", "departement"), list(c, "semaine_glissante", 
        "dep"), T)), list([, compar_tp_dep, compar_tp_dep[, `:=`(tp_drees, 
        tp)], list(:=, tp_drees, tp)), list([, compar_tp_dep, 
        compar_tp_dep[, `:=`(date, as.Date(date))], list(:=, 
            date, list(as.Date, date))), list(pdf, list(paste0, 
        path, "data/sorties/compar drees spf/", list(Sys.Date), 
        " - check tp dep - 65.pdf")), list(for, NOM_DEP, list(
        na.omit, list(unique, list($, compar_tp_dep, libelle))), 
        list(list(=, tg, list([, compar_tp_dep, list(==, libelle, 
            NOM_DEP), list(c, "date", "tp_spf", "tp_drees"))), 
            list(print, list(+, list(+, list(+, list(+, list(
                +, list(ggplot), list(geom_line, list(melt, tg, 
                  "date"), list(aes, date, value, variable, variable), 
                  1)), list(scale_color_manual, list(c, list(
                rgb, 0, 0, list(/, 128, 255)), list(rgb, 1, list(
                /, 102, 255), 0)))), list(theme, "bottom", list(
                element_blank), list(element_blank))), list(labs, 
                list(paste0, "Taux de positivité - ", NOM_DEP))), 
                list(xlab, "Date (SPF : prélèvement ; Drees : résultat)"))))), 
    list(dev.off), list([, drees_tp_reg, drees_tp_reg[, `:=`(date, 
        as.Date(date))], list(:=, date, list(as.Date, date))), 
    list(list(::, htmlwidgets, saveWidget), list(ggplotly, list(
        +, list(+, list(+, list(ggplot), list(geom_line, list(
            [, drees_tp_reg, list(!, list(%in%, nom_reg, list(
                c, "La Réunion", "Guadeloupe", "Martinique", 
                "Mayotte", "Guyane", "Région inconnue")))), list(
            aes, date, tp, nom_reg, nom_reg), 1)), list(theme, 
            "bottom", list(element_blank), list(element_blank))), 
        list(labs, list(paste0, "Taux de positivité des tests - 65 ans et plus")))), 
        list(paste0, path, "data/sorties/compar drees spf/", 
            list(Sys.Date), " - tp par région longue période - 65.html")), 
    list(print, list(gc, T)), list(print, "09"), list(print, 
        list(gc, T)), list(<-, path_config, "src/"), list(=, 
        jour_date, list(Sys.Date)), list(=, date_AAAAMMJJ, list(
        format, jour_date, "%Y%m%d")), list(=, date_AAMMJJ, list(
        substr, date_AAAAMMJJ, 3, 8)), list(<-, annee, list(list(
        ::, lubridate, year), jour_date)), list(=, date_dataset, 
        list(as.Date, date_AAAAMMJJ, "%Y%m%d")), list(=, jour_prev_update, 
        list(-, list(Sys.Date), 1)), list(=, MoisAAAA, list(c, 
        "Mai2020", "Juin2020", "Juillet2020", "Aout2020", "Septembre2020", 
        "Octobre2020", "Novembre2020", "Decembre2020", "Janvier2021", 
        "Fevrier2021", "Mars2021", "Avril2021")), list(=, YYYY.mm, 
        list(c, "2020.5", "2020.6", "2020.7", "2020.8", "2020.9", 
            "2020.10", "2020.11", "2020.12", "2021.1", "2021.2", 
            "2021.3", "2021.4")), list(=, date_vars, list(c, 
        "day_prelev", "day_valid", "day_extract_sidep")), list(
        =, posixct_vars, list(c, "date_prelev", "date_valid", 
            "date_valid_init")), list(=, char_vars, list(c, "Pseudonyme", 
        "FINESS_ET", "FINESS_EJ", "TypologiePatient", "PremierSymptomes", 
        "IRIS", "cat_etb", "Resultat", "departement", "CodePostal", 
        "fi_init", "RPPSTraitant", "RPPSPrescripteur", "ProfessionelSante", 
        "reg", "AnalyseConclusion", "Sexe", "TypeAnalyse", "Statut", 
        "valeur", "cat_pp", "nom_reg", "CodePays", "CPAdresseTemporaire", 
        "FINESSGeographique", "NumDepartementAdresseTemporaire", 
        "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
        "NumCampagneDepistage")), list(=, daily_files_char_vars, 
        list(c, "Pseudonyme", "Pseudo1", "Pseudo2", "Sexe", "CodePostal", 
            "IRIS", "NumDossier", "TypologiePatient", "ProfessionelSante", 
            "PremierSymptomes", "FINESS", "RPPSTraitant", "RPPSPrescripteur", 
            "DatePrelevement", "DateValidationCR", "AnalyseConclusion", 
            "TypeAnalyse", "Resultat", "Statut", "CodePays", 
            "CPAdresseTemporaire", "NumDepartementAdresseTemporaire", 
            "CodePaysAdresseTemporaire", "CodePaysVoyageEtranger", 
            "FINESSGeographique", "NumCampagneDepistage", "Joker1", 
            "Joker2", "Joker3")), list(=, new_tag_char_vars, 
        list(c, "RPPSPrelevTA", "AdeliPrelevTA", "idNATPrelevTA", 
            "CPPrelevTA")), list(=, run_expertise, T), list(=, 
        JP2_fromJm1P1, F), list(=, Jm1, list(format, list(-, 
        list(Sys.Date), 1), "%Y%m%d")), list(=, check_collision_p1p2, 
        F), list(=, rewrite_fichier_variants, F), list(=, addP2, 
        T), list(=, tempo, "j"), list(<-, metadata, list(list(
        ::, yaml, yaml.load_file), list(paste0, path_config, 
        "config.yaml"))), list(for, i, list(names, metadata), 
        list(list(assign, i, list([[, metadata, i)))), list(=, 
        path_fabrice, list(paste0, path, "data/sorties/dossier_quotidien_fabrice/")), 
    list(if, list(!, list(dir.exists, list(paste0, path_fabrice, 
        list(Sys.Date)))), list(dir.create, list(paste0, path_fabrice, 
        list(Sys.Date)))), list(=, path_fabrice_du_jour, list(
        paste0, path_fabrice, list(Sys.Date), "/")), list(file.copy, 
        list(paste0, path, "data/verifs/", list(Sys.Date), "_sidep_par_patient.xlsx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_par_patient.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/verifs/", 
        list(Sys.Date), "_sidep_par_patient_bis.xlsx"), list(
        paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_par_patient_bis.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/expertise/", 
        date_AAAAMMJJ, "_expertise_donnees_du_jour.docx"), list(
        paste0, path_fabrice_du_jour, list(Sys.Date), "_expertise_donnees_du_jour.docx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_antigenique_valid_65+.xlsx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_antigenique_valid_65+.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_pcr_valid_65+.xlsx"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), "_sidep_pcr_valid_65+.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_pcr_sal_mil_valid_65+.xlsx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_pcr_sal_mil_valid_65+.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_antigenique_valid.xlsx"), list(
        paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_antigenique_valid.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_pcr_valid.xlsx"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), "_sidep_pcr_valid.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/nb_tests/", 
        date_AAAAMMJJ, "_sidep_pcr_sal_mil_valid.xlsx"), list(
        paste0, path_fabrice_du_jour, list(Sys.Date), "_sidep_pcr_sal_mil_valid.xlsx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap ti (donnees drees) - evolution.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap ti (donnees drees) - evolution.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap ti (donnees drees) - delta.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap ti (donnees drees) - delta.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap tp (donnees drees) - evolution.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap tp (donnees drees) - evolution.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap tp (donnees drees) - delta.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap tp (donnees drees) - delta.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap tp (donnees drees) - evolution_65.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap tp (donnees drees) - evolution_65.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/heatmaps/", 
        list(Sys.Date), " - heatmap tp (donnees drees) - delta_65.pptx"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - heatmap tp (donnees drees) - delta_65.pptx"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check ti reg.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check ti reg.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check ti dep.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check ti dep.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check tp reg.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check tp reg.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check tp dep.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check tp dep.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check tp reg - 65.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check tp reg - 65.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - check tp dep - 65.pdf"), list(paste0, 
        path_fabrice_du_jour, list(Sys.Date), " - check tp dep - 65.pdf"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - tp par région longue période.html"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - tp par région longue période.html"), 
        T), list(file.copy, list(paste0, path, "data/sorties/compar drees spf/", 
        list(Sys.Date), " - tp par région longue période - 65.html"), 
        list(paste0, path_fabrice_du_jour, list(Sys.Date), " - tp par région longue période - 65.html"), 
        T), list(list(::, zip, zipr), list(paste0, path_fabrice, 
        list(Sys.Date), "_export_quotidien_sidep.zip"), list(
        paste0, path_fabrice_du_jour, list(dir, path_fabrice_du_jour))), 
    list(file.remove, list(paste0, path_fabrice_du_jour, list(
        dir, path_fabrice_du_jour))), list(file.remove, list(
        paste0, path_fabrice, list(Sys.Date))), list(print, "prep fichier 2"), 
    list(print, list(gc, T)), list(library, openxlsx), list(=, 
        t1, list(setDT, list(read.xlsx, list(paste0, path, "data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_pcr_valid.xlsx"), "national", 
            T))), list(=, t2, list(setDT, list(read.xlsx, list(
        paste0, path, "data/sorties/nb_tests/", date_AAAAMMJJ, 
        "_sidep_antigenique_valid.xlsx"), "national", T))), list(
        =, t3, list(setDT, list(read.xlsx, list(paste0, path, 
            "data/sorties/nb_tests/", date_AAAAMMJJ, "_sidep_pcr_sal_mil_valid.xlsx"), 
            "national", T))), list(=, t, list(merge, t1, list(
        [, t2, t2[, c("date", "nb_pos", "prop_pos_PNIX", "nb_tot")], 
        list(c, "date", "nb_pos", "prop_pos_PNIX", "nb_tot")), 
        "date", T)), list(=, t, list(merge, t, list([, t3, t3[, 
        c("date", "nb_pos", "prop_pos_PNIX", "nb_tot")], list(
        c, "date", "nb_pos", "prop_pos_PNIX", "nb_tot")), "date", 
        T)), list(=, t1, list(setDT, list(read.xlsx, list(paste0, 
        path, "data/sorties/nb_tests/", date_AAAAMMJJ, "_sidep_pcr_valid_65+.xlsx"), 
        "national", T))), list(=, t2, list(setDT, list(read.xlsx, 
        list(paste0, path, "data/sorties/nb_tests/", date_AAAAMMJJ, 
            "_sidep_antigenique_valid_65+.xlsx"), "national", 
        T))), list(=, t3, list(setDT, list(read.xlsx, list(paste0, 
        path, "data/sorties/nb_tests/", date_AAAAMMJJ, "_sidep_pcr_sal_mil_valid_65+.xlsx"), 
        "national", T))), list(=, t_65, list(merge, t1, list(
        [, t2, t2[, c("date", "nb_pos", "prop_pos_PNIX", "nb_tot")], 
        list(c, "date", "nb_pos", "prop_pos_PNIX", "nb_tot")), 
        "date", T)), list(=, t_65, list(merge, t_65, list([, 
        t3, t3[, c("date", "nb_pos", "prop_pos_PNIX", "nb_tot")], 
        list(c, "date", "nb_pos", "prop_pos_PNIX", "nb_tot")), 
        "date", T)), list(=, modele_fichier, list(loadWorkbook, 
        list(paste0, path, "src/utils/Modèle fichier 2 note quotidienne.xlsx"))), 
    list(writeData, modele_fichier, "national brut", t), list(
        writeData, modele_fichier, "national 65+ brut", t_65), 
    list(saveWorkbook, modele_fichier, list(paste0, path, "data/sorties/dossier_quotidien_fabrice/", 
        list(Sys.Date), " - fichier 2 note quotidienne.xlsx"), 
        T), list(print, "prep fichier 1"), list(print, list(gc, 
        T)), list(library, openxlsx), list(=, t1, list(setDT, 
        list(read.xlsx, list(paste0, path, "data/verifs/", list(
            Sys.Date), "_sidep_par_patient.xlsx"), "date_valid", 
            T))), list(=, t1, list([, t1, list(&, list(!, list(
        is.na, day_valid_init)), list(!=, day_valid_init, "")), 
        list(c, "day_valid_init", "nb_pos_patients"))), list(
        [, t1, t1[, `:=`(day_valid_init, seq.Date(from = as.Date("2020-05-21"), 
            by = 1, length.out = dim(t1)[1]))], list(:=, day_valid_init, 
            list(seq.Date, list(as.Date, "2020-05-21"), 1, list(
                [, list(dim, t1), 1)))), list(=, t1, list([, 
        t1, list(<=, day_valid_init, list(Sys.Date)))), list(
        =, t1, list(rbind, t1, list(data.frame, list(as.Date, 
            "2020-05-20"), NA))), list(setorder, t1, day_valid_init), 
    list(setnames, t1, "day_valid_init", "Date"), list(setnames, 
        t1, "nb_pos_patients", "Série PCR Drees dédoublonnée"), 
    list(=, t2, list(setDT, list(read.xlsx, list(paste0, path, 
        "data/sorties/nb_tests/", date_AAAAMMJJ, "_sidep_antigenique_valid.xlsx"), 
        "national", T))), list(=, t2, list([, t2, t2[, c("date", 
        "nb_pos")], list(c, "date", "nb_pos"))), list([, t2, 
        t2[, `:=`(date, date + 1)], list(:=, date, list(+, date, 
            1))), list(setnames, t2, "date", "Date"), list(setnames, 
        t2, "nb_pos", "Série TAG Drees non dédoublonnée"), list(
        =, t_all, list(merge, t1, t2, T, "Date")), list(=, t3, 
        list(setDT, list(read.xlsx, list(paste0, path, "data/sorties/nb_tests/", 
            date_AAAAMMJJ, "_sidep_pcr_sal_mil_valid.xlsx"), 
            "national", T))), list(=, t3, list([, t3, t3[, c("date", 
        "nb_pos")], list(c, "date", "nb_pos"))), list([, t3, 
        t3[, `:=`(date, date + 1)], list(:=, date, list(+, date, 
            1))), list(setnames, t3, "date", "Date"), list(setnames, 
        t3, "nb_pos", "Série salmil Drees non dédoublonnée"), 
    list(=, t_all, list(merge, t_all, t3, T, "Date")), list(=, 
        t4, list(setDT, list(read.xlsx, list(paste0, path, "data/verifs/", 
            list(Sys.Date), "_sidep_par_patient_bis.xlsx"), "date_valid", 
            T))), list(=, t4, list([, t4, list(&, list(!, list(
        is.na, day_valid_init)), list(!=, day_valid_init, "")), 
        list(c, "day_valid_init", "nb_pos_patients"))), list(
        [, t4, t4[, `:=`(day_valid_init, seq.Date(from = as.Date("2020-05-21"), 
            by = 1, length.out = dim(t1)[1]))], list(:=, day_valid_init, 
            list(seq.Date, list(as.Date, "2020-05-21"), 1, list(
                [, list(dim, t1), 1)))), list(=, t4, list([, 
        t4, list(<=, day_valid_init, list(Sys.Date)))), list(
        =, t4, list(rbind, t4, list(data.frame, list(as.Date, 
            "2020-05-20"), NA))), list(setorder, t4, day_valid_init), 
    list(setnames, t4, "day_valid_init", "Date"), list(setnames, 
        t4, "nb_pos_patients", "Série PCR Drees dédoublonnée PCR + TAG + salivaires"), 
    list(=, t_all, list(merge, t_all, t4, T, "Date")), list(=, 
        t5, list(setDT, list(read.xlsx, list(paste0, path, "data/sorties/variants/", 
            date_AAAAMMJJ, " table_pcr_variants - avec graphiques.xlsx"), 
            "PCR only", T))), list(=, t5, list([, t5, t5[, c("day_valid_init", 
        "variant_oui_quot")], list(c, "day_valid_init", "variant_oui_quot"))), 
    list([, t5, t5[, `:=`(day_valid_init, day_valid_init + 1)], 
        list(:=, day_valid_init, list(+, day_valid_init, 1))), 
    list(setnames, t5, "day_valid_init", "Date"), list(=, t_all, 
        list(merge, t_all, t5, T, "Date")), list(=, modele_fichier, 
        list(loadWorkbook, list(paste0, path, "src/utils/Modèle fichier 1 note quotidienne.xlsx"))), 
    list(writeData, modele_fichier, "input R", t_all), list(saveWorkbook, 
        modele_fichier, list(paste0, path, "data/sorties/dossier_quotidien_fabrice/", 
            list(Sys.Date), " - fichier 1 note quotidienne.xlsx"), 
        T), list(=, liste, list(dir, list(paste0, path, "data/sorties/dossier_quotidien_fabrice/export_gitlab/"))), 
    list(for, element, liste, list(file.remove, list(paste0, 
        path, "data/sorties/dossier_quotidien_fabrice/export_gitlab/", 
        element))), list(for, element, list(c, list(paste0, list(
        Sys.Date), list(c, " - fichier 1 note quotidienne.xlsx", 
        " - fichier 2 note quotidienne.xlsx", "_export_quotidien_sidep.zip", 
        "_export_quotidien_variants.zip")), list(paste0, date_AAAAMMJJ, 
        " table_pcr_variants - avec graphiques.xlsx")), list(
        list(file.copy, list(paste0, path, "data/sorties/dossier_quotidien_fabrice/", 
            element), list(paste0, path, "data/sorties/dossier_quotidien_fabrice/export_gitlab/", 
            element)))), list(if, check_collision_p1p2, list(
        list(=, p1_, list(unique, list([, new_rattrapage, list(
            !=, Pseudonyme, Pseudo2), list(c, "Pseudonyme")))), 
        list(=, p2_, list(unique, list([, new_rattrapage, list(
            !=, Pseudonyme, Pseudo2), list(c, "Pseudo2")))), 
        list(=, collisionp1p2, list(merge, p1_, p2_, "Pseudonyme", 
            "Pseudo2")), list(print, list(nrow, collisionp1p2)), 
        list(print, list(nrow, p1_)), list(print, list(nrow, 
            p2_)))))

